
# مفهوم و فرم: بانک‌ها (Banks)

---

## ۱. مفهوم

موجودیت «بانک» یک تعریف پایه و بسیار ساده در سیستم است. این موجودیت صرفاً لیستی از نام بانک‌هایی را که سازمان با آن‌ها یا مشتریان و تأمین‌کنندگان سازمان با آن‌ها کار می‌کنند، نگهداری می‌کند.

* **هدف:** این فرم به عنوان یک فهرست (List) برای انتخاب در فرم‌های دیگر (مانند تعریف حساب بانکی شرکت یا ثبت چک دریافتی از مشتری) عمل می‌کند.
* **مثال:** بانک ملت، بانک سامان، بانک ملی ایران، بانک پاسارگاد و ...

---

## ۲. فرم: تعریف بانک (Bank Definition)

این فرم معمولاً در بخش تعاریف پایه ماژول خزانه‌داری یا حسابداری قرار دارد.

**مسیر:**
`خزانه‌داری / تعاریف پایه / بانک‌ها`

### فیلدهای اطلاعاتی فرم

| نام فیلد         | نوع داده  | اجباری | توضیح                                                                        | مثال             |
| :--------------- | :-------- | :----- | :--------------------------------------------------------------------------- | :--------------- |
| **کد بانک**      | متنی/عددی | بله    | یک شناسه یکتا برای بانک (می‌تواند کد سوئیفت یا کد استاندارد بانک مرکزی باشد). | `012` (بانک ملت) |
| **نام بانک**     | متنی      | بله    | نام کامل و رسمی بانک.                                                        | `بانک ملت`       |
| **نام اختصاری**  | متنی      | خیر    | نام کوتاه یا رایج بانک.                                                      | `ملت`            |
| **لوگو (آیکون)** | تصویر     | خیر    | لوگوی بانک برای نمایش بهتر در گزارش‌ها و فرم‌ها.                               | ``               |
| **وضعیت فعال**   | بولین     | بله    | مشخص می‌کند آیا این بانک در لیست‌های انتخابی نمایش داده شود یا خیر.            | `فعال`           |

---

## ۳. کاربرد در سیستم

* هنگام تعریف «حساب بانکی» (متعلق به شرکت)، شما از این لیست، بانکِ صاحب حساب را انتخاب می‌کنید.
* هنگام ثبت «چک دریافتی» از مشتری، شما بانک صادرکننده آن چک را از این لیست انتخاب می‌کنید.
* هنگام ثبت «چک پرداختی» به تأمین‌کننده، شما بانک مقصد (در صورت نیاز) را مشخص می‌کنید.

# مفهوم و فرم: حساب‌های بانکی (Bank Accounts)

---

## ۱. مفهوم

این موجودیت یکی از **مهم‌ترین** تعاریف پایه در ماژول خزانه‌داری و حسابداری است. «حساب بانکی» در ERP تابان، نماینده یک حساب بانکی *واقعی* متعلق به یکی از **بنگاه‌های اقتصادی** شرکت شما است.

* **هدف:** مدیریت موجودی ریالی/ارزی، ردیابی تراکنش‌ها و تعریف دسته چک‌ها.
* **جایگاه در حسابداری:** هر حساب بانکی در تابان باید به یک سرفصل معین در **دفتر کل (GL)** (مثلاً: «موجودی نقد - بانک ملت شعبه مرکزی») متصل باشد. تمامی واریزها و برداشت‌ها از این حساب بانکی، به صورت خودکار سرفصل GL متناظر را بدهکار یا بستانکار می‌کنند.

> **نکته کلیدی:** یک حساب بانکی در ERP تابان، هم یک موجودیت خزانه‌داری (برای مدیریت موجودی و چک) و هم یک موجودیت حسابداری (به عنوان یک حساب معین) است.

---

## ۲. فرم: تعریف حساب بانکی (Bank Account Definition)

**مسیر:**
`خزانه‌داری / تعاریف پایه / حساب‌های بانکی`

### فیلدهای اطلاعاتی فرم

| نام فیلد | نوع داده | اجباری | توضیح | مثال |
| :--- | :--- | :--- | :--- | :--- |
| **بنگاه اقتصادی** | انتخابی (FK) | بله | بنگاه اقتصادی (شرکت) که مالک این حساب است. | `1000 - ایران خودرو مرکزی` |
| **کد حساب (داخلی)** | متنی/عددی | بله | یک شناسه کوتاه و یکتا در داخل سیستم تابان. | `MEL-100` |
| **نام حساب** | متنی | بله | نام توصیفی حساب برای استفاده در گزارش‌ها. | `حساب جاری - بانک ملت مرکزی` |
| **بانک** | انتخابی (FK) | بله | بانکی که حساب در آن قرار دارد (از فرم بانک‌ها). | `بانک ملت` |
| **شعبه بانک** | انتخابی (FK) | بله | شعبه‌ای که حساب در آن افتتاح شده (از فرم شعب). | `شعبه مرکزی` |
| **شماره حساب** | متنی | بله | شماره حساب رسمی. | `1-2345678-90` |
| **شماره شبا (IBAN)** | متنی | بله | شماره شبا جهت انتقالات بانکی (با اعتبارسنجی ساختار). | `IR...` |
| **نوع حساب** | انتخابی | بله | (جاری، پس‌انداز، ارزی، ...). | `جاری` |
| **ارز (Currency)** | انتخابی (FK) | بله | ارز پایه حساب. | `IRR` |
| **حساب معین (GL)** | انتخابی (FK) | بله | **(بسیار مهم)** سرفصل حسابداری در دفتر کل که موجودی این حساب را نشان می‌دهد. | `11010101 - بانک ملت مرکزی` |
| **حساب موقت (GL)** | انتخابی (FK) | خیر | (پیشرفته) سرفصل واسط برای مغایرت بانکی (در صورت نیاز). | `...` |
| **وضعیت** | انتخابی | بله | (فعال، مسدود، بسته شده). | `فعال` |
| **تاریخ افتتاح** | تاریخ | خیر | | `1400/01/01` |
| **موجودی اولیه** | عددی | خیر | (فقط در زمان استقرار) موجودی اولیه در تاریخ استقرار. | `1,000,000,000` |

---

## ۳. کاربرد در سیستم

* این حساب، مبدأ «پرداخت‌ها» و مقصد «دریافت‌ها» در **سند دریافت و پرداخت** است.
* موجودی این حساب با هر تراکنش (واریز، برداشت، پاس شدن چک) به‌روز می‌شود.
* **دسته چک‌ها** (Checkbooks) فقط برای حساب‌هایی از نوع «جاری» که به این فرم معرفی شده‌اند، تعریف می‌شوند.
* در فرآیند **مغایرت بانکی**، تراکنش‌های ثبت شده برای این حساب با صورتحساب واقعی بانک تطبیق داده می‌شود.

#  مفهوم و فرم: شعب بانک‌ها (Banks Branches)

---

## ۱. مفهوم

موجودیت «شعبه بانک» اطلاعات دقیق‌تری در مورد هر شعبه‌ای که شرکت در آن حساب دارد یا با آن در ارتباط است، ارائه می‌دهد. این اطلاعات هم برای حساب‌های خود شرکت و هم برای ردیابی چک‌های مشتریان (جهت وصول) کاربرد دارد.

* **هدف:** نگهداری اطلاعات آدرس، کد شعبه و اطلاعات تماس شعب بانکی.
* **ارتباط:** هر شعبه بانک (Bank Branch) الزاماً به یک «بانک» (Bank) از فرم قبلی مرتبط است. (ارتباط یک به چند از بانک به شعبه).

---

## ۲. فرم: تعریف شعبه بانک (Bank Branch Definition)

**مسیر:**
`خزانه‌داری / تعاریف پایه / بانک‌ها و شعب / تعریف شعب`

### فیلدهای اطلاعاتی فرم

| نام فیلد        | نوع داده     | اجباری | توضیح                                              | مثال                 |
| :-------------- | :----------- | :----- | :------------------------------------------------- | :------------------- |
| **بانک (Bank)** | انتخابی (FK) | بله    | بانکی که این شعبه به آن تعلق دارد (از فرم بانک‌ها). | `بانک ملت`           |
| **کد شعبه**     | متنی/عددی    | بله    | کد شناسایی شعبه که توسط بانک ارائه می‌شود.          | `12345`              |
| **نام شعبه**    | متنی         | بله    | نام رسمی شعبه.                                     | `شعبه مرکزی`         |
| **استان**       | انتخابی      | خیر    | استان محل استقرار شعبه.                            | `تهران`              |
| **شهر**         | انتخابی      | خیر    | شهر محل استقرار شعبه.                              | `تهران`              |
| **آدرس**        | متنی         | خیر    | آدرس دقیق شعبه.                                    | `خیابان انقلاب، ...` |
| **تلفن**        | متنی         | خیر    | شماره تماس شعبه.                                   | `021-66...`          |
| **وضعیت فعال**  | بولین        | بله    |                                                    | `فعال`               |

---

## ۳. کاربرد در سیستم

* هنگام تعریف «حساب بانکی» شرکت، شما شعبه‌ای که در آن حساب افتتاح شده را از این لیست انتخاب می‌کنید.
* هنگام ثبت «چک دریافتی» از مشتری، شعبه صادرکننده چک را برای سهولت در فرآیند وصول (واگذاری به بانک) در این فرم ثبت می‌کنید.

# صندوق‌ها (Cash Boxes)

## ۱. تعریف

**صندوق (Cash Box)** در ERP تابان، یک موجودیت اصلی (Master Data) در ماژول خزانه‌داری است که برای مدیریت و ردیابی **هرگونه وجه نقد فیزیکی** تحت تملک یا کنترل سازمان به کار می‌رود.

این موجودیت یک **دفتر معین (Sub-Ledger)** برای حساب‌های نقد در ترازنامه (مانند "صندوق" یا "تنخواه گردان") عمل می‌کند. هر تراکنش ورودی یا خروجی از صندوق، علاوه بر ثبت در سابقه صندوق، منجر به صدور یک **سند حسابداری خودکار** در دفتر کل (GL) می‌شود.

## ۲. معماری و دسته‌بندی

موجودیتی به نام «صندوق» تمام موارد زیر را پوشش می‌دهد و تمایز آن‌ها از طریق **"نوع صندوق (Cash Box Type)"** صورت می‌گیرد:

  * **صندوق عملیاتی/فروش (Operational/POS Cash Box):**

      * **هدف:** دریافت و پرداخت‌های روزمره.
      * **مثال:** صندوق فروشگاه، صندوق پذیرش هتل، صندوق دریافت شهریه.
      * **گردش کار:** دریافت‌های مکرر، پرداخت‌های جزئی، و واریز دوره‌ای به بانک (EOD - End of Day Process).

  * **تنخواه گردان (Petty Cash):**

      * **هدف:** مدیریت هزینه‌های جزئی و فوری سازمان تحت یک سقف مشخص.
      * **مثال:** تنخواه دفتر مدیرعامل، تنخواه کارپردازی، تنخواه تعمیرات و نگهداری.
      * **گردش کار:** مبتنی بر **سیستم سقف ثابت (Imprest System)** است؛ یعنی شارژ اولیه، ثبت هزینه‌ها، و شارژ مجدد *معادل* هزینه‌های انجام شده برای رساندن موجودی به سقف تعیین شده.

  * **صندوق مرکزی (Central Cash Box):**

      * **هدف:** مدیریت وجوه نقد اصلی سازمان، معمولاً در خزانه مرکزی.
      * **مثال:** گاوصندوق اصلی شرکت.
      * **گردش کار:** دریافت وجوه از صندوق‌های عملیاتی، پرداخت‌های نقدی کلان (در صورت لزوم)، و نگهداری موجودی.

## ۳. یکپارچه‌سازی (Integration)

تعریف «صندوق» به تنهایی کافی نیست؛ ارزش آن در یکپارچگی با سایر بخش‌های ERP است:

  * **دفتر کل (General Ledger):** حیاتی‌ترین ارتباط. هر صندوق باید به یک **حساب معین منحصربه‌فرد** در GL متصل باشد. این حساب، بازتاب ریالی موجودی آن صندوق در ترازنامه است.
  * **حساب‌های دریافتنی (AR):** هنگامی که مشتری فاکتور خود را "نقدی" پرداخت می‌کند، وجه به یک صندوق (مثلاً صندوق فروش) واریز می‌شود.
  * **حساب‌های پرداختنی (AP):** پرداخت‌های نقدی به تأمین‌کنندگان (بسیار نادر، اما ممکن) یا پرداخت هزینه‌ها (بسیار رایج در تنخواه) از مبدأ صندوق ثبت می‌شود.
  * **مدیریت سازمانی (OM):** هر صندوق به یک **مکان عملیاتی** (Operating Unit) و یک **شخص مسئول (Custodian)** که کارمند تعریف شده در ماژول منابع انسانی است لینک می‌شود.

## ۴. فرم تعریف صندوق (Cash Box Definition)

این فرم، قلب تپنده ماژول است. فیلدها باید به صورت منطقی دسته‌بندی شوند:

**مسیر:** `خزانه‌داری > تعاریف پایه > مدیریت صندوق‌ها و تنخواه`

-----

### بخش ۱: اطلاعات عمومی (General)

| نام فیلد | توضیح | مثال |
| :--- | :--- | :--- |
| **نام صندوق (Name)** | نام کامل و توصیفی صندوق | `تنخواه گردان واحد بازرگانی` |
| **بنگاه اقتصادی** | (اجباری) شرکتی که مالک این وجه نقد است. | `شرکت اصلی تابان` |
| **مکان عملیاتی** | (اختیاری) محلی که صندوق در آن مستقر است. | `3500 -کارخانه ` |
| **وضعیت** | فعال / غیرفعال / مسدود (جهت صندوق گردانی) | `فعال` |

### بخش ۲: تنظیمات حسابداری (Accounting)

| نام فیلد | توضیح | مثال |
| :--- | :--- | :--- |
| **نوع صندوق** | (اجباری) منطق عملیاتی صندوق را تعیین می‌کند. | `تنخواه (Petty Cash)` |
| **ارز صندوق** | (اجباری) ارز پایه صندوق. (اگر ارزی باشد، فرآیند تسعیر لازم است) | `IRR` |
| **حساب معین (GL)** | (اجباری) **مهم‌ترین فیلد.** حساب معین اختصاصی این صندوق در دفتر کل. | `11020105 - تنخواه بازرگانی` |
| **حساب کسری صندوق (Shortage Account)** | (توصیه اکید) حساب هزینه‌ای برای ثبت مغایرت‌های *کسری*. | `63010010 - هزینه کسری صندوق` |
| **حساب سرک صندوق (Overage Account)** | (توصیه اکید) حساب درآمدی برای ثبت مغایرت‌های *سرک*. | `71010020 - درآمد سرک صندوق` |
| **ابعاد مالی پیش‌فرض** | (اختیاری) برای سادگی در ورود اطلاعات. | `مرکز هزینه: 3500` |

### بخش ۳: کنترل‌های تنخواه (Petty Cash Controls)

> **توجه:** این تب فقط زمانی فعال و اجباری می‌شود که «نوع صندوق» = «تنخواه (Petty Cash)» باشد.

| نام فیلد | توضیح | مثال |
| :--- | :--- | :--- |
| **سقف تنخواه (Imprest Amount)** | (اجباری) حداکثر مبلغی که این صندوق *باید* داشته باشد. | `50,000,000` |
| **آستانه هشدار شارژ** | درصدی از سقف که در صورت رسیدن موجودی به آن، سیستم هشدار شارژ می‌دهد. | `20%` (یعنی 10 میلیون) |
| **سقف هر هزینه (Max Expense Limit)** | حداکثر مبلغ مجاز برای *هر* سند هزینه ثبت شده از این تنخواه. | `5,000,000` |

-----

## ۵. فرآیندهای اصلی و گردش کار (Core Workflows)

### گردش کار ۱: تنخواه گردان (سیستم سقف ثابت - Imprest System)
این فرآیند بر اساس ثابت نگه داشتن موجودی حساب کل تنخواه عمل می‌کند.

**گام اول: ایجاد و شارژ اولیه (Establish Fund):**

مدیر مالی «پرداخت» به مبلغ `سقف تنخواه` (مثلاً 50 م) از `حساب بانک` به `صندوق تنخواه` ثبت می‌کند.

**سند حسابداری (خودکار):**

* بدهکار: `11020105 - تنخواه بازرگانی` (50 م)
* بستانکار: `11010001 - بانک پاسارگاد` (50 م)

**نکته کنترلی:** از این لحظه، موجودی حساب کل `11020105` باید **همیشه** 50 م باقی بماند تا زمان تغییر سقف.

**گام دوم: ثبت هزینه‌ها (Expense Reporting - بدون سند دفتر کل):**

تنخواه‌گردان هزینه‌ها را (مثلاً مجموعاً 40 م) پرداخت می‌کند. او *فقط* «گزارش هزینه» (Expense Report) یا «رسیدهای هزینه» (Vouchers) را در سیستم ثبت می‌کند تا اسناد مثبته جمع‌آوری شوند.

**نکته:** هیچ سند حسابداری صادر نمی‌شود. موجودی حساب کل تنخواه تغییر نمی‌کند (همچنان 50 م است).

**گام سوم: شارژ مجدد (Replenishment):**

تنخواه‌گردان گزارش هزینه‌های خود (به مبلغ 40 م) را برای مدیر مالی ارسال می‌کند. مدیر مالی *دقیقاً* معادل هزینه‌های تأیید شده (40 م) را از `حساب بانک` مستقیماً به تنخواه‌گردان پرداخت می‌کند.

**سند حسابداری (خودکار - ثبت هزینه‌ها در این مرحله رخ می‌دهد):**

* بدهکار: `6201xxxx - هزینه ملزومات` (مثلاً 25 م)
* بدهکار: `6202xxxx - هزینه ایاب و ذهاب` (مثلاً 15 م)
* بستانکار: `11010001 - بانک پاسارگاد` (40 م)

**نتیجه:** موجودی فیزیکی تنخواه مجدداً به سقف 50 م بازگشت و حساب کل تنخواه نیز دست‌نخورده (50 م) باقی ماند.

### گردش کار ۲: صندوق عملیاتی (فروشگاه)

1.  **دریافت نقدی (Receipt):**
      * **عملیات:** مشتری کالا را خریده و مبلغ 1 م نقداً پرداخت می‌کند.
      * **سند حسابداری (خودکار - از ماژول فروش):**
          * بدهکار: `11020101 - صندوق فروشگاه 1` (1 م)
          * بستانکار: `41010001 - درآمد فروش` (1 م)
2.  **عملیات پایان روز (EOD - واریز به بانک):**
      * **عملیات:** صندوق‌دار در پایان روز، 30 م از وجوه را به بانک واریز می‌کند. یک "انتقال وجه" (Cash Transfer) از `صندوق فروشگاه 1` به `حساب بانک` ثبت می‌کند.
      * **سند حسابداری (خودکار):**
          * بدهکار: `11010001 - بانک پاسارگاد` (30 م)
          * بستانکار: `11020101 - صندوق فروشگاه 1` (30 م)

### گردش کار ۳: صندوق‌گردانی و ثبت مغایرت (Reconciliation)

این فرآیند *باید* در سیستم پشتیبانی شود.

1.  **شمارش فیزیکی:** مسئول صندوق، موجودی فیزیکی را می‌شمارد (مثلاً 4,500,000).
2.  **مقایسه با سیستم:** موجودی سیستمی (موجودی دفتر کل) در آن لحظه 4,550,000 است.
3.  **نتیجه:** 50,000 کسری وجود دارد.
4.  **عملیات در ERP:** کاربر فرم "صندوق‌گردانی/ثبت مغایرت" را باز می‌کند.
      * صندوق: `تنخواه بازرگانی`
      * موجودی سیستمی: `4,550,000`
      * موجودی واقعی: `4,500,000`
      * مغایرت: `(50,000)` (کسری)
5.  **ثبت سند (خودکار پس از تأیید):**
      * سیستم از حساب‌هایی که در "بخش ۲: تنظیمات حسابداری" تعریف کردیم استفاده می‌کند:
      * بدهکار: `63010010 - هزینه کسری صندوق` (50,000)
      * بستانکار: `11020105 - تنخواه بازرگانی` (50,000)
      * *نتیجه:* موجودی دفتر کل تنخواه با موجودی واقعی یکسان می‌شود (4,500,000).

-----

## ۵.  پرسش‌های متداول (FAQ)

**تفاوت اصلی "صندوق عملیاتی" و "تنخواه" در سیستم چیست؟**

هر دو صندوق هستند، اما منطق متفاوتی دارند. **صندوق عملیاتی** (مثل فروشگاه) ذاتاً *دریافت‌کننده* وجه است و موجودی آن متغیر است و در پایان روز به بانک واریز می‌شود. **تنخواه** ذاتاً *پرداخت‌کننده* هزینه است، بر اساس سقف ثابت (Imprest) کار می‌کند و هدفش رساندن موجودی به سقف تعیین شده از طریق شارژ مجدد است.

**چرا هر صندوق باید "حساب معین" جداگانه داشته باشد؟ آیا نمی‌توان همه را زیر یک حساب "صندوق" تعریف کرد؟**

این یک الزام کنترل داخلی است. اگر همه صندوق‌ها یک حساب معین داشته باشند، شما در ترازنامه فقط یک عدد کلی (مثلاً «موجودی صندوق: 500 م») می‌بینید. اما اگر هر صندوق (تنخواه الف، تنخواه ب، صندوق فروشگاه ۱) حساب معین جدا داشته باشد، می‌توانید مغایرت‌گیری، ردیابی و گزارش‌گیری را *به تفکیک هر صندوق* انجام دهید و ترازنامه شما شفافیت کامل (Drill-Down) تا سطح هر صندوق خواهد داشت.

**مسئول صندوق (Custodian) چه نقشی دارد؟**

این فرد، مسئول فیزیکی و قانونی وجوه آن صندوق است. در ERP، این فیلد کنترل‌های امنیتی را فعال می‌کند. مثلاً:

1.  فقط "مسئول" یا کاربران مجاز می‌توانند برای آن صندوق تراکنش ثبت کنند.
2.  در فرآیند صندوق‌گردانی، نام "مسئول" به عنوان تأیید کننده ثبت می‌شود.
3.  گزارش‌ها (مانند گردش صندوق) می‌توانند بر اساس مسئول فیلتر شوند.

**اگر در صندوق‌گردانی مغایرت (کسری یا سرک) داشتیم چه؟**

این اتفاق رایج است. به همین دلیل در فرم "تعریف صندوق"، فیلدهای **"حساب کسری"** و **"حساب سرک"** را تعریف کردیم. فرآیند "صندوق‌گردانی" در ERP باید به کاربر اجازه دهد موجودی واقعی را وارد کند و سیستم به طور خودکار سند مغایرت را (همانطور که در مثال گردش کار ۳ توضیح داده شد) صادر کند تا موجودی GL با موجودی واقعی برابر شود.

**آیا یک صندوق می‌تواند چند ارزی (Multi-Currency) باشد؟**

**توصیه اکید:** خیر. هر صندوق باید *فقط یک ارز* داشته باشد (همان فیلد "ارز صندوق"). اگر شما وجوه ریالی و یورویی دارید، باید *دو صندوق جداگانه* تعریف کنید: `صندوق مرکزی (ریالی)` و `صندوق مرکزی (یورویی)` که هر کدام به حساب معین ارزی یا ریالی خود متصل هستند. مدیریت چند ارز در یک صندوق فیزیکی، فرآیندهای حسابداری و تسعیر ارز را به شدت پیچیده و مستعد خطا می‌کند.

# دسته چک‌ها (Checkbooks)

## ۱. هدف و مفهوم

در سیستم مالی تابان، موجودیت «دسته چک» نماینده یک دسته چک فیزیکی است که توسط بانک به یکی از **حساب‌های بانکی** شرکت تخصیص داده شده است.

هدف اصلی این ماژول، ایجاد یک **مرجع واحد و قابل ردیابی (Traceable)** برای مدیریت تمام برگه‌های چک از لحظه دریافت از بانک تا زمان مصرف (صدور، پاس شدن، ابطال) است. این فرآیند برای کنترل داخلی، جلوگیری از صدور چک با شماره تکراری، و مدیریت دقیق نقدینگی خروجی، حیاتی است.

  * **اهمیت در ایران:** با توجه به الزامات **سامانه صیاد**، ردیابی دقیق هر برگ چک و شناسه صیادی آن از اهمیت بالایی برخوردار است. این ماژول پایه و اساس تمام عملیات پرداختنی از طریق چک صیادی در سیستم است.
  * **ارتباط کلیدی:** هر «دسته چک» (Checkbook) الزاماً به یک «حساب بانکی» (Bank Account) که قبلاً در سیستم تعریف شده، متصل می‌شود.

-----

## ۲. پیش‌نیازها

قبل از تعریف یک دسته چک جدید، اطمینان حاصل کنید که:

1.  **حساب بانکی مربوطه:** حساب بانکی (از نوع **جاری**) که دسته چک به آن تعلق دارد، قبلاً در ماژول `خزانه‌داری / تعاریف پایه / حساب‌های بانکی` با تمام جزئیات (شعبه، شماره حساب و...) تعریف شده باشد.

-----

## ۳. گام اول: فرم تعریف دسته چک (Checkbook Definition)

این فرم، اطلاعات «سربرگ» (Header) دسته چک را ثبت می‌کند. پس از ذخیره این فرم، سیستم به‌طور خودکار برگه‌های چک را ایجاد خواهد کرد.

**مسیر:**
`خزانه‌داری / تعاریف پایه / دسته چک‌ها`

### فیلدهای اطلاعاتی فرم

| نام فیلد | نوع داده | اجباری | توضیح و مثال |
| :--- | :--- | :--- | :--- |
| **حساب بانکی (Bank Account)** | لیست انتخابی (Lookup) | بله | حسابی که این دسته چک به آن تعلق دارد.<br> **مثال:** `110-810-1234567-1 (جاری - بانک ملت شعبه مرکزی)` |
| **عنوان دسته چک (Name)** | متنی | بله | یک نام توصیفی برای شناسایی آسان‌تر این دسته چک.<br> **مثال:** `دسته چک 50 برگی صیادی (ملت) - بهار 1403` |
| **سریال شروع (Start Serial)** | عددی/متنی | بله | شماره سریال **اولین** برگ چک در این دسته فیزیکی.<br> **مثال:** `123401` |
| **سریال پایان (End Serial)** | عددی/متنی | بله | شماره سریال **آخرین** برگ چک در این دسته فیزیکی.<br> **مثال:** `123450` |
| **تعداد برگ (Leaf Count)** | عددی | خودکار (ReadOnly) | به صورت خودکار محاسبه می‌شود: (سریال پایان - سریال شروع) + 1<br> **مثال:** `50` |
| **پیشوند سریال (Serial Prefix)** | متنی | خیر | اگر شماره سریال‌های چاپی روی برگه‌ها دارای بخش ثابت در **ابتدا** هستند.<br> **مثال:** `الف/` (نتیجه: `الف/123401`) |
| **پسوند سریال (Serial Suffix)** | متنی | خیر | اگر شماره سریال‌های چاپی روی برگه‌ها دارای بخش ثابت در **انتها** هستند.<br> **مثال:** `/980` (کد شعبه) (نتیجه: `123401/980`) |
| **تاریخ دریافت (Received Date)** | تاریخ (Date Picker) | بله | تاریخی که دسته چک فیزیکی از بانک تحویل گرفته شد.<br> **مثال:** `1403/01/20` |
| **وضعیت دسته چک (Status)** | لیست انتخابی | بله | وضعیت کلی دسته چک را مشخص می‌کند (پیش‌فرض: فعال).<br> **مثال:** `فعال` |

### وضعیت‌های دسته چک (Checkbook Status)

  * **فعال (Active):** پیش‌فرض. دسته چک آماده استفاده و صدور برگه‌های چک است.
  * **مسدود (Blocked):** به دلایل مدیریتی یا احتیاطی (مثلاً اعلام مفقودی بخشی از برگه‌ها)، به طور موقت جلوی استفاده از برگه‌های *جدید* این دسته چک گرفته می‌شود.
  * **تمام شده (Finished):** **(وضعیت سیستمی)** این وضعیت نباید دستی انتخاب شود. زمانی که *آخرین* برگ چک موجود در این دسته از وضعیت «خام» خارج شود (صادر یا باطل گردد)، سیستم به طور خودکار وضعیت دسته چک را «تمام شده» تنظیم می‌کند.
  * **باطل شده (Voided):** کل دسته چک قبل از استفاده یا در حین استفاده مفقود شده یا به طور کامل توسط بانک باطل اعلام شده است.

-----

## ۴. گام دوم: ایجاد و تکمیل برگه‌های چک (Check Leaves)

این بخش مهم‌ترین بخش فرآیند است و در دو مرحله (یکی خودکار و یکی دستی توسط کاربر) انجام می‌شود.

### مرحله ۱: ایجاد خودکار برگه‌ها (توسط سیستم)

> **فرآیند:** به محض ذخیره فرم «تعریف دسته چک» (گام ۳)، سیستم یک حلقه (Loop) از «سریال شروع» تا «سریال پایان» اجرا می‌کند و به «تعداد برگ» (مثلاً ۵۰ عدد)، رکوردهای مجزای «برگه‌ چک» (Check Leaf) در وضعیت اولیه **«خام» (Unused)** ایجاد می‌کند.

### مرحله ۲: ورود شناسه‌های صیادی (توسط کاربر)

> **اخطار مهم:** یک دسته چک تا زمانی که شناسه‌های صیادی ۱۶ رقمی منحصربه‌فرد هر برگ در آن ثبت نشده باشد، **قابل استفاده نیست**.

**گردش کار پیشنهادی سیستم:**

1.  پس از ذخیره موفقیت‌آمیز فرم «دسته چک»، سیستم کاربر را مستقیماً به لیستی از برگه‌های چک «خام» که به تازگی ایجاد شده‌اند، هدایت می‌کند.
2.  این لیست باید شامل ستون «شناسه صیادی» (SayadCode) باشد که در ابتدا برای همه برگه‌ها خالی است.
3.  کاربر **باید** قبل از هرگونه استفاده از این دسته چک، برگه‌های فیزیکی چک را برداشته و شناسه ۱۶ رقمی صیادی چاپ شده روی هر برگ را در فیلد مربوط به همان شماره سریال در سیستم وارد کند. (قابلیت ویرایش گروهی یا Edit-in-Grid در اینجا بسیار مفید است).
4.  دسته چک تنها زمانی واقعاً «فعال» و قابل استفاده برای صدور چک تلقی می‌شود که برگه‌های آن دارای شناسه صیادی باشند.

-----

## ۵. موجودیت «برگ چک» (Check Leaf) و چرخه حیات آن

هر رکوردی که در گام ۴ ایجاد می‌شود، یک «برگ چک» است که چرخه حیات خود را طی می‌کند.

### فیلدهای اصلی برگ چک (Check Leaf Properties)

| فارسی | English | توضیح |
| :--- | :--- | :--- |
| **شماره سریال (SerialNumber)** | `SerialNumber` | شماره منحصربه‌فرد برگ (مثلاً `123401`). |
| **شناسه صیادی (SayadCode)** | `SayadCode` | **اجباری.** شناسه ۱۶ رقمی چاپی روی برگ چک. بدون این شناسه، برگ «خام» قابل صدور نیست. |
| **وضعیت برگ چک (Status)** | `CheckLeafStatus` | وضعیت فعلی برگ (خام، صادر شده، پاس شده...). (جزئیات در ادامه) |
| **تاریخ صدور (IssueDate)** | `IssueDate` | `Null` است تا زمانی که چک صادر شود. در لحظه صدور (اتصال به سند پرداخت) ثبت می‌شود. |
| **تاریخ سررسید (DueDate)** | `DueDate` | `Null` است تا زمانی که چک صادر شود. در لحظه صدور **اجباری** می‌شود. |
| **مبلغ چک (Amount)** | `Amount` | `Null` است تا زمانی که چک صادر شود. |
| **دریافت‌کننده (Payee)** | `Payee` | `Null` است تا زمانی که چک صادر شود. (لینک به موجودیت اشخاص/ذینفعان) |
| **توضیحات (Description)** | `Description` | یادداشت اختیاری (مثلاً علت ابطال یا جزئیات صدور). |
| **تاریخچه وضعیت (StatusHistory)** | (Link) | (پیشنهاد) لینکی به تاریخچه کامل تغییرات وضعیت این برگ، شامل کاربر، تاریخ و علت. |

### چرخه حیات وضعیت برگ چک (Check Leaf Status Lifecycle)

وضعیت‌ها صرفاً یک لیست نیستند، بلکه یک فرآیند مشخص را طی می‌کنند.

**۱. وضعیت اولیه:**

  * **خام (Unused):** برگ چک تازه توسط سیستم ایجاد شده، شناسه صیادی آن وارد شده و آماده صدور در «سند پرداخت» است.

**۲. مسیر ابطال (قبل از صدور):**

  * `خام`  **باطل شده (Voided):**
      * **علت:** برگ چک قبل از صدور مفقود شده، در هنگام چاپ توسط پرینتر خراب شده، یا به هر دلیل دیگری از رده خارج می‌شود.
      * **الزام:** سیستم باید هنگام تغییر وضعیت به «باطل شده»، کاربر را ملزم به ثبت «علت ابطال» کند.

**۳. مسیر صدور و نقد شدن (مسیر اصلی):**

1.  **صادر شده (Issued):**
      * **رویداد:** کاربر در فرم «سند پرداخت» (Payment Voucher) این برگ چک را برای پرداخت انتخاب می‌کند.
      * **تغییرات:** فیلدهای `تاریخ صدور`، `تاریخ سررسید`، `مبلغ` و `دریافت‌کننده` در این مرحله پر می‌شوند.
2.  **ثبت شده در صیاد (Registered):**
      * **رویداد:** (پس از صدور) کاربر تأیید می‌کند که این چک در سامانه صیاد بانک ثبت شده است.
3.  **منتظر تأیید ذی‌نفع (Pending Payee Confirmation):**
      * **رویداد:** وضعیت قانونی طبق سامانه صیاد.
4.  **تأیید شده (Confirmed):**
      * **رویداد:** ذی‌نفع چک را در سامانه صیاد تأیید کرده است. چک اکنون اعتبار قانونی کامل دارد.
5.  **تحویل شده (Delivered):**
      * **رویداد:** (اختیاری اما مفید) واحد مالی، فیزیک چک را به ذی‌نفع تحویل داده و تأییدیه گرفته است.
6.  **پاس شده (Cleared):**
      * **رویداد:** در زمان «صورت مغایرت بانکی» (Reconciliation)، چک در لیست آیتم‌های برداشت شده از حساب بانک ظاهر شده و وضعیت آن در تابان به‌روز می‌شود.

**۴. مسیرهای برگشتی:**

  * **برگشت خورده (Returned):**
      * **رویداد:** پس از مراجعه ذی‌نفع به بانک، چک به دلیل عدم موجودی یا دلایل دیگر توسط بانک برگشت خورده است.
  * **عودت شده (Returned from Payee):**
      * **رویداد:** ذی‌نفع به هر دلیلی (قبل یا بعد از تأیید صیادی، مثلاً لغو معامله) فیزیک چک را به شرکت عودت داده است. این برگ چک باید «باطل» شود.

-----

##  ۶. قوانین کلیدی و اتوماسیون (Business Rules)

1.  **اجباری بودن سررسید:** فیلد `تاریخ سررسید` (DueDate) زمانی که وضعیت برگ «خام» است، باید `Null` و غیرفعال باشد. اما در لحظه «صدور» (تغییر وضعیت به `Issued`)، پر کردن آن باید **اجباری** شود.
2.  **تاریخچه وضعیت:** هرگونه تغییر در `CheckLeafStatus` (به خصوص `Voided`) باید در یک تاریخچه (Audit Log) ثبت شود: *وضعیت قبلی، وضعیت جدید، تاریخ، کاربر، و فیلد اجباری «علت» (Reason)*.
۳.  **منحصربه‌فردی شناسه صیادی:** سیستم باید در سطح پایگاه داده (Database constraint) اطمینان حاصل کند که هیچ دو برگ چکی (حتی از دسته چک‌های مختلف) نمی‌توانند «شناسه صیادی» یکسان داشته باشند.

# روش‌های پرداخت/دریافت (Payment Methods)

-----

## ۱. مفهوم

**صندوق (Cash Box)** نماینده وجوه نقد فیزیکی تحت مدیریت سازمان است. این وجوه می‌توانند شامل:

* **صندوق نقدی (Operational Cash Box)**
* **صندوق فروشگاهی (Cash Register)**
* **تنخواه (Petty Cash / Imprest Fund)**
* **صندوق مرکزی (Central Cash Box)**

باشند؛ همه‌ی این موارد در ERP تحت یک موجودیت واحد به نام **Cash Box** مدیریت می‌شوند، اما با **نوع صندوق** (Cash Box Type) از یکدیگر تفکیک می‌شوند.

  * **هدف:** استانداردسازی فرآیندها، کنترل فیلدهای اجباری در فرم «سند دریافت و پرداخت»، و استفاده در «برنامه پرداخت خودکار».

-----

## ۲. فرم: تعریف روش‌های پرداخت/دریافت

**مسیر:**
`خزانه‌داری / تعاریف پایه / تنظیمات پرداخت / روش‌های پرداخت`

### فیلدهای اطلاعاتی فرم

| نام فیلد         | نوع داده  | اجباری | توضیح                                                                                                                                                                                         | مثال                                                                                                                    |
| :--------------- | :-------- | :----- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------- |
| **کد روش**       | متنی/عددی | بله    | شناسه یکتا (مثلاً `C`, `P`, `N`).                                                                                                                                                              | `P`                                                                                                                     |
| **نام**          | متنی      | بله    | *(اصلاحیه)* نام توصیفی روش.                                                                                                                                                                   | `انتقال پایا`                                                                                                           |
| **نوع تراکنش**   | انتخابی   | بله    | (پرداختنی، دریافتنی، هردو، انتقال داخلی).                                                                                                                                                     | `پرداختنی`                                                                                                              |
| **طبقه‌بندی**     | انتخابی   | بله    | (چک، حواله بانکی، نقد، ...).                                                                                                                                                                  | `حواله بانکی`                                                                                                           |
| **کنترل فیلدها** | تنظیمات   | بله    | *(توضیح کامل)* این یک تنظیم کلیدی است که رفتار فرم «سند پرداخت» را کنترل می‌کند. مشخص می‌کند که بر اساس این روش، کدام فیلدها باید اجباری (Required)، اختیاری (Optional) یا مخفی (Hidden) باشند. | مثال ۱: برای «پایا»، فیلد «شماره شبا» اجباری است. <br> مثال ۲: برای «چک»، بخش «اطلاعات دسته چک» باید فعال و اجباری شود. |


# پورتفوهای چک‌های دریافت‌شده (Received Checks Portfolio)


## ۱. مفهوم

**«پورتفوی چک‌های دریافتی»** یک موجودیت پایه (Master Data) و اساسی در ماژول خزانه‌داری است که به عنوان یک **«محفظه» (Container)** منطقی یا فیزیکی برای نگهداری، ردیابی و مدیریت **چک‌های دریافت شده** عمل می‌کند.

هر پورتفو به عنوان یک **دفتر معین (Sub-Ledger)** مستقل عمل می‌کند و الزاماً به یک **حساب معین منحصربه‌فرد در دفتر کل (GL)** متصل است.

  * **هدف:**
    1.  فراهم کردن قابلیت ردیابی دقیق محل و وضعیت اسناد دریافتنی.
    2.  ایجاد شفافیت کامل مالی در ترازنامه از طریق تفکیک حسابداری وضعیت‌های مختلف چک (نزد صندوق، در جریان وصول، برگشتی).
    3.  کنترل فرآیندهای عملیاتی مجاز برای هر وضعیت (مثلاً، چکِ در جریان وصول را نمی‌توان خرج کرد).

جابجایی یک سند (مانند چک) بین پورتفوهای مختلف، یک **تراکنش خزانه‌داری** محسوب شده و (در صورت متفاوت بودن حساب‌های GL) منجر به صدور **سند حسابداری خودکار** می‌شود.

-----

## ۲. فرم: تعریف پورتفوی چک‌های دریافتی (Portfolio Definition)

**مسیر:**
`خزانه‌داری / تعاریف پایه / پورتفوهای چک‌های دریافتی`

### فیلدهای اطلاعاتی فرم

| نام فیلد | نوع داده | اجباری | توضیح | مثال |
| :--- | :--- | :--- | :--- | :--- |
| **نام پورتفو** | متنی | بله | نام توصیفی کامل برای شناسایی در فرم‌ها. | `گاوصندوق دفتر مرکزی تهران` |
| **بنگاه اقتصادی** | انتخابی (FK) | بله | بنگاهی که مالک این پورتفو است. | `شرکت اصلی تابان` |
| **نوع پورتفو** | انتخابی | بله | **(فیلد کلیدی)** منطق و رفتار پورتفو را تعیین می‌کند. (جزئیات در بخش ۳). | `نزد صندوق (In-House)` |
| **حساب معین (GL)** | انتخابی (FK) | بله | **(حیاتی‌ترین فیلد)** حساب دفتر کلی که موجودی ریالی این پورتفو را نشان می‌دهد. | `12010101 - اسناد نزد صندوق تهران` |
| **ارز** | انتخابی (FK) | بله | ارز پایه اسناد داخل این پورتفو (معمولاً `IRR`). | `IRR` |
| **وضعیت** | انتخابی | بله | (فعال، غیرفعال). | `فعال` |

-----

## ۳. تشریح «نوع پورتفو» (Portfolio Type)

«نوع پورتفو» یک فیلد دسته‌بندی است که رفتار و عملیات مجاز پورتفو را تعریف می‌کند. این فیلد، الگو (Template) رفتار پورتفو است.

| نوع پورتفو | توضیح و منطق | حساب GL نمونه | عملیات ورودی مجاز | عملیات خروجی مجاز |
| :--- | :--- | :--- | :--- | :--- |
| **نزد صندوق (In-House)** | **(مهم‌ترین نوع)** نماینده اسناد فیزیکی موجود در شرکت (مثلاً داخل گاوصندوق). نقطه شروع چرخه حیات چک. | `120101 - اسناد نزد صندوق` | ۱. **دریافت** (از مشتری در سند دریافت) | ۱. **ارسال جهت وصول** (به پورتفوی "در جریان وصول")<br>۲. **واگذاری/خرج کردن** (به تأمین‌کننده در سند پرداخت)<br>۳. **عودت** (به مشتری) |
| **در جریان وصول (In-Collection)** | اسنادی که به بانک تحویل داده شده (خوابانده شده) و منتظر سررسید و واریز به حساب هستند. | `120102 - اسناد در جریان وصول` | ۱. **ارسال جهت وصول** (از پورتفوی "نزد صندوق") | ۱. **اعلام وصول** (تبدیل به موجودی بانک)<br>۲. **اعلام برگشت** (انتقال به پورتفوی "برگشتی") |
| **برگشتی (Bounced)** | اسنادی که توسط بانک برگشت خورده‌اند و باید توسط واحد مالی یا حقوقی پیگیری شوند. | `120103 - اسناد برگشتی` | ۱. **اعلام برگشت** (از پورتفوی "در جریان وصول") | ۱. **واخواست** (ارسال به واحد حقوقی)<br>۲. **عودت** (به مشتری پس از تسویه) |

-----
## ۴. کاربرد در سیستم و گردش کار نمونه (Lifecycle Example)

فرض کنید مشتری «الف» یک چک به مبلغ ۱۰,۰۰۰,۰۰۰ ریال به ما می‌دهد.

**گام ۱: دریافت چک**

  * **عملیات:** کاربر «سند دریافت» صادر می‌کند.
  * **انتخاب کاربر:** در ردیف «روش دریافت»، پورتفوی `IN_HOUSE_TEH` (گاوصندوق تهران) را به عنوان مقصد انتخاب می‌کند.
  * **نتیجه:** یک «سند دریافتنی» جدید ایجاد شده و در این پورتفو قرار می‌گیرد.
  * **سند حسابداری (خودکار):**
      * بدهکار: `12010101 - اسناد نزد صندوق تهران` (موجودی این پورتفو زیاد شد)
      * بستانکار: `11030001 - حساب‌های دریافتنی - مشتری الف` (بدهی مشتری کم شد)

**گام ۲: ارسال به بانک جهت وصول**

  * **عملیات:** یک هفته قبل از سررسید، کاربر فرم «ارسال جهت وصول» را باز می‌کند.
  * **انتخاب کاربر:** چک را از پورتفوی `IN_HOUSE_TEH` انتخاب و به پورتفوی `IN_COLLECTION_MELAT` (در جریان وصول بانک ملت) منتقل می‌کند.
  * **نتیجه:** چک از پورتفوی مبدأ به مقصد منتقل می‌شود.
  * **سند حسابداری (خودکار):**
      * بدهکار: `12010201 - اسناد در جریان وصول ملت` (موجودی پورتفوی مقصد زیاد شد)
      * بستانکار: `12010101 - اسناد نزد صندوق تهران` (موجودی پورتفوی مبدأ کم شد)

**گام ۳: اعلام وصول توسط بانک**

  * **عملیات:** در تاریخ سررسید، کاربر فرم «اعلام وصول/برگشت» را باز می‌کند (یا از طریق مغایرت بانکی).
  * **انتخاب کاربر:** چک را در پورتفوی `IN_COLLECTION_MELAT` انتخاب و وضعیت آن را «وصول شده» اعلام می‌کند. مقصد نهایی پول، «حساب بانکی ملت» است.
  * **نتیجه:** چک از پورتفوی «در جریان وصول» خارج شده و چرخه حیات آن تمام می‌شود.
  * **سند حسابداری (خودکار):**
      * بدهکار: `11010101 - بانک ملت` (موجودی حساب بانکی زیاد شد)
      * بستانکار: `12010201 - اسناد در جریان وصول ملت` (موجودی پورتفوی چک کم شد)

این ساختار تضمین می‌کند که در هر لحظه، دارایی‌های شما (چه نقد، چه چک نزد صندوق، چه چک نزد بانک) به درستی در ترازنامه منعکس می‌شوند.






# ماژول خزانه‌داری (Treasury): اهداف، جایگاه و یکپارچگی

---

## ۱. هدف و تعریف ماژول خزانه‌داری

ماژول خزانه‌داری (Treasury) در ERP تابان، به عنوان **قلب مدیریت نقدینگی** سازمان عمل می‌کند. این ماژول مسئولیت مدیریت، ردیابی، و گزارش‌دهی تمامی وجوه نقد (شامل حساب‌های بانکی و صندوق‌ها) و اسناد بهادار (مانند چک‌های دریافتی و پرداختی) را بر عهده دارد.

هدف اصلی این ماژول، اطمینان از سلامت جریان نقدینگی، بهینه‌سازی منابع مالی و ارائه گزارش‌های دقیق برای تصمیم‌گیری‌های مالی است.

### اهداف کلیدی (Key Objectives)

* **مدیریت نقدینگی (Liquidity Management):** ردیابی دقیق و لحظه‌ای موجودی هر حساب بانکی، صندوق و تنخواه.
* **مدیریت اسناد بهادار (Document Management):** مدیریت کامل چرخه عمر (Lifecycle) چک‌های دریافتی (از دریافت تا واگذاری و وصول) و چک‌های پرداختی (از صدور تا پاس شدن).
* **تسویه حساب (Settlement):** اطمینان از تسویه دقیق فاکتورهای خرید (AP) و فروش (AR) با دریافت‌ها و پرداخت‌های مرتبط.
* **گزارش‌دهی و کنترل (Reporting & Control):** ارائه گزارش‌های حیاتی مانند مغایرت بانکی، جریان وجوه نقد، و وضعیت چک‌ها.

---

## ۲. جایگاه در ساختار سازمانی تابان (بنگاه و مکان)

ماژول خزانه‌داری به شدت به ساختار سازمانی تعریف شده در مستندات پایه تابان وابسته است:

### الف) بنگاه اقتصادی (Legal Entity) و خزانه‌داری

همانطور که در مستندات تابان ذکر شده، **بنگاه اقتصادی** یک موجودیت حقوقی مستقل با گزارش‌های مالی مستقل است.

> **قانون کلیدی خزانه‌داری:** **حساب‌های بانکی** (Bank Accounts) و **دسته چک‌ها** (Checkbooks) در سطح **بنگاه اقتصادی** تعریف و تملک می‌شوند.

* از آنجایی که ترازنامه و صورت‌های مالی در سطح بنگاه اقتصادی تهیه می‌شود، حساب بانکی که یکی از اقلام اصلی دارایی‌های جاری است، باید متعلق به یک بنگاه اقتصادی مشخص باشد.
* **مثال:** اگر «ایران خودرو مرکزی» (کد 1000) و «بخش فروش و بازاریابی» (کد 2000) دو بنگاه اقتصادی جداگانه باشند، هر کدام باید حساب‌های بانکی، دسته چک‌ها و اسناد مالی مجزای خود را در سیستم داشته باشند. نمی‌توان چکی را از حساب بنگاه 1000 برای پرداخت فاکتور بنگاه 2000 (مگر در فرآیندهای مالی بین شرکتی) استفاده کرد.

### ب) مکان عملیاتی (Operating Unit) و خزانه‌داری

**مکان عملیاتی** یک مکان فیزیکی (مانند کارخانه، انبار یا دفتر) است که در آن فرآیندهای لجستیکی و عملیاتی رخ می‌دهد.

> **قانون کلیدی خزانه‌داری:** **صندوق‌ها (Petty Cash)** و **تنخواه‌گردان‌ها** معمولاً در سطح **مکان عملیاتی** مدیریت می‌شوند.

* در حالی که حساب‌های بانکی ماهیت حقوقی دارند، صندوق‌ها ماهیت فیزیکی و مکانی دارند.
* **مثال:** برای پوشش هزینه‌های نقدی روزمره «کارخانه تهران» (مکان عملیاتی 1100) یا «دفتر مرکزی اداری» (مکان 1500)، یک «صندوق» یا «تنخواه» در سیستم تعریف می‌شود که به آن مکان عملیاتی و یک فرد مسئول (تنخواه‌گردان) مرتبط است.

---

## ۳. قانون طلایی: یکپارچگی با حسابداری مالی (FI)

ماژول خزانه‌داری نمی‌تواند و نباید بدون اتصال لحظه‌ای و خودکار به ماژول حسابداری مالی (FI) کار کند.

> **قانون طلایی یکپارچگی:** **هیچ تراکنشی در خزانه‌داری (تغییر موجودی بانک یا صندوق) نباید رخ دهد، مگر آنکه یک سند حسابداری (Journal Entry) معادل و خودکار در دفتر کل (GL) ثبت شود.**

این یکپارچگی از طریق **نگاشت حساب‌ها (Account Mapping)** در تعاریف پایه تضمین می‌شود:

1.  **حساب بانکی:** هر «حساب بانکی» در خزانه‌داری (مثلاً `MEL-100 - بانک ملت مرکزی`) به یک حساب معین در دفتر کل (مثلاً `11010101 - موجودی نقد - بانک ملت`) متصل است.
2.  **صندوق:** هر «صندوق» (مثلاً `PC-10 - صندوق دفتر مرکزی`) به یک حساب معین در دفتر کل (مثلاً `11020101 - صندوق مرکزی`) متصل است.
3.  **طرف حساب:** هر مشتری به حساب معین «حساب‌های دریافتنی» (AR) و هر تأمین‌کننده به «حساب‌های پرداختنی» (AP) متصل است.

---

## ۴. ارتباط جامع با سایر ماژول‌ها (جریان‌های فرآیندی)

ماژول خزانه‌داری، «مجری» نهایی فرآیندهای مالی است که در ماژول‌های دیگر آغاز می‌شوند.

### الف) یکپارچگی با فروش (Sales - SD)

فرآیند فروش (صدور فاکتور) نیاز به «دریافت» وجه را ایجاد می‌کند.

* **فرآیند:** ماژول فروش، «سفارش فروش» و سپس «فاکتور فروش» را صادر می‌کند. این فاکتور یک «آیتم باز» (Open Item) بدهکار در حساب مشتری در ماژول AR (حساب‌های دریافتنی) ایجاد می‌کند.
* **اتصال:** مشتری وجه فاکتور را پرداخت می‌کند (نقدی، چک، یا حواله).
* **عملیات خزانه‌داری:** کاربر یک **«سند دریافت» (Receipt Document)** در خزانه‌داری ثبت می‌کند.
* **مثال (دریافت نقدی بابت فاکتور):**
    * *عملیات:* دریافت 10,000,000 ریال وجه نقد از «مشتری الف» بابت فاکتور `F-901` و واریز به «صندوق مرکزی».
    * *تأثیر خزانه‌داری:* موجودی `صندوق مرکزی` 10,000,000 افزایش می‌یابد.
    * *تأثیر تسویه:* فاکتور `F-901` به وضعیت «تسویه شده» (Cleared) در می‌آید.
    * *سند حسابداری خودکار (FI):*
        * **بدهکار (Debit):** 10,000,000 - `11020101 - صندوق مرکزی` (دارایی (نقد) افزایش یافت)
        * **بستانکار (Credit):** 10,000,000 - `12010101 - حساب‌های دریافتنی - مشتری الف` (دارایی (طلب) کاهش یافت)

### ب) یکپارچگی با خرید و تدارکات (Purchasing - MM)

فرآیند خرید (دریافت فاکتور) نیاز به «پرداخت» وجه را ایجاد می‌کند.

* **فرآیند:** ماژول خرید، «سفارش خرید» (PO) و سپس «فاکتور خرید» (Purchase Invoice) را ثبت می‌کند. این فاکتور یک «آیتم باز» بستانکار در حساب تأمین‌کننده در ماژول AP (حساب‌های پرداختنی) ایجاد می‌کند.
* **اتصال:** شرکت می‌خواهد وجه فاکتور را پرداخت کند.
* **عملیات خزانه‌داری:** کاربر یک **«سند پرداخت» (Payment Document)** در خزانه‌داری ثبت می‌کند.
* **مثال (پرداخت با چک بابت فاکتور):**
    * *عملیات:* صدور چک به مبلغ 50,000,000 ریال از «بانک ملت» در وجه «تأمین‌کننده ب» بابت فاکتور `P-750`.
    * *تأثیر خزانه‌داری:* یک برگ چک از «دسته چک بانک ملت» (مثلاً سریال 1001) از وضعیت «خام» به «صادر شده» (Issued) تغییر می‌کند.
    * *تأثیر تسویه:* فاکتور `P-750` به وضعیت «تسویه شده» در می‌آید.
    * *سند حسابداری خودکار (FI) - در زمان صدور چک:*
        * **بدهکار (Debit):** 50,000,000 - `21010101 - حساب‌های پرداختنی - تأمین‌کننده ب` (بدهی ما تسویه شد)
        * **بستانکار (Credit):** 50,000,000 - `21030101 - اسناد پرداختنی` (یک بدهی جدید (چک) ایجاد شد)
    * *سند حسابداری خودکار (FI) - در زمان پاس شدن چک (از طریق مغایرت بانکی):*
        * **بدهکار (Debit):** 50,000,000 - `21030101 - اسناد پرداختنی` (بدهی چک بسته شد)
        * **بستانکار (Credit):** 50,000,000 - `11010101 - بانک ملت` (موجودی بانک (دارایی) کاهش یافت)

### ج) مدیریت چک و حسابداری (مثال‌های پیچیده)

عملیات داخلی خزانه‌داری نیز مستقیماً با حسابداری در ارتباط است:

* **مثال ۱: واگذاری چک دریافتی به بانک (جهت خواباندن به حساب)**
    * *عملیات:* چکی که قبلاً از مشتری دریافت شده و در «صندوق» (نزد صندوق) نگهداری می‌شد، به «بانک ملت» جهت وصول تحویل داده می‌شود.
    * *تأثیر خزانه‌داری:* وضعیت چک از «نزد صندوق» به «در جریان وصول» (In Collection) تغییر می‌کند.
    * *سند حسابداری خودکار (FI):* (این یک انتقال دارایی است)
        * **بدهکار (Debit):** `11030102 - اسناد در جریان وصول` (حساب واسط بانکی)
        * **بستانکار (Credit):** `11030101 - اسناد دریافتنی (نزد صندوق)`

* **مثال ۲: وصول (پاس شدن) همان چک**
    * *عملیات:* بانک اعلام می‌کند چک مشتری وصول و مبلغ به حساب واریز شد.
    * *تأثیر خزانه‌داری:* وضعیت چک «پاس شده» (Cleared) می‌شود. **موجودی واقعی بانک ملت افزایش می‌یابد.**
    * *سند حسابداری خودکار (FI):*
        * **بدهکار (Debit):** `11010101 - بانک ملت` (موجودی بانک (دارایی) افزایش یافت)
        * **بستانکار (Credit):** `11030102 - اسناد در جریان وصول` (حساب واسط بسته شد)

### د) یکپارچگی داخلی (شارژ تنخواه)

* **فرآیند:** انتقال وجه بین حساب‌های داخلی شرکت.
* **مثال (شارژ صندوق از بانک):**
    * *عملیات:* انتقال 5,000,000 ریال از «بانک ملت» به «صندوق مرکزی» جهت شارژ تنخواه.
    * *تأثیر خزانه‌داری:* موجودی «بانک ملت» 5,000,000 کاهش و موجودی «صندوق مرکزی» 5,000,000 افزایش می‌یابد.
    * *سند حسابداری خودکار (FI):* (این یک جابجایی دارایی است)
        * **بدهکار (Debit):** 5,000,000 - `11020101 - صندوق مرکزی` (دارایی صندوق افزایش یافت)
        * **بستانکار (Credit):** 5,000,000 - `11010101 - بانک ملت` (دارایی بانک کاهش یافت)

---

## ۵. خلاصه جریان اطلاعات (Data Flow Summary)

1.  **ماژول‌های عملیاتی (SD/MM):** فاکتورهای فروش و خرید، **نیاز** به دریافت یا پرداخت را ایجاد می‌کنند.
2.  **ماژول خزانه‌داری (Treasury):** **عملیات** دریافت و پرداخت را از طریق اسناد (نقد، چک، حواله) مدیریت و **اجرا** می‌کند.
3.  **ماژول حسابداری (FI):** **تأثیر مالی** این عملیات را به صورت خودکار در دفتر کل (GL) **ثبت** کرده و مبنای گزارش‌های مالی (ترازنامه، سود و زیان) را فراهم می‌کند.
4.  **ماژول داده‌های پایه (MDM):** اطمینان می‌دهد که این عملیات در چارچوب ساختار سازمانی صحیح (بنگاه اقتصادی و مکان عملیاتی) انجام می‌شود.

# مفهوم و فرم: مغایرت بانکی (Bank Reconciliation)

---

## ۱. مفهوم

مغایرت بانکی فرآیندی است که در پایان هر دوره مالی (معمولاً ماهانه) انجام می‌شود تا تراکنش‌های ثبت‌شده در ERP تابان (در سرفصل GL حساب بانکی) با صورتحساب ارائه‌شده توسط بانک تطبیق داده شود.

* **هدف:** شناسایی و رفع اختلافات بین سوابق شرکت و سوابق بانک.
* **دلایل اختلاف (مغایرت):**
    1.  **چک‌های معوق (Outstanding Checks):** چک‌های پرداختی که شرکت صادر کرده اما هنوز توسط تأمین‌کننده به بانک ارائه نشده‌اند (در ERP ثبت شده، در بانک نه).
    2.  **سپرده‌های در راه (Deposits in Transit):** وجوهی (مانند چک‌های مشتریان) که شرکت به بانک واگذار کرده اما هنوز توسط بانک وصول و به حساب اضافه نشده‌اند (در ERP ثبت شده، در بانک نه).
    3.  **کارمزدهای بانکی (Bank Fees):** هزینه‌هایی که بانک مستقیماً از حساب کسر کرده اما شرکت هنوز آن‌ها را ثبت نکرده (در بانک ثبت شده، در ERP نه).
    4.  **سود بانکی (Interest Earned):** مبالغی که بانک به حساب واریز کرده (در بانک ثبت شده، در ERP نه).
    5.  **اشتباهات (Errors):** اشتباهات ثبت در هر یک از طرفین.

---

## ۲. فرم: میزکار مغایرت بانکی (Bank Reconciliation Workbench)

**مسیر:**
`خزانه‌داری / عملیات دوره‌ای / مغایرت بانکی`

### رابط کاربری (UX)

1.  **انتخاب حساب:** کاربر «حساب بانکی» (مثلاً بانک ملت مرکزی) و «بازه زمانی» (مثلاً دی ماه 1403) را انتخاب می‌کند.
2.  **ورود اطلاعات بانک:**
    * **روش ۱ (دستی):** کاربر «موجودی نهایی» طبق صورتحساب بانک را دستی وارد می‌کند.
    * **روش ۲ (بارگذاری فایل):** کاربر فایل اکسل یا فایل استاندارد صورتحساب بانک (CSV/Excel) را در سیستم بارگذاری می‌کند.
3.  **نمایش تطبیقی (Reconciliation View):**
    * سیستم یک نمای دو ستونی یا سه ستونی ارائه می‌دهد:
        * **ستون ۱: تراکنش‌های ثبت شده در تابان (ERP)**
        * **ستون ۲: تراکنش‌های ثبت شده در صورتحساب بانک (Bank Statement)**
    * سیستم به صورت هوشمند (بر اساس تاریخ و مبلغ) سعی می‌کند تراکنش‌های مشابه را با هم «تطبیق» (Match) دهد.

4.  **فرآیند مغایرت‌گیری:**
    * **تراکنش‌های تطبیق‌یافته (Matched):** به صورت سبز رنگ نمایش داده می‌شوند و کاربر آن‌ها را تأیید می‌کند.
    * **تراکنش‌های مغایر (Unmatched):**
        * *موجود در ERP، ناموجود در بانک:* (مانند چک معوق). کاربر این موارد را به عنوان «مغایرت باز» علامت‌گذاری می‌کند تا به دوره بعد منتقل شوند.
        * *موجود در بانک، ناموجود در ERP:* (مانند کارمزد). کاربر باید مستقیماً از همین فرم، برای این موارد «سند حسابداری» یا «سند خزانه‌داری» (مثلاً سند پرداخت بابت کارمزد) صادر کند.

5.  **نتیجه نهایی:**
    * `موجودی ERP (دفتر کل)`
    * `+ موارد بستانکار ثبت نشده در ERP (مثل سود)`
    * `- موارد بدهکار ثبت نشده در ERP (مثل کارمزد)`
    * `= موجودی واقعی ERP (Adjusted Book Balance)`
    * ---
    * `موجودی صورتحساب بانک`
    * `+ سپرده‌های در راه`
    * `- چک‌های معوق`
    * `= موجودی واقعی بانک (Adjusted Bank Balance)`

    > **هدف نهایی: موجودی واقعی ERP = موجودی واقعی بانک**

6.  **بستن مغایرت:** پس از تراز شدن، کاربر دوره مغایرت را «نهایی» و «قفل» می‌کند.

# تعیین وضعیت چک (اعلام وصول یا برگشت)

**مسیر دسترسی:** `خزانه‌داری > مدیریت چک‌های دریافتی > عملیات چک > اعلام وصول/برگشت`

---

## ۱. مقدمه و کاربرد
چک‌هایی که در مرحله قبل به بانک واگذار کردید (خواباندید)، اکنون در **«مخزن در جریان وصول»** منتظر هستند.
پس از گذشت تاریخ سررسید، شما باید صورتحساب بانک (Bank Statement) یا پیامک‌های واریز بانک را بررسی کنید.

* اگر پول به حساب آمده باشد می توان نتیجه گرفت که چک **وصول** شده است.
* اگر بانک اعلام عدم موجودی کند نتیجه گرفت که چک **برگشت** خورده است.

این فرم طراحی شده تا شما وضعیت سیستم را دقیقاً با آنچه در بانک اتفاق افتاده، هماهنگ کنید.

---

## ۲. سناریوی اول: اعلام وصول (پاس شدن چک)

این حالت زمانی رخ می‌دهد که چک با موفقیت نقد شده و مبلغ آن به حساب بانکی شرکت افزوده شده است.

### گام‌به‌گام عملیات وصول:

1.  **انتخاب مخزن:** در بالای فرم، مخزن بانکی که چک‌ها در آن هستند را انتخاب کنید (مثلاً: `در جریان وصول - بانک ملت`).
2.  **یافتن چک:** سیستم لیست چک‌های منتظر در آن بانک را نشان می‌دهد. چک مورد نظر را پیدا کنید.
3.  **انتخاب و اقدام:** چک (یا گروهی از چک‌ها) را تیک بزنید و دکمه **«اعلام وصول» (Cleared)** را کلیک کنید.
4.  **تأیید تاریخ:** پنجره‌ای باز می‌شود که **«تاریخ واقعی واریز»** را می‌پرسد.
    * *نکته:* ممکن است سررسید چک ۲۰ام باشد، اما بانک آن را ۲۱ام به حساب ریخته باشد. تاریخ ۲۱ام را وارد کنید تا مغایرت بانکی نداشته باشید.
5.  **ثبت:** تأیید نهایی را بزنید.

### مثال عملی (وصول):
چک ۵۰ میلیون تومانی «آقای رضایی» که سررسیدش امروز بود، در صورتحساب بانک ملت دیده می‌شود.

* شما چک را انتخاب و دکمه وصول را می‌زنید.
* **نتیجه:** موجودی بانک ملت در سیستم ۵۰ میلیون افزایش می‌یابد و چک از لیست کارهای باز حذف می‌شود.

> **سند حسابداری خودکار (وصول):**

> | کد حساب | نام حساب | بدهکار | بستانکار |
> | :--- | :--- | :--- | :--- |
> | ۱۱۱۰۰۱ | **موجودی نقد و بانک - بانک ملت** | ۵۰,۰۰۰,۰۰۰ | - |
> | ۱۱۴۰۰۲ | **اسناد در جریان وصول - بانک ملت** | - | ۵۰,۰۰۰,۰۰۰ |

---

## ۳. سناریوی دوم: اعلام برگشت (نکول چک)

این حالت زمانی رخ می‌دهد که متصدی بانک تماس می‌گیرد یا در سیستم بانکی می‌بینید که چک به دلیل «کسری موجودی»، «امضا نامطابق» یا «مسدودی حساب» برگشت خورده است.

### گام‌به‌گام عملیات برگشت:

1.  **انتخاب مخزن:** مخزن بانک مربوطه را انتخاب کنید.
2.  **یافتن چک:** چک مشکل‌دار را در لیست پیدا کنید.
3.  **انتخاب و اقدام:** دکمه **«اعلام برگشت» (Bounced)** را بزنید.
4.  **ورود علت (اختیاری):** می‌توانید علت برگشت (مثلاً: کسر موجودی) را وارد کنید.
5.  **ثبت:** تأیید نهایی را بزنید.

### مثال عملی (برگشت):
چک ۲۰ میلیون تومانی «شرکت البرز» موجودی نداشته و بانک گواهی عدم پرداخت صادر کرده است.

* شما دکمه برگشت را می‌زنید.
* **نتیجه:** چک از «مخزن بانک» خارج شده و به **«مخزن چک‌های برگشتی»** منتقل می‌شود. اکنون تیم مالی می‌داند که این یک قلم "بدهی معوقه و پرریسک" است که باید پیگیری شود.

> **سند حسابداری خودکار (برگشت):**

> | کد حساب | نام حساب | بدهکار | بستانکار |
> | :--- | :--- | :--- | :--- |
> | ۱۱۴۰۰۵ | **اسناد دریافتنی برگشتی** | ۲۰,۰۰۰,۰۰۰ | - |
> | ۱۱۴۰۰۲ | **اسناد در جریان وصول - بانک ملت** | - | ۲۰,۰۰۰,۰۰۰ |

---

## ۴. سناریوی سوم: عودت از حالت در جریان وصول (پس گرفتن از بانک)

گاهی پیش می‌آید که چک را به بانک داده‌اید (واگذار کرده‌اید)، اما قبل از سررسید یا قبل از اقدام بانک، به هر دلیلی چک را از بانک پس می‌گیرید (مثلاً مشتری پول نقد آورده و می‌گوید چک را از بانک برگردانید).

### گام‌به‌گام عملیات:
1.  در همان لیست چک‌های در جریان وصول، چک را انتخاب کنید.
2.  دکمه **«بازگشت به صندوق» (Undo Deposit)** را بزنید.
3.  **نتیجه:** چک از بانک خارج شده و دوباره به **«مخزن صندوق» (گاوصندوق)** برمی‌گردد.
4.  **سند:** سند واگذاری (صفحه ۳) معکوس می‌شود.

---

## ۵. نکات کلیدی و سوالات متداول

**۱. اهمیت تاریخ واقعی واریز**
در هنگام زدن دکمه «وصول»، سیستم از شما تاریخ می‌پرسد. دقت کنید که **تاریخی که در پرینت بانک می‌بینید** را وارد کنید. اگر سررسید چک ۱۴۰۳/۰۵/۲۰ است اما بانک در ۱۴۰۳/۰۵/۲۲ پول را واریز کرده، حتماً تاریخ ۲۲ام را وارد کنید. این کار باعث می‌شود در پایان ماه هنگام **«مغایرت‌گیری بانکی»**، مانده سیستم و بانک دقیقاً یکسان باشد.

**۲. اگر اشتباه دکمه وصول را زدم چه؟**
نگران نباشید.

* به منوی `گزارشات > لیست چک‌های وصول شده` بروید.
* چک مورد نظر را پیدا کنید.
* روی آن کلیک راست کرده (یا دکمه عملیات) و گزینه **«ابطال وصول»** را بزنید.
* چک دوباره به وضعیت «در جریان وصول» برمی‌گردد و سند حسابداری واریز وجه باطل می‌شود.

**۳. آیا چک برگشتی را می‌توانم دوباره به بانک ببرم؟**
بله. اگر مشتری تماس گرفت و گفت "حسابم را پر کردم، دوباره چک را بزنید به حساب":

* ابتدا باید چک را از وضعیت "برگشتی" خارج کنید (عملیات: واگذاری مجدد از مخزن برگشتی به مخزن بانک).
* یا بهتر است چک را به صندوق برگردانید و دوباره واگذار کنید تا تاریخچه شفاف بماند.

**۴. هزینه کارمزد برگشت چک چه می‌شود؟**
معمولاً بانک بابت صدور گواهی عدم پرداخت، مبلغی از حساب شما کسر می‌کند. این مبلغ ربطی به خودِ چک ندارد.

* این هزینه را باید جداگانه در فرم **«سند پرداخت»** (نوع: هزینه بانکی) ثبت کنید و ربطی به فرم مدیریت چک ندارد.

# واگذاری چک به بانک (خواباندن به حساب)

**مسیر دسترسی:** `خزانه‌داری > مدیریت چک‌های دریافتی > عملیات چک > واگذاری به بانک`

---

## ۱. مقدمه و کاربرد
چک‌هایی که از مشتری دریافت کرده‌اید و در **«مخزن صندوق»** (گاوصندوق) نگهداری می‌شوند، هنوز تبدیل به پول نشده‌اند. برای نقد کردن این چک‌ها، باید در تاریخ سررسید (یا چند روز زودتر)، آن‌ها را دسته‌بندی کرده، در قالب یک لیست به بانک ببرید و تحویل باجه کلر (Clear) دهید.

این فرم در سیستم تابان دقیقاً همین فرآیند فیزیکی را شبیه‌سازی می‌کند.

* **هدف:** تغییر محل استقرار چک از «شرکت» به «بانک».
* **نتیجه:** حسابدار می‌فهمد که این چک‌ها دیگر در کشوی میز خزانه‌دار نیستند و نزد بانک امانت هستند تا وصول شوند.

---

## ۲. فرآیند گام‌به‌گام واگذاری

این عملیات معمولاً به صورت **گروهی** انجام می‌شود (مثلاً ۱۰ چک با هم به بانک برده می‌شوند).

### گام اول: تنظیمات انتقال (Header)
در بالای فرم، مشخص کنید که چک‌ها از کجا به کجا می‌روند:

1.  **تاریخ واگذاری:** تاریخ روز (روزی که چک‌ها را به بانک می‌برید).
2.  **مخزن مبدأ:** `مخزن اسناد نزد صندوق` (یا گاوصندوق خاصی که چک‌ها در آن هستند).
3.  **مخزن مقصد (بانک):** `مخزن در جریان وصول - [نام بانک]` (مثلاً: در جریان وصول بانک ملت).
    * *نکته:* اگر چک‌ها را به بانک "تجارت" می‌برید، حتماً مخزن "در جریان وصول تجارت" را انتخاب کنید.

### گام دوم: انتخاب چک‌ها (Selection)
1.  دکمه **«افزودن چک / جستجو»** را بزنید.
2.  پنجره‌ای باز می‌شود که لیست تمام چک‌های موجود در «مخزن مبدأ» را نمایش می‌دهد.
3.  **فیلتر کردن:** از فیلتر تاریخ سررسید استفاده کنید. (مثلاً چک‌های سررسید امروز و فردا را فیلتر کنید).
4.  **تیک زدن:** چک‌هایی که قصد واگذاری دارید را انتخاب (Select) کنید.
5.  دکمه تأیید را بزنید تا چک‌ها به لیست اصلی فرم اضافه شوند.



### گام سوم: چاپ فرم واگذاری (Deposit Slip) - اختیاری
قبل از ثبت نهایی، می‌توانید دکمه **«چاپ فرم واگذاری»** را بزنید. سیستم یک لیست مرتب شامل شماره چک، مبلغ، بانک صادرکننده و نام صاحب حساب به شما می‌دهد.

* *کاربرد:* این لیست را پرینت بگیرید و همراه فیزیک چک‌ها به متصدی بانک تحویل دهید تا رسید مهر شده دریافت کنید.

### گام چهارم: ثبت نهایی
دکمه **«ذخیره / انجام عملیات»** را بزنید.
* **نتیجه:** چک‌ها از «مخزن صندوق» ناپدید شده و در «مخزن بانک» ظاهر می‌شوند.

---

## ۳. سناریوی عملی (مثال واقعی)

**داستان:**
امروز **۱۵ اردیبهشت** است. خزانه‌دار شرکت (آقای حسینی) چک‌های مشتریانی را که سررسید آن‌ها **۱۶ اردیبهشت** است، بررسی می‌کند. او ۳ فقره چک پیدا می‌کند که باید به حساب جاری شرکت در **بانک ملت** واریز شوند.

**مشخصات چک‌ها:**

1.  چک آقای رضایی (۵۰ میلیون تومان)
2.  چک شرکت البرز (۲۰ میلیون تومان)
3.  چک فروشگاه کوروش (۳۰ میلیون تومان)

**اقدامات در سیستم:**

1.  آقای حسینی فرم «واگذاری به بانک» را باز می‌کند.
2.  **مبدأ:** صندوق مرکزی | **مقصد:** در جریان وصول بانک ملت.
3.  دکمه افزودن را می‌زند و فیلتر تاریخ را روی `1403/02/16` تنظیم می‌کند.
4.  هر ۳ چک را در لیست می‌بیند و تیک می‌زند.
5.  دکمه **«چاپ رسید»** را می‌زند، پرینت می‌گیرد و چک‌ها را منگنه می‌کند.
6.  دکمه **«ثبت»** را در سیستم می‌زند.
7.  حالا با خیال راحت چک‌ها را برداشته و فیزیک آن‌ها را به شعبه بانک ملت می‌برد.

---

## ۴. پشت صحنه سیستم (حسابداری)

در این مرحله هنوز پولی به حساب ننشسته است، اما دارایی از یک شکل به شکل دیگر تبدیل شده است. سیستم سند زیر را صادر می‌کند:

| کد حساب | نام حساب | بدهکار | بستانکار | شرح |
| :--- | :--- | :--- | :--- | :--- |
| ۱۱۴۰۰۲ | **اسناد در جریان وصول - بانک ملت** | ۱۰۰,۰۰۰,۰۰۰ | - | واگذاری ۳ فقره چک به بانک ملت ... |
| ۱۱۴۰۰۱ | **اسناد دریافتنی نزد صندوق** | - | ۱۰۰,۰۰۰,۰۰۰ | واگذاری ۳ فقره چک به بانک ملت ... |

* **تفسیر:** حسابداری متوجه می‌شود که ۱۰۰ میلیون تومان اسناد ما الان نزد بانک ملت است و منتظر وصول می‌باشد.

---

## ۵. سوالات متداول و نکات کنترلی

**۱. آیا می‌توانم چک‌هایی که مربوط به بانک‌های مختلف هستند را در یک فرم ثبت کنم؟**
خیر.

* هر فرم واگذاری فقط **یک مقصد** (یک بانک) دارد.
* اگر می‌خواهید تعدادی چک به بانک ملت و تعدادی را به بانک صادرات ببرید، باید **دو فرم واگذاری جداگانه** ثبت کنید (یکی با مقصد مخزن ملت و دیگری با مقصد مخزن صادرات).

**۲. اگر اشتباهی چکی را واگذار کردم چه می‌شود؟ (مثلاً چکی که قرار بود فردا ببرم)**
نترسید. تا زمانی که وضعیت چک «در جریان وصول» است (هنوز وصول یا برگشت نشده)، می‌توانید عملیات را برگردانید.

* به لیست واگذاری‌ها بروید.
* فرم مربوطه را باز کنید.
* دکمه **«ابطال»** یا **«حذف»** را بزنید. چک‌ها دوباره به وضعیت «نزد صندوق» برمی‌گردند و سند حسابداری معکوس می‌شود.

**۳. آیا تاریخ واگذاری مهم است؟**
بله. معمولاً بانک‌ها چک‌ها را ۲۴ ساعت زودتر برای کلر قبول می‌کنند. تاریخ واگذاری در سیستم باید با تاریخی که چک را به بانک تحویل دادید یکی باشد تا در صورت گم شدن چک، بدانید در چه روزی و به چه کسی تحویل داده شده است.

**۴. چک "بین بانکی" (رمزدار) را هم باید واگذار کنم؟**
بله. هر برگه فیزیکی که وارد صندوق شده، برای نقد شدن باید از طریق این فرم به بانک منتقل شود. حتی اگر چک رمزدار باشد و همان لحظه نقد شود، برای حفظ زنجیره اسناد، بهتر است مسیر `صندوق -> واگذاری -> وصول` طی شود.

# خرج کردن چک - واگذاری به غیر (Check Endorsement)

**مسیر دسترسی:** `خزانه‌داری > عملیات پرداخت > سند پرداخت جدید`

-----

## ۱. مفهوم و کاربرد

### خرج کردن چک چیست؟

در بازار ایران، بسیار رایج است که شرکت‌ها چک‌هایی را که از مشتریان خود دریافت کرده‌اند، نقد نکنند؛ بلکه همان چک را بابت بدهی‌های خود به شخص دیگری (مانند تأمین‌کننده کالا، پیمانکار یا فروشنده مواد اولیه) واگذار کنند.
به این عمل در اصطلاح بازار **«خرج کردن چک»** و در اصطلاح حقوقی **«ظهرنویسی» (Endorsement)** گفته می‌شود.

### چرا این کار را انجام می‌دهیم؟

1.  **حفظ نقدینگی:** به جای خالی کردن حساب بانکی شرکت، از اسناد موجود استفاده می‌کنیم.
2.  **تسویه سریع:** بدون نیاز به منتظر ماندن برای سررسید چک مشتری، بدهی خود به تأمین‌کننده را تسویه می‌کنیم.

> **قانون مهم سیستم:** شما فقط می‌توانید چک‌هایی را خرج کنید که وضعیت آن‌ها **«نزد صندوق» (On-Hand)** باشد. چکی که به بانک واگذار شده یا برگشت خورده است، ابتدا باید به صندوق برگردد تا قابل خرج کردن باشد.

-----

## ۲. مراحل انجام کار در سیستم

از آنجا که خرج کردن چک نوعی "پرداخت بدهی" محسوب می‌شود، این عملیات در فرم **«سند پرداخت»** انجام می‌گیرد، نه در منوی عملیات چک.

### گام ۱: باز کردن سند پرداخت

به مسیر `خزانه‌داری > عملیات پرداخت` رفته و روی **«سند پرداخت جدید»** کلیک کنید.

### گام ۲: انتخاب گیرنده

در فیلد **طرف حساب (Payee)**، نام شخص یا شرکتی را که می‌خواهید چک را به او بدهید انتخاب کنید.

  * *مثال: شرکت فولاد مبارکه (تأمین‌کننده)*

### گام ۳: انتخاب روش پرداخت

در بخش جزئیات پرداخت (Payment Lines):

1.  یک ردیف جدید ایجاد کنید.
2.  نوع روش پرداخت را **«خرج چک» (Endorse Check)** انتخاب کنید.
3.  با انتخاب این گزینه، فیلد مبلغ غیرفعال می‌شود (چون مبلغ تابع چکی است که انتخاب می‌کنید) و دکمه **«انتخاب چک»** فعال می‌گردد.

### گام ۴: انتخاب چک از مخزن

با زدن دکمه انتخاب چک، سیستم پنجره‌ای باز می‌کند که **فقط** شامل چک‌های موجود در **«مخزن اسناد نزد صندوق»** است.

  * می‌توانید لیست را بر اساس مبلغ، سررسید یا نام مشتریِ صادرکننده فیلتر کنید.
  * چک (یا چک‌های) مورد نظر را تیک بزنید.

### گام ۵: ثبت نهایی (Post)

پس از انتخاب چک، مبلغ سند به صورت خودکار پر می‌شود. دکمه **«ثبت»** را بزنید.

-----

## ۳. تأثیرات مالی و حسابداری

با ثبت این سند، دو اتفاق مهم در سیستم رخ می‌دهد:

1.  **تغییر در خزانه‌داری:**

      * چک از «مخزن اسناد نزد صندوق» خارج می‌شود.
      * وضعیت چک به **«خرج شده» (Endorsed)** تغییر می‌کند.
      * مالکیت چک از شرکت شما سلب می‌شود.

2.  **سند حسابداری خودکار (GL Entry):**
    سیستم به صورت اتوماتیک سند زیر را صادر می‌کند:

| کد حساب | نام حساب | بدهکار (Dr) | بستانکار (Cr) | توضیحات |
| :--- | :--- | :--- | :--- | :--- |
| `210101` | **حساب‌های پرداختنی** <br> *(شرکت فولاد)* | 100,000,000 | 0 | بدهی ما به تأمین‌کننده کم شد. |
| `120101` | **اسناد دریافتنی نزد صندوق** <br> *(مخزن صندوق)* | 0 | 100,000,000 | دارایی چک از صندوق خارج شد. |

-----

## ۴. مثال جامع عملیاتی

**سناریو:**
شرکت شما (تابان) مبلغ ۵۰ میلیون تومان به «بازرگانی آهن‌چی» بدهکار است.
از طرفی، در گاوصندوق شرکت، یک چک ۵۰ میلیون تومانی از مشتری خود (آقای رضایی) دارید که سررسید آن ۲۰ روز دیگر است.
مدیر مالی تصمیم می‌گیرد به جای پرداخت پول نقد، چک آقای رضایی را به بازرگانی آهن‌چی بدهد.

**اجرا در نرم‌افزار:**

1.  وارد فرم **سند پرداخت** می‌شوید.
2.  گیرنده را **«بازرگانی آهن‌چی»** انتخاب می‌کنید.
3.  در ردیف پرداخت، گزینه **«خرج چک»** را انتخاب می‌کنید.
4.  لیست چک‌ها باز می‌شود. چک **آقای رضایی** (به مبلغ ۵۰ میلیون و شناسه صیادی `123...`) را انتخاب می‌کنید.
5.  سند را ثبت می‌کنید.

**نتیجه:**

  * بدهی شما به بازرگانی آهن‌چی صفر می‌شود.
  * چک آقای رضایی از لیست چک‌های موجود در صندوق شما حذف می‌شود.
  * در گزارش کاردکس چک آقای رضایی، یک ردیف اضافه می‌شود: *"واگذاری به بازرگانی آهن‌چی بابت سند پرداخت شماره X"*.

-----

## ۵. سوالات متداول و نکات کنترلی

**سوال ۱: اگر چکی را خرج کنیم و بعداً آن چک پاس نشود (برگشت بخورد) چه می‌شود؟**
**پاسخ:** این پیچیده‌ترین حالت است.

1.  بازرگانی آهن‌چی چک را به شما برمی‌گرداند، بنابراین شما باید در سیستم **«استرداد از خرج»** بزنید (بدهی آهن‌چی دوباره باز می‌شود و چک به مخزن برگشتی شما می‌آید).
2.  سپس شما سراغ مشتری (آقای رضایی) می‌روید و مراحل پیگیری چک برگشتی را طی می‌کنید.

**سوال ۲: آیا می‌توانم فقط بخشی از مبلغ چک را خرج کنم؟**
**پاسخ:** خیر. چک یک موجودیت واحد است. نمی‌توانید نیمی از کاغذ چک را پاره کنید و بدهید\! اگر مبلغ چک ۵۰ میلیون است و بدهی شما ۳۰ میلیون است، باید چک را بدهید و ۲۰ میلیون مابقی را از طرف مقابل به صورت نقد یا چکِ خرجیِ خودش دریافت کنید (که این عملیات ترکیبی می‌شود).

**سوال ۳: آیا می‌توانم چکی که "در جریان وصول" (نزد بانک) است را خرج کنم؟**
**پاسخ:** خیر. فیزیک چک اکنون دست بانک است. برای خرج کردن، ابتدا باید عملیات **«استرداد از واگذاری»** را انجام دهید تا چک به وضعیت «نزد صندوق» برگردد، سپس آن را خرج کنید.

**سوال ۴: آیا سیستم برای خرج کردن چک هشدار می‌دهد؟**
**پاسخ:** بله، اگر سررسید چک گذشته باشد یا وضعیت اعتباری صادرکننده چک (مشتری) قرمز باشد، سیستم می‌تواند به کاربر هشدار دهد که "این چک ریسک برگشت دارد، آیا از خرج کردن آن مطمئن هستید؟".

# مروری بر مدیریت چک‌های دریافتی

-----

## ۱. مقدمه: چک به عنوان یک دارایی زنده

به بخش **مدیریت چک‌های دریافتی** در ERP تابان خوش آمدید.
در حسابداری سنتی، چک‌ها اغلب به عنوان اعداد و ارقام در دفاتر ثبت می‌شوند. اما در سیستم تابان، هر برگ چک یک **موجودیت زنده (Living Entity)** است. چرا؟ چون هر چک:

1.  **متولد می‌شود:** (لحظه دریافت از مشتری).
2.  **سفر می‌کند:** (از گاوصندوق به بانک، یا به دست تأمین‌کننده).
3.  **تغییر وضعیت می‌دهد:** (نقد می‌شود، برگشت می‌خورد، یا استرداد می‌شود).

این ماژول طراحی شده تا شما به عنوان مدیر مالی یا خزانه‌دار، در هر لحظه بر سرنوشت تک‌تک اسناد تجاری خود مسلط باشید و دیگر نگران گم شدن فیزیک چک یا فراموشی تاریخ سررسید نباشید.

-----

## ۲. معماری سیستم: مفهوم «مخزن چک» (Check Repository)

مهم‌ترین مفهومی که باید در این سیستم با آن آشنا شوید، **«مخزن چک»** است.
در دنیای واقعی، چک فیزیکی نمی‌تواند همزمان در دو جا باشد. در سیستم نیز ما از «مخزن» استفاده می‌کنیم تا دقیقاً بگوییم فیزیک چک الان کجاست. چک‌ها در طول عمر خود بین این مخازن جابجا می‌شوند.

### لیست مخازن استاندارد سیستم

| نام مخزن | نام انگلیسی | شرح کاربردی | وضعیت حسابداری |
| :--- | :--- | :--- | :--- |
| **مخزن اسناد نزد صندوق** | `Safe Repository` | **(گاوصندوق شرکت)** <br> چک‌هایی که تازه از مشتری گرفته‌اید و فیزیک آن‌ها داخل کشو یا گاوصندوق خزانه‌دار است. | `اسناد دریافتنی نزد صندوق` |
| **مخزن در جریان وصول** | `In-Collection Repo` | **(نزد بانک)** <br> چک‌هایی که از شرکت خارج شده و برای وصول (کلر) به متصدی بانک تحویل داده شده‌اند. | `اسناد در جریان وصول` |
| **مخزن چک‌های برگشتی** | `Bounced Repo` | **(واحد پیگیری)** <br> چک‌هایی که سررسید شده‌اند اما به دلیل عدم موجودی، نکول شده‌اند. | `اسناد دریافتنی برگشتی` |
| **مخزن چک‌های تضمینی** | `Guarantee Repo` | **(بایگانی تضمینات)** <br> چک‌هایی که بابت حسن انجام کار گرفته شده و قرار نیست نقد شوند. | `حساب‌های انتظامی` |

> **نکته مهم:** هر مخزن در نرم‌افزار به یک **حساب معین (GL Account)** اختصاصی متصل است. وقتی شما در سیستم، چک را از یک مخزن به مخزن دیگر می‌برید، سیستم به صورت خودکار سند حسابداری جابجایی بین این حساب‌ها را صادر می‌کند.

-----

## ۳. نقشه راه عملیات (Workflows)

در این ماژول، شما با ۵ عملیات اصلی سروکار دارید. بیایید سناریوی هر کدام را بررسی کنیم:

### ۱. دریافت (Receipt)

  * **سناریو:** مشتری چک را روی میز شما می‌گذارد.
  * **عملیات سیستم:** ثبت «سند دریافت».
  * **نتیجه:** چک در **مخزن صندوق** ایجاد می‌شود.

### ۲. واگذاری (Deposit/Lodge)

  * **سناریو:** موعد چک نزدیک است. شما چک‌ها را در پاکت می‌گذارید و به بانک می‌برید.
  * **عملیات سیستم:** استفاده از فرم «واگذاری به بانک».
  * **نتیجه:** چک از مخزن صندوق کسر و به **مخزن در جریان وصول** اضافه می‌شود.

### ۳. تعیین تکلیف (Clearance/Bounce)

  * **سناریو:** صورتحساب بانک را چک می‌کنید.
      * *حالت اول:* پول واریز شده، دکمه **«وصول شد»** را می‌زنید. (چک از سیستم خارج و تبدیل به پول نقد می‌شود).
      * *حالت دوم:* چک برگشت خورده، دکمه **«برگشت خورد»** را می‌زنید. (چک به مخزن برگشتی می‌رود).

### ۴. خرج کردن (Endorsement)

  * **سناریو:** بدهی به یک فروشنده آهن دارید. به جای پول نقد، چک مشتری خودتان را پشت‌نویسی می‌کنید و به او می‌دهید.
  * **عملیات سیستم:** ثبت «سند پرداخت» با روش «خرج چک».
  * **نتیجه:** چک از دارایی‌های شما خارج شده و بدهی شما تسویه می‌شود.

### ۵. استرداد (Return)

  * **سناریو:** مشتری می‌آید و می‌گوید "چکم را نبر بانک، بیا پول نقد بگیر و لاشه چک را پس بده".
  * **عملیات سیستم:** فرم «استرداد چک».
  * **نتیجه:** سند دریافت اولیه معکوس شده و چک از سیستم حذف می‌شود.

-----

## ۴. شناسه صیادی: قلب تپنده ردیابی

در سیستم تابان، **شناسه ۱۶ رقمی صیادی** یک فیلد متنی ساده نیست؛ بلکه اثر انگشت چک است.

  * **جلوگیری از تقلب:** سیستم اجازه نمی‌دهد یک شناسه صیادی دو بار در سیستم ثبت شود (حتی اگر سال‌ها پیش ثبت شده باشد).
  * **یکپارچگی:** در آینده برای مغایرت‌گیری بانکی، سیستم بر اساس همین شناسه متوجه می‌شود کدام ردیف بانک مربوط به کدام چک در سیستم است.

-----

## ۵. مثال جامع عملیاتی (سناریوی شرکت پخش)

بیایید یک داستان واقعی را مرور کنیم تا مفاهیم بالا کاملاً جا بیفتد.

**بازیگران:**

  * **شرکت ما:** پخش مواد غذایی تابان.
  * **مشتری:** سوپرمارکت کوروش (آقای رضایی).
  * **بانک ما:** بانک ملت (شعبه مرکزی).

**پرده اول: دریافت چک (۱۴۰۳/۰۲/۰۱)**
آقای رضایی بابت خرید کالا، یک چک ۵۰ میلیون تومانی به تاریخ سررسید ۱۰ روز بعد (۱۴۰۳/۰۲/۱۰) به ویزیتور ما می‌دهد.

  * *در سیستم:* کاربر «سند دریافت» ثبت می‌کند.
  * *وضعیت:* چک در **مخزن صندوق** قرار می‌گیرد.

**پرده دوم: خواباندن به حساب (۱۴۰۳/۰۲/۰۸)**
دو روز مانده به سررسید، حسابدار چک را از گاوصندوق برداشته و به بانک ملت می‌برد.

  * *در سیستم:* کاربر فرم «واگذاری به بانک» را باز کرده، مبدأ را صندوق و مقصد را بانک ملت انتخاب می‌کند.
  * *وضعیت:* چک به **مخزن در جریان وصول (ملت)** منتقل می‌شود.

**پرده سوم: روز سررسید و برگشت (۱۴۰۳/۰۲/۱۰)**
بانک پیامک می‌دهد که حساب آقای رضایی موجودی ندارد. چک برگشت می‌خورد.

  * *در سیستم:* کاربر در فرم «اعلام وضعیت»، گزینه **برگشت** را می‌زند.
  * *وضعیت:* چک به **مخزن چک‌های برگشتی** می‌رود. (سیستم حساب اسناد برگشتی را بدهکار می‌کند).

**پرده آخر: تسویه نهایی (۱۴۰۳/۰۲/۱۵)**
با آقای رضایی تماس می‌گیریم. او می‌آید، ۵۰ میلیون کارت می‌کشد (واریز نقد) و لاشه چک برگشتی‌اش را می‌خواهد.

1.  یک «سند دریافت نقدی» ثبت می‌کنیم (پول به حساب بانک می‌نشیند).
2.  از فرم «استرداد چک»، چک موجود در مخزن برگشتی را انتخاب و به آقای رضایی استرداد می‌کنیم.

<!-- end list -->

  * *نتیجه:* پرونده چک بسته می‌شود.

-----

## ۶. پیش‌نیازهای شروع کار

برای اینکه بتوانید از این ماژول استفاده کنید، باید موارد زیر در بخش `تعاریف پایه` تکمیل شده باشند:

1.  **تعریف بانک‌ها:** نام بانک‌های کشور (ملی، صادرات، ...) در سیستم باشد.
2.  **تعریف مخازن چک:**
      * حداقل یک مخزن از نوع "نزد صندوق".
      * به ازای هر حساب جاری شرکت، یک مخزن از نوع "در جریان وصول".
      * یک مخزن از نوع "برگشتی".
3.  **ارتباط با حسابداری:** مطمئن شوید حسابدار ارشد، کدهای حساب معین (GL Codes) مربوط به هر مخزن را در تنظیمات لینک کرده است. بدون این لینک، اسناد اتوماتیک صادر نمی‌شوند.

# دریافت چک جدید (دریافت از مشتری)

**مسیر دسترسی:** `خزانه‌داری > عملیات دریافت > سند دریافت جدید`

-----

## ۱. مقدمه و کاربرد

این فرم، دروازه ورود چک‌ها به سیستم ERP تابان است. هر زمانی که مشتری، کارمند یا هر طرف حساب دیگری بابت تسویه بدهی، پیش‌پرداخت سفارش یا سایر درآمدها به شما **چک** می‌دهد، باید اطلاعات آن را در این فرم ثبت کنید.

**چرا دقت در این فرم حیاتی است؟**
اطلاعاتی که اینجا وارد می‌کنید (به ویژه تاریخ سررسید و شناسه صیادی)، مبنای تمام گزارش‌های نقدینگی، هشدارهای سررسید و پیگیری‌های حقوقی آینده خواهد بود. یک اشتباه تایپی در مبلغ یا تاریخ، می‌تواند گزارشات مالی مدیران را منحرف کند.

-----

## ۲. فرآیند گام‌به‌گام ثبت چک

برای ثبت چک، مراحل زیر را در فرم **«سند دریافت»** طی کنید:

### گام اول: اطلاعات عمومی سند (Header)

ابتدا مشخص کنید چه کسی و بابت چه چیزی پول می‌دهد.

1.  **طرف حساب (پرداخت‌کننده):** نام مشتری یا شخصی که چک را داده انتخاب کنید.
2.  **تاریخ سند:** تاریخ روز (تاریخی که چک را تحویل گرفتید).
3.  **شرح سند:** توضیحی کوتاه بنویسید (مثلاً: بابت تسویه فاکتور شماره ۱۰۱).

### گام دوم: انتخاب روش پرداخت

در بخش ردیف‌های دریافت، دکمه **«افزودن ردیف»** را زده و در فیلد روش پرداخت، گزینه **«چک»** را انتخاب کنید. با این کار، فیلدهای مخصوص چک فعال می‌شوند.

### گام سوم: ورود مشخصات چک (Detail)

اطلاعات روی فیزیک چک را با دقت وارد کنید. (جدول راهنمای فیلدها را در پایین ببینید).

### گام چهارم: ثبت نهایی

پس از اطمینان از صحت اطلاعات، دکمه **«ذخیره / ثبت نهایی»** را بزنید.

  * **نتیجه:** سیستم یک «رسید دریافت» به شما می‌دهد که می‌توانید آن را چاپ کرده و به عنوان رسید به مشتری تحویل دهید.

-----

## ۳. راهنمای جامع فیلدهای چک

| نام فیلد (فارسی) | نام فیلد (لاتین) | وضعیت | توضیحات کاربردی و نکات کنترلی |
| :--- | :--- | :--- | :--- |
| **مبلغ چک** | `Amount` | **اجباری** | مبلغ دقیق نوشته شده روی چک به ریال. <br> *نکته:* سیستم به صورت خودکار مبلغ را به حروف در زیر فیلد نمایش می‌دهد؛ حتماً چک کنید. |
| **تاریخ سررسید** | `DueDate` | **اجباری** | تاریخی که باید چک را به بانک ببرید (تاریخ نقد شدن). <br> *نکته:* این تاریخ مبنای گزارشات "جریان نقدینگی" (Cash Flow) است. |
| **شناسه صیادی** | `SayadID` | **اجباری** | کد ۱۶ رقمی گوشه بالای چک. <br> *کنترل:* سیستم یکتا بودن این کد را چک می‌کند. اگر قبلاً ثبت شده باشد، خطای تکراری می‌دهد. |
| **شماره سریال** | `SerialNo` | اجباری | شماره چاپی پایین یا گوشه چک (معمولاً ترکیبی از عدد و ممیز). <br> *کاربرد:* برای پیدا کردن فیزیک چک در بایگانی/گاوصندوق استفاده می‌شود. |
| **بانک صادرکننده** | `BankName` | اختیاری | نام بانک دسته چک مشتری (مثلاً: ملت، تجارت). |
| **شعبه** | `BranchName` | اختیاری | نام یا کد شعبه صادرکننده. |
| **صاحب حساب** | `Owner` | اختیاری | نام شخصی که زیر چک را امضا کرده است. <br> *نکته:* گاهی مشتری (پرداخت‌کننده) چک شخص دیگری را به ما می‌دهد (چک خرج شده). در این صورت نام مشتری در هدر سند و نام صاحب حساب واقعی در این فیلد درج می‌شود. |
| **در وجه** | `Payee` | پیش‌فرض | نام شرکت شما (گیرنده). اگر چک در وجه حامل است، می‌توانید این فیلد را ویرایش کنید. |

-----

## ۴. سناریوی عملی (مثال واقعی)

**داستان:**
فرض کنید شما حسابدار شرکت «پخش تابان» هستید. «آقای رضایی» (مالک فروشگاه کوروش) بابت خرید کالاهای هفته گذشته، به شرکت مراجعه کرده و یک چک صیادی بنفش رنگ تحویل می‌دهد.

**مشخصات چک:**

  * **مبلغ:** ۵۰۰,۰۰۰,۰۰۰ ریال (۵۰ میلیون تومان)
  * **سررسید:** ۲۰ مرداد ۱۴۰۳
  * **بانک:** صادرات - شعبه بازار
  * **شماره صیادی:** 1234123412341234

**اقدامات شما در سیستم:**

1.  وارد مسیر `خزانه‌داری > سند دریافت جدید` می‌شوید.
2.  در فیلد طرف حساب، **«فروشگاه کوروش - آقای رضایی»** را انتخاب می‌کنید.
3.  در قسمت ردیف‌ها، روش **«چک»** را انتخاب می‌کنید.
4.  مبلغ `500,000,000` و تاریخ سررسید `1403/05/20` را وارد می‌کنید.
5.  شناسه صیادی ۱۶ رقمی را با دقت از روی چک تایپ می‌کنید (یا با بارکدخوان اسکن می‌کنید).
6.  سایر مشخصات (بانک صادرات، شماره سریال) را پر می‌کنید.
7.  دکمه **ثبت** را می‌زنید.

-----

## ۵. پشت صحنه سیستم (آنچه کاربر نمی‌بیند)

به محض اینکه دکمه ثبت را فشار می‌دهید، سیستم سه کار مهم انجام می‌دهد:

1.  **تولد چک در مخزن:**
    یک رکورد جدید در پایگاه داده چک‌ها ایجاد می‌شود و وضعیت آن به صورت پیش‌فرض **«نزد صندوق» (On-Hand)** تنظیم می‌شود. یعنی سیستم می‌فهمد که این چک الان در گاوصندوق شرکت است.

2.  **کاهش بدهی مشتری:**
    مانده حساب آقای رضایی ۵۰ میلیون تومان کاهش می‌یابد.

3.  **صدور سند حسابداری اتوماتیک:**
    سیستم بدون دخالت شما، سند زیر را در دفتر کل (GL) صادر می‌کند:

| کد حساب | نام حساب | بدهکار | بستانکار | شرح |
| :--- | :--- | :--- | :--- | :--- |
| ۱۱۴۰۰۱ | **اسناد دریافتنی نزد صندوق** | ۵۰۰,۰۰۰,۰۰۰ | - | دریافت چک صیادی ... بابت فروشگاه کوروش |
| ۱۱۳۰۰۵ | **حساب‌های دریافتنی تجاری** | - | ۵۰۰,۰۰۰,۰۰۰ | دریافت چک صیادی ... بابت فروشگاه کوروش |

-----

## ۶. سوالات متداول و نکات طلایی

**۱. اگر چک "در وجه حامل" بود چه کنیم؟**
در فیلد "در وجه"، کلمه "حامل" را تایپ کنید. اما توجه داشته باشید طبق قوانین جدید چک صیادی، ثبت چک در وجه حامل محدودیت دارد و حتماً باید انتقال در سامانه صیاد انجام شود.

**۲. مشتری چک شخص دیگری را به ما داده است (چک خرج شده). طرف حساب کیست؟**
طرف حساب شما همچنان **مشتری (کسی که بدهکار است)** می‌باشد، نه صاحب چک.

  * *مثال:* آقای رضایی (مشتری ما) چکِ برادرش (آقای اکبری) را به ما می‌دهد.
  * *در سیستم:* در فیلد "پرداخت‌کننده" نام **آقای رضایی** را انتخاب کنید (چون می‌خواهیم حساب او تسویه شود). در فیلد "صاحب حساب"، نام **آقای اکبری** را بنویسید تا اگر چک برگشت خورد، بدانید صاحبش کیست.

**۳. سیستم خطای "شناسه صیادی تکراری" می‌دهد.**
این یعنی چکی با همین شناسه قبلاً در سیستم ثبت شده است. ممکن است:

  * همکار دیگری قبلاً آن را ثبت کرده باشد.
  * این چک قبلاً دریافت شده، خرج شده و دوباره به شرکت برگشته است (گردش چک).
  * *راه حل:* از گزارش "جستجوی چک" استفاده کنید تا وضعیت قبلی این شناسه را ببینید.

**۴. آیا می‌توانم چند چک را در یک سند ثبت کنم؟**
بله. اگر مشتری همزمان ۵ فقره چک به شما می‌دهد، نیازی نیست ۵ سند جداگانه بزنید. در همان فرم سند دریافت، ۵ بار دکمه "افزودن ردیف" را بزنید و مشخصات هر چک را جداگانه وارد کنید. سیستم یک سند حسابداری کلی برای همه آن‌ها صادر می‌کند.

# استرداد چک - بازگرداندن به مشتری (Check Return)

**مسیر دسترسی:** `خزانه‌داری > مدیریت چک‌های دریافتی > عملیات چک > استرداد چک`

---

## ۱. مفهوم و کاربرد

### استرداد چک چیست؟
عملیات **استرداد** به معنای بازگرداندن فیزیک چک (لاشه چک) به صادرکننده آن (مشتری) و خارج کردن چک از چرخه دارایی‌های شرکت است.
در این حالت، چک نه نقد شده و نه خرج شده؛ بلکه معامله‌ای که بابت آن چک گرفته بودیم، به نحوی تغییر کرده است که باید چک را پس بدهیم.

### چه زمانی از این فرم استفاده می‌کنیم؟
این فرم در سه سناریوی اصلی کاربرد دارد:

1.  **فسخ معامله:** مشتری کالا را پس داده و چک خود را می‌خواهد.
2.  **تعویض چک (Replacement):** مشتری می‌خواهد چک فعلی را با یک چک جدید (تاریخ متفاوت) یا پول نقد عوض کند.
3.  **تسویه چک برگشتی:** چک برگشت خورده، مشتری می‌آید تسویه می‌کند و لاشه چک برگشتی را تحویل می‌گیرد.

> **نکته مهم:** استرداد چک باعث می‌شود حساب مشتری دوباره **بدهکار** شود (چون چکی که بابت پرداخت داده بود را پس گرفته است). بنابراین معمولاً قبل یا بعد از استرداد، یک سند دریافت دیگر (نقد یا چک جدید) ثبت می‌شود.

---

## ۲. پیش‌نیازهای سیستمی
برای استرداد یک چک، آن چک باید حتماً در یکی از مخازن زیر باشد:

* **مخزن اسناد نزد صندوق (Safe Repository):** برای چک‌های عادی که هنوز به بانک نرفته‌اند.
* **مخزن چک‌های برگشتی (Bounced Repository):** برای چک‌هایی که نکول شده‌اند.

> **هشدار:** شما نمی‌توانید چکی را که در وضعیت **«در جریان وصول» (نزد بانک)** است، مستقیماً به مشتری استرداد کنید. ابتدا باید آن را از بانک تحویل بگیرید (عملیات «استرداد از واگذاری») تا به صندوق برگردد، سپس به مشتری پس دهید.

---

## ۳. مراحل انجام کار

### گام ۱: انتخاب فیلترها
وارد فرم استرداد شوید. برای پیدا کردن چک، دو فیلد را تنظیم کنید:

1.  **مخزن فعلی:** مشخص کنید چک الان کجاست؟ (مثلاً "مخزن چک‌های برگشتی").
2.  **طرف حساب:** نام مشتری را انتخاب کنید.

### گام ۲: انتخاب چک
سیستم لیست چک‌های آن مشتری در آن مخزن خاص را نمایش می‌دهد.
چک (یا چک‌های) مورد نظر را تیک بزنید.

### گام ۳: ثبت استرداد
دکمه **«ثبت استرداد»** را بزنید. سیستم ممکن است از شما "بابت" یا "توضیحات" بخواهد (مثلاً: بابت تعویض با چک جدید).

---

## ۴. سناریوهای عملیاتی و اسناد حسابداری

بیایید دو مثال بسیار رایج در بازار کار ایران را بررسی کنیم.

### سناریوی ۱: تعویض چک (قبل از سررسید)
**داستان:** آقای رضایی چکی به مبلغ ۲۰ میلیون تومان برای تاریخ فردا دارد. تماس می‌گیرد و می‌گوید: "چکم پاس نمی‌شود، آن را پس بدهید و یک چک برای ۱۰ روز دیگر بگیرید."

**اقدامات شما در سیستم:**

1.  **مرحله استرداد:** به فرم «استرداد چک» می‌روید. مخزن "نزد صندوق" را انتخاب کرده و چک ۲۰ میلیونی را به آقای رضایی استرداد می‌کنید.
    * *اثر:* چک از سیستم خارج می‌شود. حساب آقای رضایی ۲۰ میلیون **بدهکار** می‌شود.
2.  **مرحله دریافت جدید:** به فرم «سند دریافت» می‌روید و چک جدید (تاریخ ۱۰ روز بعد) را ثبت می‌کنید.
    * *اثر:* چک جدید وارد سیستم می‌شود. حساب آقای رضایی ۲۰ میلیون **بستانکار** می‌شود.

> **سند حسابداری استرداد (خودکار):**

> * **بدهکار:** حساب‌های دریافتنی - آقای رضایی
> * **بستانکار:** اسناد دریافتنی نزد صندوق

---

### سناریوی ۲: تسویه چک برگشتی (پس از نکول)
**داستان:** چک ۵۰ میلیونی "شرکت پخش البرز" برگشت خورده و در **مخزن برگشتی** است. نماینده شرکت می‌آید، ۵۰ میلیون کارت می‌کشد (واریز نقد) و لاشه چک برگشتی را می‌برد.

**اقدامات شما در سیستم:**

1.  **مرحله دریافت پول:** ابتدا یک «سند دریافت» از نوع **نقد/کارت‌خوان** ثبت می‌کنید.
    * *اثر:* موجودی بانک شما ۵۰ میلیون زیاد می‌شود. حساب شرکت البرز ۵۰ میلیون **بستانکار** می‌شود.
2.  **مرحله استرداد لاشه:** به فرم «استرداد چک» می‌روید. مخزن **"چک‌های برگشتی"** را انتخاب می‌کنید. چک مورد نظر را تیک زده و استرداد می‌کنید.
    * *اثر:* چک از لیست برگشتی‌ها حذف می‌شود. حساب شرکت البرز ۵۰ میلیون **بدهکار** می‌شود.

> **تحلیل مانده حساب مشتری:**
> مشتری ۵۰ میلیون بدهکار شد (بابت گرفتن لاشه) و ۵۰ میلیون بستانکار شد (بابت واریز پول). پس مانده حسابش صفر و تسویه می‌شود.

> **سند حسابداری استرداد از برگشتی (خودکار):**

> * **بدهکار:** حساب‌های دریافتنی - شرکت پخش البرز
> * **بستانکار:** حساب اسناد دریافتنی برگشتی

---

## ۵. سوالات متداول (FAQ)

**سوال: آیا با استرداد چک، سابقه آن کلاً پاک می‌شود؟**
**پاسخ:** خیر، رکورد چک پاک نمی‌شود. وضعیت (Status) آن به **«استرداد شده» (Returned)** تغییر می‌کند و در گزارشات با رنگ متمایز نمایش داده می‌شود تا تاریخچه همکاری با مشتری حفظ شود.

**سوال: اگر بخواهم فقط بخشی از مبلغ چک را دریافت کنم و بقیه را چک جدید بگیرم چه؟**
**پاسخ:** فرآیند مشابه سناریوی تعویض است.

1.  چک قدیم را کامل **استرداد** می‌کنید (مشتری کل مبلغ را بدهکار می‌شود).
2.  یک سند دریافت ترکیبی ثبت می‌کنید: یک ردیف "نقد" (برای مبلغی که داده) و یک ردیف "چک جدید" (برای باقیمانده).

**سوال: اشتباهاً چک را استرداد کردم. چه کنم؟**
**پاسخ:** باید به لیست چک‌های استرداد شده بروید (یا از طریق گزارش کاردکس چک)، روی آن کلیک راست کرده و گزینه **«ابطال استرداد»** را بزنید. چک به مخزن قبلی خود باز می‌گردد.

# صورتحساب‌های بانکی (Bank Statements)
توضیح: موجودیت Header برای فایلی که از بانک دریافت می‌کنید (برای مغایرت‌گیری).

فیلدها:

Statement_ID (PK)

Bank_Account_ID (FK)

Statement_Date

Opening_Balance

Closing_Balance

ردیف صورتحساب بانکی (Bank Statement Line)

توضیح: ردیف‌های داخل فایل صورتحساب بانک.

فیلدها:

Statement_Line_ID (PK)

Statement_ID (FK)

Transaction_Date

Amount_Debit

Amount_Credit

Description (شرحی که بانک می‌زند)

Reconciled (Boolean - آیا این ردیف مغایرت‌گیری شده؟)

# اسناد دریافت و پرداخت (Payment/Receipt Documents)

---

## ۱. مفهوم و هدف

این فرم، **قلب تپنده و فرم عملیاتی اصلی** در ماژول خزانه‌داری است. بر اساس این اصل کلیدی طراحی شده است که:

> **اصل طلایی:** هیچ جابجایی وجهی (نقد، چک، یا حواله) در دنیای واقعی نباید اتفاق بیفتد، مگر آنکه یک «سند دریافت و پرداخت» متناظر در ERP تابان برای ردیابی آن ثبت شود.

این سند، موجودیت واحدی است که تمام ورودی‌ها، خروجی‌ها و جابجایی‌های داخلی وجوه نقد سازمان را ثبت می‌کند. این فرم، مسئول مستقیم تغییر موجودی بانک/صندوق و همچنین مبنای اصلی صدور **سند حسابداری خودکار** در دفتر کل (GL) است.

### انواع تراکنش‌های تحت پوشش

این فرم باید سه سناریوی اصلی را از طریق یک فیلد کلیدی به نام **«نوع سند» (Document Type)** مدیریت کند:

1.  **دریافت (Receipt):**
    * **هدف:** ثبت ورود وجه به سازمان.
    * **مثال‌ها:** دریافت چک از مشتری بابت فاکتور فروش، دریافت واریز نقدی بابت پیش‌پرداخت سفارش، دریافت درآمد متفرقه (مثلاً فروش ضایعات).
2.  **پرداخت (Payment):**
    * **هدف:** ثبت خروج وجه از سازمان.
    * **مثال‌ها:** صدور چک برای تأمین‌کننده بابت فاکتور خرید، پرداخت نقدی هزینه‌های مستقیم (مانند پیک)، پرداخت علی‌الحساب به کارمند.
3.  **انتقال (Transfer):**
    * **هدف:** ثبت جابجایی وجه بین دو حساب داخلی شرکت (بدون دخالت طرف حساب خارجی).
    * **مثال‌ها:** انتقال پول از «حساب بانک ملت» به «حساب بانک سامان»، یا انتقال وجه از «بانک» برای «شارژ صندوق تنخواه».

---

## ۲. ملاحظات کلیدی: مدیریت سناریوهای پرداخت

یک سند پرداخت ساده فقط پرداخت یک فاکتور است. اما یک ERP قدرتمند باید سناریوهای پیچیده‌تر را مدیریت کند. این فرم باید سه حالت اصلی ارتباط با طرف حساب را پوشش دهد:

### الف) پرداخت/دریافت بابت فاکتور (Standard)
* **مفهوم:** ساده‌ترین حالت. یک یا چند فاکتور مشخص وجود دارد و این سند برای تسویه (کامل یا بخشی از) آن‌ها صادر می‌شود.
* **نحوه اجرا:** این کار معمولاً در این فرم انجام **نمی‌شود**، بلکه در فرم «تسویه حساب» (Settlement) انجام می‌شود. این فرم فقط پول را دریافت یا پرداخت می‌کند (به بخش ۴، گام ۴ مراجعه کنید).

### ب) پیش‌پرداخت (Prepayment - مرتبط با سفارش)
* **مفهوم:** پرداختی که *قبل* از دریافت کالا/خدمات و *قبل* از صدور فاکتور انجام می‌شود، اما مستقیماً به یک **سفارش (PO/SO)** مشخص مرتبط است.
* **مثال سناریو:**
    * ما یک «سفارش خرید» (PO-1002) برای خرید مواد اولیه از «شرکت فولاد پارس» به مبلغ ۱ میلیارد ریال ثبت می‌کنیم.
    * فولاد پارس برای شروع کار، ۳۰۰ میلیون ریال پیش‌پرداخت می‌خواهد.
    * ما یک «سند پرداخت» (نوع: پرداخت) صادر می‌کنیم و در فیلد **«ارجاع به سفارش»**، کد PO-1002 را انتخاب می‌کنیم.
    * **نتیجه:** این ۳۰۰ میلیون به عنوان یک آیتم باز بستانکار روی PO-1002 می‌نشیند. زمانی که فاکتور نهایی ۱ میلیاردی از فولاد پارس می‌رسد، سیستم به صورت خودکار تشخیص می‌دهد که فقط ۷۰۰ میلیون ریال دیگر قابل پرداخت است.

### ج) علی‌الحساب (On-Account - شناور)
* **مفهوم:** پرداختی که در لحظه ثبت، به هیچ فاکتور یا سفارش *مشخصی* مرتبط نیست. این صرفاً واریز یا دریافت وجه به/از حساب یک طرف حساب است.
* **مثال سناریو:**
    * «شرکت ایران خودرو» (مشتری کلیدی ما) برای ساده‌سازی فرآیند، در ابتدای ماه یک حواله ۵ میلیارد ریالی به حساب ما واریز می‌کند.
    * ما یک «سند دریافت» (نوع: دریافت) به مبلغ ۵ میلیارد ریال به صورت «علی‌الحساب» برای ایران خودرو ثبت می‌کنیم.
    * **نتیجه:** این ۵ میلیارد به عنوان «اعتبار» (Credit) در حساب این مشتری می‌نشیند. طی ماه، ما ۱۰ فاکتور مختلف (مثلاً هر کدام ۲۰۰ میلیون ریال) برای ایران خودرو صادر می‌کنیم. در پایان هفته، حسابدار ما به فرم «تسویه حساب» (Settlement) رفته و آن ۱۰ فاکتور را با استفاده از این اعتبار ۵ میلیاردی تسویه می‌کند، بدون آنکه نیاز به ثبت سند دریافت جدیدی باشد.

### د) پرداخت هزینه مستقیم (Direct Expense - مرتبط با G/L)
* **مفهوم:** پرداختی که اصلاً به ماژول‌های خرید (AP) یا فروش (AR) مرتبط نیست. این پرداخت مستقیماً برای یک «حساب هزینه» در دفتر کل انجام می‌شود.
* **مثال سناریو:**
    * پرداخت هزینه پیک به مبلغ ۵۰۰,۰۰۰ ریال از «صندوق تنخواه».
    * پرداخت قبض برق ماهانه به مبلغ ۱۲,۰۰۰,۰۰۰ ریال از «حساب بانک».
* **نحوه اجرا:** در بخش «طرف حساب» (Partner)، کاربر به جای مشتری یا تأمین‌کننده، مستقیماً **«حساب معین G/L»** (مثلاً `6201010 - هزینه پیک` یا `6105020 - هزینه آب و برق`) را انتخاب می‌کند.

---

## ۳. فرم: سند دریافت و پرداخت (Payment/Receipt Document)

**مسیر:** `خزانه‌داری / عملیات / سند دریافت و پرداخت جدید`

این فرم از یک بخش «سربرگ» (اطلاعات کلی) و یک یا چند «ردیف» (جزئیات روش پرداخت) تشکیل شده است.

### بخش سربرگ (Header)

| نام فیلد               | نوع داده     | اجباری                    | توضیح و مثال‌ها                                                                                                                                                                                                                                                                               |
| :--------------------- | :----------- | :------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **بنگاه اقتصادی**      | انتخابی (FK) | بله                       | بنگاهی که تراکنش مالی را انجام می‌دهد.                                                                                                                                                                                                                                                        |
| **نوع سند**            | انتخابی      | بله                       | **(فیلد کنترلی اصلی)** `دریافت` / `پرداخت` / `انتقال`. (انتخاب این گزینه، رفتار سایر فیلدها را تغییر می‌دهد).                                                                                                                                                                                 |
| **تاریخ سند**          | تاریخ        | بله                       | تاریخ واقعی چک، حواله یا واریز نقدی.                                                                                                                                                                                                                                                         |
| **تاریخ ثبت**          | تاریخ        | بله                       | تاریخ ورود داده در سیستم (معمولاً خودکار = تاریخ روز).                                                                                                                                                                                                                                        |
| **طرف حساب (Partner)** | انتخابی (FK) | (بله، برای دریافت/پرداخت) | **(فیلد هوشمند)** <br> * **اگر پرداخت/دریافت استاندارد بود:** `مشتری` یا `تأمین‌کننده` را انتخاب می‌کنید (مثلاً: «شرکت فولاد پارس»). <br> * **اگر پرداخت هزینه مستقیم بود:** `حساب G/L` را انتخاب می‌کنید (مثلاً: «6201010 - هزینه پیک»). <br> * **اگر انتقال بود:** این فیلد غیرفعال/مخفی می‌شود. |
| **مبلغ کل**            | عددی         | بله                       | مبلغ کل سند. سیستم باید اعتبارسنجی کند که **مجموع ردیف‌ها = مبلغ کل**.                                                                                                                                                                                                                        |
| **شرح سند**            | متنی         | بله                       | توضیح کلی (مثلاً: «پرداخت علی‌الحساب بابت PO-1002»).                                                                                                                                                                                                                                           |
| **ارجاع به سفارش**     | انتخابی (FK) | خیر                       | (فقط برای سناریوی «پیش‌پرداخت») شماره سفارش فروش یا سفارش خرید.                                                                                                                                                                                                                               |

---

### بخش ردیف‌ها (Lines) - (جزئیات روش پرداخت)

کاربر می‌تواند برای یک سند، چندین ردیف اضافه کند. (مثال: پرداخت یک فاکتور ۵۰ میلیونی با ۱۰ میلیون نقد + یک چک ۴۰ میلیونی).

| نام فیلد            | نوع داده     | اجباری                        | توضیح و مثال‌ها                                                        |
| :------------------ | :----------- | :---------------------------- | :-------------------------------------------------------------------- |
| **روش پرداخت**      | انتخابی      | بله                           | `نقد` / `چک` / `حواله (انتقال بانکی)` / `کارت‌خوان (POS)`...           |
| **مبلغ**            | عددی         | بله                           | مبلغ مربوط به این ردیف خاص.                                           |
| **حساب/صندوق مبدأ** | انتخابی (FK) | (بله، برای `پرداخت`/`انتقال`) | حساب بانکی یا صندوقی که پول از آن *خارج* می‌شود. (مثلاً: «بانک ملت»)    |
| **حساب/صندوق مقصد** | انتخابی (FK) | (بله، برای `دریافت`/`انتقال`) | حساب بانکی یا صندوقی که پول به آن *وارد* می‌شود. (مثلاً: «صندوق مرکزی») |
| **شرح ردیف**        | متنی         | خیر                           | توضیحات جزئی (مثلاً: «چک اول از سه قسط»).                              |

---

### بخش ردیف‌ها: فیلدهای پویا بر اساس روش پرداخت

بخش ردیف‌ها باید هوشمند باشد و فیلدهای اضافی را فقط در صورت نیاز نشان دهد:

**الف) اگر روش = `چک` (پرداختی):**

* **حساب بانکی مبدأ:** (اجباری) حسابی که چک از دسته چک آن صادر می‌شود.
* **شماره سریال چک:** (اجباری) **لیست انتخابی** از سریال‌های «خام» ثبت شده در «دسته چک» آن حساب. (کاربر دستی وارد نمی‌کند، بلکه انتخاب می‌کند).
* **تاریخ سررسید:** (اجباری) تاریخ سررسید چک.
* **در وجه:** (متنی) نام گیرنده (معمولاً از سربرگ می‌آید).

**ب) اگر روش = `چک` (دریافتی):**

* **شماره سریال چک:** (متنی) کاربر شماره چک مشتری را **دستی** وارد می‌کند.
* **بانک چک:** (انتخابی FK) بانکی که چک مشتری روی آن است (از لیست بانک‌ها).
* **شعبه و کد:** (متنی) اطلاعات شعبه چک مشتری.
* **تاریخ سررسید:** (اجباری) تاریخ سررسید چک.
* **صاحب حساب:** (متنی) نام صاحب حساب چک (جهت ردیابی).

**ج) اگر روش = `حواله (انتقال بانکی)`:**

* **شماره پیگیری/ارجاع:** (متنی) کد رهگیری انتقال بانکی (ساتنا، پایا، یا شماره رسید).

---

## ۴. فرآیند پس از ثبت (Post-Registration Logic)

پس از اینکه کاربر دکمه «ثبت نهایی» (Post) را فشار می‌دهد، چهار اتفاق کلیدی *باید* در پشت صحنه رخ دهد:

1.  **ثبت نهایی (Posting):**
    * سند قفل می‌شود و دیگر قابل ویرایش نیست (مگر با فرآیند ابطال).
    * وضعیت آن از «پیش‌نویس» (Draft) به «ثبت شده» (Posted) تغییر می‌کند.

2.  **تأثیر بر موجودی (Cash Balance Impact):**
    * **برای نقد/حواله:** موجودی «حساب بانکی» یا «صندوق» انتخاب شده در ردیف‌ها، *بلافاصله* به‌روزرسانی (کم یا زیاد) می‌شود.
    * **برای چک (پرداختی/دریافتی):** موجودی بانک/صندوق *تغییر نمی‌کند*. چک فقط در ماژول «مدیریت چک» (Check Management) با وضعیت «صادر شده» یا «نزد صندوق» ثبت می‌شود. تأثیر واقعی بر موجودی بانک، بعداً در زمان «پاس شدن» یا «وصول» چک رخ خواهد داد.

3.  **ایجاد سند حسابداری (G/L Creation):**
    * مهم‌ترین بخش. سیستم باید *بلافاصله* و *به‌صورت خودکار* یک سند حسابداری در دفتر کل صادر کند. (نمونه‌ها در بخش ۵).

4.  **ایجاد آیتم باز (Open Item Creation):**
    * **اگر سند «علی‌الحساب» یا «پیش‌پرداخت» باشد:** یک «آیتم باز» (Open Item) در حساب طرف حساب (مشتری یا تأمین‌کننده) ایجاد می‌کند. این آیتم نشان‌دهنده اعتبار یا بدهی شناوری است که باید بعداً در فرم **«تسویه حساب» (Settlement Workbench)** با فاکتورها تسویه شود.

---

## ۵. نمونه اسناد حسابداری خودکار (G/L Journals)

این فرم باید اسناد زیر را به صورت خودکار ایجاد کند:

**سناریو ۱: دریافت نقدی علی‌الحساب از مشتری (10 م ریال به صندوق)**

* بدهکار: `11020101 - صندوق مرکزی` (10 م)
* بستانکار: `12010101 - حساب‌های دریافتنی - مشتری الف` (10 م)

**سناریو ۲: پرداخت هزینه مستقیم (پیک) از تنخواه (500 ه.ر)**

* بدهکار: `6201010 - هزینه پیک` (500 ه.ر)
* بستانکار: `11020105 - تنخواه بازرگانی` (500 ه.ر)

**سناریو ۳: صدور چک برای تأمین‌کننده (40 م ریال)**

* بدهکار: `21010101 - حساب‌های پرداختنی - تأمین‌کننده ب` (40 م)
* بستانکار: `21030101 - اسناد پرداختنی` (40 م)
*(توجه: حساب بانک هنوز بستانکار نمی‌شود تا زمان پاس شدن چک)*

**سناریو ۴: انتقال از بانک به صندوق (شارژ تنخواه - 5 م ریال)**

* بدهکار: `11020105 - تنخواه بازرگانی` (5 م)
* بستانکار: `11010001 - بانک ملت` (5 م)

# مفهوم و فرم: تسویه حساب (Settlement / Clearing)

---

## ۱. مفهوم

تسویه حساب، فرآیند حیاتی «اتصال» آیتم‌های بستانکار (مانند پرداخت‌ها، پیش‌پرداخت‌ها، اعتبارات) به آیتم‌های بدهکار (مانند فاکتورها) در حساب یک طرف حساب (مشتری یا تأمین‌کننده) است.

* **هدف:** صفر کردن مانده حساب آیتم‌های باز و تعیین وضعیت «تسویه شده» برای فاکتورها و پرداخت‌ها.
* **نیاز به تسویه (M:N):** این فرآیند ضروری است زیرا ارتباط بین فاکتور و پرداخت همیشه یک به یک (1:1) نیست:
    * **چند به یک (N:1):** یک مشتری ممکن است ۳ فاکتور باز را با ۱ چک پرداخت کند.
    * **یک به چند (1:N):** یک مشتری ممکن است ۱ فاکتور را در ۳ قسط پرداخت کند.
    * **چند به چند (M:N):** یک مشتری ممکن است ۲ فاکتور و بخشی از فاکتور سوم را با ۱ چک و ۱ واریز نقدی (که قبلاً علی‌الحساب پرداخت کرده) تسویه کند.

---

## ۲. فرم: میزکار تسویه حساب (Settlement Workbench)

این فرم یک ابزار تعاملی است که به کاربر (حسابدار) اجازه می‌دهد آیتم‌های باز یک طرف حساب را مشاهده و با هم تسویه کند.

**مسیر:**
`خزانه‌داری / عملیات / تسویه حساب مشتریان`
`خزانه‌داری / عملیات / تسویه حساب تأمین‌کنندگان`

### رابط کاربری (UX)

این فرم معمولاً به صورت زیر طراحی می‌شود:

1.  **انتخاب طرف حساب:** کاربر ابتدا مشتری یا تأمین‌کننده مورد نظر را انتخاب می‌کند.
2.  **نمایش دو ستونی:** سیستم تمامی آیتم‌های باز (Open Items) آن شخص را در دو ستون نمایش می‌دهد:

    * **ستون ۱: بدهی‌ها (Invoices / Debits):**
        * لیست تمام فاکتورهای فروش (برای مشتری) یا فاکتورهای خرید (برای تأمین‌کننده) که هنوز تسویه نشده‌اند.
        * شامل: شماره فاکتور، تاریخ، مبلغ کل، مبلغ باقیمانده.

    * **ستون ۲: بستانکاری‌ها (Payments / Credits):**
        * لیست تمام پرداخت‌های «علی‌الحساب».
        * پیش‌پرداخت‌های مرتبط.
        * برگشت از فروش‌ها (Credit Memos).
        * شامل: شماره سند پرداخت، تاریخ، مبلغ کل، مبلغ باقیمانده قابل تخصیص.

3.  **فرآیند تسویه (Matching):**
    * کاربر آیتم‌های مورد نظر از هر دو ستون را انتخاب (تیک) می‌کند.
    * *مثال:* انتخاب فاکتور ۱ (مبلغ ۱۰۰) و فاکتور ۲ (مبلغ ۵۰) از ستون ۱؛ و انتخاب پرداخت علی‌الحساب (مبلغ ۱۲۰) و پرداخت جدید (مبلغ ۳۰) از ستون ۲.
    * مجموع بدهی انتخاب شده = ۱۵۰
    * مجموع بستانکاری انتخاب شده = ۱۵۰

4.  **دکمه «تسویه» (Settle):**
    * کاربر دکمه تسویه را می‌زند.
    * سیستم بررسی می‌کند که مجموع دو طرف برابر باشد (یا در صورت تسویه جزئی، منطق آن رعایت شود).
    * سیستم وضعیت فاکتورها و پرداخت‌های انتخاب شده را به «تسویه شده» (Cleared) تغییر می‌دهد و رکوردهای ارتباطی (Settlement Line) را ایجاد می‌کند.

---

## ۳. تسویه خودکار (Automatic Settlement)

برای سادگی، سیستم می‌تواند یک دکمه «تسویه خودکار» نیز داشته باشد که بر اساس منطق FIFO (اولین فاکتور با اولین پرداخت) یا بر اساس شماره ارجاع یکسان، آیتم‌ها را به صورت خودکار تسویه کند.
