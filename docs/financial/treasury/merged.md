
# بانک‌ها (Banks)

## ۱. مقدمه: چرا باید نام بانک‌ها را تعریف کنیم؟

در سیستم ERP تابان، موجودیت **«بانک» (Bank)** سنگ بنای تمام عملیات مالی است. این فرم، **لیست مرجع (Reference List)** تمام موسسات مالی و اعتباری مجاز در شبکه بانکی کشور را نگهداری می‌کند.

دقت کنید که در این مرحله، شما **شماره حساب** یا **شعبه** تعریف نمی‌کنید؛ بلکه فقط هویت اصلی بانک (برند بانک) را ثبت می‌کنید.

**چرا نمی‌توانیم نام بانک را دستی تایپ کنیم؟**
اگر این لیست مرجع وجود نداشته باشد، کاربران نام بانک را به سلیقه خود وارد می‌کنند (یکی می‌نویسد "ملت"، دیگری "بانک ملت"، سومی "Mellat").
این عدم یکپارچگی باعث فاجعه در سیستم می‌شود:

1.  **گزارش‌گیری غلط:** سیستم نمی‌تواند بفهمد که "ملت" و "بانک ملت" یکی هستند.
2.  **عدم اعتبارسنجی:** سیستم نمی‌تواند شماره شبا (IBAN) یا شناسه صیادی چک را کنترل کند (چون الگوریتم هر بانک متفاوت است).
3.  **مغایرت بانکی:** فایل اکسل بانک با سیستم تطبیق پیدا نمی‌کند.

-----

## ۲. راهنمای تکمیل فرم

**مسیر دسترسی:** `خزانه‌داری > تعاریف پایه > بانک‌ها`

این فرم معمولاً یک‌بار در زمان استقرار سیستم توسط مدیر سیستم پر می‌شود (یا به صورت آماده بارگذاری می‌شود).

| عنوان فیلد (در نرم‌افزار) | نام فنی (Technical) | نوع داده | راهنمای تکمیل و منطق سیستم |
| :--- | :--- | :--- | :--- |
| **شناسه سیستمی** | `ID` | Integer (PK) | **(فنی)** کلید اصلی جدول (تولید خودکار). |
| **کد سیستم** | `Code` | String (Unique) | یک کد کوتاه لاتین برای استفاده در سیستم. <br> *مثال:* `MEL` برای ملت، `BMI` برای ملی. |
| **نام بانک** | `Name` | String | نام کامل و رسمی بانک طبق مجوز بانک مرکزی. <br> *مثال:* `بانک پاسارگاد` |
| **کد بانک مرکزی** | `CentralBankCode` | String (digits) | **(حیاتی برای چک صیادی)** <br> کد ۲ یا ۳ رقمی که بانک مرکزی به هر بانک اختصاص داده است. <br> *مثال:* `057` برای پاسارگاد، `012` برای ملت. <br> *منطق سیستم:* سیستم هنگام ثبت چک صیادی، با استفاده از این کد بررسی می‌کند که آیا شناسه ۱۶ رقمی چک معتبر است یا خیر. |
| **کد سوئیفت** | `SwiftCode` | String | کد شناسایی بین‌المللی بانک (برای شرکت‌هایی که تراکنش ارزی/صرافی دارند). |
| **نام لاتین** | `EnName` | String | نام انگلیسی بانک (اختیاری). |
| **لینک اینترنت بانک** | `WebsiteURL` | URL | لینک صفحه لاگین بانکداری شرکتی. <br> *ارزش افزوده:* حسابدار می‌تواند در داشبورد خود روی لوگوی بانک کلیک کرده و مستقیم وارد سایت بانک شود. |
| **لوگو/آیکون** | `LogoBlob` | Image/Binary | فایل تصویر لوگوی بانک. <br> *کاربرد:* نمایش در لیست کارت‌خوان‌ها (POS) و گزارش موجودی نقدینگی برای تشخیص بصری سریع. |
| **رنگ سازمانی** | `ColorHex` | String (Hex) | (اختیاری) کد رنگ برند بانک (مثلاً `#FFD700` برای پاسارگاد). جهت زیباسازی نمودارها. |
| **وضعیت** | `IsActive` | Boolean | اگر بانکی منحل شد (مثل ادغام بانک‌های نظامی در سپه)، تیک فعال را بردارید. **هرگز بانک را حذف نکنید** تا تاریخچه چک‌های قدیمی خراب نشود. |

-----

## ۳. معماری درختی: بانک، شعبه یا حساب؟

بسیاری از کاربران در تفکیک این سه مفهوم دچار اشتباه می‌شوند. ساختار درختی سیستم تابان به شکل زیر است:

1.  **سطح اول (ریشه): بانک (Bank)**

      * *ماهیت:* برند موسسه مالی.
      * *مثال:* بانک ملی ایران.
      * *محل تعریف:* همین فرم جاری.

2.  **سطح دوم (فرزند): شعبه (Bank Branch)**

      * *ماهیت:* ساختمان فیزیکی بانک در یک شهر/منطقه خاص.
      * *مثال:* شعبه بازار، کد ۱۲۳.
      * *محل تعریف:* فرم «مدیریت شعب» (وابسته به سطح ۱).

3.  **سطح سوم (فرزندِ فرزند): حساب بانکی (Bank Account)**

      * *ماهیت:* شماره حساب مالی شرکت شما در آن شعبه.
      * *مثال:* جاری ۰۱۰۵۵۵۵۵۵۰۰۰۱.
      * *محل تعریف:* فرم «حساب‌های بانکی» (وابسته به سطح ۱ و ۲).

-----

## ۴. نکات پیاده‌سازی (ویژه تیم فنی و استقرار)

### الف) داده‌های اولیه

تجربه کاربری (UX) حرفه‌ای حکم می‌کند که کاربر نهایی مجبور نباشد نام ۳۰ بانک کشور را دستی وارد کند.
**پیشنهاد:** تیم فنی باید اسکریپتی (Migration Script) آماده کند که لیست تمام بانک‌های فعال ایران را همراه با `Code`، `CentralBankCode` و `Logo` به صورت پیش‌فرض در دیتابیس درج کند.

  * *بانک ملی:* Code=`BMI`, CB=`017`
  * *بانک ملت:* Code=`MEL`, CB=`012`
  * *بانک صادرات:* Code=`BSI`, CB=`019`
  * *...*

### ب) اعتبارسنجی‌ها (Validations)

1.  **یکتایی نام:** سیستم نباید اجازه دهد دو بانک با نام `Name` یکسان ثبت شوند.
2.  **یکتایی کد بانک مرکزی:** این فیلد بسیار حساس است و نباید تکراری باشد.
3.  **حذف ممنوع (Soft Delete):** اگر رکوردی در جدول `Cheques` یا `BankAccounts` وجود دارد که به `BankID=5` ارجاع می‌دهد، حذف فیزیکی بانک شماره ۵ باید مسدود شود.

-----

## ۵. پرسش‌های متداول (FAQ)

**س: آیا اگر با بانک «آینده» کار نمی‌کنیم، باز هم باید آن را تعریف کنیم؟**

پ: بله\! شاید خودتان در آنجا حساب نداشته باشید، اما ممکن است مشتری شما چکی از بانک آینده به شما بدهد. برای ثبت آن چک، نام بانک آینده باید در سیستم باشد. به همین دلیل توصیه می‌کنیم لیست تمام بانک‌های کشور را فعال نگه دارید.

**س: اگر دو بانک ادغام شدند (مثل بانک انصار در سپه) چه کنیم؟**

پ: بانک قدیمی (انصار) را غیرفعال (`IsActive = False`) کنید و بانک جدید (سپه) را فعال نگه دارید. سوابق چک‌های قدیمی انصار با همان نام "انصار" باقی می‌مانند، اما برای چک‌های جدید باید "سپه" انتخاب شود.

**س: کد بانک مرکزی را از کجا پیدا کنیم؟**

پ: این کد معمولاً همان ۳ رقم یا ۲ رقم اول شماره حساب‌های متمرکز یا بخشی از شماره شبا است. همچنین در لیست‌های رسمی سایت بانک مرکزی (شاپرک) موجود است. (اگر از داده‌های پیش‌فرض سیستم استفاده کنید، نیازی به جستجو ندارید).

# حساب‌های بانکی (Bank Accounts)

## ۱. مقدمه: حساب بانکی در سیستم یعنی چه؟

موجودیت **«حساب بانکی» (Bank Account)** نقطه تلاقی عملیات خزانه‌داری و حسابداری مالی است.
این فرم، نماینده دیجیتالی حساب واقعی است که شرکت شما در یکی از شعب بانک‌ها افتتاح کرده است.

**تفاوت این فرم با فرم «بانک» چیست؟**
بسیاری از کاربران این دو را اشتباه می‌گیرند:

  * **فرم بانک (فصل ۱):** فقط نام برند را نگه می‌دارد (مثلاً: "بانک ملت"). مثل نام یک شرکت خودروسازی.
  * **فرم حساب بانکی (این فصل):** مشخصات دقیق مالی شما را نگه می‌دارد (مثلاً: "حساب جاری ۱۰۴۴ شعبه ونک"). مثل پلاک یک خودروی خاص.

> **قانون طلایی:** تمام واریزها (Receipts)، برداشت‌ها (Payments)، صدور چک‌ها و مغایرت‌گیری‌ها، روی **«حساب بانکی»** انجام می‌شود، نه روی نام بانک.

-----

## ۲. انواع حساب‌های بانکی (دسته‌بندی)

قبل از تعریف حساب، باید ماهیت آن را در سیستم مشخص کنید (فیلد `AccountType`). این کار تعیین می‌کند چه عملیاتی روی حساب مجاز است:

| نوع حساب | نام فنی (Enum) | ویژگی‌ها و محدودیت‌ها |
| :--- | :--- | :--- |
| **۱. حساب جاری** | `Current` / `Checking` | **(پرکاربردترین)** <br> *ویژگی:* قابلیت تعریف دسته چک دارد. برای واریز و برداشت روزمره استفاده می‌شود. |
| **۲. حساب پس‌انداز/کوتاه مدت** | `Savings` / `Deposit` | *ویژگی:* معمولاً سود به آن تعلق می‌گیرد. **قابلیت تعریف دسته چک ندارد.** فقط واریز/برداشت اینترنتی مجاز است. |
| **۳. حساب ارزی** | `ForeignCurrency` | *ویژگی:* مخصوص نگهداری ارز (دلار/یورو). سیستم اجازه تراکنش ریالی روی آن را نمی‌دهد. |
| **۴. حساب تنخواه کارت** | `CorporateCard` | *ویژگی:* کارت بانکی که دست پرسنل است اما به حساب شرکت متصل است. |

-----

## ۳. راهنمای تکمیل فرم تعریف حساب بانکی

**مسیر دسترسی:** `خزانه‌داری > تعاریف پایه > حساب‌های بانکی`

لطفاً فیلدها را با دقت و بر اساس اطلاعات دفترچه حساب یا قرارداد بانک پر کنید.

### الف) اطلاعات شناسنامه حساب (General Info)

| عنوان فیلد | نام فنی (Technical) | نوع داده | راهنمای تکمیل و منطق سیستم |
| :--- | :--- | :--- | :--- |
| **بنگاه اقتصادی** | `LegalEntityID` | FK | **(حیاتی)** مالک قانونی حساب کیست؟ <br> *منطق:* تمام اسناد حسابداری این حساب در دفاتر کل (General Ledger) این شرکت ثبت می‌شود. |
| **کد داخلی** | `Code` | String | یک کد کوتاه برای استفاده سریع در سیستم (مثلاً `MEL-01`). |
| **نام حساب** | `Title` | String | نام توصیفی جهت نمایش در گزارشات. <br> *مثال:* `جاری فراگیر ملت - مرکزی (حقوق)` |
| **بانک عامل** | `BankID` | FK | حساب نزد کدام بانک است؟ (انتخاب از لیست بانک‌های تعریف شده در فصل ۱). |
| **شعبه** | `BranchID` | FK | حساب در کدام شعبه افتتاح شده؟ (انتخاب از لیست شعب تعریف شده). |
| **شماره حساب** | `AccountNumber` | String | شماره حساب اصلی (فقط عدد وارد کنید، بدون خط تیره). |
| **شماره شبا (IBAN)** | `IBAN` | String | شماره ۲۴ یا ۲۶ رقمی استاندارد بین‌المللی. <br> **کنترل سیستمی:** سیستم به صورت خودکار صحت شبا را بررسی می‌کند. وجود شبا برای پرداخت‌های پایا و ساتنا الزامی است. |
| **نوع حساب** | `AccountType` | Enum | جاری، پس‌انداز و ... (طبق جدول بالا). |
| **ارز** | `CurrencyID` | FK | ارز پایه حساب. <br> *نکته:* پس از ثبت اولین تراکنش، این فیلد غیرقابل تغییر می‌شود. |
| **وضعیت** | `IsActive` | Boolean | اگر حساب بسته شد، آن را غیرفعال کنید. |

### ب) تنظیمات مالی و حسابداری (Accounting Configuration)

این بخش قلب اتصال به حسابداری است.

| عنوان فیلد | نام فنی (Technical) | راهنمای تکمیل |
| :--- | :--- | :--- |
| **حساب معین (GL)** | `GLAccountID` | **(مهمترین فیلد)** کد حسابداری که موجودی این بانک را در ترازنامه نشان می‌دهد. <br> *مثال:* `۱۱۰۱۰۰۱ - موجودی نقد بانک ملت` |
| **حساب واسط (مغایرت)** | `ClearingGLAccountID` | (اختیاری/پیشرفته) حسابی برای ثبت موقت تراکنش‌ها. <br> *کاربرد:* وقتی چک صادر می‌کنید، مبلغ ابتدا در این حساب بستانکار می‌شود و وقتی در پرینت بانک دیدید (پاس شد)، به حساب اصلی منتقل می‌شود. (روش استاندارد جهانی). |
| **فرمت پرداخت** | `PaymentFormat` | Enum | فرمت فایل خروجی برای پرداخت گروهی. <br> *مثال:* `Mellat_Paya_Excel`. اگر این را ست کنید، در زمان پرداخت حقوق، سیستم فایل دیسکت بانک را می‌سازد. |
| **سقف اعتبار (Overdraft)** | `OverdraftLimit` | Amount | (اختیاری) اگر بانک به شما اجازه داده تا سقف معینی منفی شوید (تسهیلات آنی)، اینجا وارد کنید. |
| **حداقل موجودی** | `MinBalanceAlert` | Amount | اگر موجودی کمتر از این شد، سیستم هشدار دهد (برای جلوگیری از برگشت خوردن چک‌های شرکت). |

-----

## ۴. سناریوهای عملیاتی: کار با حساب بانکی

### سناریو ۱: افتتاح حساب و واریز سرمایه

**داستان:** شرکت حساب جاری جدیدی در **بانک پاسارگاد** باز کرده و ۱ میلیارد ریال واریز کرده است.

1.  **تعریف:** کاربر فرم را پر می‌کند. نوع حساب را «جاری» و ارز را «ریال» می‌گذارد.
2.  **سند واریز:** در بخش «سند دریافت»، یک واریز نقدی ثبت می‌کند.
      * **[بدهکار]:** حساب معین بانک پاسارگاد (۱,۰۰۰,۰۰۰,۰۰۰)
      * **[بستانکار]:** حساب جاری شرکا (۱,۰۰۰,۰۰۰,۰۰۰)

### سناریو ۲: تعریف دسته چک برای حساب

**داستان:** بانک یک دسته چک ۵۰ برگی (صیادی) به ما داده است.

1.  **پیش‌شرط:** نوع حساب حتماً باید `Current` (جاری) باشد.
2.  **عملیات:** کاربر به منوی **«دسته چک‌ها»** می‌رود.
3.  **انتخاب حساب:** حساب پاسارگاد را انتخاب می‌کند.
4.  **ثبت:** سریال شروع و پایان را وارد می‌کند.
      * *نتیجه:* از این پس، وقتی بخواهید «سند پرداخت چکی» صادر کنید و بانک پاسارگاد را انتخاب کنید، سیستم به طور خودکار شماره چک بعدی را پیشنهاد می‌دهد.

### سناریو ۳: پرداخت حقوق (پرداخت گروهی پایا)

**داستان:** پایان ماه است و باید حقوق ۲۰۰ کارمند واریز شود.

1.  **تنظیمات:** در تعریف حساب، فیلد `PaymentFormat` را روی "فرمت پایا بانک پاسارگاد" گذاشته‌ایم.
2.  **عملیات:** در ماژول حقوق، دکمه "صدور فایل بانک" را می‌زنیم.
3.  **خروجی:** سیستم یک فایل متنی/اکسل با ساختار استاندارد بانک می‌سازد.
4.  **اجرا:** فایل را در اینترنت بانک آپلود می‌کنیم و یک سند کل حسابداری می‌زنیم:
      * **[بدهکار]:** حقوق پرداختنی.
      * **[بستانکار]:** حساب بانک پاسارگاد.

-----

## ۵. کنترل‌های هوشمند سیستم (System Validations)

برای جلوگیری از خطاهای انسانی، سیستم این موارد را چک می‌کند:

1.  **قفل دسته چک:**
      * اگر نوع حساب «پس‌انداز» باشد، دکمه "تعریف دسته چک" برای آن غیرفعال می‌شود.
2.  **صحت‌سنجی شبا (IBAN Check):**
      * کاربر نمی‌تواند شبای اشتباه تایپ کند. سیستم الگوریتم `MOD-97` را اجرا می‌کند. اگر اشتباه باشد، ذخیره نمی‌کند.
3.  **یکتایی شماره حساب:**
      * امکان ثبت دو شماره حساب تکراری در یک بانک وجود ندارد.
4.  **کنترل بنگاه اقتصادی:**
      * در زمان پرداخت فاکتور، سیستم چک می‌کند که آیا این حساب بانکی متعلق به همان شرکتی است که فاکتور برایش صادر شده؟ (جلوگیری از پرداخت‌های اشتباه بین شرکتی).

-----

## ۶. گزارش‌های کلیدی

  * **دفتر بانک (Bank Ledger):** ریز تمام تراکنش‌های واریز و برداشت ثبت شده در سیستم (شبیه پرینت بانک).
  * **صورت مغایرت بانکی (Bank Reconciliation):** جدولی که نشان می‌دهد چرا موجودی سیستم با موجودی واقعی بانک فرق دارد؟ (مثلاً ۳ فقره چک صادر شده که هنوز نقد نشده‌اند).
  * **پیش‌بینی نقدینگی (Cash Forecast):**
      * موجودی فعلی
      * (+) چک‌های دریافتی که فردا وصول می‌شوند
      * (-) چک‌های پرداختی که فردا باید پاس شوند
      * (=) موجودی قابل برنامه‌ریزی فردا.

-----

## ۷. پرسش‌های متداول (FAQ)

**س: حساب واسط (Clearing Account) به چه دردی می‌خورد؟**

**پ:** این یک روش حرفه‌ای حسابداری است. وقتی چکی صادر می‌کنید، به جای اینکه مستقیم از "موجودی بانک" کم کنید، مبلغ را در "حساب واسط" می‌برید. وقتی چک واقعاً پاس شد (در پرینت بانک دیدید)، مبلغ را از واسط به بانک اصلی می‌برید. این کار باعث می‌شود مغایرت‌گیری بسیار ساده‌تر شود.

**س: آیا می‌توانم ارز حساب را بعداً تغییر دهم؟**

**پ:** خیر. به محض ثبت اولین تراکنش، ارز قفل می‌شود. اگر نیاز به تغییر دارید، باید یک حساب جدید تعریف کنید و موجودی را منتقل کنید.

**س: اگر شماره شبا را نداشته باشم چه؟**

**پ:** می‌توانید فعلاً آن را خالی بگذارید (اگر اجباری نکرده باشید)، اما توجه کنید که بدون شبا، امکان استفاده از قابلیت‌های پرداخت گروهی (پایا/ساتنا) را نخواهید داشت.

# شعب بانک‌ها (Bank Branches)

## ۱. مفهوم و کاربرد

در ساختار بانکی، هر **«بانک»** (مثل بانک ملی) از صدها یا هزاران **«شعبه»** فیزیکی تشکیل شده است.
موجودیت **«شعبه» (Branch)** در سیستم تابان، حلقه اتصال بین "نام بانک" و "شماره حساب" شماست.

**چرا باید شعبه را تعریف کنیم؟**

1.  **برای حساب‌های خودمان:** وقتی می‌خواهید حساب جاری شرکت را تعریف کنید، سیستم باید بداند این حساب در کدام شعبه افتتاح شده است (مثلاً شعبه بازار یا شعبه شهرک صنعتی). این موضوع برای مکاتبات بانکی و دریافت دسته چک مهم است.
2.  **برای چک‌های مشتریان:** دانستن شعبه صادرکننده چک، در زمان واگذاری چک به بانک (کلر) یا پیگیری چک‌های برگشتی، به شما کمک می‌کند تا بدانید باید به کدام منطقه جغرافیایی مراجعه کنید.

-----

## ۲. راهنمای تکمیل فرم تعریف شعبه

**مسیر دسترسی:** `خزانه‌داری > تعاریف پایه > شعب بانک‌ها`

این فرم معمولاً زمانی استفاده می‌شود که شرکت حساب جدیدی افتتاح می‌کند یا مشتری چک مهمی از شعبه‌ای خاص می‌آورد.

### مشخصات فیلدها

| عنوان فیلد (در نرم‌افزار) | نام فنی (English Field) | نوع داده | الزامی | راهنمای تکمیل و منطق سیستم |
| :--- | :--- | :--- | :--- | :--- |
| **شناسه** | `ID` | Int (PK) | **بله** | کلید اصلی. |
| **بانک عامل** | `BankID` | FK | **بله** | این شعبه زیرمجموعه کدام بانک است؟ (انتخاب از لیست بانک‌های تعریف شده). <br> *مثال:* `بانک ملت` |
| **کد شعبه** | `Code` | متن/عدد | **بله** | کدی که بانک به آن شعبه اختصاص داده است. <br> **قانون سیستم:** ترکیب "نام بانک" + "کد شعبه" باید یکتا باشد. (بانک ملت نمی‌تواند دو شعبه با کد ۶۵۴ داشته باشد). |
| **نام شعبه** | `Name` | متن | **بله** | نام رسمی شعبه. <br> *مثال:* `شعبه مرکزی` یا `شعبه خیابان انقلاب` |
| **استان / شهر** | `CityID` / `ProvinceID` | FK | خیر | محل جغرافیایی شعبه. (برای گزارش‌گیری: مثلاً "چقدر چک از مشتریان اصفهان داریم؟"). |
| **آدرس** | `Address` | متن | خیر | آدرس پستی دقیق شعبه. |
| **تلفن/فکس** | `Phone` | متن | خیر | شماره تماس رئیس یا معاون شعبه (برای پیگیری‌های اضطراری چک‌های برگشتی). |
| **وضعیت** | `IsActive` | چک‌باکس | **بله** | اگر شعبه‌ای تعطیل یا ادغام شد، آن را غیرفعال کنید. |

-----

## ۳. معماری سیستم: جایگاه شعبه کجاست؟

درک این ساختار درختی برای کاربران و برنامه‌نویسان حیاتی است:

1.  **سطح ۱ (پدر): بانک** (مثلاً: بانک صادرات)
      * *کاربرد:* برندینگ و الگوریتم‌های اعتبارسنجی.
2.  **سطح ۲ (فرزند): شعبه** (مثلاً: شعبه میدان ولیعصر - کد ۱۹۲۰)
      * *کاربرد:* مکان فیزیکی و کدینگ داخلی بانک.
      * *محل تعریف:* همین فرم جاری.
3.  **سطح ۳ (نوه\!): حساب بانکی** (مثلاً: جاری ۰۱۰۰۵۵۵۵)
      * *کاربرد:* موجودیت مالی و حسابداری.

> **نکته فنی:** یک حساب بانکی (`BankAccount`) حتماً باید به یک شعبه (`Branch`) متصل باشد. و آن شعبه حتماً باید به یک بانک (`Bank`) متصل باشد.

-----

## ۴. سناریوهای کاربردی

### سناریو ۱: افتتاح حساب جدید برای شرکت

مدیر مالی حساب جدیدی در "بانک سپه، شعبه بلوار کشاورز" باز کرده است.

1.  ابتدا چک می‌کنیم آیا "بانک سپه" در سیستم هست؟ (اگر نه، در فرم بانک‌ها می‌سازیم).
2.  سپس به فرم **«شعب بانک‌ها»** می‌آییم. بانک سپه را انتخاب و شعبه "بلوار کشاورز" با کد "۱۵۴۰" را تعریف می‌کنیم.
3.  حالا می‌توانیم در فرم "حساب‌های بانکی"، حساب جاری جدید را به این شعبه متصل کنیم.

### سناریو ۲: ثبت چک مشتری (شعبه جدید)

مشتری چکی از "بانک تجارت شعبه بازار فرش" می‌دهد.

  * **روش سخت‌گیرانه:** کاربر ابتدا باید برود شعبه "بازار فرش" را تعریف کند، سپس چک را ثبت کند.
  * **روش منعطف (پیشنهادی):** در فرم ثبت چک، اگر شعبه مهم نیست، کاربر می‌تواند یک شعبه عمومی (مثلاً "شعبه متفرقه") انتخاب کند یا سیستم اجازه دهد نام شعبه را به صورت متنی (بدون نیاز به تعریف در این فرم) تایپ کند.
      * *توصیه:* برای حساب‌های خودِ شرکت، تعریف شعبه **اجباری** است. برای چک‌های مشتریان، معمولاً نام شعبه را به صورت فیلد متنی آزاد (Free Text) در همان فرم چک می‌گیرند تا سرعت کار بالا برود، مگر اینکه ردیابی دقیق جغرافیایی مد نظر باشد.

-----

## ۵. کنترل‌های سیستمی (Validations)

1.  **یکتایی کد در سطح بانک:**
      * بانک `A` می‌تواند شعبه `100` داشته باشد.
      * بانک `B` هم می‌تواند شعبه `100` داشته باشد.
      * اما بانک `A` نمی‌تواند **دو** شعبه با کد `100` داشته باشد.
2.  **وابستگی داده‌ها (Foreign Key Constraint):**
      * اگر حسابی در سیستم دارید که متعلق به "شعبه مرکزی" است، سیستم نباید اجازه دهد شما "شعبه مرکزی" را حذف کنید.

-----

## ۶. پرسش‌های متداول (FAQ)

**س: آیا باید لیست تمام ۳۰۰۰ شعبه بانک ملی در ایران را وارد کنیم؟**

پ: **خیر\!** اصلاً نیازی نیست. شما فقط شعبی را تعریف می‌کنید که:

1.  خودتان در آن حساب دارید.
2.  یا مشتریان کلیدی شما در آن حساب دارند و می‌خواهید آدرس و تلفن آن شعبه را برای پیگیری‌های بعدی داشته باشید.

**س: کد شعبه را از کجا پیدا کنیم؟**

پ: این کد معمولاً روی بالای برگه چک، یا در دفترچه حساب بانکی چاپ شده است. همچنین در لیست شعب سایت اینترنتی بانک‌ها موجود است.

**س: اگر کد شعبه را اشتباه وارد کنیم چه می‌شود؟**

پ: در سیستم داخلی شما اتفاق خاصی نمی‌افتد، اما اگر بخواهید فایل پایا/ساتنا بسازید یا چک را به بانک واگذار کنید، ممکن است مغایرت اطلاعاتی پیش بیاید. پس دقت در ورود کد شعبه (که معمولاً ۴ یا ۵ رقمی است) مهم است.

# صندوق‌های نقدی (Cash Boxes)

## ۱. مقدمه: صندوق نقدی چیست؟

در سیستم ERP تابان، **«صندوق نقدی»** (Cash Box) نماینده دیجیتالی و آینه تمام‌نمای هر محفظه فیزیکی است که در سازمان شما برای نگهداری **پول نقد (اسکناس و مسکوکات)** استفاده می‌شود.

این موجودیت به شما کمک می‌کند تا دقیقاً بدانید در هر لحظه، در هر کشو، گاوصندوق، دخل فروشگاه یا کیف پولِ تنخواه‌گردان شرکت، دقیقاً چقدر پول وجود دارد و این پول متعلق به کدام بخش است.

> **⛔️ هشدار حیاتی برای کاربران:**
> این ماژول **فقط و فقط** مخصوص ثبت **«پول نقد»** است.
>
>   * **چک دریافتی:** اگر چک دریافت کرده‌اید، جای آن اینجا نیست\! باید در ماژول **«صندوق اسناد»** ثبت شود.
>   * **موجودی بانک:** اگر پول در حساب بانکی است، باید در ماژول **«بانک‌ها»** مدیریت شود.
>   * **اشتباه رایج:** ترکیب کردن موجودی نقد و چک در یک صندوق، باعث مغایرت در گزارش‌های خزانه‌داری و به هم ریختن ترازنامه می‌شود. لطفاً جداگانه ثبت کنید.

-----

## ۲. انواع صندوق‌هایی که باید بشناسید

برای نظم‌دهی به جریان وجوه نقد، باید ماهیت هر صندوق را مشخص کنید. در سیستم، فیلد نوع صندوق نقدی `CashBoxType` رفتار و کنترل‌های صندوق را تعیین می‌کند:

| نوع صندوق | نام فنی (System Enum) | کاربرد و منطق رفتاری |
| :--- | :--- | :--- |
| **۱. صندوق فروش (عملیاتی)** | `POS` / `Operational` | **(ورودی پول)** مخصوص باجه‌های دریافت پول از مشتریان است. <br> *ویژگی:* ماهیت "افزاینده" دارد. معمولاً سقف نگهداری دارد و باید در پایان روز به خزانه یا بانک تخلیه شود. |
| **۲. تنخواه گردان** | `PettyCash` | **(خروجی پول)** مخصوص پرداخت هزینه‌های جزئی (پیک، پذیرایی، خرید خرد). <br> *ویژگی:* ماهیت "کاهنده" دارد. از مکانیزم "شارژ مجدد" (Replenishment) استفاده می‌کند. |
| **۳. صندوق مرکزی (خزانه)** | `MainVault` | **(مخزن اصلی)** گاوصندوق اصلی شرکت که وجوه نقد سایر صندوق‌ها در آن جمع‌آوری شده و سپس به بانک واریز می‌شود. |

-----

## ۳. راهنمای تکمیل فرم تعریف صندوق

**مسیر دسترسی:** `خزانه‌داری > تعاریف پایه > صندوق‌های نقدی`

برای ایجاد یک صندوق جدید، فیلدهای زیر را تکمیل کنید. (ستون نام فنی برای تیم توسعه است).

### الف) اطلاعات شناسنامه صندوق (General Info)

| عنوان فیلد | نام فنی (Technical) | راهنمای تکمیل و منطق سیستم |
| :--- | :--- | :--- |
| **کد صندوق** | `Code` | یک کد کوتاه و یکتا وارد کنید (مثلاً `C-101`). |
| **نام صندوق** | `Name` | نامی کامل و گویا انتخاب کنید. <br> *مثال:* `تنخواه گردان واحد بازرگانی - آقای حسینی` |
| **بنگاه اقتصادی** | `LegalEntityID` | مالک قانونی این پول کدام شرکت شماست؟ <br> *نکته فنی:* سند حسابداری در دفاتر کل (GL) این شرکت ثبت می‌شود. انتقال پول بین دو صندوق از دو بنگاه مختلف، نیازمند سند "حساب جاری شرکا" است. |
| **مکان عملیاتی** | `OperatingUnitID` | این صندوق فیزیکاً در کدام ساختمان یا شعبه است؟ (مثلاً: کارخانه کرج). <br> *کاربرد:* فیلتر کردن دسترسی کاربران بر اساس شعبه. |
| **مسئول صندوق** | `CustodianID` | چه کسی کلید این صندوق را دارد؟ <br> *منطق سیستم:* اگر در صندوق‌گردانی کسری دیده شود، سیستم به طور پیش‌فرض نام این شخص را در شرح سند کسری درج می‌کند. |
| **وضعیت** | `IsActive` | اگر صندوقی جمع‌آوری شد، آن را غیرفعال کنید (حذف نکنید تا سوابق بماند). |

### ب) تنظیمات مالی (Financial Settings)

| عنوان فیلد | نام فنی (Technical) | راهنمای تکمیل |
| :--- | :--- | :--- |
| **ارز** | `CurrencyID` | این صندوق چه پولی نگه می‌دارد؟ (ریال، دلار، یورو). <br> **قانون سخت‌گیرانه:** هر صندوق فقط **یک نوع ارز** قبول می‌کند. برای ارزهای مختلف، باید صندوق‌های جداگانه بسازید. |
| **حساب معین** | `GLAccountID` | کد حسابداری متصل به این صندوق در ترازنامه. <br> *مثال:* `۱۱۰۲۰۰۱ - موجودی نقد نزد صندوق مرکزی` |
| **کنترل موجودی منفی** | `AllowNegativeBalance` | آیا سیستم اجازه دهد کاربر بیشتر از موجودی صندوق، سند پرداخت بزند؟ <br> *پیش‌فرض:* **خیر**. (چون در واقعیت نمی‌توانید از جیب خالی پول بردارید\!). |
| **حساب کسری/سرک** | `ShortageAccountID` `OverageAccountID` | (اختیاری) کد حساب‌های "هزینه کسری" و "درآمد سرک" را اینجا ست کنید تا در زمان مغایرت‌گیری، سند اتوماتیک صادر شود. |

### ج) تنظیمات تنخواه‌گردان (Petty Cash Controls)

*(این بخش فقط زمانی فعال است که نوع صندوق = تنخواه باشد)*

| عنوان فیلد | نام فنی (Technical) | کاربرد |
| :--- | :--- | :--- |
| **سقف تنخواه** | `ImprestCeiling` | حداکثر پولی که باید دست تنخواه‌گردان باشد (مثلاً ۵۰ میلیون). سیستم اجازه شارژ بیش از این مبلغ را نمی‌دهد. |
| **هشدار موجودی** | `ReplenishThreshold` | "نقطه سفارش پول". عددی وارد کنید (مثلاً ۲۰٪). اگر موجودی به این سطح رسید، سیستم به مدیر مالی هشدار می‌دهد که "تنخواه نیاز به شارژ دارد". |

-----

## ۴. سناریوهای عملیاتی (چطور با سیستم کار کنیم؟)

در این بخش، ۳ سناریوی اصلی روزمره را با جزئیات کامل و **تأثیرات حسابداری** بررسی می‌کنیم.

### سناریو ۱: چرخه زندگی یک تنخواه‌گردان (Petty Cash Cycle)

**داستان:** آقای "جلالی" مسئول خرید است. یک تنخواه با سقف **۱۰,۰۰۰,۰۰۰ ریال** برای او تعریف شده است.

1.  **شارژ اولیه (Establishment):**

      * *عملیات:* مدیر مالی ۱۰ میلیون تومان از "بانک ملت" به "صندوق آقای جلالی" واریز می‌کند.
      * *سند حسابداری:* `[بدهکار] صندوق تنخواه / [بستانکار] بانک ملت`.
      * *موجودی سیستم:* ۱۰,۰۰۰,۰۰۰

2.  **خرج کردن (Expense Recording):**

      * *عملیات:* آقای جلالی ۲ میلیون بنزین می‌زند و ۳ میلیون لوازم تحریر می‌خرد. او فاکتورها را در سیستم ثبت می‌کند (سند پرداخت از محل تنخواه).
      * *سند حسابداری:* `[بدهکار] هزینه سوخت و ملزومات / [بستانکار] صندوق تنخواه`.
      * *موجودی سیستم:* ۵,۰۰۰,۰۰۰ (نصف پول خرج شد).

3.  **شارژ مجدد (Replenishment):**

      * *عملیات:* موجودی کم شده است. آقای جلالی گزارش هزینه‌ها (۵ میلیون) را به مالی می‌دهد. حسابدار پس از تایید، دقیقاً ۵ میلیون تومان به او می‌دهد تا موجودی دوباره ۱۰ میلیون شود.
      * *سند حسابداری:* `[بدهکار] صندوق تنخواه / [بستانکار] بانک ملت`.

-----

### سناریو ۲: تخلیه صندوق فروش (EOD Transfer)

**داستان:** صندوق‌دار فروشگاه در پایان شب، **۳۰,۰۰۰,۰۰۰ ریال** پول نقد در دخل دارد و می‌خواهد آن را تحویل دهد.

1.  **شمارش:** پول‌ها شمارش و دسته‌بندی می‌شوند.
2.  **انتقال در سیستم:** کاربر از فرم **«انتقال وجه» (Cash Transfer)** استفاده می‌کند.
      * **مبدأ:** صندوق فروشگاه ۱
      * **مقصد:** صندوق مرکزی (یا حساب بانک، اگر مستقیم واریز کند).
3.  **نتیجه:**
      * موجودی صندوق فروشگاه در سیستم **صفر** می‌شود.
      * موجودی صندوق مرکزی ۳۰ میلیون افزایش می‌یابد.
      * *سند حسابداری:* `[بدهکار] صندوق مرکزی / [بستانکار] صندوق فروشگاه`.

-----

### سناریو ۳: صندوق‌گردانی و مغایرت (Cash Count & Reconciliation)

**داستان:** بازرس شرکت برای شمارش ناگهانی صندوق آقای جلالی می‌رود.

1.  **وضعیت سیستم (Book Balance):** سیستم می‌گوید باید **۵,۰۰۰,۰۰۰ ریال** پول باشد.
2.  **شمارش واقعی (Physical Count):** بازرس پول‌ها را می‌شمارد: **۴,۹۵۰,۰۰۰ ریال** است (۵۰ هزار ریال گم شده).
3.  **ثبت مغایرت:**
      * بازرس فرم «صندوق‌گردانی» را باز می‌کند.
      * مبلغ واقعی (۴,۹۵۰,۰۰۰) را وارد می‌کند.
4.  **عملکرد سیستم:**
      * سیستم خودکار ۵۰,۰۰۰ ریال **کسری (Shortage)** تشخیص می‌دهد.
5.  **سند اتوماتیک:**
      * با تایید نهایی مدیر، سیستم سند زیر را صادر می‌کند تا موجودی سیستم با واقعیت یکی شود:
      * `[بدهکار] هزینه کسری صندوق (به نام آقای جلالی)`
      * `[بستانکار] صندوق تنخواه`
      * *نتیجه:* موجودی سیستم اکنون ۴,۹۵۰,۰۰۰ ریال است.

-----

## ۵. کنترل‌های هوشمند سیستم (System Validations)

این قوانین در نرم‌افزار تعبیه شده‌اند تا جلوی خطای کاربران را بگیرند:

1.  **قفل ارزی (Currency Lock):**
      * اگر سعی کنید در صندوقی که ارزش «ریال» است، سند دلاری ثبت کنید، سیستم خطا می‌دهد: *"ارز سند با ارز صندوق همخوانی ندارد."*
2.  **محدودیت دسترسی (Data Access):**
      * صندوق‌دار «شعبه ۱» به هیچ وجه نمی‌تواند موجودی یا گردش صندوق «شعبه ۲» را ببیند. (فیلتر بر اساس `OperatingUnitID`).
3.  **سقف تراکنش (Transaction Limit):**
      * اگر برای صندوق سقف تراکنش تعیین شده باشد (مثلاً ۵۰ میلیون) و کاربر بخواهد ۱۰۰ میلیون پرداخت نقدی ثبت کند، سیستم خطا می‌دهد: *"مبلغ بیش از حد مجاز پرداخت نقدی است. لطفاً چک صادر کنید."*
4.  **تاریخ مؤثر:**
      * امکان ثبت سند برای تاریخ‌های بسته شده (دوره مالی بسته) وجود ندارد.

-----

## ۶. گزارش‌های کلیدی

استفاده صحیح از این ماژول، گزارش‌های زیر را در اختیار شما قرار می‌دهد:

  * **کاردکس صندوق (Cash Ledger):** ریز گردش (واریز/برداشت) با جزئیات طرف حساب، تاریخ، ساعت و نام کاربر ثبت‌کننده.
  * **داشبورد نقدینگی (Cash Position):** یک نمای کلی که نشان می‌دهد مجموع پول نقد موجود در تمام گاوصندوق‌های شرکت (به تفکیک هر ارز) چقدر است.
  * **گزارش مغایرت‌ها:** لیستی از تمام کسری‌ها و اضافات ثبت شده در بازه زمانی مشخص (برای ارزیابی عملکرد و امانت‌داری مسئولین صندوق).
  * **مانده تنخواه‌ها:** گزارشی که نشان می‌دهد کدام تنخواه‌ها خالی شده‌اند و نیاز به شارژ فوری دارند.

# دسته چک‌ها (Checkbooks)

## ۱. مقدمه: مدیریت موجودی اسناد پرداخت

در سیستم‌های حسابداری سنتی، تمرکز فقط بر «مبلغ چک» و «تاریخ سررسید» بود. اما در سیستم ERP تابان، ما با دسته چک دقیقاً مشابه **«موجودی کالا در انبار»** برخورد می‌کنیم.

همان‌طور که شما باید بدانید دقیقاً چند عدد "لپ‌تاپ" در انبار دارید، باید دقیقاً بدانید چند برگ "چک سفید" در گاوصندوق دارید، کدام‌یک امضا شده، کدام‌یک خراب شده و کدام‌یک در دست مشتری است.

**این ماژول به سه سوال حیاتی پاسخ می‌دهد:**

1.  **کجاست؟** (فیزیک چک الان دست کیست؟ شرکت، بانک یا تأمین‌کننده؟)
2.  **چه وضعیتی دارد؟** (آیا صادر شده؟ آیا پاس شده؟ آیا باطل شده؟)
3.  **اعتبار قانونی آن چیست؟** (آیا در سامانه صیاد ثبت شده؟ آیا گیرنده آن را تایید کرده است؟)

با توجه به قوانین جدید بانک مرکزی (قانون صیاد) و ظهور چک‌های دیجیتال، این ماژول فقط یک دفترچه یادداشت نیست؛ بلکه **قلب کنترل خزانه‌داری** شماست.

-----

## ۲. انواع دسته چک (Checkbook Types)

در سیستم تابان، باید نوع ابزار پرداخت را در لحظه تعریف دسته چک مشخص کنید، زیرا رفتار سیستم برای هر کدام متفاوت است:

### الف) دسته چک قدیمی کاغذی (Old Paper)

  * **توصیف:** همان چک‌های قدیمی (معمولاً قبل از سال ۱۴۰۰) که الزامی برای ثبت در سامانه صیاد نداشتند.
  * **ویژگی:** فیلد «شناسه صیادی» برای این‌ها اختیاری است.
  * **کاربرد:** رو به انقراض هستند اما ممکن است هنوز در برخی شرکت‌ها برای ضمانت‌های قدیمی وجود داشته باشند.

### ب) دسته چک صیادی کاغذی (Sayad Paper)

  * **توصیف:** چک‌های طرح جدید (بنفش رنگ) که فیزیک کاغذی دارند.
  * **ویژگی:**
      * دارای شناسه ۱۶ رقمی یکتا هستند.
      * صدور فیزیکی کافی نیست؛ حتماً باید در اپلیکیشن بانکی ثبت شوند.
      * پشت‌نویسی (Endorsement) روی کاغذ ممنوع است.
  * **رفتار سیستم:** ورود شناسه ۱۶ رقمی برای تک‌تک برگه‌ها اجباری است.

### ج) دسته چک دیجیتال (Digital / E-Check)

  * **توصیف:** موجودیت کاملاً مجازی که در اپلیکیشن‌های بانکی و همراه بانک‌ها ارائه می‌شود. هیچ کاغذی وجود ندارد.
  * **ویژگی:**
      * امنیت بسیار بالا (امضای دیجیتال).
      * شماره سریال و شناسه صیادی در لحظه صدور توسط بانک تولید می‌شود.
  * **رفتار سیستم:** ما در سیستم یک "دسته چک مجازی" تعریف می‌کنیم تا تعداد مجوزهای صدور را کنترل کنیم. شماره سریال‌ها در لحظه صدور سند پرداخت وارد سیستم می‌شوند.

-----

## ۳. راهنمای تکمیل فرم تعریف دسته چک (Checkbook)

این فرم زمانی پر می‌شود که شما دسته چک جدیدی از بانک می‌گیرید یا بسته چک دیجیتال را در موبایل‌بانک فعال می‌کنید.

| عنوان فیلد | توضیحات و راهنمای تکمیل |
| :--- | :--- |
| **حساب بانکی (Bank Account)** | انتخاب حساب جاری متصل به این دسته چک. (سیستم فقط حساب‌های جاری را نشان می‌دهد). |
| **نوع دسته چک (Checkbook Type)** | یکی از سه نوع بالا (قدیمی، صیادی کاغذی، دیجیتال) را انتخاب کنید. |
| **عنوان دسته چک (Name)** | یک نام گویا بنویسید. <br> *مثال:* `صیادی بانک ملت - سری ۴۴ - دست خزانه‌دار` |
| **تاریخ دریافت (Receive Date)** | تاریخی که دسته چک را دریافت کردید. |
| **تعداد برگ (Leaf Count)** | تعداد کل برگه‌های چک (مثلاً ۵۰ برگ). برای چک دیجیتال، تعداد سقف مجاز صدور (مثلاً ۱۰ فقره). |
| **سریال شروع (Start Serial)** | **کاغذی:** شماره چاپ شده روی اولین برگ چک (مثلاً `۱۲۵۰۰۱`). <br> **دیجیتال:** عدد `0` یا خالی (چون سریال از قبل مشخص نیست). |
| **سریال پایان (End Serial)** | توسط سیستم محاسبه می‌شود (`شروع + تعداد - ۱`). |
| **وضعیت دسته چک (Status)** | وضعیت کلی دسته چک (فعال، مسدود شده، تمام شده). |

-----

## ۴. وضعیت‌های دسته چک (Checkbook Status)

این وضعیت بر کل دسته چک (همه برگه‌ها) حاکم است:

1.  **فعال (Active):** وضعیت پیش‌فرض. کاربران می‌توانند از برگه‌های خام این دسته چک استفاده کنند.
2.  **مسدود شده (Blocked):**
      * *کاربرد:* زمانی که دسته چک گم شده یا دزدیده شده است.
      * *رفتار سیستم:* تمام برگه‌های "خام" باقی‌مانده قفل می‌شوند و کسی نمی‌تواند سند صادر کند.
3.  **تمام شده (Depleted):**
      * *کاربرد:* زمانی که آخرین برگ چک استفاده شد.
      * *رفتار سیستم:* سیستم به صورت خودکار این وضعیت را اعمال می‌کند تا در لیست انتخاب دسته چک‌های فعال نمایش داده نشود.
4.  **بایگانی (Archived):**
      * *کاربرد:* برای دسته چک‌های قدیمی که تمام شده‌اند و نمی‌خواهید در لیست‌های دم‌دستی جلوی چشم باشند.

-----

## ۵. مدیریت برگه‌های چک و تحلیل وضعیت‌ها

پس از ذخیره فرم بالا، سیستم به تعداد برگه‌ها رکورد ایجاد می‌کند. با توجه به **تفاوت ماهیت "عملیات حسابداری" با "قوانین بانکی"** هر برگ چک دارای دو نوع وضعیت است.

### الف) وضعیت چک (Check Status) - دیدگاه داخلی

این وضعیت نشان می‌دهد چک در سیستم حسابداری ما چه مرحله‌ای را طی می‌کند.

| وضعیت | شرح |
| :--- | :--- |
| **خام (Unused)** | چک سفید است و هنوز روی آن چیزی نوشته نشده. |
| **صادر شده (Issued)** | چک در یک «سند پرداخت» استفاده شده و به طرف حساب داده شده است. |
| **نزد صندوق (On Hand)** | (مخصوص چک دریافتی) چک فیزیکی در شرکت موجود است. |
| **واگذار شده (Lodged)** | چک به بانک تحویل داده شده (در جریان وصول). |
| **پاس شده (Cleared)** | مبلغ چک از حساب کسر شده است. |
| **باطل شده (Voided)** | چک (فیزیکی یا دیجیتال) سوخت شده و قابل استفاده نیست. |

### ب) وضعیت صیادی (Sayad Status) - دیدگاه بانکی

این وضعیت نشان می‌دهد چک در دیتابیس بانک مرکزی (سامانه صیاد) چه وضعیتی دارد.

| وضعیت | شرح |
| :--- | :--- |
| **ثبت نشده (Not Registered)** | خطرناک\! چک صادر شده اما در بانک ثبت نشده. (فاقد اعتبار). |
| **ثبت اولیه (Registered)** | صادرکننده (ما) چک را در اپلیکیشن بانک ثبت کرده‌ایم. |
| **منتظر تایید (Pending)** | چک ثبت شده اما گیرنده هنوز تایید نکرده است. |
| **نهایی / تایید شده (Confirmed)** | گیرنده تایید کرده است. (وضعیت ایده‌آل). |
| **رد شده (Rejected)** | گیرنده چک را رد کرده است (باید اصلاح شود). |
| **عودت / انتقال (Transferred)** | مالکیت چک منتقل شده است. |

-----

## ۶. فیلدهای هر برگ چک

| نام فیلد | توضیحات |
| :--- | :--- |
| **شماره سریال (SerialNo)** | برای کاغذی از ابتدا پر است. برای دیجیتال در لحظه صدور پر می‌شود. |
| **شناسه صیادی (SayadID)** | کد ۱۶ رقمی (باید یکتا باشد). |
| **مبلغ (Amount)** | تا زمان صدور خالی است. |
| **تاریخ سررسید (DueDate)** | تا زمان صدور خالی است. |
| **در وجه (Payee)** | نام شخصی که چک برای او صادر می‌شود. |
| **وضعیت چک (Check Status)** | طبق جدول بالا (خام، صادر شده...). |
| **وضعیت صیادی (SayadStatus)** | طبق جدول بالا (ثبت نشده، نهایی...). |

-----

## ۷. سناریوهای عملیاتی (Scenarios)

### سناریو ۱: صدور چک دیجیتال (هماهنگی دستی)

1.  **عملیات بانکی:** حسابدار وارد همراه بانک می‌شود، گزینه صدور چک دیجیتال را می‌زند. بانک یک فایل PDF شامل شماره سریال `D-991` و شناسه صیادی `123...` می‌دهد.
2.  **عملیات سیستم:** حسابدار فرم «سند پرداخت» را باز می‌کند. روش پرداخت را `چک دیجیتال` انتخاب می‌کند.
3.  **ورود اطلاعات:** سیستم یک جای خالی برای سریال و شناسه باز می‌کند. حسابدار مقادیر `D-991` و `123...` را وارد می‌کند.
4.  **تنظیم وضعیت:** وضعیت صیادی را روی **«نهایی شده»** می‌گذارد (چون چک دیجیتال در لحظه صدور ثبت می‌شود).
5.  **ذخیره:** سیستم یکی از مجوزهای خام دسته چک دیجیتال را برداشته و اطلاعات را روی آن ذخیره می‌کند.

### سناریو ۲: رد چک توسط ذینفع (Rejection)

1.  **داستان:** شما چکی به مبلغ ۱۰ میلیون به فروشنده داده‌اید (وضعیت: صادر شده / ثبت اولیه).
2.  **رخداد:** فروشنده تماس می‌گیرد و می‌گوید: "تاریخ چک اشتباه است، من در سامانه صیاد رد کردم".
3.  **اقدام کاربر:**
      * به لیست چک‌ها می‌روید.
      * وضعیت صیادی را به **«رد شده»** تغییر می‌دهید.
      * نمی‌توانید چک را ویرایش کنید\! باید عملیات **«ابطال چک»** را انجام دهید (چک می‌سوزد).
      * یک چک جدید (برگه بعدی) صادر می‌کنید و اطلاعات صحیح را وارد می‌کنید.

### سناریو ۳: فراموشی ثبت صیاد (The Audit Alert)

1.  **داستان:** در پایان ماه، مدیر مالی گزارش «مغایرت صیاد» را می‌گیرد.
2.  **گزارش:** سیستم لیست تمام چک‌هایی را نشان می‌دهد که `Check Status = Issued` هستند اما `Sayad Status = Not Registered` است.
3.  **معنی:** این یعنی ۱۰ فقره چک دست مردم داده‌ایم که در بانک ثبت نکرده‌ایم و هر لحظه ممکن است آبروریزی شود\!
4.  **اقدام:** حسابدار باید سریعاً لیست را برداشته و در اپلیکیشن بانک ثبت کند و سپس در سیستم تیک آن‌ها را بزند.

### سناریو ۴: ابطال چک سفید (Voiding Unused Check)

1.  **داستان:** روی یک برگ چک کاغذی چای ریخته و غیرقابل استفاده شده است.
2.  **اقدام:** کاربر به فرم دسته چک می‌رود، برگ شماره `55` را پیدا کرده و دکمه **«ابطال»** را می‌زند.
3.  **وضعیت:** وضعیت چک به `Voided` تغییر می‌کند. وضعیت صیادی روی `Not Registered` می‌ماند (چون اصلاً به بانک نرسیده).

-----

## ۸. پرسش‌های متداول (FAQ)

**س: آیا می‌توانم شماره سریال چک را بعد از تعریف دسته چک تغییر دهم؟**
پ: تا زمانی که چک «خام» است، مدیر سیستم با دسترسی خاص می‌تواند آن را ویرایش کند. اما اگر چک صادر شده باشد، خیر.

**س: اگر دسته چک دیجیتال تمام شد چه کنم؟**
پ: باید در بانک درخواست بسته جدید بدهید و در سیستم یک «دسته چک جدید» تعریف کنید. نمی‌توانید به دسته چک قبلی برگه اضافه کنید.

**س: چرا باید شناسه صیادی را در سیستم وارد کنم وقتی به بانک وصل نیستیم؟**
پ:

1.  برای چاپ روی چک (اگر پرینتر چک دارید).
2.  برای گزارش‌گیری و جستجوی سریع چک.
3.  برای مغایرت‌گیری بانکی در آینده (تنها راه تطبیق تراکنش بانک با سیستم، همین شناسه است).

**س: اگر چکی را صادر کردیم و بعداً متوجه شدیم در صیاد اشتباه ثبت کرده‌ایم چه؟**
پ: اگر گیرنده هنوز تایید نکرده، در بانک اصلاح کنید و در سیستم هم ویرایش کنید. اگر گیرنده تایید کرده باشد، راهی جز این نیست که چک را پس بگیرید (استرداد)، در بانک باطل کنید و چک جدید صادر کنید.

# صندوق‌های اسناد (Document Boxes)

## ۱. مقدمه: صندوق اسناد چیست؟

در سیستم ERP تابان، **«صندوق اسناد» (Document Box)** معادل دیجیتالی هر محفظه فیزیکی است که شما برای نگهداری **اسناد تجاری (چک، سفته، اوراق بهادار)** استفاده می‌کنید.

تصور کنید در واحد مالی ۳ زونکن و ۱ گاوصندوق دارید:

1.  گاوصندوق اصلی (برای چک‌های تازه).
2.  زونکن چک‌های واگذار شده به بانک ملت.
3.  زونکن چک‌های واگذار شده به بانک تجارت.
4.  زونکن چک‌های برگشتی (دست وکیل شرکت).

در نرم‌افزار، برای تک‌تک این موارد باید یک «صندوق اسناد» تعریف کنید.

> **تفاوت کلیدی با صندوق نقد:**
>
>   * **صندوق نقد:** فقط یک عدد ریالی را نشان می‌دهد (مثلاً: ۵۰ میلیون ریال موجودی).
>   * **صندوق اسناد:** دقیقاً نشان می‌دهد **کدام برگه‌های چک** (با چه شماره سریال، چه مبلغی و از کدام مشتری) در آن قرار دارند. موجودی این صندوق، لیستِ چک‌هاست.

-----

## ۲. انواع صندوق‌هایی که باید بشناسید

برای نظم‌دهی به اسناد و صدور سند حسابداری درست، باید ماهیت هر صندوق را مشخص کنید (فیلد نوع صندوق `BoxType`):

| نوع صندوق | نام فنی (System Enum) | کاربرد و منطق رفتاری |
| :--- | :--- | :--- |
| **۱. صندوق عملیاتی (نزد شرکت)** | `Operational` / `Safe` | **(نقطه شروع)** همان گاوصندوق شرکت. تمام چک‌هایی که از مشتری می‌گیرید، ابتدا وارد این صندوق می‌شوند. |
| **۲. در جریان وصول (نزد بانک)** | `InCollection` | **(ایستگاه میانی)** این صندوق نماینده "باجه کلر بانک" است. وقتی چک را فیزیکاً به بانک تحویل می‌دهید، باید آن را به این صندوق منتقل کنید. <br> *نکته:* به ازای هر حساب جاری، یک صندوق از این نوع بسازید. |
| **۳. صندوق برگشتی** | `Bounced` | **(واحد پیگیری)** محل نگهداری چک‌هایی که نکول شده‌اند. این صندوق معمولاً دست مدیر مالی یا واحد حقوقی است. |
| **۴. صندوق تضمینی** | `Guarantee` | **(بایگانی)** مخصوص چک‌هایی که بابت ضمانت حسن انجام کار گرفته‌اید. این چک‌ها نباید در گزارش نقدینگی شرکت محاسبه شوند. |

-----

## ۳. راهنمای تکمیل فرم تعریف صندوق اسناد

**مسیر دسترسی:** `خزانه‌داری > تعاریف پایه > صندوق‌های اسناد`

لطفاً فیلدها را با دقت پر کنید. ستون «نام فنی» راهنمای تیم توسعه‌دهنده است.

| عنوان فیلد | نام فنی (Technical) | راهنمای تکمیل و منطق سیستم |
| :--- | :--- | :--- |
| **کد صندوق** | `Code` | یک کد کوتاه و یکتا (مثلاً `DOC-101`). |
| **نام صندوق** | `Name` | نامی کامل و گویا. <br> *مثال:* `صندوق اسناد در جریان وصول - بانک ملت` |
| **بنگاه اقتصادی** | `LegalEntityID` | مالک قانونی اسناد. سند حسابداری جابجایی چک در دفاتر این شرکت ثبت می‌شود. |
| **مکان عملیاتی** | `OperatingUnitID` | محل فیزیکی نگهداری چک (مثلاً: دفتر مرکزی تهران). |
| **نوع صندوق** | `BoxType` | نوع عملکرد را با دقت انتخاب کنید (عملیاتی، در جریان وصول، ...). |
| **وابستگی بانکی** | `RelatedBankAccountID` | **(شرطی)** این فیلد فقط زمانی فعال می‌شود که نوع صندوق **«در جریان وصول»** باشد. باید مشخص کنید این صندوق مربوط به کدام حساب جاری شماست. |
| **حساب معین** | `GLAccountID` | کد حسابداری متصل به صندوق. <br> *مثال:* `۱۲۰۲ - اسناد در جریان وصول` |
| **ارز** | `CurrencyID` | این صندوق چک‌های چه ارزی را قبول می‌کند؟ (ریال/دلار). |
| **مسئول (جمعدار)** | `CustodianID` | کارمندی که مسئولیت فیزیکی لاشه چک‌ها با اوست. |

-----

## ۴. سناریوی عملیاتی: سفر یک چک در سیستم

در سیستم تابان، جابجایی چک یعنی **تغییر مسئولیت و تغییر سرفصل حسابداری**.
بیایید داستان یک چک واقعی را مرور کنیم.

**فرض:** شرکت یک چک **۵۰,۰۰۰,۰۰۰ ریالی** از مشتری (فروشگاه کوروش) دریافت می‌کند.

### پرده اول: دریافت و ورود به گاوصندوق

  * **عملیات کاربر:** ثبت «سند دریافت» در سیستم.
  * **وضعیت سیستم:** چک متولد می‌شود و در **«صندوق عملیاتی»** قرار می‌گیرد.
  * **سند حسابداری (خودکار):**
      * `[بدهکار] اسناد دریافتنی نزد صندوق (۵۰ م)`
      * `[بستانکار] حساب‌های دریافتنی - مشتری (۵۰ م)`

### پرده دوم: واگذاری به بانک (خواباندن به حساب)

  * **زمان:** روز سررسید چک.
  * **عملیات کاربر:** استفاده از فرم **«واگذاری چک»**. کاربر چک را انتخاب کرده و مقصد را **«صندوق در جریان وصول بانک ملت»** تعیین می‌کند.
  * **وضعیت سیستم:** لاشه چک از صندوق عملیاتی حذف و به صندوق بانک اضافه می‌شود.
  * **سند حسابداری (خودکار):**
      * `[بدهکار] اسناد در جریان وصول - ملت (۵۰ م)`
      * `[بستانکار] اسناد دریافتنی نزد صندوق (۵۰ م)`

### پرده سوم: تعیین سرنوشت (وصول یا برگشت)

**حالت الف: چک پاس می‌شود (Happy Path)**

  * **عملیات:** بانک وجه را واریز می‌کند. کاربر دکمه **«اعلام وصول»** را می‌زند.
  * **نتیجه:** چک از سیستم اسناد خارج شده و موجودی **حساب بانکی** ۵۰ میلیون افزایش می‌یابد.
  * **سند حسابداری:**
      * `[بدهکار] موجودی بانک ملت (۵۰ م)`
      * `[بستانکار] اسناد در جریان وصول - ملت (۵۰ م)`

**حالت ب: چک برگشت می‌خورد (Unhappy Path)**

  * **عملیات:** بانک گواهی عدم پرداخت می‌دهد. کاربر دکمه **«اعلام برگشت»** را می‌زند.
  * **نتیجه:** چک از صندوق بانک خارج شده و به **«صندوق اسناد برگشتی»** منتقل می‌شود.
  * **سند حسابداری:**
      * `[بدهکار] اسناد دریافتنی برگشتی (۵۰ م)`
      * `[بستانکار] اسناد در جریان وصول - ملت (۵۰ م)`

-----

## ۵. قوانین کنترلی سیستم (System Validations)

این قوانین برای جلوگیری از خطای کاربر در سیستم تعبیه شده‌اند:

1.  **قانون موجودی:**
      * شما نمی‌توانید چکی را واگذار کنید که در صندوق نیست\! سیستم ابتدا چک می‌کند که آیا این چک در «صندوق مبدأ» وجود دارد یا خیر.
2.  **رعایت ترتیب (Workflow Constraint):**
      * پرش ممنوع\! نمی‌توانید چک را مستقیم از «گاوصندوق» به «صندوق برگشتی» بفرستید. چک حتماً باید اول به بانک (در جریان وصول) رفته باشد تا بتواند برگشت بخورد.
3.  **تطابق ارزی:**
      * سیستم اجازه نمی‌دهد یک چک دلاری را وارد یک صندوق ریالی کنید.
4.  **مرزهای حقوقی (Legal Entity Check):**
      * انتقال چک بین صندوق‌های دو شرکت مختلف ممنوع است (مگر اینکه فرآیند انتقال بین شرکتی و صدور فاکتور انجام شود).

-----

## ۶. گزارش‌های کلیدی

استفاده از این ماژول، پاسخ سوالات زیر را برای مدیران فراهم می‌کند:

  * **موجودی لحظه‌ای:** در حال حاضر دقیقاً چند فقره چک و به چه مبلغی در شرکت موجود است؟
  * **اسناد در راه (Float):** چه مبلغی چک نزد بانک داریم که هنوز پاس نشده است؟ (حیاتی برای پیش‌بینی جریان وجوه نقد).
  * **لیست سیاه مشتریان:** کدام مشتریان بیشترین چک برگشتی (موجود در صندوق برگشتی) را دارند؟
  * **انبارگردانی اسناد:** چاپ لیست چک‌های هر صندوق جهت شمارش فیزیکی و تطبیق با لاشه چک‌ها.

# روش‌های پرداخت و دریافت (Payment Methods)

## ۱. مقدمه: روش پرداخت چیست؟

در سیستم ERP تابان، وقتی می‌خواهید پولی را دریافت یا پرداخت کنید، اولین سوال سیستم این است: **«چگونه؟»**
آیا پول نقد است؟ چک است؟ کارت می‌کشید؟ یا حواله اینترنتی می‌زنید؟

موجودیت **«روش پرداخت» (Payment Method)**، پیکربندی هوشمندی است که رفتار فرم‌های عملیاتی را کنترل می‌کند.

  * اگر روش را **«چک»** انتخاب کنید -\> سیستم فیلدهای "شماره چک" و "تاریخ سررسید" را نشان می‌دهد.
  * اگر روش را **«کارت‌خوان»** انتخاب کنید -\> سیستم فیلد "شماره مرجع تراکنش" را می‌خواهد.

**هدف:** جلوگیری از شلوغی فرم‌ها و اجباری کردن فیلدهای مرتبط با هر روش.

-----

## ۲. انواع روش‌های پرداخت (The Core Logic)

قبل از تعریف روش‌ها، باید بدانید که زیرساخت فنی سیستم (Backend) چه رفتارهایی را پشتیبانی می‌کند. فیلد `MethodType` تعیین‌کننده منطق برنامه است:

| نوع روش (فارسی) | نام فنی (System Enum) | رفتار هوشمند فرم (UI Behavior) |
| :--- | :--- | :--- |
| **۱. نقد / اسکناس** | `Cash` | ساده‌ترین حالت. فقط مبلغ را می‌گیرد. متصل به «صندوق‌های نقدی». |
| **۲. چک (صیادی/عادی)** | `Check` | **پیچیده‌ترین حالت.** فیلدهای شماره سریال، صیاد، سررسید و بانک را فعال می‌کند. متصل به «دسته چک» یا «صندوق اسناد». |
| **۳. حواله بانکی (فیش/اینترنتی)** | `WireTransfer` / `EFT` | فیلدهای شماره پیگیری (Trace No) و تاریخ واریز را اجباری می‌کند. متصل به «حساب بانکی». |
| **۴. کارت‌خوان (POS)** | `POS` | فیلد شماره مرجع و ترمینال را فعال می‌کند. کارمزد بانکی را محاسبه می‌کند (اگر تنظیم شده باشد). |
| **۵. سفته** | `PromissoryNote` | شبیه چک است اما منطق صیاد و دسته چک بانکی را ندارد. |
| **۶. خرج چک (واگذاری)** | `Endorsement` | لیستی از چک‌های موجود در صندوق را باز می‌کند تا یکی را انتخاب کنید (نه اینکه چک جدید بنویسید). |

-----

## ۳. راهنمای تکمیل فرم تعریف روش پرداخت

**مسیر دسترسی:** `خزانه‌داری > تعاریف پایه > روش‌های پرداخت`

این فرم توسط مدیر سیستم تنظیم می‌شود تا گزینه‌های در دسترس کاربران را کنترل کند.

| عنوان فیلد | نام فنی (Technical) | نوع داده | راهنمای تکمیل و منطق سیستم |
| :--- | :--- | :--- | :--- |
| **کد روش** | `Code` | String | کد کوتاه (مثلاً `CHK` برای چک، `CSH` برای نقد). |
| **عنوان روش** | `Name` | String | نامی که کاربر در لیست کشویی می‌بیند. <br> *مثال:* `صدور چک روز` یا `کارت‌خوان فروشگاه` |
| **نوع رفتار** | `MethodType` | Enum | **(حیاتی)** مشخص می‌کند که این روش از چه منطقی پیروی می‌کند (طبق جدول بالا). |
| **جهت تراکنش** | `Direction` | Enum | این روش کجا نمایش داده شود؟ <br> `Inbound`: فقط در دریافت‌ها (مثل کارت‌خوان). <br> `Outbound`: فقط در پرداخت‌ها (مثل صدور چک). <br> `Both`: در هر دو (مثل نقد یا حواله). |
| **نیاز به شماره پیگیری** | `RequireRefNo` | Boolean | اگر تیک بزنید، کاربر نمی‌تواند بدون وارد کردن "شماره فیش/ارجاع" سند را ذخیره کند. |
| **نیاز به بانک طرف مقابل** | `RequireDestBank` | Boolean | (مخصوص حواله) آیا لازم است بدانیم پول به کدام بانکِ مشتری واریز شده؟ |
| **وضعیت** | `IsActive` | Boolean | فعال/غیرفعال. |

-----

## ۴. سناریوهای عملیاتی: تأثیر تنظیمات بر فرم سند

بیایید ببینیم این تنظیمات چطور ظاهر فرم **«سند دریافت/پرداخت»** را تغییر می‌دهند.

### سناریو ۱: پرداخت با چک (Check Issuance)

**تنظیمات:** روشی به نام «صدور چک» با نوع رفتار `Check` و جهت `Outbound` تعریف شده است.

1.  **کاربر:** وارد فرم سند پرداخت می‌شود.
2.  **انتخاب:** در لیست روش‌ها، **«صدور چک»** را انتخاب می‌کند.
3.  **تغییر فرم:**
      * فیلد "صندوق مبدأ" مخفی می‌شود.
      * فیلد "حساب بانکی" ظاهر می‌شود.
      * فیلد "دسته چک" ظاهر می‌شود.
      * سیستم شماره سریال چک بعدی را پیشنهاد می‌دهد.
      * فیلد "شناسه صیادی" نمایش داده می‌شود.

### سناریو ۲: دریافت با کارت‌خوان (POS Receipt)

**تنظیمات:** روشی به نام «کارت‌خوان ملت» با نوع رفتار `POS` و جهت `Inbound` تعریف شده است.

1.  **کاربر:** وارد فرم سند دریافت می‌شود.
2.  **انتخاب:** در لیست روش‌ها، **«کارت‌خوان ملت»** را انتخاب می‌کند.
3.  **تغییر فرم:**
      * فیلد "حساب بانکی" به صورت خودکار روی "حساب متصل به پوز ملت" قفل می‌شود.
      * فیلد "شماره پیگیری" (RRN) **اجباری** می‌شود (چون در تنظیمات تیک `RequireRefNo` را زده‌اید).
      * کاربر باید ۴ رقم آخر کارت مشتری را وارد کند (اختیاری).

### سناریو ۳: واریز نقدی (Cash Deposit)

**تنظیمات:** روشی به نام «نقد» با نوع رفتار `Cash` تعریف شده است.

1.  **کاربر:** روش **«نقد»** را انتخاب می‌کند.
2.  **تغییر فرم:**
      * تمام فیلدهای بانکی و چک مخفی می‌شوند.
      * فقط فیلد "انتخاب صندوق" (مثلاً صندوق فروشگاه ۱) نمایش داده می‌شود.
      * کاربر فقط مبلغ را وارد می‌کند.

-----

## ۵. کنترل‌های هوشمند سیستم (System Validations)

این قوانین تضمین می‌کنند که کاربر روش غلطی را انتخاب نکند:

1.  **محدودیت نوع حساب:**
      * اگر روش پرداخت `Check` باشد، کاربر فقط می‌تواند حساب‌های بانکی نوع **«جاری» (Current)** را انتخاب کند. (نمی‌توان از حساب پس‌انداز چک کشید).
2.  **اجبار ارجاع:**
      * اگر روش پرداخت `WireTransfer` (حواله) باشد، سیستم اجازه ثبت بدون "شماره پیگیری" را نمی‌دهد.
3.  **موجودی چک:**
      * در روش `Endorsement` (خرج چک)، سیستم فقط چک‌هایی را لیست می‌کند که وضعیت آن‌ها **«نزد صندوق»** است. چک‌های واگذار شده یا برگشتی نمایش داده نمی‌شوند.

-----

## ۶. پرسش‌های متداول (FAQ)

**س: آیا می‌توانم روشی تعریف کنم که همزمان نقد و چک باشد؟**

**پ:** خیر. در هدر سند نمی‌توانید. اما در **«جزئیات سند»** (Payment Lines) می‌توانید چند ردیف ایجاد کنید.

  * *ردیف ۱:* ۱۰ میلیون تومان -\> روش: نقد
  * *ردیف ۲:* ۲۰ میلیون تومان -\> روش: چک
  * سیستم جمع این‌ها را به عنوان مبلغ کل سند در نظر می‌گیرد.

**س: روش «تهاتر» (Clearing) چگونه تعریف می‌شود؟**

**پ:** تهاتر معمولاً جریان نقدینگی ندارد. اما اگر می‌خواهید در این فرم باشد، می‌توانید روشی با نوع `Journal / Adjustment` تعریف کنید که به جای بانک/صندوق، یک حساب واسط را درگیر کند. (هرچند توصیه می‌شود تهاتر در فرم "تسویه حساب" انجام شود نه اینجا).

**س: اگر کارت‌خوان من به دو حساب وصل باشد چه؟**

**پ:** باید دو روش پرداخت تعریف کنید:

1.  کارت‌خوان (حساب ملت)
2.  کارت‌خوان (حساب سامان)
    این کار باعث می‌شود کاربر در لحظه کشیدن کارت، دقیقاً مشخص کند پول به کدام حساب رفته تا مغایرت بانکی پیش نیاید.

-----

## ۷. گزارش‌های کلیدی

  * **گزارش تفکیکی روش‌ها:** چه مقدار از فروش امروز "نقد"، چه مقدار "کارت‌خوان" و چه مقدار "چک" بوده است؟
  * **کنترل کارت‌خوان:** گزارشی که تراکنش‌های ثبت شده در سیستم با روش `POS` را لیست می‌کند تا با "ستلمنت" (Settlement) دستگاه پوز مقایسه کنید.
  * **چک‌های صادر شده:** فیلتر کردن تمام پرداخت‌ها بر اساس روش `Check`.

# ماژول خزانه‌داری (Treasury): اهداف، جایگاه و یکپارچگی

---

## ۱. هدف و تعریف ماژول خزانه‌داری

ماژول خزانه‌داری (Treasury) در ERP تابان، به عنوان **قلب مدیریت نقدینگی** سازمان عمل می‌کند. این ماژول مسئولیت مدیریت، ردیابی، و گزارش‌دهی تمامی وجوه نقد (شامل حساب‌های بانکی و صندوق‌ها) و اسناد بهادار (مانند چک‌های دریافتی و پرداختی) را بر عهده دارد.

هدف اصلی این ماژول، اطمینان از سلامت جریان نقدینگی، بهینه‌سازی منابع مالی و ارائه گزارش‌های دقیق برای تصمیم‌گیری‌های مالی است.

### اهداف کلیدی (Key Objectives)

* **مدیریت نقدینگی (Liquidity Management):** ردیابی دقیق و لحظه‌ای موجودی هر حساب بانکی، صندوق و تنخواه.
* **مدیریت اسناد بهادار (Document Management):** مدیریت کامل چرخه عمر (Lifecycle) چک‌های دریافتی (از دریافت تا واگذاری و وصول) و چک‌های پرداختی (از صدور تا پاس شدن).
* **تسویه حساب (Settlement):** اطمینان از تسویه دقیق فاکتورهای خرید (AP) و فروش (AR) با دریافت‌ها و پرداخت‌های مرتبط.
* **گزارش‌دهی و کنترل (Reporting & Control):** ارائه گزارش‌های حیاتی مانند مغایرت بانکی، جریان وجوه نقد، و وضعیت چک‌ها.

---

## ۲. جایگاه در ساختار سازمانی تابان (بنگاه و مکان)

ماژول خزانه‌داری به شدت به ساختار سازمانی تعریف شده در مستندات پایه تابان وابسته است:

### الف) بنگاه اقتصادی (Legal Entity) و خزانه‌داری

همانطور که در مستندات تابان ذکر شده، **بنگاه اقتصادی** یک موجودیت حقوقی مستقل با گزارش‌های مالی مستقل است.

> **قانون کلیدی خزانه‌داری:** **حساب‌های بانکی** (Bank Accounts) و **دسته چک‌ها** (Checkbooks) در سطح **بنگاه اقتصادی** تعریف و تملک می‌شوند.

* از آنجایی که ترازنامه و صورت‌های مالی در سطح بنگاه اقتصادی تهیه می‌شود، حساب بانکی که یکی از اقلام اصلی دارایی‌های جاری است، باید متعلق به یک بنگاه اقتصادی مشخص باشد.
* **مثال:** اگر «ایران خودرو مرکزی» (کد 1000) و «بخش فروش و بازاریابی» (کد 2000) دو بنگاه اقتصادی جداگانه باشند، هر کدام باید حساب‌های بانکی، دسته چک‌ها و اسناد مالی مجزای خود را در سیستم داشته باشند. نمی‌توان چکی را از حساب بنگاه 1000 برای پرداخت فاکتور بنگاه 2000 (مگر در فرآیندهای مالی بین شرکتی) استفاده کرد.

### ب) مکان عملیاتی (Operating Unit) و خزانه‌داری

**مکان عملیاتی** یک مکان فیزیکی (مانند کارخانه، انبار یا دفتر) است که در آن فرآیندهای لجستیکی و عملیاتی رخ می‌دهد.

> **قانون کلیدی خزانه‌داری:** **صندوق‌ها (Petty Cash)** و **تنخواه‌گردان‌ها** معمولاً در سطح **مکان عملیاتی** مدیریت می‌شوند.

* در حالی که حساب‌های بانکی ماهیت حقوقی دارند، صندوق‌ها ماهیت فیزیکی و مکانی دارند.
* **مثال:** برای پوشش هزینه‌های نقدی روزمره «کارخانه تهران» (مکان عملیاتی 1100) یا «دفتر مرکزی اداری» (مکان 1500)، یک «صندوق» یا «تنخواه» در سیستم تعریف می‌شود که به آن مکان عملیاتی و یک فرد مسئول (تنخواه‌گردان) مرتبط است.

---

## ۳. قانون طلایی: یکپارچگی با حسابداری مالی (FI)

ماژول خزانه‌داری نمی‌تواند و نباید بدون اتصال لحظه‌ای و خودکار به ماژول حسابداری مالی (FI) کار کند.

> **قانون طلایی یکپارچگی:** **هیچ تراکنشی در خزانه‌داری (تغییر موجودی بانک یا صندوق) نباید رخ دهد، مگر آنکه یک سند حسابداری (Journal Entry) معادل و خودکار در دفتر کل (GL) ثبت شود.**

این یکپارچگی از طریق **نگاشت حساب‌ها (Account Mapping)** در تعاریف پایه تضمین می‌شود:

1.  **حساب بانکی:** هر «حساب بانکی» در خزانه‌داری (مثلاً `MEL-100 - بانک ملت مرکزی`) به یک حساب معین در دفتر کل (مثلاً `11010101 - موجودی نقد - بانک ملت`) متصل است.
2.  **صندوق:** هر «صندوق» (مثلاً `PC-10 - صندوق دفتر مرکزی`) به یک حساب معین در دفتر کل (مثلاً `11020101 - صندوق مرکزی`) متصل است.
3.  **طرف حساب:** هر مشتری به حساب معین «حساب‌های دریافتنی» (AR) و هر تأمین‌کننده به «حساب‌های پرداختنی» (AP) متصل است.

---

## ۴. ارتباط جامع با سایر ماژول‌ها (جریان‌های فرآیندی)

ماژول خزانه‌داری، «مجری» نهایی فرآیندهای مالی است که در ماژول‌های دیگر آغاز می‌شوند.

### الف) یکپارچگی با فروش (Sales - SD)

فرآیند فروش (صدور فاکتور) نیاز به «دریافت» وجه را ایجاد می‌کند.

* **فرآیند:** ماژول فروش، «سفارش فروش» و سپس «فاکتور فروش» را صادر می‌کند. این فاکتور یک «آیتم باز» (Open Item) بدهکار در حساب مشتری در ماژول AR (حساب‌های دریافتنی) ایجاد می‌کند.
* **اتصال:** مشتری وجه فاکتور را پرداخت می‌کند (نقدی، چک، یا حواله).
* **عملیات خزانه‌داری:** کاربر یک **«سند دریافت» (Receipt Document)** در خزانه‌داری ثبت می‌کند.
* **مثال (دریافت نقدی بابت فاکتور):**
    * *عملیات:* دریافت 10,000,000 ریال وجه نقد از «مشتری الف» بابت فاکتور `F-901` و واریز به «صندوق مرکزی».
    * *تأثیر خزانه‌داری:* موجودی `صندوق مرکزی` 10,000,000 افزایش می‌یابد.
    * *تأثیر تسویه:* فاکتور `F-901` به وضعیت «تسویه شده» (Cleared) در می‌آید.
    * *سند حسابداری خودکار (FI):*
        * **بدهکار (Debit):** 10,000,000 - `11020101 - صندوق مرکزی` (دارایی (نقد) افزایش یافت)
        * **بستانکار (Credit):** 10,000,000 - `12010101 - حساب‌های دریافتنی - مشتری الف` (دارایی (طلب) کاهش یافت)

### ب) یکپارچگی با خرید و تدارکات (Purchasing - MM)

فرآیند خرید (دریافت فاکتور) نیاز به «پرداخت» وجه را ایجاد می‌کند.

* **فرآیند:** ماژول خرید، «سفارش خرید» (PO) و سپس «فاکتور خرید» (Purchase Invoice) را ثبت می‌کند. این فاکتور یک «آیتم باز» بستانکار در حساب تأمین‌کننده در ماژول AP (حساب‌های پرداختنی) ایجاد می‌کند.
* **اتصال:** شرکت می‌خواهد وجه فاکتور را پرداخت کند.
* **عملیات خزانه‌داری:** کاربر یک **«سند پرداخت» (Payment Document)** در خزانه‌داری ثبت می‌کند.
* **مثال (پرداخت با چک بابت فاکتور):**
    * *عملیات:* صدور چک به مبلغ 50,000,000 ریال از «بانک ملت» در وجه «تأمین‌کننده ب» بابت فاکتور `P-750`.
    * *تأثیر خزانه‌داری:* یک برگ چک از «دسته چک بانک ملت» (مثلاً سریال 1001) از وضعیت «خام» به «صادر شده» (Issued) تغییر می‌کند.
    * *تأثیر تسویه:* فاکتور `P-750` به وضعیت «تسویه شده» در می‌آید.
    * *سند حسابداری خودکار (FI) - در زمان صدور چک:*
        * **بدهکار (Debit):** 50,000,000 - `21010101 - حساب‌های پرداختنی - تأمین‌کننده ب` (بدهی ما تسویه شد)
        * **بستانکار (Credit):** 50,000,000 - `21030101 - اسناد پرداختنی` (یک بدهی جدید (چک) ایجاد شد)
    * *سند حسابداری خودکار (FI) - در زمان پاس شدن چک (از طریق مغایرت بانکی):*
        * **بدهکار (Debit):** 50,000,000 - `21030101 - اسناد پرداختنی` (بدهی چک بسته شد)
        * **بستانکار (Credit):** 50,000,000 - `11010101 - بانک ملت` (موجودی بانک (دارایی) کاهش یافت)

### ج) مدیریت چک و حسابداری (مثال‌های پیچیده)

عملیات داخلی خزانه‌داری نیز مستقیماً با حسابداری در ارتباط است:

* **مثال ۱: واگذاری چک دریافتی به بانک (جهت خواباندن به حساب)**
    * *عملیات:* چکی که قبلاً از مشتری دریافت شده و در «صندوق» (نزد صندوق) نگهداری می‌شد، به «بانک ملت» جهت وصول تحویل داده می‌شود.
    * *تأثیر خزانه‌داری:* وضعیت چک از «نزد صندوق» به «در جریان وصول» (In Collection) تغییر می‌کند.
    * *سند حسابداری خودکار (FI):* (این یک انتقال دارایی است)
        * **بدهکار (Debit):** `11030102 - اسناد در جریان وصول` (حساب واسط بانکی)
        * **بستانکار (Credit):** `11030101 - اسناد دریافتنی (نزد صندوق)`

* **مثال ۲: وصول (پاس شدن) همان چک**
    * *عملیات:* بانک اعلام می‌کند چک مشتری وصول و مبلغ به حساب واریز شد.
    * *تأثیر خزانه‌داری:* وضعیت چک «پاس شده» (Cleared) می‌شود. **موجودی واقعی بانک ملت افزایش می‌یابد.**
    * *سند حسابداری خودکار (FI):*
        * **بدهکار (Debit):** `11010101 - بانک ملت` (موجودی بانک (دارایی) افزایش یافت)
        * **بستانکار (Credit):** `11030102 - اسناد در جریان وصول` (حساب واسط بسته شد)

### د) یکپارچگی داخلی (شارژ تنخواه)

* **فرآیند:** انتقال وجه بین حساب‌های داخلی شرکت.
* **مثال (شارژ صندوق از بانک):**
    * *عملیات:* انتقال 5,000,000 ریال از «بانک ملت» به «صندوق مرکزی» جهت شارژ تنخواه.
    * *تأثیر خزانه‌داری:* موجودی «بانک ملت» 5,000,000 کاهش و موجودی «صندوق مرکزی» 5,000,000 افزایش می‌یابد.
    * *سند حسابداری خودکار (FI):* (این یک جابجایی دارایی است)
        * **بدهکار (Debit):** 5,000,000 - `11020101 - صندوق مرکزی` (دارایی صندوق افزایش یافت)
        * **بستانکار (Credit):** 5,000,000 - `11010101 - بانک ملت` (دارایی بانک کاهش یافت)

---

## ۵. خلاصه جریان اطلاعات (Data Flow Summary)

1.  **ماژول‌های عملیاتی (SD/MM):** فاکتورهای فروش و خرید، **نیاز** به دریافت یا پرداخت را ایجاد می‌کنند.
2.  **ماژول خزانه‌داری (Treasury):** **عملیات** دریافت و پرداخت را از طریق اسناد (نقد، چک، حواله) مدیریت و **اجرا** می‌کند.
3.  **ماژول حسابداری (FI):** **تأثیر مالی** این عملیات را به صورت خودکار در دفتر کل (GL) **ثبت** کرده و مبنای گزارش‌های مالی (ترازنامه، سود و زیان) را فراهم می‌کند.
4.  **ماژول داده‌های پایه (MDM):** اطمینان می‌دهد که این عملیات در چارچوب ساختار سازمانی صحیح (بنگاه اقتصادی و مکان عملیاتی) انجام می‌شود.

# مفهوم و فرم: مغایرت بانکی (Bank Reconciliation)

---

## ۱. مفهوم

مغایرت بانکی فرآیندی است که در پایان هر دوره مالی (معمولاً ماهانه) انجام می‌شود تا تراکنش‌های ثبت‌شده در ERP تابان (در سرفصل GL حساب بانکی) با صورتحساب ارائه‌شده توسط بانک تطبیق داده شود.

* **هدف:** شناسایی و رفع اختلافات بین سوابق شرکت و سوابق بانک.
* **دلایل اختلاف (مغایرت):**
    1.  **چک‌های معوق (Outstanding Checks):** چک‌های پرداختی که شرکت صادر کرده اما هنوز توسط تأمین‌کننده به بانک ارائه نشده‌اند (در ERP ثبت شده، در بانک نه).
    2.  **سپرده‌های در راه (Deposits in Transit):** وجوهی (مانند چک‌های مشتریان) که شرکت به بانک واگذار کرده اما هنوز توسط بانک وصول و به حساب اضافه نشده‌اند (در ERP ثبت شده، در بانک نه).
    3.  **کارمزدهای بانکی (Bank Fees):** هزینه‌هایی که بانک مستقیماً از حساب کسر کرده اما شرکت هنوز آن‌ها را ثبت نکرده (در بانک ثبت شده، در ERP نه).
    4.  **سود بانکی (Interest Earned):** مبالغی که بانک به حساب واریز کرده (در بانک ثبت شده، در ERP نه).
    5.  **اشتباهات (Errors):** اشتباهات ثبت در هر یک از طرفین.

---

## ۲. فرم: میزکار مغایرت بانکی (Bank Reconciliation Workbench)

**مسیر:**
`خزانه‌داری / عملیات دوره‌ای / مغایرت بانکی`

### رابط کاربری (UX)

1.  **انتخاب حساب:** کاربر «حساب بانکی» (مثلاً بانک ملت مرکزی) و «بازه زمانی» (مثلاً دی ماه 1403) را انتخاب می‌کند.
2.  **ورود اطلاعات بانک:**
    * **روش ۱ (دستی):** کاربر «موجودی نهایی» طبق صورتحساب بانک را دستی وارد می‌کند.
    * **روش ۲ (بارگذاری فایل):** کاربر فایل اکسل یا فایل استاندارد صورتحساب بانک (CSV/Excel) را در سیستم بارگذاری می‌کند.
3.  **نمایش تطبیقی (Reconciliation View):**
    * سیستم یک نمای دو ستونی یا سه ستونی ارائه می‌دهد:
        * **ستون ۱: تراکنش‌های ثبت شده در تابان (ERP)**
        * **ستون ۲: تراکنش‌های ثبت شده در صورتحساب بانک (Bank Statement)**
    * سیستم به صورت هوشمند (بر اساس تاریخ و مبلغ) سعی می‌کند تراکنش‌های مشابه را با هم «تطبیق» (Match) دهد.

4.  **فرآیند مغایرت‌گیری:**
    * **تراکنش‌های تطبیق‌یافته (Matched):** به صورت سبز رنگ نمایش داده می‌شوند و کاربر آن‌ها را تأیید می‌کند.
    * **تراکنش‌های مغایر (Unmatched):**
        * *موجود در ERP، ناموجود در بانک:* (مانند چک معوق). کاربر این موارد را به عنوان «مغایرت باز» علامت‌گذاری می‌کند تا به دوره بعد منتقل شوند.
        * *موجود در بانک، ناموجود در ERP:* (مانند کارمزد). کاربر باید مستقیماً از همین فرم، برای این موارد «سند حسابداری» یا «سند خزانه‌داری» (مثلاً سند پرداخت بابت کارمزد) صادر کند.

5.  **نتیجه نهایی:**
    * `موجودی ERP (دفتر کل)`
    * `+ موارد بستانکار ثبت نشده در ERP (مثل سود)`
    * `- موارد بدهکار ثبت نشده در ERP (مثل کارمزد)`
    * `= موجودی واقعی ERP (Adjusted Book Balance)`
    * ---
    * `موجودی صورتحساب بانک`
    * `+ سپرده‌های در راه`
    * `- چک‌های معوق`
    * `= موجودی واقعی بانک (Adjusted Bank Balance)`

    > **هدف نهایی: موجودی واقعی ERP = موجودی واقعی بانک**

6.  **بستن مغایرت:** پس از تراز شدن، کاربر دوره مغایرت را «نهایی» و «قفل» می‌کند.

# تعیین وضعیت چک (اعلام وصول یا برگشت)

**مسیر دسترسی:** `خزانه‌داری > مدیریت چک‌های دریافتی > عملیات چک > اعلام وصول/برگشت`

---

## ۱. مقدمه و کاربرد
چک‌هایی که در مرحله قبل به بانک واگذار کردید (خواباندید)، اکنون در **«صندوق اسناد در جریان وصول»** منتظر هستند.
پس از گذشت تاریخ سررسید، شما باید صورتحساب بانک (Bank Statement) یا پیامک‌های واریز بانک را بررسی کنید.

* اگر پول به حساب آمده باشد می توان نتیجه گرفت که چک **وصول** شده است.
* اگر بانک اعلام عدم موجودی کند نتیجه گرفت که چک **برگشت** خورده است.

این فرم طراحی شده تا شما وضعیت سیستم را دقیقاً با آنچه در بانک اتفاق افتاده، هماهنگ کنید.

---

## ۲. سناریوی اول: اعلام وصول (پاس شدن چک)

این حالت زمانی رخ می‌دهد که چک با موفقیت نقد شده و مبلغ آن به حساب بانکی شرکت افزوده شده است.

### گام‌به‌گام عملیات وصول:

1.  **انتخاب صندوق اسناد:** در بالای فرم، صندوق اسناد بانکی که چک‌ها در آن هستند را انتخاب کنید (مثلاً: `در جریان وصول - بانک ملت`).
2.  **یافتن چک:** سیستم لیست چک‌های منتظر در آن بانک را نشان می‌دهد. چک مورد نظر را پیدا کنید.
3.  **انتخاب و اقدام:** چک (یا گروهی از چک‌ها) را تیک بزنید و دکمه **«اعلام وصول» (Cleared)** را کلیک کنید.
4.  **تأیید تاریخ:** پنجره‌ای باز می‌شود که **«تاریخ واقعی واریز»** را می‌پرسد.
    * *نکته:* ممکن است سررسید چک ۲۰ام باشد، اما بانک آن را ۲۱ام به حساب ریخته باشد. تاریخ ۲۱ام را وارد کنید تا مغایرت بانکی نداشته باشید.
5.  **ثبت:** تأیید نهایی را بزنید.

### مثال عملی (وصول):
چک ۵۰ میلیون تومانی «آقای رضایی» که سررسیدش امروز بود، در صورتحساب بانک ملت دیده می‌شود.

* شما چک را انتخاب و دکمه وصول را می‌زنید.
* **نتیجه:** موجودی بانک ملت در سیستم ۵۰ میلیون افزایش می‌یابد و چک از لیست کارهای باز حذف می‌شود.

> **سند حسابداری خودکار (وصول):**

> | کد حساب | نام حساب | بدهکار | بستانکار |
> | :--- | :--- | :--- | :--- |
> | ۱۱۱۰۰۱ | **موجودی نقد و بانک - بانک ملت** | ۵۰,۰۰۰,۰۰۰ | - |
> | ۱۱۴۰۰۲ | **اسناد در جریان وصول - بانک ملت** | - | ۵۰,۰۰۰,۰۰۰ |

---

## ۳. سناریوی دوم: اعلام برگشت (نکول چک)

این حالت زمانی رخ می‌دهد که متصدی بانک تماس می‌گیرد یا در سیستم بانکی می‌بینید که چک به دلیل «کسری موجودی»، «امضا نامطابق» یا «مسدودی حساب» برگشت خورده است.

### گام‌به‌گام عملیات برگشت:

1.  **انتخاب صندوق اسناد:** صندوق اسناد بانک مربوطه را انتخاب کنید.
2.  **یافتن چک:** چک مشکل‌دار را در لیست پیدا کنید.
3.  **انتخاب و اقدام:** دکمه **«اعلام برگشت» (Bounced)** را بزنید.
4.  **ورود علت (اختیاری):** می‌توانید علت برگشت (مثلاً: کسر موجودی) را وارد کنید.
5.  **ثبت:** تأیید نهایی را بزنید.

### مثال عملی (برگشت):
چک ۲۰ میلیون تومانی «شرکت البرز» موجودی نداشته و بانک گواهی عدم پرداخت صادر کرده است.

* شما دکمه برگشت را می‌زنید.
* **نتیجه:** چک از «صندوق اسناد بانک» خارج شده و به **«صندوق اسناد چک‌های برگشتی»** منتقل می‌شود. اکنون تیم مالی می‌داند که این یک قلم "بدهی معوقه و پرریسک" است که باید پیگیری شود.

> **سند حسابداری خودکار (برگشت):**

> | کد حساب | نام حساب | بدهکار | بستانکار |
> | :--- | :--- | :--- | :--- |
> | ۱۱۴۰۰۵ | **اسناد دریافتنی برگشتی** | ۲۰,۰۰۰,۰۰۰ | - |
> | ۱۱۴۰۰۲ | **اسناد در جریان وصول - بانک ملت** | - | ۲۰,۰۰۰,۰۰۰ |

---

## ۴. سناریوی سوم: عودت از حالت در جریان وصول (پس گرفتن از بانک)

گاهی پیش می‌آید که چک را به بانک داده‌اید (واگذار کرده‌اید)، اما قبل از سررسید یا قبل از اقدام بانک، به هر دلیلی چک را از بانک پس می‌گیرید (مثلاً مشتری پول نقد آورده و می‌گوید چک را از بانک برگردانید).

### گام‌به‌گام عملیات:
1.  در همان لیست چک‌های در جریان وصول، چک را انتخاب کنید.
2.  دکمه **«بازگشت به صندوق» (Undo Deposit)** را بزنید.
3.  **نتیجه:** چک از بانک خارج شده و دوباره به **«صندوق اسناد صندوق» (گاوصندوق)** برمی‌گردد.
4.  **سند:** سند واگذاری (صفحه ۳) معکوس می‌شود.

---

## ۵. نکات کلیدی و سوالات متداول

**۱. اهمیت تاریخ واقعی واریز**
در هنگام زدن دکمه «وصول»، سیستم از شما تاریخ می‌پرسد. دقت کنید که **تاریخی که در پرینت بانک می‌بینید** را وارد کنید. اگر سررسید چک ۱۴۰۳/۰۵/۲۰ است اما بانک در ۱۴۰۳/۰۵/۲۲ پول را واریز کرده، حتماً تاریخ ۲۲ام را وارد کنید. این کار باعث می‌شود در پایان ماه هنگام **«مغایرت‌گیری بانکی»**، مانده سیستم و بانک دقیقاً یکسان باشد.

**۲. اگر اشتباه دکمه وصول را زدم چه؟**
نگران نباشید.

* به منوی `گزارشات > لیست چک‌های وصول شده` بروید.
* چک مورد نظر را پیدا کنید.
* روی آن کلیک راست کرده (یا دکمه عملیات) و گزینه **«ابطال وصول»** را بزنید.
* چک دوباره به وضعیت «در جریان وصول» برمی‌گردد و سند حسابداری واریز وجه باطل می‌شود.

**۳. آیا چک برگشتی را می‌توانم دوباره به بانک ببرم؟**
بله. اگر مشتری تماس گرفت و گفت "حسابم را پر کردم، دوباره چک را بزنید به حساب":

* ابتدا باید چک را از وضعیت "برگشتی" خارج کنید (عملیات: واگذاری مجدد از صندوق اسناد برگشتی به صندوق اسناد بانک).
* یا بهتر است چک را به صندوق برگردانید و دوباره واگذار کنید تا تاریخچه شفاف بماند.

**۴. هزینه کارمزد برگشت چک چه می‌شود؟**
معمولاً بانک بابت صدور گواهی عدم پرداخت، مبلغی از حساب شما کسر می‌کند. این مبلغ ربطی به خودِ چک ندارد.

* این هزینه را باید جداگانه در فرم **«سند پرداخت»** (نوع: هزینه بانکی) ثبت کنید و ربطی به فرم مدیریت چک ندارد.

# واگذاری چک به بانک (خواباندن به حساب)

**مسیر دسترسی:** `خزانه‌داری > مدیریت چک‌های دریافتی > عملیات چک > واگذاری به بانک`

---

## ۱. مقدمه و کاربرد
چک‌هایی که از مشتری دریافت کرده‌اید و در **«صندوق اسناد صندوق»** (گاوصندوق) نگهداری می‌شوند، هنوز تبدیل به پول نشده‌اند. برای نقد کردن این چک‌ها، باید در تاریخ سررسید (یا چند روز زودتر)، آن‌ها را دسته‌بندی کرده، در قالب یک لیست به بانک ببرید و تحویل باجه کلر (Clear) دهید.

این فرم در سیستم تابان دقیقاً همین فرآیند فیزیکی را شبیه‌سازی می‌کند.

* **هدف:** تغییر محل استقرار چک از «شرکت» به «بانک».
* **نتیجه:** حسابدار می‌فهمد که این چک‌ها دیگر در کشوی میز خزانه‌دار نیستند و نزد بانک امانت هستند تا وصول شوند.

---

## ۲. فرآیند گام‌به‌گام واگذاری

این عملیات معمولاً به صورت **گروهی** انجام می‌شود (مثلاً ۱۰ چک با هم به بانک برده می‌شوند).

### گام اول: تنظیمات انتقال (Header)
در بالای فرم، مشخص کنید که چک‌ها از کجا به کجا می‌روند:

1.  **تاریخ واگذاری:** تاریخ روز (روزی که چک‌ها را به بانک می‌برید).
2.  **صندوق اسناد مبدأ:** `صندوق اسناد اسناد نزد صندوق` (یا گاوصندوق خاصی که چک‌ها در آن هستند).
3.  **صندوق اسناد مقصد (بانک):** `صندوق اسناد در جریان وصول - [نام بانک]` (مثلاً: در جریان وصول بانک ملت).
    * *نکته:* اگر چک‌ها را به بانک "تجارت" می‌برید، حتماً صندوق اسناد "در جریان وصول تجارت" را انتخاب کنید.

### گام دوم: انتخاب چک‌ها (Selection)
1.  دکمه **«افزودن چک / جستجو»** را بزنید.
2.  پنجره‌ای باز می‌شود که لیست تمام چک‌های موجود در «صندوق اسناد مبدأ» را نمایش می‌دهد.
3.  **فیلتر کردن:** از فیلتر تاریخ سررسید استفاده کنید. (مثلاً چک‌های سررسید امروز و فردا را فیلتر کنید).
4.  **تیک زدن:** چک‌هایی که قصد واگذاری دارید را انتخاب (Select) کنید.
5.  دکمه تأیید را بزنید تا چک‌ها به لیست اصلی فرم اضافه شوند.



### گام سوم: چاپ فرم واگذاری (Deposit Slip) - اختیاری
قبل از ثبت نهایی، می‌توانید دکمه **«چاپ فرم واگذاری»** را بزنید. سیستم یک لیست مرتب شامل شماره چک، مبلغ، بانک صادرکننده و نام صاحب حساب به شما می‌دهد.

* *کاربرد:* این لیست را پرینت بگیرید و همراه فیزیک چک‌ها به متصدی بانک تحویل دهید تا رسید مهر شده دریافت کنید.

### گام چهارم: ثبت نهایی
دکمه **«ذخیره / انجام عملیات»** را بزنید.
* **نتیجه:** چک‌ها از «صندوق اسناد صندوق» ناپدید شده و در «صندوق اسناد بانک» ظاهر می‌شوند.

---

## ۳. سناریوی عملی (مثال واقعی)

**داستان:**
امروز **۱۵ اردیبهشت** است. خزانه‌دار شرکت (آقای حسینی) چک‌های مشتریانی را که سررسید آن‌ها **۱۶ اردیبهشت** است، بررسی می‌کند. او ۳ فقره چک پیدا می‌کند که باید به حساب جاری شرکت در **بانک ملت** واریز شوند.

**مشخصات چک‌ها:**

1.  چک آقای رضایی (۵۰ میلیون تومان)
2.  چک شرکت البرز (۲۰ میلیون تومان)
3.  چک فروشگاه کوروش (۳۰ میلیون تومان)

**اقدامات در سیستم:**

1.  آقای حسینی فرم «واگذاری به بانک» را باز می‌کند.
2.  **مبدأ:** صندوق مرکزی | **مقصد:** در جریان وصول بانک ملت.
3.  دکمه افزودن را می‌زند و فیلتر تاریخ را روی `1403/02/16` تنظیم می‌کند.
4.  هر ۳ چک را در لیست می‌بیند و تیک می‌زند.
5.  دکمه **«چاپ رسید»** را می‌زند، پرینت می‌گیرد و چک‌ها را منگنه می‌کند.
6.  دکمه **«ثبت»** را در سیستم می‌زند.
7.  حالا با خیال راحت چک‌ها را برداشته و فیزیک آن‌ها را به شعبه بانک ملت می‌برد.

---

## ۴. پشت صحنه سیستم (حسابداری)

در این مرحله هنوز پولی به حساب ننشسته است، اما دارایی از یک شکل به شکل دیگر تبدیل شده است. سیستم سند زیر را صادر می‌کند:

| کد حساب | نام حساب | بدهکار | بستانکار | شرح |
| :--- | :--- | :--- | :--- | :--- |
| ۱۱۴۰۰۲ | **اسناد در جریان وصول - بانک ملت** | ۱۰۰,۰۰۰,۰۰۰ | - | واگذاری ۳ فقره چک به بانک ملت ... |
| ۱۱۴۰۰۱ | **اسناد دریافتنی نزد صندوق** | - | ۱۰۰,۰۰۰,۰۰۰ | واگذاری ۳ فقره چک به بانک ملت ... |

* **تفسیر:** حسابداری متوجه می‌شود که ۱۰۰ میلیون تومان اسناد ما الان نزد بانک ملت است و منتظر وصول می‌باشد.

---

## ۵. سوالات متداول و نکات کنترلی

**۱. آیا می‌توانم چک‌هایی که مربوط به بانک‌های مختلف هستند را در یک فرم ثبت کنم؟**
خیر.

* هر فرم واگذاری فقط **یک مقصد** (یک بانک) دارد.
* اگر می‌خواهید تعدادی چک به بانک ملت و تعدادی را به بانک صادرات ببرید، باید **دو فرم واگذاری جداگانه** ثبت کنید (یکی با مقصد صندوق اسناد ملت و دیگری با مقصد صندوق اسناد صادرات).

**۲. اگر اشتباهی چکی را واگذار کردم چه می‌شود؟ (مثلاً چکی که قرار بود فردا ببرم)**
نترسید. تا زمانی که وضعیت چک «در جریان وصول» است (هنوز وصول یا برگشت نشده)، می‌توانید عملیات را برگردانید.

* به لیست واگذاری‌ها بروید.
* فرم مربوطه را باز کنید.
* دکمه **«ابطال»** یا **«حذف»** را بزنید. چک‌ها دوباره به وضعیت «نزد صندوق» برمی‌گردند و سند حسابداری معکوس می‌شود.

**۳. آیا تاریخ واگذاری مهم است؟**
بله. معمولاً بانک‌ها چک‌ها را ۲۴ ساعت زودتر برای کلر قبول می‌کنند. تاریخ واگذاری در سیستم باید با تاریخی که چک را به بانک تحویل دادید یکی باشد تا در صورت گم شدن چک، بدانید در چه روزی و به چه کسی تحویل داده شده است.

**۴. چک "بین بانکی" (رمزدار) را هم باید واگذار کنم؟**
بله. هر برگه فیزیکی که وارد صندوق شده، برای نقد شدن باید از طریق این فرم به بانک منتقل شود. حتی اگر چک رمزدار باشد و همان لحظه نقد شود، برای حفظ زنجیره اسناد، بهتر است مسیر `صندوق -> واگذاری -> وصول` طی شود.

# خرج کردن چک - واگذاری به غیر (Check Endorsement)

**مسیر دسترسی:** `خزانه‌داری > عملیات پرداخت > سند پرداخت جدید`

-----

## ۱. مفهوم و کاربرد

### خرج کردن چک چیست؟

در بازار ایران، بسیار رایج است که شرکت‌ها چک‌هایی را که از مشتریان خود دریافت کرده‌اند، نقد نکنند؛ بلکه همان چک را بابت بدهی‌های خود به شخص دیگری (مانند تأمین‌کننده کالا، پیمانکار یا فروشنده مواد اولیه) واگذار کنند.
به این عمل در اصطلاح بازار **«خرج کردن چک»** و در اصطلاح حقوقی **«ظهرنویسی» (Endorsement)** گفته می‌شود.

### چرا این کار را انجام می‌دهیم؟

1.  **حفظ نقدینگی:** به جای خالی کردن حساب بانکی شرکت، از اسناد موجود استفاده می‌کنیم.
2.  **تسویه سریع:** بدون نیاز به منتظر ماندن برای سررسید چک مشتری، بدهی خود به تأمین‌کننده را تسویه می‌کنیم.

> **قانون مهم سیستم:** شما فقط می‌توانید چک‌هایی را خرج کنید که وضعیت آن‌ها **«نزد صندوق» (On-Hand)** باشد. چکی که به بانک واگذار شده یا برگشت خورده است، ابتدا باید به صندوق برگردد تا قابل خرج کردن باشد.

-----

## ۲. مراحل انجام کار در سیستم

از آنجا که خرج کردن چک نوعی "پرداخت بدهی" محسوب می‌شود، این عملیات در فرم **«سند پرداخت»** انجام می‌گیرد، نه در منوی عملیات چک.

### گام ۱: باز کردن سند پرداخت

به مسیر `خزانه‌داری > عملیات پرداخت` رفته و روی **«سند پرداخت جدید»** کلیک کنید.

### گام ۲: انتخاب گیرنده

در فیلد **طرف حساب (Payee)**، نام شخص یا شرکتی را که می‌خواهید چک را به او بدهید انتخاب کنید.

  * *مثال: شرکت فولاد مبارکه (تأمین‌کننده)*

### گام ۳: انتخاب روش پرداخت

در بخش جزئیات پرداخت (Payment Lines):

1.  یک ردیف جدید ایجاد کنید.
2.  نوع روش پرداخت را **«خرج چک» (Endorse Check)** انتخاب کنید.
3.  با انتخاب این گزینه، فیلد مبلغ غیرفعال می‌شود (چون مبلغ تابع چکی است که انتخاب می‌کنید) و دکمه **«انتخاب چک»** فعال می‌گردد.

### گام ۴: انتخاب چک از صندوق اسناد

با زدن دکمه انتخاب چک، سیستم پنجره‌ای باز می‌کند که **فقط** شامل چک‌های موجود در **«صندوق اسناد اسناد نزد صندوق»** است.

  * می‌توانید لیست را بر اساس مبلغ، سررسید یا نام مشتریِ صادرکننده فیلتر کنید.
  * چک (یا چک‌های) مورد نظر را تیک بزنید.

### گام ۵: ثبت نهایی (Post)

پس از انتخاب چک، مبلغ سند به صورت خودکار پر می‌شود. دکمه **«ثبت»** را بزنید.

-----

## ۳. تأثیرات مالی و حسابداری

با ثبت این سند، دو اتفاق مهم در سیستم رخ می‌دهد:

1.  **تغییر در خزانه‌داری:**

      * چک از «صندوق اسناد اسناد نزد صندوق» خارج می‌شود.
      * وضعیت چک به **«خرج شده» (Endorsed)** تغییر می‌کند.
      * مالکیت چک از شرکت شما سلب می‌شود.

2.  **سند حسابداری خودکار (GL Entry):**
    سیستم به صورت اتوماتیک سند زیر را صادر می‌کند:

| کد حساب | نام حساب | بدهکار (Dr) | بستانکار (Cr) | توضیحات |
| :--- | :--- | :--- | :--- | :--- |
| `210101` | **حساب‌های پرداختنی** <br> *(شرکت فولاد)* | 100,000,000 | 0 | بدهی ما به تأمین‌کننده کم شد. |
| `120101` | **اسناد دریافتنی نزد صندوق** <br> *(صندوق اسناد صندوق)* | 0 | 100,000,000 | دارایی چک از صندوق خارج شد. |

-----

## ۴. مثال جامع عملیاتی

**سناریو:**
شرکت شما (تابان) مبلغ ۵۰ میلیون تومان به «بازرگانی آهن‌چی» بدهکار است.
از طرفی، در گاوصندوق شرکت، یک چک ۵۰ میلیون تومانی از مشتری خود (آقای رضایی) دارید که سررسید آن ۲۰ روز دیگر است.
مدیر مالی تصمیم می‌گیرد به جای پرداخت پول نقد، چک آقای رضایی را به بازرگانی آهن‌چی بدهد.

**اجرا در نرم‌افزار:**

1.  وارد فرم **سند پرداخت** می‌شوید.
2.  گیرنده را **«بازرگانی آهن‌چی»** انتخاب می‌کنید.
3.  در ردیف پرداخت، گزینه **«خرج چک»** را انتخاب می‌کنید.
4.  لیست چک‌ها باز می‌شود. چک **آقای رضایی** (به مبلغ ۵۰ میلیون و شناسه صیادی `123...`) را انتخاب می‌کنید.
5.  سند را ثبت می‌کنید.

**نتیجه:**

  * بدهی شما به بازرگانی آهن‌چی صفر می‌شود.
  * چک آقای رضایی از لیست چک‌های موجود در صندوق شما حذف می‌شود.
  * در گزارش کاردکس چک آقای رضایی، یک ردیف اضافه می‌شود: *"واگذاری به بازرگانی آهن‌چی بابت سند پرداخت شماره X"*.

-----

## ۵. سوالات متداول و نکات کنترلی

**سوال ۱: اگر چکی را خرج کنیم و بعداً آن چک پاس نشود (برگشت بخورد) چه می‌شود؟**
**پاسخ:** این پیچیده‌ترین حالت است.

1.  بازرگانی آهن‌چی چک را به شما برمی‌گرداند، بنابراین شما باید در سیستم **«استرداد از خرج»** بزنید (بدهی آهن‌چی دوباره باز می‌شود و چک به صندوق اسناد برگشتی شما می‌آید).
2.  سپس شما سراغ مشتری (آقای رضایی) می‌روید و مراحل پیگیری چک برگشتی را طی می‌کنید.

**سوال ۲: آیا می‌توانم فقط بخشی از مبلغ چک را خرج کنم؟**
**پاسخ:** خیر. چک یک موجودیت واحد است. نمی‌توانید نیمی از کاغذ چک را پاره کنید و بدهید\! اگر مبلغ چک ۵۰ میلیون است و بدهی شما ۳۰ میلیون است، باید چک را بدهید و ۲۰ میلیون مابقی را از طرف مقابل به صورت نقد یا چکِ خرجیِ خودش دریافت کنید (که این عملیات ترکیبی می‌شود).

**سوال ۳: آیا می‌توانم چکی که "در جریان وصول" (نزد بانک) است را خرج کنم؟**
**پاسخ:** خیر. فیزیک چک اکنون دست بانک است. برای خرج کردن، ابتدا باید عملیات **«استرداد از واگذاری»** را انجام دهید تا چک به وضعیت «نزد صندوق» برگردد، سپس آن را خرج کنید.

**سوال ۴: آیا سیستم برای خرج کردن چک هشدار می‌دهد؟**
**پاسخ:** بله، اگر سررسید چک گذشته باشد یا وضعیت اعتباری صادرکننده چک (مشتری) قرمز باشد، سیستم می‌تواند به کاربر هشدار دهد که "این چک ریسک برگشت دارد، آیا از خرج کردن آن مطمئن هستید؟".


# تعیین وضعیت چک (اعلام وصول یا برگشت)

**مسیر دسترسی:** `خزانه‌داری > مدیریت چک‌های دریافتی > عملیات چک > اعلام وصول/برگشت`

---

## ۱. مقدمه و کاربرد
چک‌هایی که در مرحله قبل به بانک واگذار کردید (خواباندید)، اکنون در **«صندوق اسناد در جریان وصول»** منتظر هستند.
پس از گذشت تاریخ سررسید، شما باید صورتحساب بانک (Bank Statement) یا پیامک‌های واریز بانک را بررسی کنید.

* اگر پول به حساب آمده باشد می توان نتیجه گرفت که چک **وصول** شده است.
* اگر بانک اعلام عدم موجودی کند نتیجه گرفت که چک **برگشت** خورده است.

این فرم طراحی شده تا شما وضعیت سیستم را دقیقاً با آنچه در بانک اتفاق افتاده، هماهنگ کنید.

---

## ۲. سناریوی اول: اعلام وصول (پاس شدن چک)

این حالت زمانی رخ می‌دهد که چک با موفقیت نقد شده و مبلغ آن به حساب بانکی شرکت افزوده شده است.

### گام‌به‌گام عملیات وصول:

1.  **انتخاب صندوق اسناد:** در بالای فرم، صندوق اسناد بانکی که چک‌ها در آن هستند را انتخاب کنید (مثلاً: `در جریان وصول - بانک ملت`).
2.  **یافتن چک:** سیستم لیست چک‌های منتظر در آن بانک را نشان می‌دهد. چک مورد نظر را پیدا کنید.
3.  **انتخاب و اقدام:** چک (یا گروهی از چک‌ها) را تیک بزنید و دکمه **«اعلام وصول» (Cleared)** را کلیک کنید.
4.  **تأیید تاریخ:** پنجره‌ای باز می‌شود که **«تاریخ واقعی واریز»** را می‌پرسد.
    * *نکته:* ممکن است سررسید چک ۲۰ام باشد، اما بانک آن را ۲۱ام به حساب ریخته باشد. تاریخ ۲۱ام را وارد کنید تا مغایرت بانکی نداشته باشید.
5.  **ثبت:** تأیید نهایی را بزنید.

### مثال عملی (وصول):
چک ۵۰ میلیون تومانی «آقای رضایی» که سررسیدش امروز بود، در صورتحساب بانک ملت دیده می‌شود.

* شما چک را انتخاب و دکمه وصول را می‌زنید.
* **نتیجه:** موجودی بانک ملت در سیستم ۵۰ میلیون افزایش می‌یابد و چک از لیست کارهای باز حذف می‌شود.

> **سند حسابداری خودکار (وصول):**

> | کد حساب | نام حساب | بدهکار | بستانکار |
> | :--- | :--- | :--- | :--- |
> | ۱۱۱۰۰۱ | **موجودی نقد و بانک - بانک ملت** | ۵۰,۰۰۰,۰۰۰ | - |
> | ۱۱۴۰۰۲ | **اسناد در جریان وصول - بانک ملت** | - | ۵۰,۰۰۰,۰۰۰ |

---

## ۳. سناریوی دوم: اعلام برگشت (نکول چک)

این حالت زمانی رخ می‌دهد که متصدی بانک تماس می‌گیرد یا در سیستم بانکی می‌بینید که چک به دلیل «کسری موجودی»، «امضا نامطابق» یا «مسدودی حساب» برگشت خورده است.

### گام‌به‌گام عملیات برگشت:

1.  **انتخاب صندوق اسناد:** صندوق اسناد بانک مربوطه را انتخاب کنید.
2.  **یافتن چک:** چک مشکل‌دار را در لیست پیدا کنید.
3.  **انتخاب و اقدام:** دکمه **«اعلام برگشت» (Bounced)** را بزنید.
4.  **ورود علت (اختیاری):** می‌توانید علت برگشت (مثلاً: کسر موجودی) را وارد کنید.
5.  **ثبت:** تأیید نهایی را بزنید.

### مثال عملی (برگشت):
چک ۲۰ میلیون تومانی «شرکت البرز» موجودی نداشته و بانک گواهی عدم پرداخت صادر کرده است.

* شما دکمه برگشت را می‌زنید.
* **نتیجه:** چک از «صندوق اسناد بانک» خارج شده و به **«صندوق اسناد چک‌های برگشتی»** منتقل می‌شود. اکنون تیم مالی می‌داند که این یک قلم "بدهی معوقه و پرریسک" است که باید پیگیری شود.

> **سند حسابداری خودکار (برگشت):**

> | کد حساب | نام حساب | بدهکار | بستانکار |
> | :--- | :--- | :--- | :--- |
> | ۱۱۴۰۰۵ | **اسناد دریافتنی برگشتی** | ۲۰,۰۰۰,۰۰۰ | - |
> | ۱۱۴۰۰۲ | **اسناد در جریان وصول - بانک ملت** | - | ۲۰,۰۰۰,۰۰۰ |

---

## ۴. سناریوی سوم: عودت از حالت در جریان وصول (پس گرفتن از بانک)

گاهی پیش می‌آید که چک را به بانک داده‌اید (واگذار کرده‌اید)، اما قبل از سررسید یا قبل از اقدام بانک، به هر دلیلی چک را از بانک پس می‌گیرید (مثلاً مشتری پول نقد آورده و می‌گوید چک را از بانک برگردانید).

### گام‌به‌گام عملیات:
1.  در همان لیست چک‌های در جریان وصول، چک را انتخاب کنید.
2.  دکمه **«بازگشت به صندوق» (Undo Deposit)** را بزنید.
3.  **نتیجه:** چک از بانک خارج شده و دوباره به **«صندوق اسناد صندوق» (گاوصندوق)** برمی‌گردد.
4.  **سند:** سند واگذاری (صفحه ۳) معکوس می‌شود.

---

## ۵. نکات کلیدی و سوالات متداول

**۱. اهمیت تاریخ واقعی واریز**
در هنگام زدن دکمه «وصول»، سیستم از شما تاریخ می‌پرسد. دقت کنید که **تاریخی که در پرینت بانک می‌بینید** را وارد کنید. اگر سررسید چک ۱۴۰۳/۰۵/۲۰ است اما بانک در ۱۴۰۳/۰۵/۲۲ پول را واریز کرده، حتماً تاریخ ۲۲ام را وارد کنید. این کار باعث می‌شود در پایان ماه هنگام **«مغایرت‌گیری بانکی»**، مانده سیستم و بانک دقیقاً یکسان باشد.

**۲. اگر اشتباه دکمه وصول را زدم چه؟**
نگران نباشید.

* به منوی `گزارشات > لیست چک‌های وصول شده` بروید.
* چک مورد نظر را پیدا کنید.
* روی آن کلیک راست کرده (یا دکمه عملیات) و گزینه **«ابطال وصول»** را بزنید.
* چک دوباره به وضعیت «در جریان وصول» برمی‌گردد و سند حسابداری واریز وجه باطل می‌شود.

**۳. آیا چک برگشتی را می‌توانم دوباره به بانک ببرم؟**
بله. اگر مشتری تماس گرفت و گفت "حسابم را پر کردم، دوباره چک را بزنید به حساب":

* ابتدا باید چک را از وضعیت "برگشتی" خارج کنید (عملیات: واگذاری مجدد از صندوق اسناد برگشتی به صندوق اسناد بانک).
* یا بهتر است چک را به صندوق برگردانید و دوباره واگذار کنید تا تاریخچه شفاف بماند.

**۴. هزینه کارمزد برگشت چک چه می‌شود؟**
معمولاً بانک بابت صدور گواهی عدم پرداخت، مبلغی از حساب شما کسر می‌کند. این مبلغ ربطی به خودِ چک ندارد.

* این هزینه را باید جداگانه در فرم **«سند پرداخت»** (نوع: هزینه بانکی) ثبت کنید و ربطی به فرم مدیریت چک ندارد.

# واگذاری چک به بانک (خواباندن به حساب)

**مسیر دسترسی:** `خزانه‌داری > مدیریت چک‌های دریافتی > عملیات چک > واگذاری به بانک`

---

## ۱. مقدمه و کاربرد
چک‌هایی که از مشتری دریافت کرده‌اید و در **«صندوق اسناد صندوق»** (گاوصندوق) نگهداری می‌شوند، هنوز تبدیل به پول نشده‌اند. برای نقد کردن این چک‌ها، باید در تاریخ سررسید (یا چند روز زودتر)، آن‌ها را دسته‌بندی کرده، در قالب یک لیست به بانک ببرید و تحویل باجه کلر (Clear) دهید.

این فرم در سیستم تابان دقیقاً همین فرآیند فیزیکی را شبیه‌سازی می‌کند.

* **هدف:** تغییر محل استقرار چک از «شرکت» به «بانک».
* **نتیجه:** حسابدار می‌فهمد که این چک‌ها دیگر در کشوی میز خزانه‌دار نیستند و نزد بانک امانت هستند تا وصول شوند.

---

## ۲. فرآیند گام‌به‌گام واگذاری

این عملیات معمولاً به صورت **گروهی** انجام می‌شود (مثلاً ۱۰ چک با هم به بانک برده می‌شوند).

### گام اول: تنظیمات انتقال (Header)
در بالای فرم، مشخص کنید که چک‌ها از کجا به کجا می‌روند:

1.  **تاریخ واگذاری:** تاریخ روز (روزی که چک‌ها را به بانک می‌برید).
2.  **صندوق اسناد مبدأ:** `صندوق اسناد اسناد نزد صندوق` (یا گاوصندوق خاصی که چک‌ها در آن هستند).
3.  **صندوق اسناد مقصد (بانک):** `صندوق اسناد در جریان وصول - [نام بانک]` (مثلاً: در جریان وصول بانک ملت).
    * *نکته:* اگر چک‌ها را به بانک "تجارت" می‌برید، حتماً صندوق اسناد "در جریان وصول تجارت" را انتخاب کنید.

### گام دوم: انتخاب چک‌ها (Selection)
1.  دکمه **«افزودن چک / جستجو»** را بزنید.
2.  پنجره‌ای باز می‌شود که لیست تمام چک‌های موجود در «صندوق اسناد مبدأ» را نمایش می‌دهد.
3.  **فیلتر کردن:** از فیلتر تاریخ سررسید استفاده کنید. (مثلاً چک‌های سررسید امروز و فردا را فیلتر کنید).
4.  **تیک زدن:** چک‌هایی که قصد واگذاری دارید را انتخاب (Select) کنید.
5.  دکمه تأیید را بزنید تا چک‌ها به لیست اصلی فرم اضافه شوند.



### گام سوم: چاپ فرم واگذاری (Deposit Slip) - اختیاری
قبل از ثبت نهایی، می‌توانید دکمه **«چاپ فرم واگذاری»** را بزنید. سیستم یک لیست مرتب شامل شماره چک، مبلغ، بانک صادرکننده و نام صاحب حساب به شما می‌دهد.

* *کاربرد:* این لیست را پرینت بگیرید و همراه فیزیک چک‌ها به متصدی بانک تحویل دهید تا رسید مهر شده دریافت کنید.

### گام چهارم: ثبت نهایی
دکمه **«ذخیره / انجام عملیات»** را بزنید.
* **نتیجه:** چک‌ها از «صندوق اسناد صندوق» ناپدید شده و در «صندوق اسناد بانک» ظاهر می‌شوند.

---

## ۳. سناریوی عملی (مثال واقعی)

**داستان:**
امروز **۱۵ اردیبهشت** است. خزانه‌دار شرکت (آقای حسینی) چک‌های مشتریانی را که سررسید آن‌ها **۱۶ اردیبهشت** است، بررسی می‌کند. او ۳ فقره چک پیدا می‌کند که باید به حساب جاری شرکت در **بانک ملت** واریز شوند.

**مشخصات چک‌ها:**

1.  چک آقای رضایی (۵۰ میلیون تومان)
2.  چک شرکت البرز (۲۰ میلیون تومان)
3.  چک فروشگاه کوروش (۳۰ میلیون تومان)

**اقدامات در سیستم:**

1.  آقای حسینی فرم «واگذاری به بانک» را باز می‌کند.
2.  **مبدأ:** صندوق مرکزی | **مقصد:** در جریان وصول بانک ملت.
3.  دکمه افزودن را می‌زند و فیلتر تاریخ را روی `1403/02/16` تنظیم می‌کند.
4.  هر ۳ چک را در لیست می‌بیند و تیک می‌زند.
5.  دکمه **«چاپ رسید»** را می‌زند، پرینت می‌گیرد و چک‌ها را منگنه می‌کند.
6.  دکمه **«ثبت»** را در سیستم می‌زند.
7.  حالا با خیال راحت چک‌ها را برداشته و فیزیک آن‌ها را به شعبه بانک ملت می‌برد.

---

## ۴. پشت صحنه سیستم (حسابداری)

در این مرحله هنوز پولی به حساب ننشسته است، اما دارایی از یک شکل به شکل دیگر تبدیل شده است. سیستم سند زیر را صادر می‌کند:

| کد حساب | نام حساب | بدهکار | بستانکار | شرح |
| :--- | :--- | :--- | :--- | :--- |
| ۱۱۴۰۰۲ | **اسناد در جریان وصول - بانک ملت** | ۱۰۰,۰۰۰,۰۰۰ | - | واگذاری ۳ فقره چک به بانک ملت ... |
| ۱۱۴۰۰۱ | **اسناد دریافتنی نزد صندوق** | - | ۱۰۰,۰۰۰,۰۰۰ | واگذاری ۳ فقره چک به بانک ملت ... |

* **تفسیر:** حسابداری متوجه می‌شود که ۱۰۰ میلیون تومان اسناد ما الان نزد بانک ملت است و منتظر وصول می‌باشد.

---

## ۵. سوالات متداول و نکات کنترلی

**۱. آیا می‌توانم چک‌هایی که مربوط به بانک‌های مختلف هستند را در یک فرم ثبت کنم؟**
خیر.

* هر فرم واگذاری فقط **یک مقصد** (یک بانک) دارد.
* اگر می‌خواهید تعدادی چک به بانک ملت و تعدادی را به بانک صادرات ببرید، باید **دو فرم واگذاری جداگانه** ثبت کنید (یکی با مقصد صندوق اسناد ملت و دیگری با مقصد صندوق اسناد صادرات).

**۲. اگر اشتباهی چکی را واگذار کردم چه می‌شود؟ (مثلاً چکی که قرار بود فردا ببرم)**
نترسید. تا زمانی که وضعیت چک «در جریان وصول» است (هنوز وصول یا برگشت نشده)، می‌توانید عملیات را برگردانید.

* به لیست واگذاری‌ها بروید.
* فرم مربوطه را باز کنید.
* دکمه **«ابطال»** یا **«حذف»** را بزنید. چک‌ها دوباره به وضعیت «نزد صندوق» برمی‌گردند و سند حسابداری معکوس می‌شود.

**۳. آیا تاریخ واگذاری مهم است؟**
بله. معمولاً بانک‌ها چک‌ها را ۲۴ ساعت زودتر برای کلر قبول می‌کنند. تاریخ واگذاری در سیستم باید با تاریخی که چک را به بانک تحویل دادید یکی باشد تا در صورت گم شدن چک، بدانید در چه روزی و به چه کسی تحویل داده شده است.

**۴. چک "بین بانکی" (رمزدار) را هم باید واگذار کنم؟**
بله. هر برگه فیزیکی که وارد صندوق شده، برای نقد شدن باید از طریق این فرم به بانک منتقل شود. حتی اگر چک رمزدار باشد و همان لحظه نقد شود، برای حفظ زنجیره اسناد، بهتر است مسیر `صندوق -> واگذاری -> وصول` طی شود.

# خرج کردن چک - واگذاری به غیر (Check Endorsement)

**مسیر دسترسی:** `خزانه‌داری > عملیات پرداخت > سند پرداخت جدید`

-----

## ۱. مفهوم و کاربرد

### خرج کردن چک چیست؟

در بازار ایران، بسیار رایج است که شرکت‌ها چک‌هایی را که از مشتریان خود دریافت کرده‌اند، نقد نکنند؛ بلکه همان چک را بابت بدهی‌های خود به شخص دیگری (مانند تأمین‌کننده کالا، پیمانکار یا فروشنده مواد اولیه) واگذار کنند.
به این عمل در اصطلاح بازار **«خرج کردن چک»** و در اصطلاح حقوقی **«ظهرنویسی» (Endorsement)** گفته می‌شود.

### چرا این کار را انجام می‌دهیم؟

1.  **حفظ نقدینگی:** به جای خالی کردن حساب بانکی شرکت، از اسناد موجود استفاده می‌کنیم.
2.  **تسویه سریع:** بدون نیاز به منتظر ماندن برای سررسید چک مشتری، بدهی خود به تأمین‌کننده را تسویه می‌کنیم.

> **قانون مهم سیستم:** شما فقط می‌توانید چک‌هایی را خرج کنید که وضعیت آن‌ها **«نزد صندوق» (On-Hand)** باشد. چکی که به بانک واگذار شده یا برگشت خورده است، ابتدا باید به صندوق برگردد تا قابل خرج کردن باشد.

-----

## ۲. مراحل انجام کار در سیستم

از آنجا که خرج کردن چک نوعی "پرداخت بدهی" محسوب می‌شود، این عملیات در فرم **«سند پرداخت»** انجام می‌گیرد، نه در منوی عملیات چک.

### گام ۱: باز کردن سند پرداخت

به مسیر `خزانه‌داری > عملیات پرداخت` رفته و روی **«سند پرداخت جدید»** کلیک کنید.

### گام ۲: انتخاب گیرنده

در فیلد **طرف حساب (Payee)**، نام شخص یا شرکتی را که می‌خواهید چک را به او بدهید انتخاب کنید.

  * *مثال: شرکت فولاد مبارکه (تأمین‌کننده)*

### گام ۳: انتخاب روش پرداخت

در بخش جزئیات پرداخت (Payment Lines):

1.  یک ردیف جدید ایجاد کنید.
2.  نوع روش پرداخت را **«خرج چک» (Endorse Check)** انتخاب کنید.
3.  با انتخاب این گزینه، فیلد مبلغ غیرفعال می‌شود (چون مبلغ تابع چکی است که انتخاب می‌کنید) و دکمه **«انتخاب چک»** فعال می‌گردد.

### گام ۴: انتخاب چک از صندوق اسناد

با زدن دکمه انتخاب چک، سیستم پنجره‌ای باز می‌کند که **فقط** شامل چک‌های موجود در **«صندوق اسناد اسناد نزد صندوق»** است.

  * می‌توانید لیست را بر اساس مبلغ، سررسید یا نام مشتریِ صادرکننده فیلتر کنید.
  * چک (یا چک‌های) مورد نظر را تیک بزنید.

### گام ۵: ثبت نهایی (Post)

پس از انتخاب چک، مبلغ سند به صورت خودکار پر می‌شود. دکمه **«ثبت»** را بزنید.

-----

## ۳. تأثیرات مالی و حسابداری

با ثبت این سند، دو اتفاق مهم در سیستم رخ می‌دهد:

1.  **تغییر در خزانه‌داری:**

      * چک از «صندوق اسناد اسناد نزد صندوق» خارج می‌شود.
      * وضعیت چک به **«خرج شده» (Endorsed)** تغییر می‌کند.
      * مالکیت چک از شرکت شما سلب می‌شود.

2.  **سند حسابداری خودکار (GL Entry):**
    سیستم به صورت اتوماتیک سند زیر را صادر می‌کند:

| کد حساب | نام حساب | بدهکار (Dr) | بستانکار (Cr) | توضیحات |
| :--- | :--- | :--- | :--- | :--- |
| `210101` | **حساب‌های پرداختنی** <br> *(شرکت فولاد)* | 100,000,000 | 0 | بدهی ما به تأمین‌کننده کم شد. |
| `120101` | **اسناد دریافتنی نزد صندوق** <br> *(صندوق اسناد صندوق)* | 0 | 100,000,000 | دارایی چک از صندوق خارج شد. |

-----

## ۴. مثال جامع عملیاتی

**سناریو:**
شرکت شما (تابان) مبلغ ۵۰ میلیون تومان به «بازرگانی آهن‌چی» بدهکار است.
از طرفی، در گاوصندوق شرکت، یک چک ۵۰ میلیون تومانی از مشتری خود (آقای رضایی) دارید که سررسید آن ۲۰ روز دیگر است.
مدیر مالی تصمیم می‌گیرد به جای پرداخت پول نقد، چک آقای رضایی را به بازرگانی آهن‌چی بدهد.

**اجرا در نرم‌افزار:**

1.  وارد فرم **سند پرداخت** می‌شوید.
2.  گیرنده را **«بازرگانی آهن‌چی»** انتخاب می‌کنید.
3.  در ردیف پرداخت، گزینه **«خرج چک»** را انتخاب می‌کنید.
4.  لیست چک‌ها باز می‌شود. چک **آقای رضایی** (به مبلغ ۵۰ میلیون و شناسه صیادی `123...`) را انتخاب می‌کنید.
5.  سند را ثبت می‌کنید.

**نتیجه:**

  * بدهی شما به بازرگانی آهن‌چی صفر می‌شود.
  * چک آقای رضایی از لیست چک‌های موجود در صندوق شما حذف می‌شود.
  * در گزارش کاردکس چک آقای رضایی، یک ردیف اضافه می‌شود: *"واگذاری به بازرگانی آهن‌چی بابت سند پرداخت شماره X"*.

-----

## ۵. سوالات متداول و نکات کنترلی

**سوال ۱: اگر چکی را خرج کنیم و بعداً آن چک پاس نشود (برگشت بخورد) چه می‌شود؟**
**پاسخ:** این پیچیده‌ترین حالت است.

1.  بازرگانی آهن‌چی چک را به شما برمی‌گرداند، بنابراین شما باید در سیستم **«استرداد از خرج»** بزنید (بدهی آهن‌چی دوباره باز می‌شود و چک به صندوق اسناد برگشتی شما می‌آید).
2.  سپس شما سراغ مشتری (آقای رضایی) می‌روید و مراحل پیگیری چک برگشتی را طی می‌کنید.

**سوال ۲: آیا می‌توانم فقط بخشی از مبلغ چک را خرج کنم؟**
**پاسخ:** خیر. چک یک موجودیت واحد است. نمی‌توانید نیمی از کاغذ چک را پاره کنید و بدهید\! اگر مبلغ چک ۵۰ میلیون است و بدهی شما ۳۰ میلیون است، باید چک را بدهید و ۲۰ میلیون مابقی را از طرف مقابل به صورت نقد یا چکِ خرجیِ خودش دریافت کنید (که این عملیات ترکیبی می‌شود).

**سوال ۳: آیا می‌توانم چکی که "در جریان وصول" (نزد بانک) است را خرج کنم؟**
**پاسخ:** خیر. فیزیک چک اکنون دست بانک است. برای خرج کردن، ابتدا باید عملیات **«استرداد از واگذاری»** را انجام دهید تا چک به وضعیت «نزد صندوق» برگردد، سپس آن را خرج کنید.

**سوال ۴: آیا سیستم برای خرج کردن چک هشدار می‌دهد؟**
**پاسخ:** بله، اگر سررسید چک گذشته باشد یا وضعیت اعتباری صادرکننده چک (مشتری) قرمز باشد، سیستم می‌تواند به کاربر هشدار دهد که "این چک ریسک برگشت دارد، آیا از خرج کردن آن مطمئن هستید؟".

# مروری بر مدیریت چک‌های دریافتی

-----

## ۱. مقدمه: چک به عنوان یک دارایی زنده

به بخش **مدیریت چک‌های دریافتی** در ERP تابان خوش آمدید.
در حسابداری سنتی، چک‌ها اغلب به عنوان اعداد و ارقام در دفاتر ثبت می‌شوند. اما در سیستم تابان، هر برگ چک یک **موجودیت زنده (Living Entity)** است. چرا؟ چون هر چک:

1.  **متولد می‌شود:** (لحظه دریافت از مشتری).
2.  **سفر می‌کند:** (از گاوصندوق به بانک، یا به دست تأمین‌کننده).
3.  **تغییر وضعیت می‌دهد:** (نقد می‌شود، برگشت می‌خورد، یا استرداد می‌شود).

این ماژول طراحی شده تا شما به عنوان مدیر مالی یا خزانه‌دار، در هر لحظه بر سرنوشت تک‌تک اسناد تجاری خود مسلط باشید و دیگر نگران گم شدن فیزیک چک یا فراموشی تاریخ سررسید نباشید.

-----

## ۲. معماری سیستم: مفهوم «صندوق اسناد چک»

مهم‌ترین مفهومی که باید در این سیستم با آن آشنا شوید، **«صندوق اسناد چک»** است.
در دنیای واقعی، چک فیزیکی نمی‌تواند همزمان در دو جا باشد. در سیستم نیز ما از «صندوق اسناد» استفاده می‌کنیم تا دقیقاً بگوییم فیزیک چک الان کجاست. چک‌ها در طول عمر خود بین این صندوق‌های اسنادجابجا می‌شوند.

### لیست صندوق‌های اسناد استاندارد سیستم

| نام صندوق اسناد | نام انگلیسی | شرح کاربردی | وضعیت حسابداری |
| :--- | :--- | :--- | :--- |
| **صندوق اسناد نزد صندوق** | `Safe Doc Boxsitory` | **(گاوصندوق شرکت)** <br> چک‌هایی که تازه از مشتری گرفته‌اید و فیزیک آن‌ها داخل کشو یا گاوصندوق خزانه‌دار است. | `اسناد دریافتنی نزد صندوق` |
| **صندوق اسناد در جریان وصول** | `In-Collection Doc Box` | **(نزد بانک)** <br> چک‌هایی که از شرکت خارج شده و برای وصول (کلر) به متصدی بانک تحویل داده شده‌اند. | `اسناد در جریان وصول` |
| **صندوق اسناد چک‌های برگشتی** | `Bounced Doc Box` | **(واحد پیگیری)** <br> چک‌هایی که سررسید شده‌اند اما به دلیل عدم موجودی، نکول شده‌اند. | `اسناد دریافتنی برگشتی` |
| **صندوق اسناد چک‌های تضمینی** | `Guarantee Doc Box` | **(بایگانی تضمینات)** <br> چک‌هایی که بابت حسن انجام کار گرفته شده و قرار نیست نقد شوند. | `حساب‌های انتظامی` |

> **نکته مهم:** هر صندوق اسناد در نرم‌افزار به یک **حساب معین (GL Account)** اختصاصی متصل است. وقتی شما در سیستم، چک را از یک صندوق اسناد به صندوق اسناد دیگر می‌برید، سیستم به صورت خودکار سند حسابداری جابجایی بین این حساب‌ها را صادر می‌کند.

-----

## ۳. نقشه راه عملیات (Workflows)

در این ماژول، شما با ۵ عملیات اصلی سروکار دارید. بیایید سناریوی هر کدام را بررسی کنیم:

### ۱. دریافت (Receipt)

  * **سناریو:** مشتری چک را روی میز شما می‌گذارد.
  * **عملیات سیستم:** ثبت «سند دریافت».
  * **نتیجه:** چک در **صندوق اسناد صندوق** ایجاد می‌شود.

### ۲. واگذاری (Deposit/Lodge)

  * **سناریو:** موعد چک نزدیک است. شما چک‌ها را در پاکت می‌گذارید و به بانک می‌برید.
  * **عملیات سیستم:** استفاده از فرم «واگذاری به بانک».
  * **نتیجه:** چک از صندوق اسناد صندوق کسر و به **صندوق اسناد در جریان وصول** اضافه می‌شود.

### ۳. تعیین تکلیف (Clearance/Bounce)

  * **سناریو:** صورتحساب بانک را چک می‌کنید.
      * *حالت اول:* پول واریز شده، دکمه **«وصول شد»** را می‌زنید. (چک از سیستم خارج و تبدیل به پول نقد می‌شود).
      * *حالت دوم:* چک برگشت خورده، دکمه **«برگشت خورد»** را می‌زنید. (چک به صندوق اسناد برگشتی می‌رود).

### ۴. خرج کردن (Endorsement)

  * **سناریو:** بدهی به یک فروشنده آهن دارید. به جای پول نقد، چک مشتری خودتان را پشت‌نویسی می‌کنید و به او می‌دهید.
  * **عملیات سیستم:** ثبت «سند پرداخت» با روش «خرج چک».
  * **نتیجه:** چک از دارایی‌های شما خارج شده و بدهی شما تسویه می‌شود.

### ۵. استرداد (Return)

  * **سناریو:** مشتری می‌آید و می‌گوید "چکم را نبر بانک، بیا پول نقد بگیر و لاشه چک را پس بده".
  * **عملیات سیستم:** فرم «استرداد چک».
  * **نتیجه:** سند دریافت اولیه معکوس شده و چک از سیستم حذف می‌شود.

-----

## ۴. شناسه صیادی: قلب تپنده ردیابی

در سیستم تابان، **شناسه ۱۶ رقمی صیادی** یک فیلد متنی ساده نیست؛ بلکه اثر انگشت چک است.

  * **جلوگیری از تقلب:** سیستم اجازه نمی‌دهد یک شناسه صیادی دو بار در سیستم ثبت شود (حتی اگر سال‌ها پیش ثبت شده باشد).
  * **یکپارچگی:** در آینده برای مغایرت‌گیری بانکی، سیستم بر اساس همین شناسه متوجه می‌شود کدام ردیف بانک مربوط به کدام چک در سیستم است.

-----

## ۵. مثال جامع عملیاتی (سناریوی شرکت پخش)

بیایید یک داستان واقعی را مرور کنیم تا مفاهیم بالا کاملاً جا بیفتد.

**بازیگران:**

  * **شرکت ما:** پخش مواد غذایی تابان.
  * **مشتری:** سوپرمارکت کوروش (آقای رضایی).
  * **بانک ما:** بانک ملت (شعبه مرکزی).

**پرده اول: دریافت چک (۱۴۰۳/۰۲/۰۱)**
آقای رضایی بابت خرید کالا، یک چک ۵۰ میلیون تومانی به تاریخ سررسید ۱۰ روز بعد (۱۴۰۳/۰۲/۱۰) به ویزیتور ما می‌دهد.

  * *در سیستم:* کاربر «سند دریافت» ثبت می‌کند.
  * *وضعیت:* چک در **صندوق اسناد صندوق** قرار می‌گیرد.

**پرده دوم: خواباندن به حساب (۱۴۰۳/۰۲/۰۸)**
دو روز مانده به سررسید، حسابدار چک را از گاوصندوق برداشته و به بانک ملت می‌برد.

  * *در سیستم:* کاربر فرم «واگذاری به بانک» را باز کرده، مبدأ را صندوق و مقصد را بانک ملت انتخاب می‌کند.
  * *وضعیت:* چک به **صندوق اسناد در جریان وصول (ملت)** منتقل می‌شود.

**پرده سوم: روز سررسید و برگشت (۱۴۰۳/۰۲/۱۰)**
بانک پیامک می‌دهد که حساب آقای رضایی موجودی ندارد. چک برگشت می‌خورد.

  * *در سیستم:* کاربر در فرم «اعلام وضعیت»، گزینه **برگشت** را می‌زند.
  * *وضعیت:* چک به **صندوق اسناد چک‌های برگشتی** می‌رود. (سیستم حساب اسناد برگشتی را بدهکار می‌کند).

**پرده آخر: تسویه نهایی (۱۴۰۳/۰۲/۱۵)**
با آقای رضایی تماس می‌گیریم. او می‌آید، ۵۰ میلیون کارت می‌کشد (واریز نقد) و لاشه چک برگشتی‌اش را می‌خواهد.

1.  یک «سند دریافت نقدی» ثبت می‌کنیم (پول به حساب بانک می‌نشیند).
2.  از فرم «استرداد چک»، چک موجود در صندوق اسناد برگشتی را انتخاب و به آقای رضایی استرداد می‌کنیم.

<!-- end list -->

  * *نتیجه:* پرونده چک بسته می‌شود.

-----

## ۶. پیش‌نیازهای شروع کار

برای اینکه بتوانید از این ماژول استفاده کنید، باید موارد زیر در بخش `تعاریف پایه` تکمیل شده باشند:

1.  **تعریف بانک‌ها:** نام بانک‌های کشور (ملی، صادرات، ...) در سیستم باشد.
2.  **تعریف صندوق‌های اسنادچک:**
      * حداقل یک صندوق اسناد از نوع "نزد صندوق".
      * به ازای هر حساب جاری شرکت، یک صندوق اسناد از نوع "در جریان وصول".
      * یک صندوق اسناد از نوع "برگشتی".
3.  **ارتباط با حسابداری:** مطمئن شوید حسابدار ارشد، کدهای حساب معین (GL Codes) مربوط به هر صندوق اسناد را در تنظیمات لینک کرده است. بدون این لینک، اسناد اتوماتیک صادر نمی‌شوند.

# دریافت چک جدید (دریافت از مشتری)

**مسیر دسترسی:** `خزانه‌داری > عملیات دریافت > سند دریافت جدید`

-----

## ۱. مقدمه و کاربرد

این فرم، دروازه ورود چک‌ها به سیستم ERP تابان است. هر زمانی که مشتری، کارمند یا هر طرف حساب دیگری بابت تسویه بدهی، پیش‌پرداخت سفارش یا سایر درآمدها به شما **چک** می‌دهد، باید اطلاعات آن را در این فرم ثبت کنید.

**چرا دقت در این فرم حیاتی است؟**
اطلاعاتی که اینجا وارد می‌کنید (به ویژه تاریخ سررسید و شناسه صیادی)، مبنای تمام گزارش‌های نقدینگی، هشدارهای سررسید و پیگیری‌های حقوقی آینده خواهد بود. یک اشتباه تایپی در مبلغ یا تاریخ، می‌تواند گزارشات مالی مدیران را منحرف کند.

-----

## ۲. فرآیند گام‌به‌گام ثبت چک

برای ثبت چک، مراحل زیر را در فرم **«سند دریافت»** طی کنید:

### گام اول: اطلاعات عمومی سند (Header)

ابتدا مشخص کنید چه کسی و بابت چه چیزی پول می‌دهد.

1.  **طرف حساب (پرداخت‌کننده):** نام مشتری یا شخصی که چک را داده انتخاب کنید.
2.  **تاریخ سند:** تاریخ روز (تاریخی که چک را تحویل گرفتید).
3.  **شرح سند:** توضیحی کوتاه بنویسید (مثلاً: بابت تسویه فاکتور شماره ۱۰۱).

### گام دوم: انتخاب روش پرداخت

در بخش ردیف‌های دریافت، دکمه **«افزودن ردیف»** را زده و در فیلد روش پرداخت، گزینه **«چک»** را انتخاب کنید. با این کار، فیلدهای مخصوص چک فعال می‌شوند.

### گام سوم: ورود مشخصات چک (Detail)

اطلاعات روی فیزیک چک را با دقت وارد کنید. (جدول راهنمای فیلدها را در پایین ببینید).

### گام چهارم: ثبت نهایی

پس از اطمینان از صحت اطلاعات، دکمه **«ذخیره / ثبت نهایی»** را بزنید.

  * **نتیجه:** سیستم یک «رسید دریافت» به شما می‌دهد که می‌توانید آن را چاپ کرده و به عنوان رسید به مشتری تحویل دهید.

-----

## ۳. راهنمای جامع فیلدهای چک

| نام فیلد (فارسی) | نام فیلد (لاتین) | وضعیت | توضیحات کاربردی و نکات کنترلی |
| :--- | :--- | :--- | :--- |
| **مبلغ چک** | `Amount` | **اجباری** | مبلغ دقیق نوشته شده روی چک به ریال. <br> *نکته:* سیستم به صورت خودکار مبلغ را به حروف در زیر فیلد نمایش می‌دهد؛ حتماً چک کنید. |
| **تاریخ سررسید** | `DueDate` | **اجباری** | تاریخی که باید چک را به بانک ببرید (تاریخ نقد شدن). <br> *نکته:* این تاریخ مبنای گزارشات "جریان نقدینگی" (Cash Flow) است. |
| **شناسه صیادی** | `SayadID` | **اجباری** | کد ۱۶ رقمی گوشه بالای چک. <br> *کنترل:* سیستم یکتا بودن این کد را چک می‌کند. اگر قبلاً ثبت شده باشد، خطای تکراری می‌دهد. |
| **شماره سریال** | `SerialNo` | اجباری | شماره چاپی پایین یا گوشه چک (معمولاً ترکیبی از عدد و ممیز). <br> *کاربرد:* برای پیدا کردن فیزیک چک در بایگانی/گاوصندوق استفاده می‌شود. |
| **بانک صادرکننده** | `BankName` | اختیاری | نام بانک دسته چک مشتری (مثلاً: ملت، تجارت). |
| **شعبه** | `BranchName` | اختیاری | نام یا کد شعبه صادرکننده. |
| **صاحب حساب** | `Owner` | اختیاری | نام شخصی که زیر چک را امضا کرده است. <br> *نکته:* گاهی مشتری (پرداخت‌کننده) چک شخص دیگری را به ما می‌دهد (چک خرج شده). در این صورت نام مشتری در هدر سند و نام صاحب حساب واقعی در این فیلد درج می‌شود. |
| **در وجه** | `Payee` | پیش‌فرض | نام شرکت شما (گیرنده). اگر چک در وجه حامل است، می‌توانید این فیلد را ویرایش کنید. |

-----

## ۴. سناریوی عملی (مثال واقعی)

**داستان:**
فرض کنید شما حسابدار شرکت «پخش تابان» هستید. «آقای رضایی» (مالک فروشگاه کوروش) بابت خرید کالاهای هفته گذشته، به شرکت مراجعه کرده و یک چک صیادی بنفش رنگ تحویل می‌دهد.

**مشخصات چک:**

  * **مبلغ:** ۵۰۰,۰۰۰,۰۰۰ ریال (۵۰ میلیون تومان)
  * **سررسید:** ۲۰ مرداد ۱۴۰۳
  * **بانک:** صادرات - شعبه بازار
  * **شماره صیادی:** 1234123412341234

**اقدامات شما در سیستم:**

1.  وارد مسیر `خزانه‌داری > سند دریافت جدید` می‌شوید.
2.  در فیلد طرف حساب، **«فروشگاه کوروش - آقای رضایی»** را انتخاب می‌کنید.
3.  در قسمت ردیف‌ها، روش **«چک»** را انتخاب می‌کنید.
4.  مبلغ `500,000,000` و تاریخ سررسید `1403/05/20` را وارد می‌کنید.
5.  شناسه صیادی ۱۶ رقمی را با دقت از روی چک تایپ می‌کنید (یا با بارکدخوان اسکن می‌کنید).
6.  سایر مشخصات (بانک صادرات، شماره سریال) را پر می‌کنید.
7.  دکمه **ثبت** را می‌زنید.

-----

## ۵. پشت صحنه سیستم (آنچه کاربر نمی‌بیند)

به محض اینکه دکمه ثبت را فشار می‌دهید، سیستم سه کار مهم انجام می‌دهد:

1.  **تولد چک در صندوق اسناد:**
    یک رکورد جدید در پایگاه داده چک‌ها ایجاد می‌شود و وضعیت آن به صورت پیش‌فرض **«نزد صندوق» (On-Hand)** تنظیم می‌شود. یعنی سیستم می‌فهمد که این چک الان در گاوصندوق شرکت است.

2.  **کاهش بدهی مشتری:**
    مانده حساب آقای رضایی ۵۰ میلیون تومان کاهش می‌یابد.

3.  **صدور سند حسابداری اتوماتیک:**
    سیستم بدون دخالت شما، سند زیر را در دفتر کل (GL) صادر می‌کند:

| کد حساب | نام حساب | بدهکار | بستانکار | شرح |
| :--- | :--- | :--- | :--- | :--- |
| ۱۱۴۰۰۱ | **اسناد دریافتنی نزد صندوق** | ۵۰۰,۰۰۰,۰۰۰ | - | دریافت چک صیادی ... بابت فروشگاه کوروش |
| ۱۱۳۰۰۵ | **حساب‌های دریافتنی تجاری** | - | ۵۰۰,۰۰۰,۰۰۰ | دریافت چک صیادی ... بابت فروشگاه کوروش |

-----

## ۶. سوالات متداول و نکات طلایی

**۱. اگر چک "در وجه حامل" بود چه کنیم؟**
در فیلد "در وجه"، کلمه "حامل" را تایپ کنید. اما توجه داشته باشید طبق قوانین جدید چک صیادی، ثبت چک در وجه حامل محدودیت دارد و حتماً باید انتقال در سامانه صیاد انجام شود.

**۲. مشتری چک شخص دیگری را به ما داده است (چک خرج شده). طرف حساب کیست؟**
طرف حساب شما همچنان **مشتری (کسی که بدهکار است)** می‌باشد، نه صاحب چک.

  * *مثال:* آقای رضایی (مشتری ما) چکِ برادرش (آقای اکبری) را به ما می‌دهد.
  * *در سیستم:* در فیلد "پرداخت‌کننده" نام **آقای رضایی** را انتخاب کنید (چون می‌خواهیم حساب او تسویه شود). در فیلد "صاحب حساب"، نام **آقای اکبری** را بنویسید تا اگر چک برگشت خورد، بدانید صاحبش کیست.

**۳. سیستم خطای "شناسه صیادی تکراری" می‌دهد.**
این یعنی چکی با همین شناسه قبلاً در سیستم ثبت شده است. ممکن است:

  * همکار دیگری قبلاً آن را ثبت کرده باشد.
  * این چک قبلاً دریافت شده، خرج شده و دوباره به شرکت برگشته است (گردش چک).
  * *راه حل:* از گزارش "جستجوی چک" استفاده کنید تا وضعیت قبلی این شناسه را ببینید.

**۴. آیا می‌توانم چند چک را در یک سند ثبت کنم؟**
بله. اگر مشتری همزمان ۵ فقره چک به شما می‌دهد، نیازی نیست ۵ سند جداگانه بزنید. در همان فرم سند دریافت، ۵ بار دکمه "افزودن ردیف" را بزنید و مشخصات هر چک را جداگانه وارد کنید. سیستم یک سند حسابداری کلی برای همه آن‌ها صادر می‌کند.

# استرداد چک - بازگرداندن به مشتری (Check Return)

**مسیر دسترسی:** `خزانه‌داری > مدیریت چک‌های دریافتی > عملیات چک > استرداد چک`

---

## ۱. مفهوم و کاربرد

### استرداد چک چیست؟
عملیات **استرداد** به معنای بازگرداندن فیزیک چک (لاشه چک) به صادرکننده آن (مشتری) و خارج کردن چک از چرخه دارایی‌های شرکت است.
در این حالت، چک نه نقد شده و نه خرج شده؛ بلکه معامله‌ای که بابت آن چک گرفته بودیم، به نحوی تغییر کرده است که باید چک را پس بدهیم.

### چه زمانی از این فرم استفاده می‌کنیم؟
این فرم در سه سناریوی اصلی کاربرد دارد:

1.  **فسخ معامله:** مشتری کالا را پس داده و چک خود را می‌خواهد.
2.  **تعویض چک (Replacement):** مشتری می‌خواهد چک فعلی را با یک چک جدید (تاریخ متفاوت) یا پول نقد عوض کند.
3.  **تسویه چک برگشتی:** چک برگشت خورده، مشتری می‌آید تسویه می‌کند و لاشه چک برگشتی را تحویل می‌گیرد.

> **نکته مهم:** استرداد چک باعث می‌شود حساب مشتری دوباره **بدهکار** شود (چون چکی که بابت پرداخت داده بود را پس گرفته است). بنابراین معمولاً قبل یا بعد از استرداد، یک سند دریافت دیگر (نقد یا چک جدید) ثبت می‌شود.

---

## ۲. پیش‌نیازهای سیستمی
برای استرداد یک چک، آن چک باید حتماً در یکی از صندوق‌های اسنادزیر باشد:

* **صندوق اسناد اسناد نزد صندوق (Safe Doc Boxsitory):** برای چک‌های عادی که هنوز به بانک نرفته‌اند.
* **صندوق اسناد چک‌های برگشتی (Bounced Doc Boxsitory):** برای چک‌هایی که نکول شده‌اند.

> **هشدار:** شما نمی‌توانید چکی را که در وضعیت **«در جریان وصول» (نزد بانک)** است، مستقیماً به مشتری استرداد کنید. ابتدا باید آن را از بانک تحویل بگیرید (عملیات «استرداد از واگذاری») تا به صندوق برگردد، سپس به مشتری پس دهید.

---

## ۳. مراحل انجام کار

### گام ۱: انتخاب فیلترها
وارد فرم استرداد شوید. برای پیدا کردن چک، دو فیلد را تنظیم کنید:

1.  **صندوق اسناد فعلی:** مشخص کنید چک الان کجاست؟ (مثلاً "صندوق اسناد چک‌های برگشتی").
2.  **طرف حساب:** نام مشتری را انتخاب کنید.

### گام ۲: انتخاب چک
سیستم لیست چک‌های آن مشتری در آن صندوق اسناد خاص را نمایش می‌دهد.
چک (یا چک‌های) مورد نظر را تیک بزنید.

### گام ۳: ثبت استرداد
دکمه **«ثبت استرداد»** را بزنید. سیستم ممکن است از شما "بابت" یا "توضیحات" بخواهد (مثلاً: بابت تعویض با چک جدید).

---

## ۴. سناریوهای عملیاتی و اسناد حسابداری

بیایید دو مثال بسیار رایج در بازار کار ایران را بررسی کنیم.

### سناریوی ۱: تعویض چک (قبل از سررسید)
**داستان:** آقای رضایی چکی به مبلغ ۲۰ میلیون تومان برای تاریخ فردا دارد. تماس می‌گیرد و می‌گوید: "چکم پاس نمی‌شود، آن را پس بدهید و یک چک برای ۱۰ روز دیگر بگیرید."

**اقدامات شما در سیستم:**

1.  **مرحله استرداد:** به فرم «استرداد چک» می‌روید. صندوق اسناد "نزد صندوق" را انتخاب کرده و چک ۲۰ میلیونی را به آقای رضایی استرداد می‌کنید.
    * *اثر:* چک از سیستم خارج می‌شود. حساب آقای رضایی ۲۰ میلیون **بدهکار** می‌شود.
2.  **مرحله دریافت جدید:** به فرم «سند دریافت» می‌روید و چک جدید (تاریخ ۱۰ روز بعد) را ثبت می‌کنید.
    * *اثر:* چک جدید وارد سیستم می‌شود. حساب آقای رضایی ۲۰ میلیون **بستانکار** می‌شود.

> **سند حسابداری استرداد (خودکار):**

> * **بدهکار:** حساب‌های دریافتنی - آقای رضایی
> * **بستانکار:** اسناد دریافتنی نزد صندوق

---

### سناریوی ۲: تسویه چک برگشتی (پس از نکول)
**داستان:** چک ۵۰ میلیونی "شرکت پخش البرز" برگشت خورده و در **صندوق اسناد برگشتی** است. نماینده شرکت می‌آید، ۵۰ میلیون کارت می‌کشد (واریز نقد) و لاشه چک برگشتی را می‌برد.

**اقدامات شما در سیستم:**

1.  **مرحله دریافت پول:** ابتدا یک «سند دریافت» از نوع **نقد/کارت‌خوان** ثبت می‌کنید.
    * *اثر:* موجودی بانک شما ۵۰ میلیون زیاد می‌شود. حساب شرکت البرز ۵۰ میلیون **بستانکار** می‌شود.
2.  **مرحله استرداد لاشه:** به فرم «استرداد چک» می‌روید. صندوق اسناد **"چک‌های برگشتی"** را انتخاب می‌کنید. چک مورد نظر را تیک زده و استرداد می‌کنید.
    * *اثر:* چک از لیست برگشتی‌ها حذف می‌شود. حساب شرکت البرز ۵۰ میلیون **بدهکار** می‌شود.

> **تحلیل مانده حساب مشتری:**
> مشتری ۵۰ میلیون بدهکار شد (بابت گرفتن لاشه) و ۵۰ میلیون بستانکار شد (بابت واریز پول). پس مانده حسابش صفر و تسویه می‌شود.

> **سند حسابداری استرداد از برگشتی (خودکار):**

> * **بدهکار:** حساب‌های دریافتنی - شرکت پخش البرز
> * **بستانکار:** حساب اسناد دریافتنی برگشتی

---

## ۵. سوالات متداول (FAQ)

**سوال: آیا با استرداد چک، سابقه آن کلاً پاک می‌شود؟**
**پاسخ:** خیر، رکورد چک پاک نمی‌شود. وضعیت (Status) آن به **«استرداد شده» (Returned)** تغییر می‌کند و در گزارشات با رنگ متمایز نمایش داده می‌شود تا تاریخچه همکاری با مشتری حفظ شود.

**سوال: اگر بخواهم فقط بخشی از مبلغ چک را دریافت کنم و بقیه را چک جدید بگیرم چه؟**
**پاسخ:** فرآیند مشابه سناریوی تعویض است.

1.  چک قدیم را کامل **استرداد** می‌کنید (مشتری کل مبلغ را بدهکار می‌شود).
2.  یک سند دریافت ترکیبی ثبت می‌کنید: یک ردیف "نقد" (برای مبلغی که داده) و یک ردیف "چک جدید" (برای باقیمانده).

**سوال: اشتباهاً چک را استرداد کردم. چه کنم؟**
**پاسخ:** باید به لیست چک‌های استرداد شده بروید (یا از طریق گزارش کاردکس چک)، روی آن کلیک راست کرده و گزینه **«ابطال استرداد»** را بزنید. چک به صندوق اسناد قبلی خود باز می‌گردد.


# مروری بر مدیریت چک‌های دریافتی

-----

## ۱. مقدمه: چک به عنوان یک دارایی زنده

به بخش **مدیریت چک‌های دریافتی** در ERP تابان خوش آمدید.
در حسابداری سنتی، چک‌ها اغلب به عنوان اعداد و ارقام در دفاتر ثبت می‌شوند. اما در سیستم تابان، هر برگ چک یک **موجودیت زنده (Living Entity)** است. چرا؟ چون هر چک:

1.  **متولد می‌شود:** (لحظه دریافت از مشتری).
2.  **سفر می‌کند:** (از گاوصندوق به بانک، یا به دست تأمین‌کننده).
3.  **تغییر وضعیت می‌دهد:** (نقد می‌شود، برگشت می‌خورد، یا استرداد می‌شود).

این ماژول طراحی شده تا شما به عنوان مدیر مالی یا خزانه‌دار، در هر لحظه بر سرنوشت تک‌تک اسناد تجاری خود مسلط باشید و دیگر نگران گم شدن فیزیک چک یا فراموشی تاریخ سررسید نباشید.

-----

## ۲. معماری سیستم: مفهوم «صندوق اسناد چک»

مهم‌ترین مفهومی که باید در این سیستم با آن آشنا شوید، **«صندوق اسناد چک»** است.
در دنیای واقعی، چک فیزیکی نمی‌تواند همزمان در دو جا باشد. در سیستم نیز ما از «صندوق اسناد» استفاده می‌کنیم تا دقیقاً بگوییم فیزیک چک الان کجاست. چک‌ها در طول عمر خود بین این صندوق‌های اسنادجابجا می‌شوند.

### لیست صندوق‌های اسناد استاندارد سیستم

| نام صندوق اسناد | نام انگلیسی | شرح کاربردی | وضعیت حسابداری |
| :--- | :--- | :--- | :--- |
| **صندوق اسناد نزد صندوق** | `Safe Doc Boxsitory` | **(گاوصندوق شرکت)** <br> چک‌هایی که تازه از مشتری گرفته‌اید و فیزیک آن‌ها داخل کشو یا گاوصندوق خزانه‌دار است. | `اسناد دریافتنی نزد صندوق` |
| **صندوق اسناد در جریان وصول** | `In-Collection Doc Box` | **(نزد بانک)** <br> چک‌هایی که از شرکت خارج شده و برای وصول (کلر) به متصدی بانک تحویل داده شده‌اند. | `اسناد در جریان وصول` |
| **صندوق اسناد چک‌های برگشتی** | `Bounced Doc Box` | **(واحد پیگیری)** <br> چک‌هایی که سررسید شده‌اند اما به دلیل عدم موجودی، نکول شده‌اند. | `اسناد دریافتنی برگشتی` |
| **صندوق اسناد چک‌های تضمینی** | `Guarantee Doc Box` | **(بایگانی تضمینات)** <br> چک‌هایی که بابت حسن انجام کار گرفته شده و قرار نیست نقد شوند. | `حساب‌های انتظامی` |

> **نکته مهم:** هر صندوق اسناد در نرم‌افزار به یک **حساب معین (GL Account)** اختصاصی متصل است. وقتی شما در سیستم، چک را از یک صندوق اسناد به صندوق اسناد دیگر می‌برید، سیستم به صورت خودکار سند حسابداری جابجایی بین این حساب‌ها را صادر می‌کند.

-----

## ۳. نقشه راه عملیات (Workflows)

در این ماژول، شما با ۵ عملیات اصلی سروکار دارید. بیایید سناریوی هر کدام را بررسی کنیم:

### ۱. دریافت (Receipt)

  * **سناریو:** مشتری چک را روی میز شما می‌گذارد.
  * **عملیات سیستم:** ثبت «سند دریافت».
  * **نتیجه:** چک در **صندوق اسناد صندوق** ایجاد می‌شود.

### ۲. واگذاری (Deposit/Lodge)

  * **سناریو:** موعد چک نزدیک است. شما چک‌ها را در پاکت می‌گذارید و به بانک می‌برید.
  * **عملیات سیستم:** استفاده از فرم «واگذاری به بانک».
  * **نتیجه:** چک از صندوق اسناد صندوق کسر و به **صندوق اسناد در جریان وصول** اضافه می‌شود.

### ۳. تعیین تکلیف (Clearance/Bounce)

  * **سناریو:** صورتحساب بانک را چک می‌کنید.
      * *حالت اول:* پول واریز شده، دکمه **«وصول شد»** را می‌زنید. (چک از سیستم خارج و تبدیل به پول نقد می‌شود).
      * *حالت دوم:* چک برگشت خورده، دکمه **«برگشت خورد»** را می‌زنید. (چک به صندوق اسناد برگشتی می‌رود).

### ۴. خرج کردن (Endorsement)

  * **سناریو:** بدهی به یک فروشنده آهن دارید. به جای پول نقد، چک مشتری خودتان را پشت‌نویسی می‌کنید و به او می‌دهید.
  * **عملیات سیستم:** ثبت «سند پرداخت» با روش «خرج چک».
  * **نتیجه:** چک از دارایی‌های شما خارج شده و بدهی شما تسویه می‌شود.

### ۵. استرداد (Return)

  * **سناریو:** مشتری می‌آید و می‌گوید "چکم را نبر بانک، بیا پول نقد بگیر و لاشه چک را پس بده".
  * **عملیات سیستم:** فرم «استرداد چک».
  * **نتیجه:** سند دریافت اولیه معکوس شده و چک از سیستم حذف می‌شود.

-----

## ۴. شناسه صیادی: قلب تپنده ردیابی

در سیستم تابان، **شناسه ۱۶ رقمی صیادی** یک فیلد متنی ساده نیست؛ بلکه اثر انگشت چک است.

  * **جلوگیری از تقلب:** سیستم اجازه نمی‌دهد یک شناسه صیادی دو بار در سیستم ثبت شود (حتی اگر سال‌ها پیش ثبت شده باشد).
  * **یکپارچگی:** در آینده برای مغایرت‌گیری بانکی، سیستم بر اساس همین شناسه متوجه می‌شود کدام ردیف بانک مربوط به کدام چک در سیستم است.

-----

## ۵. مثال جامع عملیاتی (سناریوی شرکت پخش)

بیایید یک داستان واقعی را مرور کنیم تا مفاهیم بالا کاملاً جا بیفتد.

**بازیگران:**

  * **شرکت ما:** پخش مواد غذایی تابان.
  * **مشتری:** سوپرمارکت کوروش (آقای رضایی).
  * **بانک ما:** بانک ملت (شعبه مرکزی).

**پرده اول: دریافت چک (۱۴۰۳/۰۲/۰۱)**
آقای رضایی بابت خرید کالا، یک چک ۵۰ میلیون تومانی به تاریخ سررسید ۱۰ روز بعد (۱۴۰۳/۰۲/۱۰) به ویزیتور ما می‌دهد.

  * *در سیستم:* کاربر «سند دریافت» ثبت می‌کند.
  * *وضعیت:* چک در **صندوق اسناد صندوق** قرار می‌گیرد.

**پرده دوم: خواباندن به حساب (۱۴۰۳/۰۲/۰۸)**
دو روز مانده به سررسید، حسابدار چک را از گاوصندوق برداشته و به بانک ملت می‌برد.

  * *در سیستم:* کاربر فرم «واگذاری به بانک» را باز کرده، مبدأ را صندوق و مقصد را بانک ملت انتخاب می‌کند.
  * *وضعیت:* چک به **صندوق اسناد در جریان وصول (ملت)** منتقل می‌شود.

**پرده سوم: روز سررسید و برگشت (۱۴۰۳/۰۲/۱۰)**
بانک پیامک می‌دهد که حساب آقای رضایی موجودی ندارد. چک برگشت می‌خورد.

  * *در سیستم:* کاربر در فرم «اعلام وضعیت»، گزینه **برگشت** را می‌زند.
  * *وضعیت:* چک به **صندوق اسناد چک‌های برگشتی** می‌رود. (سیستم حساب اسناد برگشتی را بدهکار می‌کند).

**پرده آخر: تسویه نهایی (۱۴۰۳/۰۲/۱۵)**
با آقای رضایی تماس می‌گیریم. او می‌آید، ۵۰ میلیون کارت می‌کشد (واریز نقد) و لاشه چک برگشتی‌اش را می‌خواهد.

1.  یک «سند دریافت نقدی» ثبت می‌کنیم (پول به حساب بانک می‌نشیند).
2.  از فرم «استرداد چک»، چک موجود در صندوق اسناد برگشتی را انتخاب و به آقای رضایی استرداد می‌کنیم.

<!-- end list -->

  * *نتیجه:* پرونده چک بسته می‌شود.

-----

## ۶. پیش‌نیازهای شروع کار

برای اینکه بتوانید از این ماژول استفاده کنید، باید موارد زیر در بخش `تعاریف پایه` تکمیل شده باشند:

1.  **تعریف بانک‌ها:** نام بانک‌های کشور (ملی، صادرات، ...) در سیستم باشد.
2.  **تعریف صندوق‌های اسنادچک:**
      * حداقل یک صندوق اسناد از نوع "نزد صندوق".
      * به ازای هر حساب جاری شرکت، یک صندوق اسناد از نوع "در جریان وصول".
      * یک صندوق اسناد از نوع "برگشتی".
3.  **ارتباط با حسابداری:** مطمئن شوید حسابدار ارشد، کدهای حساب معین (GL Codes) مربوط به هر صندوق اسناد را در تنظیمات لینک کرده است. بدون این لینک، اسناد اتوماتیک صادر نمی‌شوند.

# دریافت چک جدید (دریافت از مشتری)

**مسیر دسترسی:** `خزانه‌داری > عملیات دریافت > سند دریافت جدید`

-----

## ۱. مقدمه و کاربرد

این فرم، دروازه ورود چک‌ها به سیستم ERP تابان است. هر زمانی که مشتری، کارمند یا هر طرف حساب دیگری بابت تسویه بدهی، پیش‌پرداخت سفارش یا سایر درآمدها به شما **چک** می‌دهد، باید اطلاعات آن را در این فرم ثبت کنید.

**چرا دقت در این فرم حیاتی است؟**
اطلاعاتی که اینجا وارد می‌کنید (به ویژه تاریخ سررسید و شناسه صیادی)، مبنای تمام گزارش‌های نقدینگی، هشدارهای سررسید و پیگیری‌های حقوقی آینده خواهد بود. یک اشتباه تایپی در مبلغ یا تاریخ، می‌تواند گزارشات مالی مدیران را منحرف کند.

-----

## ۲. فرآیند گام‌به‌گام ثبت چک

برای ثبت چک، مراحل زیر را در فرم **«سند دریافت»** طی کنید:

### گام اول: اطلاعات عمومی سند (Header)

ابتدا مشخص کنید چه کسی و بابت چه چیزی پول می‌دهد.

1.  **طرف حساب (پرداخت‌کننده):** نام مشتری یا شخصی که چک را داده انتخاب کنید.
2.  **تاریخ سند:** تاریخ روز (تاریخی که چک را تحویل گرفتید).
3.  **شرح سند:** توضیحی کوتاه بنویسید (مثلاً: بابت تسویه فاکتور شماره ۱۰۱).

### گام دوم: انتخاب روش پرداخت

در بخش ردیف‌های دریافت، دکمه **«افزودن ردیف»** را زده و در فیلد روش پرداخت، گزینه **«چک»** را انتخاب کنید. با این کار، فیلدهای مخصوص چک فعال می‌شوند.

### گام سوم: ورود مشخصات چک (Detail)

اطلاعات روی فیزیک چک را با دقت وارد کنید. (جدول راهنمای فیلدها را در پایین ببینید).

### گام چهارم: ثبت نهایی

پس از اطمینان از صحت اطلاعات، دکمه **«ذخیره / ثبت نهایی»** را بزنید.

  * **نتیجه:** سیستم یک «رسید دریافت» به شما می‌دهد که می‌توانید آن را چاپ کرده و به عنوان رسید به مشتری تحویل دهید.

-----

## ۳. راهنمای جامع فیلدهای چک

| نام فیلد (فارسی) | نام فیلد (لاتین) | وضعیت | توضیحات کاربردی و نکات کنترلی |
| :--- | :--- | :--- | :--- |
| **مبلغ چک** | `Amount` | **اجباری** | مبلغ دقیق نوشته شده روی چک به ریال. <br> *نکته:* سیستم به صورت خودکار مبلغ را به حروف در زیر فیلد نمایش می‌دهد؛ حتماً چک کنید. |
| **تاریخ سررسید** | `DueDate` | **اجباری** | تاریخی که باید چک را به بانک ببرید (تاریخ نقد شدن). <br> *نکته:* این تاریخ مبنای گزارشات "جریان نقدینگی" (Cash Flow) است. |
| **شناسه صیادی** | `SayadID` | **اجباری** | کد ۱۶ رقمی گوشه بالای چک. <br> *کنترل:* سیستم یکتا بودن این کد را چک می‌کند. اگر قبلاً ثبت شده باشد، خطای تکراری می‌دهد. |
| **شماره سریال** | `SerialNo` | اجباری | شماره چاپی پایین یا گوشه چک (معمولاً ترکیبی از عدد و ممیز). <br> *کاربرد:* برای پیدا کردن فیزیک چک در بایگانی/گاوصندوق استفاده می‌شود. |
| **بانک صادرکننده** | `BankName` | اختیاری | نام بانک دسته چک مشتری (مثلاً: ملت، تجارت). |
| **شعبه** | `BranchName` | اختیاری | نام یا کد شعبه صادرکننده. |
| **صاحب حساب** | `Owner` | اختیاری | نام شخصی که زیر چک را امضا کرده است. <br> *نکته:* گاهی مشتری (پرداخت‌کننده) چک شخص دیگری را به ما می‌دهد (چک خرج شده). در این صورت نام مشتری در هدر سند و نام صاحب حساب واقعی در این فیلد درج می‌شود. |
| **در وجه** | `Payee` | پیش‌فرض | نام شرکت شما (گیرنده). اگر چک در وجه حامل است، می‌توانید این فیلد را ویرایش کنید. |

-----

## ۴. سناریوی عملی (مثال واقعی)

**داستان:**
فرض کنید شما حسابدار شرکت «پخش تابان» هستید. «آقای رضایی» (مالک فروشگاه کوروش) بابت خرید کالاهای هفته گذشته، به شرکت مراجعه کرده و یک چک صیادی بنفش رنگ تحویل می‌دهد.

**مشخصات چک:**

  * **مبلغ:** ۵۰۰,۰۰۰,۰۰۰ ریال (۵۰ میلیون تومان)
  * **سررسید:** ۲۰ مرداد ۱۴۰۳
  * **بانک:** صادرات - شعبه بازار
  * **شماره صیادی:** 1234123412341234

**اقدامات شما در سیستم:**

1.  وارد مسیر `خزانه‌داری > سند دریافت جدید` می‌شوید.
2.  در فیلد طرف حساب، **«فروشگاه کوروش - آقای رضایی»** را انتخاب می‌کنید.
3.  در قسمت ردیف‌ها، روش **«چک»** را انتخاب می‌کنید.
4.  مبلغ `500,000,000` و تاریخ سررسید `1403/05/20` را وارد می‌کنید.
5.  شناسه صیادی ۱۶ رقمی را با دقت از روی چک تایپ می‌کنید (یا با بارکدخوان اسکن می‌کنید).
6.  سایر مشخصات (بانک صادرات، شماره سریال) را پر می‌کنید.
7.  دکمه **ثبت** را می‌زنید.

-----

## ۵. پشت صحنه سیستم (آنچه کاربر نمی‌بیند)

به محض اینکه دکمه ثبت را فشار می‌دهید، سیستم سه کار مهم انجام می‌دهد:

1.  **تولد چک در صندوق اسناد:**
    یک رکورد جدید در پایگاه داده چک‌ها ایجاد می‌شود و وضعیت آن به صورت پیش‌فرض **«نزد صندوق» (On-Hand)** تنظیم می‌شود. یعنی سیستم می‌فهمد که این چک الان در گاوصندوق شرکت است.

2.  **کاهش بدهی مشتری:**
    مانده حساب آقای رضایی ۵۰ میلیون تومان کاهش می‌یابد.

3.  **صدور سند حسابداری اتوماتیک:**
    سیستم بدون دخالت شما، سند زیر را در دفتر کل (GL) صادر می‌کند:

| کد حساب | نام حساب | بدهکار | بستانکار | شرح |
| :--- | :--- | :--- | :--- | :--- |
| ۱۱۴۰۰۱ | **اسناد دریافتنی نزد صندوق** | ۵۰۰,۰۰۰,۰۰۰ | - | دریافت چک صیادی ... بابت فروشگاه کوروش |
| ۱۱۳۰۰۵ | **حساب‌های دریافتنی تجاری** | - | ۵۰۰,۰۰۰,۰۰۰ | دریافت چک صیادی ... بابت فروشگاه کوروش |

-----

## ۶. سوالات متداول و نکات طلایی

**۱. اگر چک "در وجه حامل" بود چه کنیم؟**
در فیلد "در وجه"، کلمه "حامل" را تایپ کنید. اما توجه داشته باشید طبق قوانین جدید چک صیادی، ثبت چک در وجه حامل محدودیت دارد و حتماً باید انتقال در سامانه صیاد انجام شود.

**۲. مشتری چک شخص دیگری را به ما داده است (چک خرج شده). طرف حساب کیست؟**
طرف حساب شما همچنان **مشتری (کسی که بدهکار است)** می‌باشد، نه صاحب چک.

  * *مثال:* آقای رضایی (مشتری ما) چکِ برادرش (آقای اکبری) را به ما می‌دهد.
  * *در سیستم:* در فیلد "پرداخت‌کننده" نام **آقای رضایی** را انتخاب کنید (چون می‌خواهیم حساب او تسویه شود). در فیلد "صاحب حساب"، نام **آقای اکبری** را بنویسید تا اگر چک برگشت خورد، بدانید صاحبش کیست.

**۳. سیستم خطای "شناسه صیادی تکراری" می‌دهد.**
این یعنی چکی با همین شناسه قبلاً در سیستم ثبت شده است. ممکن است:

  * همکار دیگری قبلاً آن را ثبت کرده باشد.
  * این چک قبلاً دریافت شده، خرج شده و دوباره به شرکت برگشته است (گردش چک).
  * *راه حل:* از گزارش "جستجوی چک" استفاده کنید تا وضعیت قبلی این شناسه را ببینید.

**۴. آیا می‌توانم چند چک را در یک سند ثبت کنم؟**
بله. اگر مشتری همزمان ۵ فقره چک به شما می‌دهد، نیازی نیست ۵ سند جداگانه بزنید. در همان فرم سند دریافت، ۵ بار دکمه "افزودن ردیف" را بزنید و مشخصات هر چک را جداگانه وارد کنید. سیستم یک سند حسابداری کلی برای همه آن‌ها صادر می‌کند.

# استرداد چک - بازگرداندن به مشتری (Check Return)

**مسیر دسترسی:** `خزانه‌داری > مدیریت چک‌های دریافتی > عملیات چک > استرداد چک`

---

## ۱. مفهوم و کاربرد

### استرداد چک چیست؟
عملیات **استرداد** به معنای بازگرداندن فیزیک چک (لاشه چک) به صادرکننده آن (مشتری) و خارج کردن چک از چرخه دارایی‌های شرکت است.
در این حالت، چک نه نقد شده و نه خرج شده؛ بلکه معامله‌ای که بابت آن چک گرفته بودیم، به نحوی تغییر کرده است که باید چک را پس بدهیم.

### چه زمانی از این فرم استفاده می‌کنیم؟
این فرم در سه سناریوی اصلی کاربرد دارد:

1.  **فسخ معامله:** مشتری کالا را پس داده و چک خود را می‌خواهد.
2.  **تعویض چک (Replacement):** مشتری می‌خواهد چک فعلی را با یک چک جدید (تاریخ متفاوت) یا پول نقد عوض کند.
3.  **تسویه چک برگشتی:** چک برگشت خورده، مشتری می‌آید تسویه می‌کند و لاشه چک برگشتی را تحویل می‌گیرد.

> **نکته مهم:** استرداد چک باعث می‌شود حساب مشتری دوباره **بدهکار** شود (چون چکی که بابت پرداخت داده بود را پس گرفته است). بنابراین معمولاً قبل یا بعد از استرداد، یک سند دریافت دیگر (نقد یا چک جدید) ثبت می‌شود.

---

## ۲. پیش‌نیازهای سیستمی
برای استرداد یک چک، آن چک باید حتماً در یکی از صندوق‌های اسنادزیر باشد:

* **صندوق اسناد اسناد نزد صندوق (Safe Doc Boxsitory):** برای چک‌های عادی که هنوز به بانک نرفته‌اند.
* **صندوق اسناد چک‌های برگشتی (Bounced Doc Boxsitory):** برای چک‌هایی که نکول شده‌اند.

> **هشدار:** شما نمی‌توانید چکی را که در وضعیت **«در جریان وصول» (نزد بانک)** است، مستقیماً به مشتری استرداد کنید. ابتدا باید آن را از بانک تحویل بگیرید (عملیات «استرداد از واگذاری») تا به صندوق برگردد، سپس به مشتری پس دهید.

---

## ۳. مراحل انجام کار

### گام ۱: انتخاب فیلترها
وارد فرم استرداد شوید. برای پیدا کردن چک، دو فیلد را تنظیم کنید:

1.  **صندوق اسناد فعلی:** مشخص کنید چک الان کجاست؟ (مثلاً "صندوق اسناد چک‌های برگشتی").
2.  **طرف حساب:** نام مشتری را انتخاب کنید.

### گام ۲: انتخاب چک
سیستم لیست چک‌های آن مشتری در آن صندوق اسناد خاص را نمایش می‌دهد.
چک (یا چک‌های) مورد نظر را تیک بزنید.

### گام ۳: ثبت استرداد
دکمه **«ثبت استرداد»** را بزنید. سیستم ممکن است از شما "بابت" یا "توضیحات" بخواهد (مثلاً: بابت تعویض با چک جدید).

---

## ۴. سناریوهای عملیاتی و اسناد حسابداری

بیایید دو مثال بسیار رایج در بازار کار ایران را بررسی کنیم.

### سناریوی ۱: تعویض چک (قبل از سررسید)
**داستان:** آقای رضایی چکی به مبلغ ۲۰ میلیون تومان برای تاریخ فردا دارد. تماس می‌گیرد و می‌گوید: "چکم پاس نمی‌شود، آن را پس بدهید و یک چک برای ۱۰ روز دیگر بگیرید."

**اقدامات شما در سیستم:**

1.  **مرحله استرداد:** به فرم «استرداد چک» می‌روید. صندوق اسناد "نزد صندوق" را انتخاب کرده و چک ۲۰ میلیونی را به آقای رضایی استرداد می‌کنید.
    * *اثر:* چک از سیستم خارج می‌شود. حساب آقای رضایی ۲۰ میلیون **بدهکار** می‌شود.
2.  **مرحله دریافت جدید:** به فرم «سند دریافت» می‌روید و چک جدید (تاریخ ۱۰ روز بعد) را ثبت می‌کنید.
    * *اثر:* چک جدید وارد سیستم می‌شود. حساب آقای رضایی ۲۰ میلیون **بستانکار** می‌شود.

> **سند حسابداری استرداد (خودکار):**

> * **بدهکار:** حساب‌های دریافتنی - آقای رضایی
> * **بستانکار:** اسناد دریافتنی نزد صندوق

---

### سناریوی ۲: تسویه چک برگشتی (پس از نکول)
**داستان:** چک ۵۰ میلیونی "شرکت پخش البرز" برگشت خورده و در **صندوق اسناد برگشتی** است. نماینده شرکت می‌آید، ۵۰ میلیون کارت می‌کشد (واریز نقد) و لاشه چک برگشتی را می‌برد.

**اقدامات شما در سیستم:**

1.  **مرحله دریافت پول:** ابتدا یک «سند دریافت» از نوع **نقد/کارت‌خوان** ثبت می‌کنید.
    * *اثر:* موجودی بانک شما ۵۰ میلیون زیاد می‌شود. حساب شرکت البرز ۵۰ میلیون **بستانکار** می‌شود.
2.  **مرحله استرداد لاشه:** به فرم «استرداد چک» می‌روید. صندوق اسناد **"چک‌های برگشتی"** را انتخاب می‌کنید. چک مورد نظر را تیک زده و استرداد می‌کنید.
    * *اثر:* چک از لیست برگشتی‌ها حذف می‌شود. حساب شرکت البرز ۵۰ میلیون **بدهکار** می‌شود.

> **تحلیل مانده حساب مشتری:**
> مشتری ۵۰ میلیون بدهکار شد (بابت گرفتن لاشه) و ۵۰ میلیون بستانکار شد (بابت واریز پول). پس مانده حسابش صفر و تسویه می‌شود.

> **سند حسابداری استرداد از برگشتی (خودکار):**

> * **بدهکار:** حساب‌های دریافتنی - شرکت پخش البرز
> * **بستانکار:** حساب اسناد دریافتنی برگشتی

---

## ۵. سوالات متداول (FAQ)

**سوال: آیا با استرداد چک، سابقه آن کلاً پاک می‌شود؟**
**پاسخ:** خیر، رکورد چک پاک نمی‌شود. وضعیت (Status) آن به **«استرداد شده» (Returned)** تغییر می‌کند و در گزارشات با رنگ متمایز نمایش داده می‌شود تا تاریخچه همکاری با مشتری حفظ شود.

**سوال: اگر بخواهم فقط بخشی از مبلغ چک را دریافت کنم و بقیه را چک جدید بگیرم چه؟**
**پاسخ:** فرآیند مشابه سناریوی تعویض است.

1.  چک قدیم را کامل **استرداد** می‌کنید (مشتری کل مبلغ را بدهکار می‌شود).
2.  یک سند دریافت ترکیبی ثبت می‌کنید: یک ردیف "نقد" (برای مبلغی که داده) و یک ردیف "چک جدید" (برای باقیمانده).

**سوال: اشتباهاً چک را استرداد کردم. چه کنم؟**
**پاسخ:** باید به لیست چک‌های استرداد شده بروید (یا از طریق گزارش کاردکس چک)، روی آن کلیک راست کرده و گزینه **«ابطال استرداد»** را بزنید. چک به صندوق اسناد قبلی خود باز می‌گردد.

# صورتحساب‌های بانکی (Bank Statements)
توضیح: موجودیت Header برای فایلی که از بانک دریافت می‌کنید (برای مغایرت‌گیری).

فیلدها:

Statement_ID (PK)

Bank_Account_ID (FK)

Statement_Date

Opening_Balance

Closing_Balance

ردیف صورتحساب بانکی (Bank Statement Line)

توضیح: ردیف‌های داخل فایل صورتحساب بانک.

فیلدها:

Statement_Line_ID (PK)

Statement_ID (FK)

Transaction_Date

Amount_Debit

Amount_Credit

Description (شرحی که بانک می‌زند)

Reconciled (Boolean - آیا این ردیف مغایرت‌گیری شده؟)

# اسناد دریافت و پرداخت (Payment/Receipt Documents)

---

## ۱. مفهوم و هدف

این فرم، **قلب تپنده و فرم عملیاتی اصلی** در ماژول خزانه‌داری است. بر اساس این اصل کلیدی طراحی شده است که:

> **اصل طلایی:** هیچ جابجایی وجهی (نقد، چک، یا حواله) در دنیای واقعی نباید اتفاق بیفتد، مگر آنکه یک «سند دریافت و پرداخت» متناظر در ERP تابان برای ردیابی آن ثبت شود.

این سند، موجودیت واحدی است که تمام ورودی‌ها، خروجی‌ها و جابجایی‌های داخلی وجوه نقد سازمان را ثبت می‌کند. این فرم، مسئول مستقیم تغییر موجودی بانک/صندوق و همچنین مبنای اصلی صدور **سند حسابداری خودکار** در دفتر کل (GL) است.

### انواع تراکنش‌های تحت پوشش

این فرم باید سه سناریوی اصلی را از طریق یک فیلد کلیدی به نام **«نوع سند» (Document Type)** مدیریت کند:

1.  **دریافت (Receipt):**
    * **هدف:** ثبت ورود وجه به سازمان.
    * **مثال‌ها:** دریافت چک از مشتری بابت فاکتور فروش، دریافت واریز نقدی بابت پیش‌پرداخت سفارش، دریافت درآمد متفرقه (مثلاً فروش ضایعات).
2.  **پرداخت (Payment):**
    * **هدف:** ثبت خروج وجه از سازمان.
    * **مثال‌ها:** صدور چک برای تأمین‌کننده بابت فاکتور خرید، پرداخت نقدی هزینه‌های مستقیم (مانند پیک)، پرداخت علی‌الحساب به کارمند.
3.  **انتقال (Transfer):**
    * **هدف:** ثبت جابجایی وجه بین دو حساب داخلی شرکت (بدون دخالت طرف حساب خارجی).
    * **مثال‌ها:** انتقال پول از «حساب بانک ملت» به «حساب بانک سامان»، یا انتقال وجه از «بانک» برای «شارژ صندوق تنخواه».

---

## ۲. ملاحظات کلیدی: مدیریت سناریوهای پرداخت

یک سند پرداخت ساده فقط پرداخت یک فاکتور است. اما یک ERP قدرتمند باید سناریوهای پیچیده‌تر را مدیریت کند. این فرم باید سه حالت اصلی ارتباط با طرف حساب را پوشش دهد:

### الف) پرداخت/دریافت بابت فاکتور (Standard)
* **مفهوم:** ساده‌ترین حالت. یک یا چند فاکتور مشخص وجود دارد و این سند برای تسویه (کامل یا بخشی از) آن‌ها صادر می‌شود.
* **نحوه اجرا:** این کار معمولاً در این فرم انجام **نمی‌شود**، بلکه در فرم «تسویه حساب» (Settlement) انجام می‌شود. این فرم فقط پول را دریافت یا پرداخت می‌کند (به بخش ۴، گام ۴ مراجعه کنید).

### ب) پیش‌پرداخت (Prepayment - مرتبط با سفارش)
* **مفهوم:** پرداختی که *قبل* از دریافت کالا/خدمات و *قبل* از صدور فاکتور انجام می‌شود، اما مستقیماً به یک **سفارش (PO/SO)** مشخص مرتبط است.
* **مثال سناریو:**
    * ما یک «سفارش خرید» (PO-1002) برای خرید مواد اولیه از «شرکت فولاد پارس» به مبلغ ۱ میلیارد ریال ثبت می‌کنیم.
    * فولاد پارس برای شروع کار، ۳۰۰ میلیون ریال پیش‌پرداخت می‌خواهد.
    * ما یک «سند پرداخت» (نوع: پرداخت) صادر می‌کنیم و در فیلد **«ارجاع به سفارش»**، کد PO-1002 را انتخاب می‌کنیم.
    * **نتیجه:** این ۳۰۰ میلیون به عنوان یک آیتم باز بستانکار روی PO-1002 می‌نشیند. زمانی که فاکتور نهایی ۱ میلیاردی از فولاد پارس می‌رسد، سیستم به صورت خودکار تشخیص می‌دهد که فقط ۷۰۰ میلیون ریال دیگر قابل پرداخت است.

### ج) علی‌الحساب (On-Account - شناور)
* **مفهوم:** پرداختی که در لحظه ثبت، به هیچ فاکتور یا سفارش *مشخصی* مرتبط نیست. این صرفاً واریز یا دریافت وجه به/از حساب یک طرف حساب است.
* **مثال سناریو:**
    * «شرکت ایران خودرو» (مشتری کلیدی ما) برای ساده‌سازی فرآیند، در ابتدای ماه یک حواله ۵ میلیارد ریالی به حساب ما واریز می‌کند.
    * ما یک «سند دریافت» (نوع: دریافت) به مبلغ ۵ میلیارد ریال به صورت «علی‌الحساب» برای ایران خودرو ثبت می‌کنیم.
    * **نتیجه:** این ۵ میلیارد به عنوان «اعتبار» (Credit) در حساب این مشتری می‌نشیند. طی ماه، ما ۱۰ فاکتور مختلف (مثلاً هر کدام ۲۰۰ میلیون ریال) برای ایران خودرو صادر می‌کنیم. در پایان هفته، حسابدار ما به فرم «تسویه حساب» (Settlement) رفته و آن ۱۰ فاکتور را با استفاده از این اعتبار ۵ میلیاردی تسویه می‌کند، بدون آنکه نیاز به ثبت سند دریافت جدیدی باشد.

### د) پرداخت هزینه مستقیم (Direct Expense - مرتبط با G/L)
* **مفهوم:** پرداختی که اصلاً به ماژول‌های خرید (AP) یا فروش (AR) مرتبط نیست. این پرداخت مستقیماً برای یک «حساب هزینه» در دفتر کل انجام می‌شود.
* **مثال سناریو:**
    * پرداخت هزینه پیک به مبلغ ۵۰۰,۰۰۰ ریال از «صندوق تنخواه».
    * پرداخت قبض برق ماهانه به مبلغ ۱۲,۰۰۰,۰۰۰ ریال از «حساب بانک».
* **نحوه اجرا:** در بخش «طرف حساب» (Partner)، کاربر به جای مشتری یا تأمین‌کننده، مستقیماً **«حساب معین G/L»** (مثلاً `6201010 - هزینه پیک` یا `6105020 - هزینه آب و برق`) را انتخاب می‌کند.

---

## ۳. فرم: سند دریافت و پرداخت (Payment/Receipt Document)

**مسیر:** `خزانه‌داری / عملیات / سند دریافت و پرداخت جدید`

این فرم از یک بخش «سربرگ» (اطلاعات کلی) و یک یا چند «ردیف» (جزئیات روش پرداخت) تشکیل شده است.

### بخش سربرگ (Header)

| نام فیلد               | نوع داده     | اجباری                    | توضیح و مثال‌ها                                                                                                                                                                                                                                                                               |
| :--------------------- | :----------- | :------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **بنگاه اقتصادی**      | انتخابی (FK) | بله                       | بنگاهی که تراکنش مالی را انجام می‌دهد.                                                                                                                                                                                                                                                        |
| **نوع سند**            | انتخابی      | بله                       | **(فیلد کنترلی اصلی)** `دریافت` / `پرداخت` / `انتقال`. (انتخاب این گزینه، رفتار سایر فیلدها را تغییر می‌دهد).                                                                                                                                                                                 |
| **تاریخ سند**          | تاریخ        | بله                       | تاریخ واقعی چک، حواله یا واریز نقدی.                                                                                                                                                                                                                                                         |
| **تاریخ ثبت**          | تاریخ        | بله                       | تاریخ ورود داده در سیستم (معمولاً خودکار = تاریخ روز).                                                                                                                                                                                                                                        |
| **طرف حساب (Partner)** | انتخابی (FK) | (بله، برای دریافت/پرداخت) | **(فیلد هوشمند)** <br> * **اگر پرداخت/دریافت استاندارد بود:** `مشتری` یا `تأمین‌کننده` را انتخاب می‌کنید (مثلاً: «شرکت فولاد پارس»). <br> * **اگر پرداخت هزینه مستقیم بود:** `حساب G/L` را انتخاب می‌کنید (مثلاً: «6201010 - هزینه پیک»). <br> * **اگر انتقال بود:** این فیلد غیرفعال/مخفی می‌شود. |
| **مبلغ کل**            | عددی         | بله                       | مبلغ کل سند. سیستم باید اعتبارسنجی کند که **مجموع ردیف‌ها = مبلغ کل**.                                                                                                                                                                                                                        |
| **شرح سند**            | متنی         | بله                       | توضیح کلی (مثلاً: «پرداخت علی‌الحساب بابت PO-1002»).                                                                                                                                                                                                                                           |
| **ارجاع به سفارش**     | انتخابی (FK) | خیر                       | (فقط برای سناریوی «پیش‌پرداخت») شماره سفارش فروش یا سفارش خرید.                                                                                                                                                                                                                               |

---

### بخش ردیف‌ها (Lines) - (جزئیات روش پرداخت)

کاربر می‌تواند برای یک سند، چندین ردیف اضافه کند. (مثال: پرداخت یک فاکتور ۵۰ میلیونی با ۱۰ میلیون نقد + یک چک ۴۰ میلیونی).

| نام فیلد            | نوع داده     | اجباری                        | توضیح و مثال‌ها                                                        |
| :------------------ | :----------- | :---------------------------- | :-------------------------------------------------------------------- |
| **روش پرداخت**      | انتخابی      | بله                           | `نقد` / `چک` / `حواله (انتقال بانکی)` / `کارت‌خوان (POS)`...           |
| **مبلغ**            | عددی         | بله                           | مبلغ مربوط به این ردیف خاص.                                           |
| **حساب/صندوق مبدأ** | انتخابی (FK) | (بله، برای `پرداخت`/`انتقال`) | حساب بانکی یا صندوقی که پول از آن *خارج* می‌شود. (مثلاً: «بانک ملت»)    |
| **حساب/صندوق مقصد** | انتخابی (FK) | (بله، برای `دریافت`/`انتقال`) | حساب بانکی یا صندوقی که پول به آن *وارد* می‌شود. (مثلاً: «صندوق مرکزی») |
| **شرح ردیف**        | متنی         | خیر                           | توضیحات جزئی (مثلاً: «چک اول از سه قسط»).                              |

---

### بخش ردیف‌ها: فیلدهای پویا بر اساس روش پرداخت

بخش ردیف‌ها باید هوشمند باشد و فیلدهای اضافی را فقط در صورت نیاز نشان دهد:

**الف) اگر روش = `چک` (پرداختی):**

* **حساب بانکی مبدأ:** (اجباری) حسابی که چک از دسته چک آن صادر می‌شود.
* **شماره سریال چک:** (اجباری) **لیست انتخابی** از سریال‌های «خام» ثبت شده در «دسته چک» آن حساب. (کاربر دستی وارد نمی‌کند، بلکه انتخاب می‌کند).
* **تاریخ سررسید:** (اجباری) تاریخ سررسید چک.
* **در وجه:** (متنی) نام گیرنده (معمولاً از سربرگ می‌آید).

**ب) اگر روش = `چک` (دریافتی):**

* **شماره سریال چک:** (متنی) کاربر شماره چک مشتری را **دستی** وارد می‌کند.
* **بانک چک:** (انتخابی FK) بانکی که چک مشتری روی آن است (از لیست بانک‌ها).
* **شعبه و کد:** (متنی) اطلاعات شعبه چک مشتری.
* **تاریخ سررسید:** (اجباری) تاریخ سررسید چک.
* **صاحب حساب:** (متنی) نام صاحب حساب چک (جهت ردیابی).

**ج) اگر روش = `حواله (انتقال بانکی)`:**

* **شماره پیگیری/ارجاع:** (متنی) کد رهگیری انتقال بانکی (ساتنا، پایا، یا شماره رسید).

---

## ۴. فرآیند پس از ثبت (Post-Registration Logic)

پس از اینکه کاربر دکمه «ثبت نهایی» (Post) را فشار می‌دهد، چهار اتفاق کلیدی *باید* در پشت صحنه رخ دهد:

1.  **ثبت نهایی (Posting):**
    * سند قفل می‌شود و دیگر قابل ویرایش نیست (مگر با فرآیند ابطال).
    * وضعیت آن از «پیش‌نویس» (Draft) به «ثبت شده» (Posted) تغییر می‌کند.

2.  **تأثیر بر موجودی (Cash Balance Impact):**
    * **برای نقد/حواله:** موجودی «حساب بانکی» یا «صندوق» انتخاب شده در ردیف‌ها، *بلافاصله* به‌روزرسانی (کم یا زیاد) می‌شود.
    * **برای چک (پرداختی/دریافتی):** موجودی بانک/صندوق *تغییر نمی‌کند*. چک فقط در ماژول «مدیریت چک» (Check Management) با وضعیت «صادر شده» یا «نزد صندوق» ثبت می‌شود. تأثیر واقعی بر موجودی بانک، بعداً در زمان «پاس شدن» یا «وصول» چک رخ خواهد داد.

3.  **ایجاد سند حسابداری (G/L Creation):**
    * مهم‌ترین بخش. سیستم باید *بلافاصله* و *به‌صورت خودکار* یک سند حسابداری در دفتر کل صادر کند. (نمونه‌ها در بخش ۵).

4.  **ایجاد آیتم باز (Open Item Creation):**
    * **اگر سند «علی‌الحساب» یا «پیش‌پرداخت» باشد:** یک «آیتم باز» (Open Item) در حساب طرف حساب (مشتری یا تأمین‌کننده) ایجاد می‌کند. این آیتم نشان‌دهنده اعتبار یا بدهی شناوری است که باید بعداً در فرم **«تسویه حساب» (Settlement Workbench)** با فاکتورها تسویه شود.

---

## ۵. نمونه اسناد حسابداری خودکار (G/L Journals)

این فرم باید اسناد زیر را به صورت خودکار ایجاد کند:

**سناریو ۱: دریافت نقدی علی‌الحساب از مشتری (10 م ریال به صندوق)**

* بدهکار: `11020101 - صندوق مرکزی` (10 م)
* بستانکار: `12010101 - حساب‌های دریافتنی - مشتری الف` (10 م)

**سناریو ۲: پرداخت هزینه مستقیم (پیک) از تنخواه (500 ه.ر)**

* بدهکار: `6201010 - هزینه پیک` (500 ه.ر)
* بستانکار: `11020105 - تنخواه بازرگانی` (500 ه.ر)

**سناریو ۳: صدور چک برای تأمین‌کننده (40 م ریال)**

* بدهکار: `21010101 - حساب‌های پرداختنی - تأمین‌کننده ب` (40 م)
* بستانکار: `21030101 - اسناد پرداختنی` (40 م)
*(توجه: حساب بانک هنوز بستانکار نمی‌شود تا زمان پاس شدن چک)*

**سناریو ۴: انتقال از بانک به صندوق (شارژ تنخواه - 5 م ریال)**

* بدهکار: `11020105 - تنخواه بازرگانی` (5 م)
* بستانکار: `11010001 - بانک ملت` (5 م)

# مفهوم و فرم: تسویه حساب (Settlement / Clearing)

---

## ۱. مفهوم

تسویه حساب، فرآیند حیاتی «اتصال» آیتم‌های بستانکار (مانند پرداخت‌ها، پیش‌پرداخت‌ها، اعتبارات) به آیتم‌های بدهکار (مانند فاکتورها) در حساب یک طرف حساب (مشتری یا تأمین‌کننده) است.

* **هدف:** صفر کردن مانده حساب آیتم‌های باز و تعیین وضعیت «تسویه شده» برای فاکتورها و پرداخت‌ها.
* **نیاز به تسویه (M:N):** این فرآیند ضروری است زیرا ارتباط بین فاکتور و پرداخت همیشه یک به یک (1:1) نیست:
    * **چند به یک (N:1):** یک مشتری ممکن است ۳ فاکتور باز را با ۱ چک پرداخت کند.
    * **یک به چند (1:N):** یک مشتری ممکن است ۱ فاکتور را در ۳ قسط پرداخت کند.
    * **چند به چند (M:N):** یک مشتری ممکن است ۲ فاکتور و بخشی از فاکتور سوم را با ۱ چک و ۱ واریز نقدی (که قبلاً علی‌الحساب پرداخت کرده) تسویه کند.

---

## ۲. فرم: میزکار تسویه حساب (Settlement Workbench)

این فرم یک ابزار تعاملی است که به کاربر (حسابدار) اجازه می‌دهد آیتم‌های باز یک طرف حساب را مشاهده و با هم تسویه کند.

**مسیر:**
`خزانه‌داری / عملیات / تسویه حساب مشتریان`
`خزانه‌داری / عملیات / تسویه حساب تأمین‌کنندگان`

### رابط کاربری (UX)

این فرم معمولاً به صورت زیر طراحی می‌شود:

1.  **انتخاب طرف حساب:** کاربر ابتدا مشتری یا تأمین‌کننده مورد نظر را انتخاب می‌کند.
2.  **نمایش دو ستونی:** سیستم تمامی آیتم‌های باز (Open Items) آن شخص را در دو ستون نمایش می‌دهد:

    * **ستون ۱: بدهی‌ها (Invoices / Debits):**
        * لیست تمام فاکتورهای فروش (برای مشتری) یا فاکتورهای خرید (برای تأمین‌کننده) که هنوز تسویه نشده‌اند.
        * شامل: شماره فاکتور، تاریخ، مبلغ کل، مبلغ باقیمانده.

    * **ستون ۲: بستانکاری‌ها (Payments / Credits):**
        * لیست تمام پرداخت‌های «علی‌الحساب».
        * پیش‌پرداخت‌های مرتبط.
        * برگشت از فروش‌ها (Credit Memos).
        * شامل: شماره سند پرداخت، تاریخ، مبلغ کل، مبلغ باقیمانده قابل تخصیص.

3.  **فرآیند تسویه (Matching):**
    * کاربر آیتم‌های مورد نظر از هر دو ستون را انتخاب (تیک) می‌کند.
    * *مثال:* انتخاب فاکتور ۱ (مبلغ ۱۰۰) و فاکتور ۲ (مبلغ ۵۰) از ستون ۱؛ و انتخاب پرداخت علی‌الحساب (مبلغ ۱۲۰) و پرداخت جدید (مبلغ ۳۰) از ستون ۲.
    * مجموع بدهی انتخاب شده = ۱۵۰
    * مجموع بستانکاری انتخاب شده = ۱۵۰

4.  **دکمه «تسویه» (Settle):**
    * کاربر دکمه تسویه را می‌زند.
    * سیستم بررسی می‌کند که مجموع دو طرف برابر باشد (یا در صورت تسویه جزئی، منطق آن رعایت شود).
    * سیستم وضعیت فاکتورها و پرداخت‌های انتخاب شده را به «تسویه شده» (Cleared) تغییر می‌دهد و رکوردهای ارتباطی (Settlement Line) را ایجاد می‌کند.

---

## ۳. تسویه خودکار (Automatic Settlement)

برای سادگی، سیستم می‌تواند یک دکمه «تسویه خودکار» نیز داشته باشد که بر اساس منطق FIFO (اولین فاکتور با اولین پرداخت) یا بر اساس شماره ارجاع یکسان، آیتم‌ها را به صورت خودکار تسویه کند.
