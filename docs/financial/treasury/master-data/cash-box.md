# صندوق‌های نقدی (Cash Boxes)

## ۱. مقدمه: صندوق نقدی چیست؟

در سیستم ERP تابان، **«صندوق نقدی»** (Cash Box) نماینده دیجیتالی و آینه تمام‌نمای هر محفظه فیزیکی است که در سازمان شما برای نگهداری **پول نقد (اسکناس و مسکوکات)** استفاده می‌شود.

این موجودیت به شما کمک می‌کند تا دقیقاً بدانید در هر لحظه، در هر کشو، گاوصندوق، دخل فروشگاه یا کیف پولِ تنخواه‌گردان شرکت، دقیقاً چقدر پول وجود دارد و این پول متعلق به کدام بخش است.

> **⛔️ هشدار حیاتی برای کاربران:**
> این ماژول **فقط و فقط** مخصوص ثبت **«پول نقد»** است.
>
>   * **چک دریافتی:** اگر چک دریافت کرده‌اید، جای آن اینجا نیست\! باید در ماژول **«صندوق اسناد»** ثبت شود.
>   * **موجودی بانک:** اگر پول در حساب بانکی است، باید در ماژول **«بانک‌ها»** مدیریت شود.
>   * **اشتباه رایج:** ترکیب کردن موجودی نقد و چک در یک صندوق، باعث مغایرت در گزارش‌های خزانه‌داری و به هم ریختن ترازنامه می‌شود. لطفاً جداگانه ثبت کنید.

-----

## ۲. انواع صندوق‌هایی که باید بشناسید

برای نظم‌دهی به جریان وجوه نقد، باید ماهیت هر صندوق را مشخص کنید. در سیستم، فیلد نوع صندوق نقدی `CashBoxType` رفتار و کنترل‌های صندوق را تعیین می‌کند:

| نوع صندوق | نام فنی (System Enum) | کاربرد و منطق رفتاری |
| :--- | :--- | :--- |
| **۱. صندوق فروش (عملیاتی)** | `POS` / `Operational` | **(ورودی پول)** مخصوص باجه‌های دریافت پول از مشتریان است. <br> *ویژگی:* ماهیت "افزاینده" دارد. معمولاً سقف نگهداری دارد و باید در پایان روز به خزانه یا بانک تخلیه شود. |
| **۲. تنخواه گردان** | `PettyCash` | **(خروجی پول)** مخصوص پرداخت هزینه‌های جزئی (پیک، پذیرایی، خرید خرد). <br> *ویژگی:* ماهیت "کاهنده" دارد. از مکانیزم "شارژ مجدد" (Replenishment) استفاده می‌کند. |
| **۳. صندوق مرکزی (خزانه)** | `MainVault` | **(مخزن اصلی)** گاوصندوق اصلی شرکت که وجوه نقد سایر صندوق‌ها در آن جمع‌آوری شده و سپس به بانک واریز می‌شود. |

-----

## ۳. راهنمای تکمیل فرم تعریف صندوق

**مسیر دسترسی:** `خزانه‌داری > تعاریف پایه > صندوق‌های نقدی`

برای ایجاد یک صندوق جدید، فیلدهای زیر را تکمیل کنید. (ستون نام فنی برای تیم توسعه است).

### الف) اطلاعات شناسنامه صندوق (General Info)

| عنوان فیلد | نام فنی (Technical) | راهنمای تکمیل و منطق سیستم |
| :--- | :--- | :--- |
| **کد صندوق** | `Code` | یک کد کوتاه و یکتا وارد کنید (مثلاً `C-101`). |
| **نام صندوق** | `Name` | نامی کامل و گویا انتخاب کنید. <br> *مثال:* `تنخواه گردان واحد بازرگانی - آقای حسینی` |
| **بنگاه اقتصادی** | `LegalEntityID` | مالک قانونی این پول کدام شرکت شماست؟ <br> *نکته فنی:* سند حسابداری در دفاتر کل (GL) این شرکت ثبت می‌شود. انتقال پول بین دو صندوق از دو بنگاه مختلف، نیازمند سند "حساب جاری شرکا" است. |
| **مکان عملیاتی** | `OperatingUnitID` | این صندوق فیزیکاً در کدام ساختمان یا شعبه است؟ (مثلاً: کارخانه کرج). <br> *کاربرد:* فیلتر کردن دسترسی کاربران بر اساس شعبه. |
| **مسئول صندوق** | `CustodianID` | چه کسی کلید این صندوق را دارد؟ <br> *منطق سیستم:* اگر در صندوق‌گردانی کسری دیده شود، سیستم به طور پیش‌فرض نام این شخص را در شرح سند کسری درج می‌کند. |
| **وضعیت** | `IsActive` | اگر صندوقی جمع‌آوری شد، آن را غیرفعال کنید (حذف نکنید تا سوابق بماند). |

### ب) تنظیمات مالی (Financial Settings)

| عنوان فیلد | نام فنی (Technical) | راهنمای تکمیل |
| :--- | :--- | :--- |
| **ارز** | `CurrencyID` | این صندوق چه پولی نگه می‌دارد؟ (ریال، دلار، یورو). <br> **قانون سخت‌گیرانه:** هر صندوق فقط **یک نوع ارز** قبول می‌کند. برای ارزهای مختلف، باید صندوق‌های جداگانه بسازید. |
| **حساب معین** | `GLAccountID` | کد حسابداری متصل به این صندوق در ترازنامه. <br> *مثال:* `۱۱۰۲۰۰۱ - موجودی نقد نزد صندوق مرکزی` |
| **کنترل موجودی منفی** | `AllowNegativeBalance` | آیا سیستم اجازه دهد کاربر بیشتر از موجودی صندوق، سند پرداخت بزند؟ <br> *پیش‌فرض:* **خیر**. (چون در واقعیت نمی‌توانید از جیب خالی پول بردارید\!). |
| **حساب کسری/سرک** | `ShortageAccountID` `OverageAccountID` | (اختیاری) کد حساب‌های "هزینه کسری" و "درآمد سرک" را اینجا ست کنید تا در زمان مغایرت‌گیری، سند اتوماتیک صادر شود. |

### ج) تنظیمات تنخواه‌گردان (Petty Cash Controls)

*(این بخش فقط زمانی فعال است که نوع صندوق = تنخواه باشد)*

| عنوان فیلد | نام فنی (Technical) | کاربرد |
| :--- | :--- | :--- |
| **سقف تنخواه** | `ImprestCeiling` | حداکثر پولی که باید دست تنخواه‌گردان باشد (مثلاً ۵۰ میلیون). سیستم اجازه شارژ بیش از این مبلغ را نمی‌دهد. |
| **هشدار موجودی** | `ReplenishThreshold` | "نقطه سفارش پول". عددی وارد کنید (مثلاً ۲۰٪). اگر موجودی به این سطح رسید، سیستم به مدیر مالی هشدار می‌دهد که "تنخواه نیاز به شارژ دارد". |

-----

## ۴. سناریوهای عملیاتی (چطور با سیستم کار کنیم؟)

در این بخش، ۳ سناریوی اصلی روزمره را با جزئیات کامل و **تأثیرات حسابداری** بررسی می‌کنیم.

### سناریو ۱: چرخه زندگی یک تنخواه‌گردان (Petty Cash Cycle)

**داستان:** آقای "جلالی" مسئول خرید است. یک تنخواه با سقف **۱۰,۰۰۰,۰۰۰ ریال** برای او تعریف شده است.

1.  **شارژ اولیه (Establishment):**

      * *عملیات:* مدیر مالی ۱۰ میلیون تومان از "بانک ملت" به "صندوق آقای جلالی" واریز می‌کند.
      * *سند حسابداری:* `[بدهکار] صندوق تنخواه / [بستانکار] بانک ملت`.
      * *موجودی سیستم:* ۱۰,۰۰۰,۰۰۰

2.  **خرج کردن (Expense Recording):**

      * *عملیات:* آقای جلالی ۲ میلیون بنزین می‌زند و ۳ میلیون لوازم تحریر می‌خرد. او فاکتورها را در سیستم ثبت می‌کند (سند پرداخت از محل تنخواه).
      * *سند حسابداری:* `[بدهکار] هزینه سوخت و ملزومات / [بستانکار] صندوق تنخواه`.
      * *موجودی سیستم:* ۵,۰۰۰,۰۰۰ (نصف پول خرج شد).

3.  **شارژ مجدد (Replenishment):**

      * *عملیات:* موجودی کم شده است. آقای جلالی گزارش هزینه‌ها (۵ میلیون) را به مالی می‌دهد. حسابدار پس از تایید، دقیقاً ۵ میلیون تومان به او می‌دهد تا موجودی دوباره ۱۰ میلیون شود.
      * *سند حسابداری:* `[بدهکار] صندوق تنخواه / [بستانکار] بانک ملت`.

-----

### سناریو ۲: تخلیه صندوق فروش (EOD Transfer)

**داستان:** صندوق‌دار فروشگاه در پایان شب، **۳۰,۰۰۰,۰۰۰ ریال** پول نقد در دخل دارد و می‌خواهد آن را تحویل دهد.

1.  **شمارش:** پول‌ها شمارش و دسته‌بندی می‌شوند.
2.  **انتقال در سیستم:** کاربر از فرم **«انتقال وجه» (Cash Transfer)** استفاده می‌کند.
      * **مبدأ:** صندوق فروشگاه ۱
      * **مقصد:** صندوق مرکزی (یا حساب بانک، اگر مستقیم واریز کند).
3.  **نتیجه:**
      * موجودی صندوق فروشگاه در سیستم **صفر** می‌شود.
      * موجودی صندوق مرکزی ۳۰ میلیون افزایش می‌یابد.
      * *سند حسابداری:* `[بدهکار] صندوق مرکزی / [بستانکار] صندوق فروشگاه`.

-----

### سناریو ۳: صندوق‌گردانی و مغایرت (Cash Count & Reconciliation)

**داستان:** بازرس شرکت برای شمارش ناگهانی صندوق آقای جلالی می‌رود.

1.  **وضعیت سیستم (Book Balance):** سیستم می‌گوید باید **۵,۰۰۰,۰۰۰ ریال** پول باشد.
2.  **شمارش واقعی (Physical Count):** بازرس پول‌ها را می‌شمارد: **۴,۹۵۰,۰۰۰ ریال** است (۵۰ هزار ریال گم شده).
3.  **ثبت مغایرت:**
      * بازرس فرم «صندوق‌گردانی» را باز می‌کند.
      * مبلغ واقعی (۴,۹۵۰,۰۰۰) را وارد می‌کند.
4.  **عملکرد سیستم:**
      * سیستم خودکار ۵۰,۰۰۰ ریال **کسری (Shortage)** تشخیص می‌دهد.
5.  **سند اتوماتیک:**
      * با تایید نهایی مدیر، سیستم سند زیر را صادر می‌کند تا موجودی سیستم با واقعیت یکی شود:
      * `[بدهکار] هزینه کسری صندوق (به نام آقای جلالی)`
      * `[بستانکار] صندوق تنخواه`
      * *نتیجه:* موجودی سیستم اکنون ۴,۹۵۰,۰۰۰ ریال است.

-----

## ۵. کنترل‌های هوشمند سیستم (System Validations)

این قوانین در نرم‌افزار تعبیه شده‌اند تا جلوی خطای کاربران را بگیرند:

1.  **قفل ارزی (Currency Lock):**
      * اگر سعی کنید در صندوقی که ارزش «ریال» است، سند دلاری ثبت کنید، سیستم خطا می‌دهد: *"ارز سند با ارز صندوق همخوانی ندارد."*
2.  **محدودیت دسترسی (Data Access):**
      * صندوق‌دار «شعبه ۱» به هیچ وجه نمی‌تواند موجودی یا گردش صندوق «شعبه ۲» را ببیند. (فیلتر بر اساس `OperatingUnitID`).
3.  **سقف تراکنش (Transaction Limit):**
      * اگر برای صندوق سقف تراکنش تعیین شده باشد (مثلاً ۵۰ میلیون) و کاربر بخواهد ۱۰۰ میلیون پرداخت نقدی ثبت کند، سیستم خطا می‌دهد: *"مبلغ بیش از حد مجاز پرداخت نقدی است. لطفاً چک صادر کنید."*
4.  **تاریخ مؤثر:**
      * امکان ثبت سند برای تاریخ‌های بسته شده (دوره مالی بسته) وجود ندارد.

-----

## ۶. گزارش‌های کلیدی

استفاده صحیح از این ماژول، گزارش‌های زیر را در اختیار شما قرار می‌دهد:

  * **کاردکس صندوق (Cash Ledger):** ریز گردش (واریز/برداشت) با جزئیات طرف حساب، تاریخ، ساعت و نام کاربر ثبت‌کننده.
  * **داشبورد نقدینگی (Cash Position):** یک نمای کلی که نشان می‌دهد مجموع پول نقد موجود در تمام گاوصندوق‌های شرکت (به تفکیک هر ارز) چقدر است.
  * **گزارش مغایرت‌ها:** لیستی از تمام کسری‌ها و اضافات ثبت شده در بازه زمانی مشخص (برای ارزیابی عملکرد و امانت‌داری مسئولین صندوق).
  * **مانده تنخواه‌ها:** گزارشی که نشان می‌دهد کدام تنخواه‌ها خالی شده‌اند و نیاز به شارژ فوری دارند.