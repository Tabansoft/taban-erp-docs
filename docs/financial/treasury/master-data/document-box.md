# صندوق‌های اسناد (Document Boxes)

## ۱. مقدمه: صندوق اسناد چیست؟

در سیستم ERP تابان، **«صندوق اسناد» (Document Box)** معادل دیجیتالی هر محفظه فیزیکی است که شما برای نگهداری **اسناد تجاری (چک، سفته، اوراق بهادار)** استفاده می‌کنید.

تصور کنید در واحد مالی ۳ زونکن و ۱ گاوصندوق دارید:

1.  گاوصندوق اصلی (برای چک‌های تازه).
2.  زونکن چک‌های واگذار شده به بانک ملت.
3.  زونکن چک‌های واگذار شده به بانک تجارت.
4.  زونکن چک‌های برگشتی (دست وکیل شرکت).

در نرم‌افزار، برای تک‌تک این موارد باید یک «صندوق اسناد» تعریف کنید.

> **تفاوت کلیدی با صندوق نقد:**
>
>   * **صندوق نقد:** فقط یک عدد ریالی را نشان می‌دهد (مثلاً: ۵۰ میلیون ریال موجودی).
>   * **صندوق اسناد:** دقیقاً نشان می‌دهد **کدام برگه‌های چک** (با چه شماره سریال، چه مبلغی و از کدام مشتری) در آن قرار دارند. موجودی این صندوق، لیستِ چک‌هاست.

-----

## ۲. انواع صندوق‌هایی که باید بشناسید

برای نظم‌دهی به اسناد و صدور سند حسابداری درست، باید ماهیت هر صندوق را مشخص کنید (فیلد نوع صندوق `BoxType`):

| نوع صندوق | نام فنی (System Enum) | کاربرد و منطق رفتاری |
| :--- | :--- | :--- |
| **۱. صندوق عملیاتی (نزد شرکت)** | `Operational` / `Safe` | **(نقطه شروع)** همان گاوصندوق شرکت. تمام چک‌هایی که از مشتری می‌گیرید، ابتدا وارد این صندوق می‌شوند. |
| **۲. در جریان وصول (نزد بانک)** | `InCollection` | **(ایستگاه میانی)** این صندوق نماینده "باجه کلر بانک" است. وقتی چک را فیزیکاً به بانک تحویل می‌دهید، باید آن را به این صندوق منتقل کنید. <br> *نکته:* به ازای هر حساب جاری، یک صندوق از این نوع بسازید. |
| **۳. صندوق برگشتی** | `Bounced` | **(واحد پیگیری)** محل نگهداری چک‌هایی که نکول شده‌اند. این صندوق معمولاً دست مدیر مالی یا واحد حقوقی است. |
| **۴. صندوق تضمینی** | `Guarantee` | **(بایگانی)** مخصوص چک‌هایی که بابت ضمانت حسن انجام کار گرفته‌اید. این چک‌ها نباید در گزارش نقدینگی شرکت محاسبه شوند. |

-----

## ۳. راهنمای تکمیل فرم تعریف صندوق اسناد

**مسیر دسترسی:** `خزانه‌داری > تعاریف پایه > صندوق‌های اسناد`

لطفاً فیلدها را با دقت پر کنید. ستون «نام فنی» راهنمای تیم توسعه‌دهنده است.

| عنوان فیلد | نام فنی (Technical) | راهنمای تکمیل و منطق سیستم |
| :--- | :--- | :--- |
| **کد صندوق** | `Code` | یک کد کوتاه و یکتا (مثلاً `DOC-101`). |
| **نام صندوق** | `Name` | نامی کامل و گویا. <br> *مثال:* `صندوق اسناد در جریان وصول - بانک ملت` |
| **بنگاه اقتصادی** | `LegalEntityID` | مالک قانونی اسناد. سند حسابداری جابجایی چک در دفاتر این شرکت ثبت می‌شود. |
| **مکان عملیاتی** | `OperatingUnitID` | محل فیزیکی نگهداری چک (مثلاً: دفتر مرکزی تهران). |
| **نوع صندوق** | `BoxType` | نوع عملکرد را با دقت انتخاب کنید (عملیاتی، در جریان وصول، ...). |
| **وابستگی بانکی** | `RelatedBankAccountID` | **(شرطی)** این فیلد فقط زمانی فعال می‌شود که نوع صندوق **«در جریان وصول»** باشد. باید مشخص کنید این صندوق مربوط به کدام حساب جاری شماست. |
| **حساب معین** | `GLAccountID` | کد حسابداری متصل به صندوق. <br> *مثال:* `۱۲۰۲ - اسناد در جریان وصول` |
| **ارز** | `CurrencyID` | این صندوق چک‌های چه ارزی را قبول می‌کند؟ (ریال/دلار). |
| **مسئول (جمعدار)** | `CustodianID` | کارمندی که مسئولیت فیزیکی لاشه چک‌ها با اوست. |

-----

## ۴. سناریوی عملیاتی: سفر یک چک در سیستم

در سیستم تابان، جابجایی چک یعنی **تغییر مسئولیت و تغییر سرفصل حسابداری**.
بیایید داستان یک چک واقعی را مرور کنیم.

**فرض:** شرکت یک چک **۵۰,۰۰۰,۰۰۰ ریالی** از مشتری (فروشگاه کوروش) دریافت می‌کند.

### پرده اول: دریافت و ورود به گاوصندوق

  * **عملیات کاربر:** ثبت «سند دریافت» در سیستم.
  * **وضعیت سیستم:** چک متولد می‌شود و در **«صندوق عملیاتی»** قرار می‌گیرد.
  * **سند حسابداری (خودکار):**
      * `[بدهکار] اسناد دریافتنی نزد صندوق (۵۰ م)`
      * `[بستانکار] حساب‌های دریافتنی - مشتری (۵۰ م)`

### پرده دوم: واگذاری به بانک (خواباندن به حساب)

  * **زمان:** روز سررسید چک.
  * **عملیات کاربر:** استفاده از فرم **«واگذاری چک»**. کاربر چک را انتخاب کرده و مقصد را **«صندوق در جریان وصول بانک ملت»** تعیین می‌کند.
  * **وضعیت سیستم:** لاشه چک از صندوق عملیاتی حذف و به صندوق بانک اضافه می‌شود.
  * **سند حسابداری (خودکار):**
      * `[بدهکار] اسناد در جریان وصول - ملت (۵۰ م)`
      * `[بستانکار] اسناد دریافتنی نزد صندوق (۵۰ م)`

### پرده سوم: تعیین سرنوشت (وصول یا برگشت)

**حالت الف: چک پاس می‌شود (Happy Path)**

  * **عملیات:** بانک وجه را واریز می‌کند. کاربر دکمه **«اعلام وصول»** را می‌زند.
  * **نتیجه:** چک از سیستم اسناد خارج شده و موجودی **حساب بانکی** ۵۰ میلیون افزایش می‌یابد.
  * **سند حسابداری:**
      * `[بدهکار] موجودی بانک ملت (۵۰ م)`
      * `[بستانکار] اسناد در جریان وصول - ملت (۵۰ م)`

**حالت ب: چک برگشت می‌خورد (Unhappy Path)**

  * **عملیات:** بانک گواهی عدم پرداخت می‌دهد. کاربر دکمه **«اعلام برگشت»** را می‌زند.
  * **نتیجه:** چک از صندوق بانک خارج شده و به **«صندوق اسناد برگشتی»** منتقل می‌شود.
  * **سند حسابداری:**
      * `[بدهکار] اسناد دریافتنی برگشتی (۵۰ م)`
      * `[بستانکار] اسناد در جریان وصول - ملت (۵۰ م)`

-----

## ۵. قوانین کنترلی سیستم (System Validations)

این قوانین برای جلوگیری از خطای کاربر در سیستم تعبیه شده‌اند:

1.  **قانون موجودی:**
      * شما نمی‌توانید چکی را واگذار کنید که در صندوق نیست\! سیستم ابتدا چک می‌کند که آیا این چک در «صندوق مبدأ» وجود دارد یا خیر.
2.  **رعایت ترتیب (Workflow Constraint):**
      * پرش ممنوع\! نمی‌توانید چک را مستقیم از «گاوصندوق» به «صندوق برگشتی» بفرستید. چک حتماً باید اول به بانک (در جریان وصول) رفته باشد تا بتواند برگشت بخورد.
3.  **تطابق ارزی:**
      * سیستم اجازه نمی‌دهد یک چک دلاری را وارد یک صندوق ریالی کنید.
4.  **مرزهای حقوقی (Legal Entity Check):**
      * انتقال چک بین صندوق‌های دو شرکت مختلف ممنوع است (مگر اینکه فرآیند انتقال بین شرکتی و صدور فاکتور انجام شود).

-----

## ۶. گزارش‌های کلیدی

استفاده از این ماژول، پاسخ سوالات زیر را برای مدیران فراهم می‌کند:

  * **موجودی لحظه‌ای:** در حال حاضر دقیقاً چند فقره چک و به چه مبلغی در شرکت موجود است؟
  * **اسناد در راه (Float):** چه مبلغی چک نزد بانک داریم که هنوز پاس نشده است؟ (حیاتی برای پیش‌بینی جریان وجوه نقد).
  * **لیست سیاه مشتریان:** کدام مشتریان بیشترین چک برگشتی (موجود در صندوق برگشتی) را دارند؟
  * **انبارگردانی اسناد:** چاپ لیست چک‌های هر صندوق جهت شمارش فیزیکی و تطبیق با لاشه چک‌ها.