# شعب بانک‌ها (Bank Branches)

## ۱. مفهوم و کاربرد

در ساختار بانکی، هر **«بانک»** (مثل بانک ملی) از صدها یا هزاران **«شعبه»** فیزیکی تشکیل شده است.
موجودیت **«شعبه» (Branch)** در سیستم تابان، حلقه اتصال بین "نام بانک" و "شماره حساب" شماست.

**چرا باید شعبه را تعریف کنیم؟**

1.  **برای حساب‌های خودمان:** وقتی می‌خواهید حساب جاری شرکت را تعریف کنید، سیستم باید بداند این حساب در کدام شعبه افتتاح شده است (مثلاً شعبه بازار یا شعبه شهرک صنعتی). این موضوع برای مکاتبات بانکی و دریافت دسته چک مهم است.
2.  **برای چک‌های مشتریان:** دانستن شعبه صادرکننده چک، در زمان واگذاری چک به بانک (کلر) یا پیگیری چک‌های برگشتی، به شما کمک می‌کند تا بدانید باید به کدام منطقه جغرافیایی مراجعه کنید.

-----

## ۲. راهنمای تکمیل فرم تعریف شعبه

**مسیر دسترسی:** `خزانه‌داری > تعاریف پایه > شعب بانک‌ها`

این فرم معمولاً زمانی استفاده می‌شود که شرکت حساب جدیدی افتتاح می‌کند یا مشتری چک مهمی از شعبه‌ای خاص می‌آورد.

### مشخصات فیلدها

| عنوان فیلد (در نرم‌افزار) | نام فنی (English Field) | نوع داده | الزامی | راهنمای تکمیل و منطق سیستم |
| :--- | :--- | :--- | :--- | :--- |
| **شناسه** | `ID` | Int (PK) | **بله** | کلید اصلی. |
| **بانک عامل** | `BankID` | FK | **بله** | این شعبه زیرمجموعه کدام بانک است؟ (انتخاب از لیست بانک‌های تعریف شده). <br> *مثال:* `بانک ملت` |
| **کد شعبه** | `Code` | متن/عدد | **بله** | کدی که بانک به آن شعبه اختصاص داده است. <br> **قانون سیستم:** ترکیب "نام بانک" + "کد شعبه" باید یکتا باشد. (بانک ملت نمی‌تواند دو شعبه با کد ۶۵۴ داشته باشد). |
| **نام شعبه** | `Name` | متن | **بله** | نام رسمی شعبه. <br> *مثال:* `شعبه مرکزی` یا `شعبه خیابان انقلاب` |
| **استان / شهر** | `CityID` / `ProvinceID` | FK | خیر | محل جغرافیایی شعبه. (برای گزارش‌گیری: مثلاً "چقدر چک از مشتریان اصفهان داریم؟"). |
| **آدرس** | `Address` | متن | خیر | آدرس پستی دقیق شعبه. |
| **تلفن/فکس** | `Phone` | متن | خیر | شماره تماس رئیس یا معاون شعبه (برای پیگیری‌های اضطراری چک‌های برگشتی). |
| **وضعیت** | `IsActive` | چک‌باکس | **بله** | اگر شعبه‌ای تعطیل یا ادغام شد، آن را غیرفعال کنید. |

-----

## ۳. معماری سیستم: جایگاه شعبه کجاست؟

درک این ساختار درختی برای کاربران و برنامه‌نویسان حیاتی است:

1.  **سطح ۱ (پدر): بانک** (مثلاً: بانک صادرات)
      * *کاربرد:* برندینگ و الگوریتم‌های اعتبارسنجی.
2.  **سطح ۲ (فرزند): شعبه** (مثلاً: شعبه میدان ولیعصر - کد ۱۹۲۰)
      * *کاربرد:* مکان فیزیکی و کدینگ داخلی بانک.
      * *محل تعریف:* همین فرم جاری.
3.  **سطح ۳ (نوه\!): حساب بانکی** (مثلاً: جاری ۰۱۰۰۵۵۵۵)
      * *کاربرد:* موجودیت مالی و حسابداری.

> **نکته فنی:** یک حساب بانکی (`BankAccount`) حتماً باید به یک شعبه (`Branch`) متصل باشد. و آن شعبه حتماً باید به یک بانک (`Bank`) متصل باشد.

-----

## ۴. سناریوهای کاربردی

### سناریو ۱: افتتاح حساب جدید برای شرکت

مدیر مالی حساب جدیدی در "بانک سپه، شعبه بلوار کشاورز" باز کرده است.

1.  ابتدا چک می‌کنیم آیا "بانک سپه" در سیستم هست؟ (اگر نه، در فرم بانک‌ها می‌سازیم).
2.  سپس به فرم **«شعب بانک‌ها»** می‌آییم. بانک سپه را انتخاب و شعبه "بلوار کشاورز" با کد "۱۵۴۰" را تعریف می‌کنیم.
3.  حالا می‌توانیم در فرم "حساب‌های بانکی"، حساب جاری جدید را به این شعبه متصل کنیم.

### سناریو ۲: ثبت چک مشتری (شعبه جدید)

مشتری چکی از "بانک تجارت شعبه بازار فرش" می‌دهد.

  * **روش سخت‌گیرانه:** کاربر ابتدا باید برود شعبه "بازار فرش" را تعریف کند، سپس چک را ثبت کند.
  * **روش منعطف (پیشنهادی):** در فرم ثبت چک، اگر شعبه مهم نیست، کاربر می‌تواند یک شعبه عمومی (مثلاً "شعبه متفرقه") انتخاب کند یا سیستم اجازه دهد نام شعبه را به صورت متنی (بدون نیاز به تعریف در این فرم) تایپ کند.
      * *توصیه:* برای حساب‌های خودِ شرکت، تعریف شعبه **اجباری** است. برای چک‌های مشتریان، معمولاً نام شعبه را به صورت فیلد متنی آزاد (Free Text) در همان فرم چک می‌گیرند تا سرعت کار بالا برود، مگر اینکه ردیابی دقیق جغرافیایی مد نظر باشد.

-----

## ۵. کنترل‌های سیستمی (Validations)

1.  **یکتایی کد در سطح بانک:**
      * بانک `A` می‌تواند شعبه `100` داشته باشد.
      * بانک `B` هم می‌تواند شعبه `100` داشته باشد.
      * اما بانک `A` نمی‌تواند **دو** شعبه با کد `100` داشته باشد.
2.  **وابستگی داده‌ها (Foreign Key Constraint):**
      * اگر حسابی در سیستم دارید که متعلق به "شعبه مرکزی" است، سیستم نباید اجازه دهد شما "شعبه مرکزی" را حذف کنید.

-----

## ۶. پرسش‌های متداول (FAQ)

**س: آیا باید لیست تمام ۳۰۰۰ شعبه بانک ملی در ایران را وارد کنیم؟**

پ: **خیر\!** اصلاً نیازی نیست. شما فقط شعبی را تعریف می‌کنید که:

1.  خودتان در آن حساب دارید.
2.  یا مشتریان کلیدی شما در آن حساب دارند و می‌خواهید آدرس و تلفن آن شعبه را برای پیگیری‌های بعدی داشته باشید.

**س: کد شعبه را از کجا پیدا کنیم؟**

پ: این کد معمولاً روی بالای برگه چک، یا در دفترچه حساب بانکی چاپ شده است. همچنین در لیست شعب سایت اینترنتی بانک‌ها موجود است.

**س: اگر کد شعبه را اشتباه وارد کنیم چه می‌شود؟**

پ: در سیستم داخلی شما اتفاق خاصی نمی‌افتد، اما اگر بخواهید فایل پایا/ساتنا بسازید یا چک را به بانک واگذار کنید، ممکن است مغایرت اطلاعاتی پیش بیاید. پس دقت در ورود کد شعبه (که معمولاً ۴ یا ۵ رقمی است) مهم است.