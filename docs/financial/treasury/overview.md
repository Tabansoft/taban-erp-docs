# ماژول خزانه‌داری (Treasury): اهداف، جایگاه و یکپارچگی

---

## ۱. هدف و تعریف ماژول خزانه‌داری

ماژول خزانه‌داری (Treasury) در ERP تابان، به عنوان **قلب مدیریت نقدینگی** سازمان عمل می‌کند. این ماژول مسئولیت مدیریت، ردیابی، و گزارش‌دهی تمامی وجوه نقد (شامل حساب‌های بانکی و صندوق‌ها) و اسناد بهادار (مانند چک‌های دریافتی و پرداختی) را بر عهده دارد.

هدف اصلی این ماژول، اطمینان از سلامت جریان نقدینگی، بهینه‌سازی منابع مالی و ارائه گزارش‌های دقیق برای تصمیم‌گیری‌های مالی است.

### اهداف کلیدی (Key Objectives)

* **مدیریت نقدینگی (Liquidity Management):** ردیابی دقیق و لحظه‌ای موجودی هر حساب بانکی، صندوق و تنخواه.
* **مدیریت اسناد بهادار (Document Management):** مدیریت کامل چرخه عمر (Lifecycle) چک‌های دریافتی (از دریافت تا واگذاری و وصول) و چک‌های پرداختی (از صدور تا پاس شدن).
* **تسویه حساب (Settlement):** اطمینان از تسویه دقیق فاکتورهای خرید (AP) و فروش (AR) با دریافت‌ها و پرداخت‌های مرتبط.
* **گزارش‌دهی و کنترل (Reporting & Control):** ارائه گزارش‌های حیاتی مانند مغایرت بانکی، جریان وجوه نقد، و وضعیت چک‌ها.

---

## ۲. جایگاه در ساختار سازمانی تابان (بنگاه و مکان)

ماژول خزانه‌داری به شدت به ساختار سازمانی تعریف شده در مستندات پایه تابان وابسته است:

### الف) بنگاه اقتصادی (Legal Entity) و خزانه‌داری

همانطور که در مستندات تابان ذکر شده، **بنگاه اقتصادی** یک موجودیت حقوقی مستقل با گزارش‌های مالی مستقل است.

> **قانون کلیدی خزانه‌داری:** **حساب‌های بانکی** (Bank Accounts) و **دسته چک‌ها** (Checkbooks) در سطح **بنگاه اقتصادی** تعریف و تملک می‌شوند.

* از آنجایی که ترازنامه و صورت‌های مالی در سطح بنگاه اقتصادی تهیه می‌شود، حساب بانکی که یکی از اقلام اصلی دارایی‌های جاری است، باید متعلق به یک بنگاه اقتصادی مشخص باشد.
* **مثال:** اگر «ایران خودرو مرکزی» (کد 1000) و «بخش فروش و بازاریابی» (کد 2000) دو بنگاه اقتصادی جداگانه باشند، هر کدام باید حساب‌های بانکی، دسته چک‌ها و اسناد مالی مجزای خود را در سیستم داشته باشند. نمی‌توان چکی را از حساب بنگاه 1000 برای پرداخت فاکتور بنگاه 2000 (مگر در فرآیندهای مالی بین شرکتی) استفاده کرد.

### ب) مکان عملیاتی (Operating Unit) و خزانه‌داری

**مکان عملیاتی** یک مکان فیزیکی (مانند کارخانه، انبار یا دفتر) است که در آن فرآیندهای لجستیکی و عملیاتی رخ می‌دهد.

> **قانون کلیدی خزانه‌داری:** **صندوق‌ها (Petty Cash)** و **تنخواه‌گردان‌ها** معمولاً در سطح **مکان عملیاتی** مدیریت می‌شوند.

* در حالی که حساب‌های بانکی ماهیت حقوقی دارند، صندوق‌ها ماهیت فیزیکی و مکانی دارند.
* **مثال:** برای پوشش هزینه‌های نقدی روزمره «کارخانه تهران» (مکان عملیاتی 1100) یا «دفتر مرکزی اداری» (مکان 1500)، یک «صندوق» یا «تنخواه» در سیستم تعریف می‌شود که به آن مکان عملیاتی و یک فرد مسئول (تنخواه‌گردان) مرتبط است.

---

## ۳. قانون طلایی: یکپارچگی با حسابداری مالی (FI)

ماژول خزانه‌داری نمی‌تواند و نباید بدون اتصال لحظه‌ای و خودکار به ماژول حسابداری مالی (FI) کار کند.

> **قانون طلایی یکپارچگی:** **هیچ تراکنشی در خزانه‌داری (تغییر موجودی بانک یا صندوق) نباید رخ دهد، مگر آنکه یک سند حسابداری (Journal Entry) معادل و خودکار در دفتر کل (GL) ثبت شود.**

این یکپارچگی از طریق **نگاشت حساب‌ها (Account Mapping)** در تعاریف پایه تضمین می‌شود:

1.  **حساب بانکی:** هر «حساب بانکی» در خزانه‌داری (مثلاً `MEL-100 - بانک ملت مرکزی`) به یک حساب معین در دفتر کل (مثلاً `11010101 - موجودی نقد - بانک ملت`) متصل است.
2.  **صندوق:** هر «صندوق» (مثلاً `PC-10 - صندوق دفتر مرکزی`) به یک حساب معین در دفتر کل (مثلاً `11020101 - صندوق مرکزی`) متصل است.
3.  **طرف حساب:** هر مشتری به حساب معین «حساب‌های دریافتنی» (AR) و هر تأمین‌کننده به «حساب‌های پرداختنی» (AP) متصل است.

---

## ۴. ارتباط جامع با سایر ماژول‌ها (جریان‌های فرآیندی)

ماژول خزانه‌داری، «مجری» نهایی فرآیندهای مالی است که در ماژول‌های دیگر آغاز می‌شوند.

### الف) یکپارچگی با فروش (Sales - SD)

فرآیند فروش (صدور فاکتور) نیاز به «دریافت» وجه را ایجاد می‌کند.

* **فرآیند:** ماژول فروش، «سفارش فروش» و سپس «فاکتور فروش» را صادر می‌کند. این فاکتور یک «آیتم باز» (Open Item) بدهکار در حساب مشتری در ماژول AR (حساب‌های دریافتنی) ایجاد می‌کند.
* **اتصال:** مشتری وجه فاکتور را پرداخت می‌کند (نقدی، چک، یا حواله).
* **عملیات خزانه‌داری:** کاربر یک **«سند دریافت» (Receipt Document)** در خزانه‌داری ثبت می‌کند.
* **مثال (دریافت نقدی بابت فاکتور):**
    * *عملیات:* دریافت 10,000,000 ریال وجه نقد از «مشتری الف» بابت فاکتور `F-901` و واریز به «صندوق مرکزی».
    * *تأثیر خزانه‌داری:* موجودی `صندوق مرکزی` 10,000,000 افزایش می‌یابد.
    * *تأثیر تسویه:* فاکتور `F-901` به وضعیت «تسویه شده» (Cleared) در می‌آید.
    * *سند حسابداری خودکار (FI):*
        * **بدهکار (Debit):** 10,000,000 - `11020101 - صندوق مرکزی` (دارایی (نقد) افزایش یافت)
        * **بستانکار (Credit):** 10,000,000 - `12010101 - حساب‌های دریافتنی - مشتری الف` (دارایی (طلب) کاهش یافت)

### ب) یکپارچگی با خرید و تدارکات (Purchasing - MM)

فرآیند خرید (دریافت فاکتور) نیاز به «پرداخت» وجه را ایجاد می‌کند.

* **فرآیند:** ماژول خرید، «سفارش خرید» (PO) و سپس «فاکتور خرید» (Purchase Invoice) را ثبت می‌کند. این فاکتور یک «آیتم باز» بستانکار در حساب تأمین‌کننده در ماژول AP (حساب‌های پرداختنی) ایجاد می‌کند.
* **اتصال:** شرکت می‌خواهد وجه فاکتور را پرداخت کند.
* **عملیات خزانه‌داری:** کاربر یک **«سند پرداخت» (Payment Document)** در خزانه‌داری ثبت می‌کند.
* **مثال (پرداخت با چک بابت فاکتور):**
    * *عملیات:* صدور چک به مبلغ 50,000,000 ریال از «بانک ملت» در وجه «تأمین‌کننده ب» بابت فاکتور `P-750`.
    * *تأثیر خزانه‌داری:* یک برگ چک از «دسته چک بانک ملت» (مثلاً سریال 1001) از وضعیت «خام» به «صادر شده» (Issued) تغییر می‌کند.
    * *تأثیر تسویه:* فاکتور `P-750` به وضعیت «تسویه شده» در می‌آید.
    * *سند حسابداری خودکار (FI) - در زمان صدور چک:*
        * **بدهکار (Debit):** 50,000,000 - `21010101 - حساب‌های پرداختنی - تأمین‌کننده ب` (بدهی ما تسویه شد)
        * **بستانکار (Credit):** 50,000,000 - `21030101 - اسناد پرداختنی` (یک بدهی جدید (چک) ایجاد شد)
    * *سند حسابداری خودکار (FI) - در زمان پاس شدن چک (از طریق مغایرت بانکی):*
        * **بدهکار (Debit):** 50,000,000 - `21030101 - اسناد پرداختنی` (بدهی چک بسته شد)
        * **بستانکار (Credit):** 50,000,000 - `11010101 - بانک ملت` (موجودی بانک (دارایی) کاهش یافت)

### ج) مدیریت چک و حسابداری (مثال‌های پیچیده)

عملیات داخلی خزانه‌داری نیز مستقیماً با حسابداری در ارتباط است:

* **مثال ۱: واگذاری چک دریافتی به بانک (جهت خواباندن به حساب)**
    * *عملیات:* چکی که قبلاً از مشتری دریافت شده و در «صندوق» (نزد صندوق) نگهداری می‌شد، به «بانک ملت» جهت وصول تحویل داده می‌شود.
    * *تأثیر خزانه‌داری:* وضعیت چک از «نزد صندوق» به «در جریان وصول» (In Collection) تغییر می‌کند.
    * *سند حسابداری خودکار (FI):* (این یک انتقال دارایی است)
        * **بدهکار (Debit):** `11030102 - اسناد در جریان وصول` (حساب واسط بانکی)
        * **بستانکار (Credit):** `11030101 - اسناد دریافتنی (نزد صندوق)`

* **مثال ۲: وصول (پاس شدن) همان چک**
    * *عملیات:* بانک اعلام می‌کند چک مشتری وصول و مبلغ به حساب واریز شد.
    * *تأثیر خزانه‌داری:* وضعیت چک «پاس شده» (Cleared) می‌شود. **موجودی واقعی بانک ملت افزایش می‌یابد.**
    * *سند حسابداری خودکار (FI):*
        * **بدهکار (Debit):** `11010101 - بانک ملت` (موجودی بانک (دارایی) افزایش یافت)
        * **بستانکار (Credit):** `11030102 - اسناد در جریان وصول` (حساب واسط بسته شد)

### د) یکپارچگی داخلی (شارژ تنخواه)

* **فرآیند:** انتقال وجه بین حساب‌های داخلی شرکت.
* **مثال (شارژ صندوق از بانک):**
    * *عملیات:* انتقال 5,000,000 ریال از «بانک ملت» به «صندوق مرکزی» جهت شارژ تنخواه.
    * *تأثیر خزانه‌داری:* موجودی «بانک ملت» 5,000,000 کاهش و موجودی «صندوق مرکزی» 5,000,000 افزایش می‌یابد.
    * *سند حسابداری خودکار (FI):* (این یک جابجایی دارایی است)
        * **بدهکار (Debit):** 5,000,000 - `11020101 - صندوق مرکزی` (دارایی صندوق افزایش یافت)
        * **بستانکار (Credit):** 5,000,000 - `11010101 - بانک ملت` (دارایی بانک کاهش یافت)

---

## ۵. خلاصه جریان اطلاعات (Data Flow Summary)

1.  **ماژول‌های عملیاتی (SD/MM):** فاکتورهای فروش و خرید، **نیاز** به دریافت یا پرداخت را ایجاد می‌کنند.
2.  **ماژول خزانه‌داری (Treasury):** **عملیات** دریافت و پرداخت را از طریق اسناد (نقد، چک، حواله) مدیریت و **اجرا** می‌کند.
3.  **ماژول حسابداری (FI):** **تأثیر مالی** این عملیات را به صورت خودکار در دفتر کل (GL) **ثبت** کرده و مبنای گزارش‌های مالی (ترازنامه، سود و زیان) را فراهم می‌کند.
4.  **ماژول داده‌های پایه (MDM):** اطمینان می‌دهد که این عملیات در چارچوب ساختار سازمانی صحیح (بنگاه اقتصادی و مکان عملیاتی) انجام می‌شود.