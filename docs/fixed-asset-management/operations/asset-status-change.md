# تغییر وضعیت دارایی (Asset Status Change)

**مسیر دسترسی:** `دارایی ثابت > عملیات > تغییر وضعیت`
**نام فنی:** `AssetStatusChange`

## ۱. مقدمه و فلسفه وجودی

دارایی‌های ثابت همیشه در حال کار (Active) نیستند.

* ممکن است یک دستگاه خراب شود و ۶ ماه در تعمیرگاه باشد.
* ممکن است یک خودرو دزدیده شود و وضعیتش نامشخص باشد.
* ممکن است یک خط تولید متوقف شود و ماشین‌آلاتش "راکد" شوند.

ماژول **تغییر وضعیت** وظیفه دارد این تغییرات فیزیکی را به **منطق‌های سیستمی** (مثل توقف استهلاک یا قفل کردن نقل‌وانتقال) ترجمه کند.
بدون این ماژول، گزارشات مالی "دروغ" می‌گویند (مثلاً برای دستگاهی که دزدیده شده، همچنان هزینه استهلاک شناسایی می‌کنند!).

---

## ۲. چرخه حیات و وضعیت‌های استاندارد (State Lifecycle)

ERP تابان از وضعیت‌های استاندارد زیر پشتیبانی می‌کند. هر وضعیت، رفتار سیستم را تغییر می‌دهد:

| وضعیت (Status) | شرح بیزینسی | آیا استهلاک محاسبه می‌شود؟ | آیا قابل انتقال است؟ |
| :--- | :--- | :---: | :---: |
| **فعال (Active)** | وضعیت عادی. دارایی در حال استفاده است. | ✅ بله | ✅ بله |
| **راکد / بلااستفاده (Idle)** | دارایی سالم است اما فعلاً استفاده نمی‌شود (در انبار خوابیده). | ✅ بله (طبق استاندارد ۱۱) | ✅ بله |
| **در دست تعمیر (Under Repair)** | دارایی موقتاً از دسترس خارج شده (نزد تعمیرکار). | ✅ بله (معمولاً) | ❌ خیر (قفل) |
| **نگهداری برای فروش (Held for Sale)** | تصمیم قطعی برای فروش گرفته شده. منتظر خریدار. | ❌ **خیر (متوقف)** | ❌ خیر |
| **مفقود / سرقت (Lost/Stolen)** | دارایی وجود ندارد، اما هنوز از دفاتر حذف نشده (بلاتکلیف). | ❌ **خیر (تعلیق)** | ❌ خیر |
| **اسقاط شده (Scrapped)** | دارایی از دفاتر حذف شده (لاشه). | -- (پایان عمر) | -- |
| **فروخته شده (Sold)** | دارایی از دفاتر حذف شده (خروج). | -- (پایان عمر) | -- |

> **نکته مهم قانونی (ایران):** طبق استانداردهای حسابداری ایران، دارایی **«راکد»** همچنان مستهلک می‌شود (چون فرسودگی ناشی از گذشت زمان دارد)، مگر اینکه رسماً به طبقه **«نگهداری برای فروش»** (مبحث دارایی‌های غیرجاری نگهداری شده برای فروش) منتقل شود.

---

## ۳. منطق عملکردی فرم (Functional Logic)

این فرم صرفاً یک ویرایشگر نیست؛ بلکه یک "تراکنش" (Transaction) است.

### ۳-۱. تاریخ مؤثر (Effective Date)
کاربر باید مشخص کند این تغییر وضعیت **از چه تاریخی** رخ داده است.

* *مثال:* امروز (۱۵ مهر) متوجه شدیم دستگاه از ۱ مهر خراب بوده است.
* **اثر:** موتور استهلاک باید هوشمند باشد و اگر استهلاک مهرماه را حساب کرده، آن را اصلاح (Reverse) کند یا تعدیل نماید.

### ۳-۲. مستندات مثبته
تغییر وضعیت "الکی" نیست! سیستم برای برخی وضعیت‌ها مدرک می‌خواهد:

* تغییر به **سرقت** -> اجبار به آپلود "صورتجلسه پلیس/حراست".
* تغییر به **اسقاط** -> اجبار به آپلود "نظریه کارشناس فنی".
* تغییر به **راکد** -> (در دولتی) اجبار به ثبت در سامانه سادا به عنوان "مازاد".

---

## ۴. جزئیات فرم تغییر وضعیت (Form Details)

| عنوان فیلد | نوع داده | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **شماره سند** | String | قفل | تولید خودکار (مثلاً `STC-1403-101`). |
| **دارایی** | Lookup | بله | انتخاب دارایی (فقط دارایی‌هایی که هنوز در دفاتر موجودند). |
| **وضعیت جاری** | Enum | قفل | وضعیت فعلی را نشان می‌دهد (مثلاً: فعال). |
| **وضعیت جدید** | Enum | بله | انتخاب وضعیت مقصد (مثلاً: راکد). |
| **تاریخ تغییر** | Date | بله | تاریخ وقوع رخداد. |
| **علت تغییر** | Enum | بله | (خرابی فنی، مازاد بر نیاز، دستور مدیریت، سرقت). |
| **توضیحات** | Text | خیر | شرح جزئیات (مثلاً: موتور سوخت و فعلاً قطعه یدکی ندارد). |
| **پیوست‌ها** | File | شرطی | مدارک ضمیمه. |

---

## ۵. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: آماده‌سازی برای مزایده (بخش دولتی/خصوصی)
شرکت تصمیم می‌گیرد ۱۰ خودرو را بفروشد. مزایده ۲ ماه طول می‌کشد.

1.  **اقدام:** تغییر وضعیت خودروها از "فعال" به **"نگهداری برای فروش"**.
2.  **اثر مالی:** سیستم محاسبه استهلاک را برای این خودروها **متوقف** می‌کند (تا ارزش دفتری ثابت بماند و سود/زیان فروش دقیق محاسبه شود).
3.  **اثر عملیاتی:** این خودروها دیگر در لیست "انتقال به پرسنل" نمایش داده نمی‌شوند (قفل می‌شوند).

### سناریوی ۲: سرقت نامشخص (Legal Limbo)
یک لپ‌تاپ از اتاق کنفرانس دزدیده شده. حراست در حال پیگیری است و هنوز دزد پیدا نشده.

1.  **اقدام:** تغییر وضعیت به **"مفقود/سرقت"**.
2.  **اثر مالی:** دارایی از حساب‌های عملیاتی خارج و به "حساب‌های انتظامی" (یا وضعیت تعلیق) می‌رود. استهلاک متوقف می‌شود.
3.  **نتیجه نهایی:** ۶ ماه بعد اگر پیدا شد -> وضعیت برمی‌گردد به "فعال". اگر پیدا نشد -> تغییر وضعیت به "خروج نهایی" (Write-off).

### سناریوی ۳: تعمیرات اساسی (Overhaul)
توربین نیروگاه برای تعمیرات اساسی (اورهال) باز می‌شود و ۳ ماه خاموش است.

1.  **اقدام:** تغییر وضعیت به **"در دست تعمیر"**.
2.  **اثر:** در این مدت جمعدار نمی‌تواند آن را به کسی تحویل دهد.
3.  **نکته:** استهلاک در زمان تعمیرات اساسی (اگر منجر به توقف تولید شود) ممکن است طبق سیاست شرکت متوقف شود یا ادامه یابد. (این یک تنظیم در `Depreciation Profile` است).

---

## ۶. تعامل با سایر بخش‌ها (Integration)

1.  **با ماژول نگهداری و تعمیرات (CMMS):**
    * وقتی در ماژول تعمیرات، یک "دستور کار" (Work Order) باز می‌شود، سیستم می‌تواند به صورت خودکار وضعیت دارایی را در FAM به "در دست تعمیر" تغییر دهد.
    * وقتی تعمیر تمام شد، وضعیت به "فعال" برمی‌گردد.

2.  **با سامانه سادا (بخش دولتی):**
    * اگر وضعیت دارایی دولتی به **"راکد" (مازاد)** تغییر کند، ERP تابان باید این تغییر را از طریق وب‌سرویس به سادا مخابره کند تا وزارت دارایی بداند این دستگاه مازاد است و شاید بخواهد به اداره دیگری منتقل کند.

---

## ۷. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) تاریخچه وضعیت (State History Pattern)
هرگز روی فیلد `Status` در جدول `AssetMaster` دستور `UPDATE` نزنید بدون اینکه سابقه را نگه دارید.

* جدول `AssetStatusHistory` باید تمام تغییرات را با `UserID` و `Timestamp` ذخیره کند.
* این تاریخچه برای گزارش "کارکرد دارایی" (Availability Report) حیاتی است. (دستگاه چند درصد سال در دسترس بوده؟).

### ب) اعتبارسنجی ماتریسی (State Transition Matrix)
همه تغییر وضعیت‌ها مجاز نیستند.

* **غلط:** تغییر از "اسقاط شده" به "فعال" (زنده کردن مرده!).
* **غلط:** تغییر از "فروخته شده" به "راکد".
* **صحیح:** سیستم باید یک ماتریس داشته باشد که بگوید از وضعیت A به کدام وضعیت‌ها می‌توان رفت.

### ج) بازگشت به عقب (Rollback Logic)
اگر کاربری اشتباهاً وضعیت را "سرقت" زد و فردا پشیمان شد:

* باید امکان "ابطال سند تغییر وضعیت" وجود داشته باشد، به شرطی که سند حسابداری نهایی صادر نشده باشد.

---

## ۸. پرسش‌های متداول (FAQ)

**س: تفاوت "راکد" (Idle) با "اسقاط" (Scrapped) چیست؟**

* **پاسخ:**
    * **راکد:** دارایی **سالم** است، فقط فعلاً کاری برایش نداریم. هنوز ارزش دارد و در ترازنامه است.
    * **اسقاط:** دارایی **خراب و غیرقابل استفاده** است (آهن قراضه). باید از ترازنامه خارج شود.

**س: آیا تغییر وضعیت سند حسابداری صادر می‌کند؟**

* **پاسخ:**
    * تغییراتی مثل "فعال به راکد" معمولاً سند مالی ندارند (فقط اثر محاسباتی دارند).
    * اما تغییر به "نگهداری برای فروش" در استانداردهای IFRS ممکن است نیاز به سند تجدید طبقه‌بندی (Reclassification) داشته باشد. در ایران معمولاً سند نمی‌خورد تا لحظه فروش قطعی.

**س: اگر دارایی "در دست تعمیر" باشد، می‌توانیم آن را اموال‌گردانی کنیم؟**

* **پاسخ:** بله، اما در لیست اموال‌گردانی جلوی آن تیک "نزد تعمیرکار" می‌خورد و جمعدار به جای دیدن خودِ کالا، "رسید تعمیرگاه" را اسکن یا رویت می‌کند.