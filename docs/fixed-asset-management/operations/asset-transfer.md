# نقل و انتقال دارایی (Asset Transfer)

**مسیر دسترسی:** `دارایی ثابت > عملیات > نقل و انتقال`
**نام فنی:** `AssetTransferRequest`

## ۱. مقدمه و فلسفه وجودی

در چرخه عمر دارایی، «تحصیل» فقط یک بار اتفاق می‌افتد، اما «انتقال» ممکن است صدها بار رخ دهد. عدم ثبت دقیق انتقالات، منجر به دو فاجعه سازمانی می‌شود:

1.  **فاجعه فیزیکی (گم شدن اموال):** در زمان اموال‌گردانی، دارایی در اتاق X نیست و مسئول اتاق می‌گوید "من دو ماه پیش دادم به واحد تدارکات"، اما هیچ سندی وجود ندارد.
2.  **فاجعه مالی (هزینه اشتباه):** واحد "فروش" از یک پرینتر گران‌قیمت استفاده می‌کند، اما هزینه استهلاک آن هنوز به پای واحد "اداری" نوشته می‌شود. این یعنی سود و زیان مراکز هزینه غلط است.

ماژول نقل و انتقال تابان، فرآیند را از حالت "کاغذی و شفاهی" به یک **"فرآیند دیجیتال با تایید دوطرفه"** تبدیل می‌کند.

---

## ۲. ابعاد انتقال (Dimensions of Transfer)

در ERP تابان، یک انتقال می‌تواند شامل تغییر در یک یا چند بُعد زیر باشد:

### الف) انتقال مسئولیت / جمعداری (Custody Transfer)
* **تغییر:** دارایی از "آقای رضایی" گرفته شده و به "خانم حسینی" تحویل داده می‌شود.
* **اهمیت:** مسئولیت حقوقی حفظ و نگهداری کالا منتقل می‌شود. اگر کالا بشکند، نفر جدید مسئول است.
* **سند خروجی:** صورتجلسه تحویل و تحول (رسید امانی).

### ب) انتقال مکانی (Location Transfer)
* **تغییر:** دارایی از "ساختمان مرکزی - طبقه ۱" به "انبار شماره ۲" می‌رود.
* **اهمیت:** برای تیم اموال‌گردانی و حراست مهم است تا بدانند برای شمارش کالا کجا بروند.

### ج) انتقال مالی / مرکز هزینه (Financial/Cost Center Transfer)
* **تغییر:** دارایی از واحد "تولید" به واحد "آموزش" منتقل می‌شود.
* **اهمیت:** **بسیار حیاتی برای حسابداری.** از ماه آینده، هزینه استهلاک این دستگاه باید از سرفصل "سربار تولید" کسر و به "هزینه‌های اداری/آموزشی" اضافه شود.

---

## ۳. فرآیند "دست‌دهی دیجیتال" (The Handshake Protocol)

در سیستم‌های قدیمی، جمعدار مبدأ فقط ثبت می‌کرد "فرستادم رفت!".
اما در تابان، انتقال یک تراکنش **سه‌مرحله‌ای** است تا هیچ‌کس نتواند زیر بار مسئولیت شانه خالی کند:

1.  **درخواست (Request):** مبدأ (یا مدیر اموال) درخواست انتقال را ثبت می‌کند.
    * *وضعیت دارایی:* `In Transit` (در راه).
2.  **تایید ارسال (Send):** دارایی فیزیکی از اتاق خارج می‌شود.
3.  **تایید دریافت (Acknowledge):** مقصد (تحویل‌گیرنده جدید) در کارتابل خود دکمه **«تحویل گرفتم»** را می‌زند.
    * *تنها در این لحظه است که نام مسئول در "کارت دارایی" تغییر می‌کند.*

> **نکته امنیتی:** تا زمانی که مقصد تایید نکرده، مسئولیت کالا همچنان با فرستنده (یا واحد حمل‌ونقل) است.

---

## ۴. جزئیات فرم انتقال (Form Details)

| عنوان فیلد | نوع داده | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **شماره سند** | String | قفل | تولید خودکار (مثلاً `TRN-1403-500`). |
| **تاریخ انتقال** | Date | بله | تاریخ واقعی جابجایی. (مؤثر در محاسبات استهلاک). |
| **دارایی(ها)** | List | بله | انتخاب یک یا چند پلاک برای انتقال گروهی. |
| **از جمعدار / به جمعدار** | FK | بله | مسئول قدیم و جدید. |
| **از محل / به محل** | FK | بله | لوکیشن قدیم و جدید. |
| **از مرکز هزینه / به مرکز هزینه** | FK | شرطی | اگر انتقال بین واحدی باشد، تغییر مرکز هزینه الزامی است. |
| **علت انتقال** | Enum | خیر | (تعمیرات، تغییر ساختار، مازاد بر نیاز، امانت). |
| **شرح/توضیحات** | Text | خیر | ثبت وضعیت سلامت کالا هنگام تحویل (مثلاً: "پایه صندلی لق است"). |

---

## ۵. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: جابجایی پرسنل (تغییر اتاق)
آقای محمدی از واحد فروش به واحد بازرگانی منتقل می‌شود و لپ‌تاپش را هم با خود می‌برد.

* **نوع انتقال:** فقط "مکان" و "مرکز هزینه" عوض می‌شود. "جمعدار" (خود آقای محمدی) ثابت است.
* **اثر:** هزینه استهلاک لپ‌تاپ از این به بعد پای واحد بازرگانی نوشته می‌شود.

### سناریوی ۲: امانت دادن به بیرون (Lending)
یک پروژه موقت با پیمانکار داریم و ۱۰ عدد تبلت به آن‌ها امانت می‌دهیم.

* **نوع انتقال:** انتقال به "طرف حساب تجاری" (Business Partner).
* **محل جدید:** "محل پیمانکار".
* **جمعدار جدید:** نماینده پیمانکار.
* **نکته:** دارایی همچنان در ترازنامه ماست و استهلاکش محاسبه می‌شود، اما در "لیست اموال موجود در شرکت" فیلتر می‌شود.

### سناریوی ۳: برگشت به انبار (Return to Store)
میز خانم منشی اضافه است و به انبار اسقاط/راکد فرستاده می‌شود.

* **محل جدید:** انبار مرکزی.
* **تحویل گیرنده:** انباردار.
* **وضعیت:** تغییر اتوماتیک وضعیت دارایی از `Active` به `Idle` (راکد).

---

## ۶. اثرات مالی و حسابداری (Accounting Impact)

این بخش مهم‌ترین تفاوت انتقال فیزیکی با انتقال ERP است.

### تغییر مرکز هزینه (Cost Center Change Logic)
اگر دارایی در وسط ماه (مثلاً ۱۵‌م) منتقل شود، هزینه استهلاک آن ماه چطور محاسبه می‌شود؟

سیستم تابان از دو استاندارد پشتیبانی می‌کند (قابل تنظیم در پروفایل):

1.  **استاندارد دقیق (Day-based):**
    * ۱۵ روز اول: هزینه برای مرکز قدیم.
    * ۱۵ روز دوم: هزینه برای مرکز جدید.
2.  **استاندارد ماهانه (Period-based) - رایج در ایران:**
    * اگر انتقال قبل از ۱۵م باشد -> کل ماه برای مرکز جدید.
    * اگر بعد از ۱۵م باشد -> کل ماه برای مرکز قدیم.
    * *یا:* تغییر همیشه از **اول ماه بعد** اعمال شود.

> **نکته:** انتقال معمولاً "سند حسابداری" (Voucher) تولید نمی‌کند، مگر اینکه مراکز هزینه در دو "شعبه مستقل" (Legal Entities) باشند که نیاز به صدور فاکتور داخلی (Inter-company Invoice) داشته باشد.

---

## ۷. تفاوت‌های دولتی و خصوصی

### بخش دولتی (Public Sector)
* **فرم‌های قانونی:** سیستم باید قابلیت چاپ **«فرم ۱۱ اموال»** (حواله انتقالی) و **«فرم ۲۲»** (صورتجلسه تحویل و تحول) را دقیقاً با فرمت وزارت دارایی داشته باشد.
* **تایید ذیحساب:** انتقالات بین ساختمان‌های اصلی، ممکن است نیاز به تایید امین اموال و ذیحساب داشته باشد.

### بخش خصوصی (Private Sector)
* **چابکی:** انتقالات معمولاً با تایید مدیر واحد مبدأ و مقصد انجام می‌شود.
* **تمرکز:** بیشتر روی تغییر "مرکز هزینه" حساس هستند تا بودجه‌بندی واحدها درست دربیاید.

---

## ۸. ملاحظات فنی برای توسعه‌دهندگان

### الف) تاریخچه تغییرناپذیر (Immutable History)
جدول `AssetTransferHistory` باید لاگ کامل را نگه دارد.

* رکورد قبلی در جدول `AssetMaster` پاک نمی‌شود؛ بلکه یک رکورد جدید در جدول هیستوری درج می‌شود.

### ب) انتقال گروهی (Batch Transfer)
کاربر باید بتواند ۱۰۰ صندلی سالن کنفرانس را انتخاب کند و با یک کلیک همه را به سالن شماره ۲ منتقل کند.

* **UI:** قابلیت Multi-select در گرید.
* **Backend:** اجرای تراکنش در یک حلقه (Loop) یا Bulk Insert.

### ج) امضای دیجیتال (Digital Signature)
در نسخه موبایل (اپلیکیشن جمعداری)، تحویل‌گیرنده می‌تواند روی صفحه گوشی امضا کند. تصویر امضا باید در دیتابیس (به عنوان پیوست سند انتقال) ذخیره شود.

---

## ۹. پرسش‌های متداول (FAQ)

**س: اگر دارایی در حین انتقال گم شود چه؟**

* **پاسخ:** وضعیت دارایی در سیستم `In Transit` است. اگر مقصد تحویل نگیرد، مسئولیت با فرستنده یا شرکت حمل‌ونقل است. در نهایت باید سند "مفقودی" ثبت شود.

**س: آیا می‌توانیم دارایی را به یک "واحد سازمانی" بدهیم نه یک "شخص"؟**

* **پاسخ:** در سیستم تابان، هر دارایی باید حتماً یک **مسئول حقیقی** (Person) داشته باشد. حتی اگر به واحد "دبیرخانه" می‌دهید، باید "مسئول دبیرخانه" به عنوان تحویل‌گیرنده ثبت شود. (اموال بدون صاحب ممنوع است).

**س: تاریخ انتقال را می‌توانم در گذشته بزنم؟**

* **پاسخ:**
    * اگر فقط تغییر مکان است: بله.
    * اگر تغییر مرکز هزینه است: فقط تا زمانی که "سند استهلاک" آن دوره صادر نشده باشد. اگر استهلاک خرداد محاسبه و بسته شده، نمی‌توانید انتقالی با تاریخ خرداد ثبت کنید (چون سند هزینه قبلاً صادر شده).