# اموال‌گردانی و ممیزی دارایی (Asset Physical Count)

**مسیر دسترسی:** `دارایی ثابت > عملیات > اموال‌گردانی`
**نام فنی:** `AssetPhysicalInventory`

## ۱. مقدمه و فلسفه وجودی

در طول سال مالی، اتفاقات زیادی می‌افتد: صندلی‌ها بین اتاق‌ها جابجا می‌شوند، یک مانیتور خراب به انبار می‌رود و شاید یک پرینتر دزدیده شود، بدون اینکه کسی در سیستم ثبت کند.
نتیجه؟ **«مغایرت» (Discrepancy)** بین دفاتر حسابداری و واقعیت فیزیکی.

ماژول اموال‌گردانی تابان وظیفه دارد این شکاف را پر کند. این ماژول یک **«عکس فوری» (Snapshot)** از وضعیت موجود می‌گیرد، آن را با دفاتر مقایسه می‌کند و به مدیران می‌گوید چه چیزی کم یا زیاد است.

### اهداف اصلی:
1.  **کشف کسری (Deficit):** دارایی‌هایی که باید باشند، اما نیستند (احتمال سرقت).
2.  **کشف اضافی (Surplus):** دارایی‌هایی که هستند، اما پلاک ندارند یا در سیستم نیستند.
3.  **اصلاح محل استقرار:** به‌روزرسانی مکان واقعی دارایی‌ها.

---

## ۲. چرخه عملیات اموال‌گردانی (The Counting Workflow)

فرآیند اموال‌گردانی در تابان ۴ مرحله استاندارد دارد:

### مرحله ۱: برنامه‌ریزی و ایجاد دوره (Planning)
مدیر اموال یک "دوره شمارش" باز می‌کند.

* **محدوده (Scope):** کل سازمان؟ یا فقط "ساختمان مرکزی"؟ یا فقط "تجهیزات IT"؟
* **تیم شمارش:** چه کسانی مجاز به شمارش هستند؟
* **روش شمارش:**
    * **شمارش باز (Open Count):** شمارشگر لیست دارایی‌های مورد انتظار را در هندهلد می‌بیند.
    * **شمارش کور (Blind Count):** شمارشگر لیست را نمی‌بیند (برای جلوگیری از تقلب) و فقط اسکن می‌کند.

### مرحله ۲: شمارش میدانی (Execution)
تیم شمارش با استفاده از **«اپلیکیشن موبایل تابان»** (روی هندهلد یا گوشی) وارد اتاق‌ها می‌شوند.

1.  بارکد مکان (QR روی درب اتاق) را اسکن می‌کنند.
2.  شروع به اسکن کردن پلاک‌های داخل اتاق می‌کنند (با بارکدخوان یا RFID).
3.  اگر دارایی پلاک نداشت یا مخدوش بود، امکان ثبت دستی یا عکس‌برداری وجود دارد.

### مرحله ۳: مغایرت‌گیری سیستمی (Comparison)
سیستم به صورت اتوماتیک داده‌های اسکن شده را با دیتابیس مقایسه می‌کند و دارایی‌ها را در ۴ دسته قرار می‌دهد:

1.  **تطبیق کامل (Matched):** در سیستم بود، در اتاق هم پیدا شد. ✅
2.  **کسری (Missing/Deficit):** در سیستم باید در این اتاق می‌بود، اما پیدا نشد. ❌
3.  **اضافی (Surplus):** پلاک در این اتاق پیدا شد، اما طبق سیستم باید جای دیگری می‌بود (جابجایی ثبت نشده). ⚠️
4.  **ناشناس (Unknown):** پلاکی اسکن شده که اصلاً در دیتابیس وجود ندارد! ❓

### مرحله ۴: تعیین تکلیف و بستن (Reconciliation)
مدیر گزارش مغایرت را می‌بیند و تصمیم می‌گیرد:

* برای **کسری‌ها**: یا "اعلام مفقودی/سرقت" می‌کند یا "سند خروج" می‌زند.
* برای **اضافی‌ها (جابجا شده)**: سیستم پیشنهاد می‌دهد: *"آیا محل استقرار این‌ها در سیستم به محل جدید آپدیت شود؟"* با یک کلیک، محل اصلاح می‌شود.
* برای **ناشناس‌ها**: دستور پلاک‌کوبی جدید صادر می‌شود.

---

## ۳. جزئیات فرم اموال‌گردانی (Form Details)

این فرم دارای یک "هدر" (تنظیمات دوره) و یک "گرید عملیاتی" (لیست شمارش) است.

| عنوان فیلد | شرح و منطق بیزینسی |
| :--- | :--- |
| **عنوان دوره** | مثلاً: "اموال‌گردانی پایان سال ۱۴۰۲ - ساختمان شماره ۱". |
| **تاریخ شروع/پایان** | بازه زمانی مجاز برای شمارش. |
| **وضعیت دوره** | `برنامه‌ریزی شده` -> `در حال شمارش` -> `تکمیل شده` -> `بسته شده`. |
| **مسئول شمارش** | نام جمعدار یا تیم پیمانکار. |
| **تعداد دفتری** | تعداد کل دارایی‌هایی که سیستم انتظار دارد پیدا کند (مثلاً ۱۰۰۰ عدد). |
| **تعداد شمارش شده** | تعداد واقعی اسکن شده (مثلاً ۹۸۰ عدد). |
| **درصد پیشرفت** | نوار گرافیکی وضعیت پیشرفت شمارش. |

---

## ۴. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: کشف جابجایی خودسرانه (Private Sector)
کارمند واحد فروش، بدون اطلاع جمعدار، صندلی‌اش را با صندلی واحد مالی عوض کرده است.

1.  در اموال‌گردانی واحد مالی، صندلی آقای X پیدا می‌شود.
2.  سیستم هشدار می‌دهد: *"این پلاک متعلق به واحد فروش است ولی در واحد مالی پیدا شد (اضافی در محل)."*
3.  **اقدام:** مدیر تایید می‌کند و سیستم به صورت اتوماتیک محل استقرار را به "واحد مالی" تغییر می‌دهد (انتقال سیستمی).

### سناریوی ۲: سرعت RFID (Public Sector)
یک دانشگاه دولتی با ۱۰,۰۰۰ میز و صندلی. شمارش دستی ۲ ماه طول می‌کشد.

1.  تگ RFID زیر میزها چسبیده است.
2.  جمعدار با هندهلد در راهرو راه می‌رود.
3.  در عرض ۳ روز، کل ۱۰,۰۰۰ قلم خوانده می‌شود.
4.  سیستم لیست ۲۰ میز "کسری" را چاپ می‌کند تا حراست پیگیری کند.

### سناریوی ۳: دارایی‌های مخدوش
جمعدار پلاکی را می‌بیند که بارکدش پاره شده.

1.  در اپلیکیشن موبایل، گزینه "جستجوی دستی" را می‌زند.
2.  شماره پلاک (که عددش خواناست) را وارد می‌کند.
3.  سیستم تایید می‌کند.
4.  جمعدار تیک **"نیاز به چاپ مجدد"** را در اپلیکیشن می‌زند تا بعداً لیبل جدید صادر شود.

---

## ۵. تعامل با سایر بخش‌ها (Integration)

1.  **با اپلیکیشن موبایل (Mobile App):**
    * این ماژول بدون اپلیکیشن تقریباً بی‌معنی است. داده‌ها به صورت آنلاین (Wi-Fi) یا آفلاین (Batch Sync) بین سرور و هندهلد تبادل می‌شوند.

2.  **با حسابداری (GL Adjustment):**
    * اگر در پایان دوره، کسری‌ها تایید شوند (یعنی دزدی یا گم شدن قطعی باشد)، سیستم به ماژول حسابداری فرمان می‌دهد که سند **«زیان ناشی از کسری انبار/اموال»** را صادر کند.

3.  **با ماژول تعمیرات:**
    * اگر جمعدار حین شمارش ببیند دستگاهی خراب است، می‌تواند در همان لحظه در اپلیکیشن، وضعیت "خراب" را ثبت کند تا به کارتابل تعمیرات برود.

---

## ۶. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) فریز کردن موجودی (Inventory Freeze / Snapshot)
این مهم‌ترین چالش فنی است.

* وقتی دکمه "شروع شمارش" زده می‌شود، سیستم باید یک کپی از وضعیت دارایی‌ها (Location فعلی) در جدول `InventorySnapshot` ذخیره کند.
* **چرا؟** چون اگر در حینِ ۳ روز شمارش، کسی در سیستم دارایی جدیدی ثبت کند یا انتقالی انجام دهد، نباید محاسبات مغایرت بهم بریزد. مقایسه همیشه با "لحظه شروع" انجام می‌شود.

### ب) همگام‌سازی آفلاین (Offline Sync)
در زیرزمین‌ها و انبارها معمولاً وای‌فای آنتن نمی‌دهد.

* اپلیکیشن باید دیتابیس داخلی (SQLite/Realm) داشته باشد.
* لیست را دانلود کند، شمارش انجام شود و وقتی به شبکه وصل شد، نتیجه را آپلود کند.

### ج) موقعیت‌یاپی سلسله‌مراتبی (Location Hierarchy)
شمارش باید به تفکیک "اتاق" باشد.

* اگر ۱۰۰ تا صندلی درست باشد اما همگی در اتاق‌های غلط باشند، گزارش کلی می‌گوید "کسری نداریم"، اما گزارش دقیق می‌گوید "۱۰۰٪ جابجایی داریم". سیستم باید دقت در سطح اتاق (Room-Level Accuracy) داشته باشد.

---

## ۷. پرسش‌های متداول (FAQ)

**س: اگر یک دارایی را پیدا کنیم که پلاک ندارد، چه کنیم؟**

* **پاسخ:** در اپلیکیشن گزینه‌ای به نام "ثبت دارایی ناشناس" وجود دارد. شما عکس آن را می‌گیرید و موقتاً ثبت می‌کنید. بعداً مدیر اموال بررسی می‌کند که آیا این دارایی جدید است یا پلاک قدیمش کنده شده است.

**س: آیا حین اموال‌گردانی، عملیات نقل و انتقال در سیستم قفل می‌شود؟**

* **پاسخ:**
    * **روش سخت‌گیرانه (دولتی):** بله، تا پایان شمارش هیچ‌کس حق جابجایی سیستمی ندارد.
    * **روش منعطف (خصوصی):** خیر، اما سیستم هشداری می‌دهد که "این دارایی در لیست شمارش باز است".

**س: چند بار در سال باید اموال‌گردانی کنیم؟**

* **پاسخ:** سیستم محدودیتی ندارد. می‌توانید "اموال‌گردانی پیوسته" (Cycle Counting) داشته باشید؛ یعنی هر هفته فقط ۵٪ اموال را بشمارید، به طوری که در پایان سال همه چیز یک بار شمرده شده باشد. (این روش مدرن و پیشنهادی تابان است).