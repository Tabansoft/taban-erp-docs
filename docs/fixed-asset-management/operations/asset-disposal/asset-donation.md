# اهدا و انتقال بلاعوض (Donation & Gratuitous Transfer)

**مسیر دسترسی:** `دارایی ثابت > عملیات > اهدا و انتقال`
**نام فنی:** `AssetDonationProcess`

## ۱. مقدمه و فلسفه وجودی

چرا یک سازمان باید دارایی خود را رایگان بدهد؟

1.  **بخش دولتی (انتقال بین دستگاهی):** مالکیت تمام اموال دولتی با "حکومت" است. انتقال یک سرور از "وزارت نیرو" به "دانشگاه تهران"، صرفاً جابجایی جیب‌به‌جیب است و پولی نباید رد و بدل شود.
2.  **بخش خصوصی (مسئولیت اجتماعی - CSR):** یک کارخانه تصمیم می‌گیرد اتوبوس قدیمی خود را به مدرسه روستا اهدا کند.
3.  **هلدینگ‌ها (انتقال درون‌گروهی):** جابجایی دارایی بین شرکت مادر و شرکت‌های تابعه.

در ERP تابان، این فرآیند باید طوری مدیریت شود که ضمن خروج دارایی از حساب‌ها، **«مستندات قانونی انتقال»** به دقت ثبت شود. همچنین این ماژول باید هوشمندانه تشخیص دهد که آیا این واگذاری مشمول «مالیات» است یا خیر و آیا نیاز به «مجوز خزانه‌داری» دارد یا خیر.

> **نکته:** این مستند مربوط به **خروج** (اهدا کردن) است. دریافت دارایی اهدایی در بخش "تحصیل دارایی" مدیریت می‌شود.

-----

## ۲. انواع واگذاری و سناریوهای قانونی (Transfer Types)

فیلد **«نوع واگذاری» (`TransferType`)** قلب تپنده این ماژول است. انتخاب هر گزینه، رفتار سیستم (UI و Accounting) را تغییر می‌دهد:

### الف) انتقال به دستگاه‌های اجرایی (`GOV_TRANSFER`)

  * **مرجع قانونی:** مواد ۱۰۶ و ۱۰۷ قانون محاسبات عمومی کشور.
  * **منطق:** اموال از یک امین اموال به امین اموال دستگاه دیگر منتقل می‌شود. هیچ درآمد یا هزینه‌ای شناسایی نمی‌شود.
  * **الزامات:**
      * گیرنده حتماً باید «دستگاه دولتی» باشد.
      * شماره و تاریخ **«مجوز خزانه‌داری»** یا مصوبه هیئت وزیران اجباری است.
      * ارسال به سامانه **سادا** الزامی است.

### ب) اهدا به خیریه / مسئولیت اجتماعی (`CHARITY_DONATION`)

  * **مرجع قانونی:** ماده ۱۷۲ ق.م.م (هزینه‌های قابل قبول) و سیاست‌های CSR.
  * **منطق:** دارایی به یک نهاد غیرانتفاعی (خارج از دولت) واگذار می‌شود.
  * **الزامات:**
      * شناسایی **هزینه/زیان** در دفاتر.
      * محاسبه **مالیات بر ارزش افزوده (VAT)** (چون عرضه کالا به غیر است).
      * کنترل **سقف بودجه مسئولیت اجتماعی** شرکت.

### ج) انتقال درون‌گروهی (`INTER_COMPANY`)

  * **مرجع قانونی:** استانداردهای حسابداری تلفیقی.
  * **منطق:** دارایی از شرکت A به شرکت B (هم‌گروه) منتقل می‌شود.
  * **الزامات:**
      * گیرنده باید در لیست «اشخاص وابسته» باشد.
      * معمولاً انتقال به **ارزش دفتری (NBV)** انجام می‌شود تا سود/زیان کاذب شناسایی نشود.
      * ایجاد حساب‌های بدهی/طلب بین‌شرکتی (Inter-company AR/AP).

-----

## ۳. چرخه عملیات انتقال (The Workflow)

### گام ۱: ثبت درخواست و تعیین نوع

مدیر اموال فرم را باز کرده و «نوع واگذاری» را انتخاب می‌کند. بر اساس نوع، فیلدهای فرم تغییر می‌کنند (مثلاً برای دولتی، فیلد مجوز اجباری می‌شود).

### گام ۲: اخذ مجوز و تاییدات

  * **دولتی:** ثبت شماره نامه خزانه‌داری.
  * **خصوصی:** تایید مدیر مالی (جهت تقبل هزینه VAT و بودجه CSR).

### گام ۳: دستور خروج به انبار (Warehouse Request)

  * سیستم اموال یک درخواست به کارتابل انباردار می‌فرستد.
  * انباردار بر اساس این درخواست، **«حواله خروج انبار» (GIN)** صادر می‌کند.
  * **نکته:** تا زمانی که حواله انبار صادر نشود، دارایی از سیستم اموال خارج نمی‌شود (وضعیت: `Waiting for Warehouse`).

### گام ۴: سند حسابداری و خروج نهایی

با تایید حواله انبار، سیستم اموال به صورت اتوماتیک:

1.  دارایی را `Disposed` (خارج شده) می‌کند.
2.  سند حسابداری نهایی را صادر می‌کند.
3.  (در بخش دولتی) وب‌سرویس سادا را صدا می‌زند.

-----

## ۴. منطق حسابداری (Accounting Logic)

تفاوت حسابداری بر اساس «نوع واگذاری» در اینجا مشخص می‌شود:

### مدل ۱: اهدا به خیریه (بخش خصوصی) - با لحاظ VAT

فرض: دارایی با ارزش دفتری ۱۰۰ ریال اهدا می‌شود. ارزش کارشناسی روز ۱۲۰ ریال است (مبنای محاسبه VAT). نرخ VAT ده درصد.
*شرکت باید ۱۲ ریال مالیات را از جیب بدهد.*

| کد حساب | شرح حساب | بدهکار | بستانکار |
| :--- | :--- | :--- | :--- |
| ۶۱۰ | **هزینه کمک‌های بلاعوض (Expense)** | **۱۱۲** | -- |
| ۱۲۲ | استهلاک انباشته | ۲۰ | -- |
| ۱۲۱ | دارایی ثابت (بهای تمام شده) | -- | ۱۲۰ |
| ۴۲۰ | **مالیات بر ارزش افزوده پرداختنی** | -- | **۱۲** |

### مدل ۲: انتقال بین دستگاهی (بخش دولتی - نظام نوین)

فرض: انتقال از وزارتخانه الف به وزارتخانه ب. (بدون هزینه، بدون مالیات).

| کد حساب | شرح حساب | بدهکار | بستانکار |
| :--- | :--- | :--- | :--- |
| ۳۱۰۱۵ | **تغییرات در ارزش خالص - واگذاری دارایی** | ۲۰ | -- |
| ۱۶۲۲ | استهلاک انباشته | ۸۰ | -- |
| ۱۶۲۱ | دارایی ثابت | -- | ۱۰۰ |

### مدل ۳: انتقال درون‌گروهی (Inter-company)

فرض: انتقال از شرکت مادر به شرکت تابعه به ارزش دفتری.

| کد حساب | شرح حساب | بدهکار | بستانکار |
| :--- | :--- | :--- | :--- |
| ۱۱۴ | **حساب‌های دریافتنی از شرکت‌های گروه** | **۲۰** | -- |
| ۱۲۲ | استهلاک انباشته | ۸۰ | -- |
| ۱۲۱ | دارایی ثابت | -- | ۱۰۰ |

-----

## ۵. جزئیات فرم اهدا (Form Details)

این فرم هوشمند است و بر اساس `TransferType` فیلدها را مدیریت می‌کند.

| عنوان فیلد | نوع | وضعیت | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **نوع واگذاری** | Enum | **الزامی** | `GOV_TRANSFER`, `CHARITY`, `INTER_COMPANY`. (کنترل‌کننده رفتار فرم). |
| **دارایی** | Lookup | **الزامی** | انتخاب پلاک (باید وضعیت فعال/راکد باشد و دست شخص نباشد). |
| **سازمان گیرنده** | Lookup | **الزامی** | اگر نوع دولتی باشد -\> فیلتر روی "دستگاه‌های اجرایی". <br> اگر نوع خیریه باشد -\> فیلتر روی "موسسات". |
| **محل مبدأ (Source)** | Lookup | **نمایشی** | محل فعلی دارایی (مثلاً: انبار مرکزی). جهت اطلاع انباردار برای صدور حواله. |
| **شماره مجوز** | String | **شرطی** | در نوع `GOV_TRANSFER` **اجباری** است. |
| **تاریخ مجوز** | Date | **شرطی** | در نوع `GOV_TRANSFER` **اجباری** است. |
| **شناسه ملی گیرنده** | String | **الزامی** | جهت گزارشات فصلی و سادا. |
| **ارزش کارشناسی** | Money | **شرطی** | در نوع خیریه (برای محاسبه VAT) الزامی است. |
| **پیوست‌ها** | File | **الزامی** | تصویر مجوز، رسید تحویل گیرنده، صورتجلسه هیئت مدیره. |

-----

## ۶. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: ادغام دو شرکت (M\&A)

هلدینگ "تابان" دو شرکت زیرمجموعه (الف و ب) را ادغام می‌کند.

1.  **نوع:** `INTER_COMPANY`.
2.  **عملیات:** استفاده از قابلیت **«انتقال دسته‌ای»**. تمام ۵۰۰۰ قلم دارایی شرکت الف انتخاب و به شرکت ب منتقل می‌شوند.
3.  **مالی:** حساب‌های رابط (Inter-company) درگیر می‌شوند و هیچ سود/زیانی شناسایی نمی‌شود.

### سناریوی ۲: تجهیز مدارس (دولتی)

اداره کل نوسازی مدارس، ۱۰۰ عدد نیمکت را به "دانشگاه آزاد" (که دستگاه مستقل غیردولتی محسوب شود) می‌دهد.

1.  **نوع:** اگر دانشگاه دولتی باشد `GOV_TRANSFER`، اگر نباشد `CHARITY` یا سایر انواع.
2.  **کنترل:** سیستم چک می‌کند آیا مجوز خزانه‌داری برای خروج این اموال وجود دارد؟

-----

## ۷. تعامل با سایر بخش‌ها (Integration)

1.  **با انبار (Warehouse / GIN):**

      * سند اهدا در اموال = **درخواست**.
      * حواله خروج در انبار = **اجرا**.
      * این دو سند با یک `ReferenceID` به هم متصل می‌شوند. تا انباردار حواله نزند، دارایی از لیست اموال کسر نمی‌شود.

2.  **با سامانه سادا (SADA Integration):**

      * در نوع دولتی، پس از ثبت نهایی، وب‌سرویس `TransferAsset` با پارامترهای `SourceID` و `TargetID` فراخوانی می‌شود.

-----

## ۸. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) ماشین وضعیت و اعتبارسنجی (State Machine Validation)

قبل از ثبت سند اهدا، تابع `CanTransfer` باید شرایط زیر را چک کند:

  * دارایی در وضعیت `Active` یا `Idle` باشد.
  * دارایی در وضعیت `Lost`، `Scrapped` یا `Under Repair` **نباید** باشد.
  * **مهم:** دارایی نباید در تحویل **شخص (پرسنل)** باشد. اگر هست، سیستم باید ابتدا درخواست "برگشت از پرسنل به انبار" را پیشنهاد دهد.

### ب) ماتریس فیلدها (UI Matrix)

فرانت‌‌اند باید بر اساس جدول بخش ۵، فیلدهای `Required` و `Hidden` را به صورت پویا مدیریت کند.

### ج) بازگشت‌ناپذیری

وقتی سند انتقال صادر و حواله انبار خورد، بازگرداندن آن در سیستم بسیار پیچیده است. پیام هشدار (`Confirmation Dialog`) باید واضح باشد: *"با تایید این سند، مالکیت دارایی منتقل شده و سند حسابداری قطعی صادر می‌گردد."*

-----

## ۹. پرسش‌های متداول (FAQ)

**س: آیا اهدای دارایی مشمول مالیات بر ارزش افزوده (VAT) است؟**

  * **پاسخ:** بله. در قانون ایران، "عرضه کالا به صورت بلاعوض" به اشخاص ثالث (غیر دولتی) مشمول مالیات است. سیستم تابان این مبلغ را محاسبه و در سند به عنوان بدهی شرکت به سازمان مالیاتی ثبت می‌کند.

**س: اگر مجوز خزانه‌داری هنوز نیامده باشد، می‌توانیم دارایی را بفرستیم؟**

  * **پاسخ:** خیر. سند اهدا نباید ثبت نهایی شود. می‌توانید در انبار یک "حواله امانی" بزنید، اما در سیستم اموال دارایی نباید خارج شود (`Disposed`) تا زمانی که مجوز بیاید.

**س: تفاوت فرم «نقل و انتقال» با «اهدا» چیست؟**

  * **پاسخ:** فرم نقل و انتقال (بخش ۹) برای جابجایی **داخلی** (تغییر اتاق/جمعدار) است و دارایی در ترازنامه می‌ماند. فرم اهدا (بخش ۱۰) برای خروج **بیرونی** است و دارایی از ترازنامه حذف می‌شود.