# فروش و مزایده دارایی (Asset Sale & Auction)

**مسیر دسترسی:** `دارایی ثابت > عملیات > فروش و مزایده`
**نام فنی:** `AssetSaleProcess`

## ۱. مقدمه و تفاوت‌های کلیدی

در ERP تابان، فروش دارایی به دو روش انجام می‌شود:

1.  **فروش مستقیم (Direct Sale):** مشتری مشخص است، قیمت توافق شده و فاکتور صادر می‌شود (معمولاً در بخش خصوصی).
2.  **مزایده عمومی (Public Auction):** خریدار مشخص نیست. دارایی به بالاترین پیشنهاد فروخته می‌شود (الزام قانونی بخش دولتی و شرکت‌های بزرگ).

### چالش اصلی: ارتباط با ماژول فروش (Sales Integration)
آیا برای فروش یک میز کهنه، باید در ماژول فروش "پیش‌فاکتور" و "حواله خروج" صادر کنیم؟

* **پاسخ:**
    * در **سیستم یکپارچه کامل**، بله. زیرا فروش دارایی مشمول **مالیات بر ارزش افزوده (VAT)** است و باید در سامانه مؤدیان ثبت شود.
    * ماژول دارایی ثابت تابان، نقش "تامین‌کننده" را برای ماژول فروش بازی می‌کند.

---

## ۲. چرخه عملیات مزایده (Auction Workflow)

این بخش مخصوص سازمان‌های دولتی و هلدینگ‌های بزرگ است که فروش اموال بدون تشریفات مزایده در آن‌ها ممنوع است.



### گام ۱: قیمت‌گذاری کارشناسی (Evaluation)
قبل از مزایده، دارایی باید توسط کارشناس رسمی دادگستری قیمت‌گذاری شود.

* **فیلد:** `ExpertPrice` (قیمت پایه کارشناسی).
* **کنترل:** قیمت فروش نمی‌تواند از قیمت پایه کمتر باشد (مگر در مزایده نوبت دوم).

### گام ۲: برگزاری مزایده (Auction Event)
یک پرونده مزایده در سیستم باز می‌شود.

* **اقلام:** لیست ۵۰ خودروی مازاد.
* **سپرده شرکت در مزایده:** ثبت ضمانت‌نامه‌ها یا فیش‌های واریزی شرکت‌کنندگان.

### گام ۳: ثبت پاکت‌ها و تعیین برنده (Bidding)
پیشنهادات (پاکت ب) در سیستم ثبت می‌شوند.

* سیستم به صورت اتوماتیک بالاترین قیمت را به عنوان **برنده (Winner)** مشخص می‌کند.
* سپرده نفرات اول و دوم نگهداری و بقیه آزاد می‌شود.

---

## ۳. چرخه فروش و صدور فاکتور (Sales & Invoicing)

پس از مشخص شدن خریدار (چه در مذاکره مستقیم، چه برنده مزایده)، فرآیند مالی آغاز می‌شود:

### مرحله ۱: صدور فاکتور فروش دارایی (Asset Invoice)
یک فاکتور فروش صادر می‌شود که اقلام آن "کالا" نیستند، بلکه "پلاک‌های اموال" هستند.

| شرح کالا | تعداد | مبلغ واحد | مالیات (VAT) | جمع کل |
| :--- | :--- | :--- | :--- | :--- |
| خودروی پژو پارس (پلاک ۱۲۳) | ۱ | ۳,۵۰۰,۰۰۰,۰۰۰ | ۳۵۰,۰۰۰,۰۰۰ | ۳,۸۵۰,۰۰۰,۰۰۰ |

> **نکته:** درآمد حاصل از این فاکتور به حساب "فروش" نمی‌رود، بلکه به حساب واسط **«وجوه حاصل از فروش دارایی»** می‌رود.

### مرحله ۲: دریافت وجه (Receipt)
خریدار مبلغ را واریز می‌کند و سند دریافت در خزانه‌داری ثبت می‌شود.

### مرحله ۳: سند قطعی خروج (Disposal Posting)
پس از تسویه حساب، سیستم سند نهایی خروج را در ماژول اموال صادر می‌کند:

1.  حذف بهای تمام شده دارایی.
2.  حذف استهلاک انباشته.
3.  بستن حساب واسط فروش.
4.  شناسایی **سود/زیان ناشی از واگذاری**.

---

## ۴. منطق حسابداری (Accounting Entries)

بیایید یک سناریوی کامل را بررسی کنیم.

* **دارایی:** بهای تمام شده ۱۰۰ ریال، استهلاک انباشته ۸۰ ریال (ارزش دفتری ۲۰).
* **فروش:** به مبلغ ۳۰ ریال + ۳ ریال مالیات (جمعاً ۳۳ ریال).

### الف) سند فاکتور فروش (در ماژول فروش صادر می‌شود):
| کد حساب | شرح | بدهکار | بستانکار |
| :--- | :--- | :--- | :--- |
| ۱۲۰ | حساب‌های دریافتنی (مشتری) | ۳۳ | -- |
| ۲۲۰ | مالیات بر ارزش افزوده فروش | -- | ۳ |
| **۲۹۰** | **حساب واسط واگذاری دارایی** | -- | **۳۰** |
*(دقت کنید: هنوز دارایی از دفاتر خارج نشده، فقط پول طلبکار شدیم).*

### ب) سند خروج دارایی (در ماژول اموال صادر می‌شود):
| کد حساب | شرح | بدهکار | بستانکار |
| :--- | :--- | :--- | :--- |
| **۲۹۰** | **حساب واسط واگذاری دارایی** | **۳۰** | -- |
| ۱۲۲ | استهلاک انباشته | ۸۰ | -- |
| ۱۲۱ | دارایی ثابت (بهای تمام شده) | -- | ۱۰۰ |
| ۷۰۱ | **سود ناشی از فروش دارایی** | -- | **۱۰** |

*(در اینجا حساب واسط ۲۹۰ صفر می‌شود و سود ۱۰ ریالی شناسایی می‌گردد).*

---

## ۵. جزئیات فرم فروش (Form Details)

این فرم پل ارتباطی بین "اموال" و "فروش" است.

| عنوان فیلد | نوع | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **نوع فروش** | Enum | بله | فروش مستقیم / مزایده. |
| **مشتری** | Lookup | بله | انتخاب مشتری از ماژول CRM/فروش. |
| **شماره مزایده** | String | شرطی | اگر نوع مزایده باشد. |
| **لیست دارایی‌ها** | Grid | بله | انتخاب پلاک‌هایی که فروخته می‌شوند. |
| **مبلغ فروش** | Money | بله | مبلغ توافق شده (بدون مالیات). |
| **هزینه‌های فروش** | Money | خیر | هزینه کارشناسی، آگهی روزنامه، کمیسیون حراج (این هزینه‌ها از سود فروش کسر می‌شوند). |
| **فاکتور رسمی؟** | Bool | بله | آیا نیاز به صدور فاکتور رسمی مالیاتی است؟ |

---

## ۶. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: فروش ضایعاتی (Bulk Scrap Sale)
کارخانه ۱۰۰۰ عدد صندلی و میز شکسته دارد. این‌ها را دانه‌دانه نمی‌فروشد، بلکه "کیلویی" به خریدار ضایعات می‌دهد.

1.  **انتخاب:** انتخاب ۱۰۰۰ پلاک در فرم خروج.
2.  **قیمت‌گذاری:** مبلغ کل قرارداد (مثلاً ۵۰ میلیون تومان) وارد می‌شود.
3.  **تسهیم:** سیستم ۵۰ میلیون را به نسبت ارزش دفتری (یا مساوی) بین ۱۰۰۰ قلم تقسیم می‌کند تا سند حسابداری تراز شود.

### سناریوی ۲: تعویض (Trade-in)
شرکت یک کامیون قدیمی می‌دهد و یک کامیون نو می‌خرد و مابه‌التفاوت را می‌پردازد.

* این عملیات در تابان شامل دو سند جداگانه است:
    1.  **سند فروش:** فروش کامیون قدیمی به شرکت خودروساز (شناسایی سود/زیان).
    2.  **سند خرید:** خرید کامیون نو به قیمت کامل (ثبت دارایی جدید).
* *نکته:* تهاتر مانده حساب مشتری/فروشنده در خزانه‌داری انجام می‌شود.

### سناریوی ۳: مزایده دولتی (سامانه ستاد)
سازمان دولتی اموال را در "سامانه تدارکات الکترونیکی دولت (ستاد)" می‌فروشد.

1.  خروجی اکسل لیست اموال از ERP تابان گرفته می‌شود.
2.  در سامانه ستاد بارگذاری می‌شود.
3.  پس از مشخص شدن برنده در ستاد، نام برنده و مبلغ نهایی در تابان وارد شده و سند خروج صادر می‌شود.

---

## ۷. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) قفل دارایی در حین مزایده (Auction Lock)
وقتی دارایی وارد "لیست مزایده" شد، وضعیت آن باید به `Locked for Auction` تغییر کند.

* در این حالت: نقل و انتقال، تعمیرات، و تغییر وضعیت ممنوع است.
* اگر مزایده برنده نداشت، وضعیت به `Active` یا `Idle` برمی‌گردد.

### ب) محاسبه مالیات (VAT Calculation)
محاسبه مالیات فروش دارایی پیچیده است.

* برخی دارایی‌ها (مثل خودروهای سواری در قانون جدید ایران) معافیت‌های خاص یا نرخ‌های خاص دارند.
* سیستم باید از تنظیمات "گروه مالیاتی دارایی" (Tax Group) استفاده کند، نه تنظیمات عمومی کالا.

### ج) اعتبارسنجی خریدار
در مزایده‌ها، خریدار نباید از "کارکنان دولت" یا "بستگان مدیران" باشد (قانون منع مداخله).

* سیستم می‌تواند کدملی برنده را با لیست سیاه یا لیست پرسنل چک کند و هشدار دهد.

---

## ۸. پرسش‌های متداول (FAQ)

**س: اگر دارایی را به صورت قسطی بفروشیم چه می‌شود؟**

* **پاسخ:** سند خروج همان لحظه تحویل صادر می‌شود و سود شناسایی می‌گردد. اقساط مربوط به ماژول "خزانه‌داری" و پیگیری مطالبات است. خروج دارایی معطل قسط آخر نمی‌ماند.

**س: هزینه‌های برگزاری مزایده (آگهی روزنامه) را چطور ثبت کنیم؟**

* **پاسخ:** این هزینه‌ها در سند خروج به عنوان "هزینه واگذاری" ثبت می‌شوند و مستقیماً از "سود حاصل از فروش" کسر می‌گردند (Net Gain).

**س: اگر برنده مزایده انصراف داد، سپرده‌اش چه می‌شود؟**

* **پاسخ:** سپرده ضبط می‌شود (درآمد متفرقه). سپس سیستم نفر دوم را به عنوان برنده پیشنهاد می‌دهد یا مزایده تجدید می‌شود. دارایی از سیستم خارج نمی‌شود.