# خروج و برکناری دارایی (Asset Disposal & Retirement)

**مسیر دسترسی:** `دارایی ثابت > عملیات > خروج و فروش دارایی`
**نام فنی:** `AssetDisposalTransaction`

## ۱. مقدمه و فلسفه وجودی

یک دارایی به دلایل مختلفی از سازمان خارج می‌شود: شاید فروخته شود، شاید اسقاط شود (آهن قراضه)، شاید دزدیده شود و شاید به سازمان دیگری اهدا گردد.

در حسابداری، به این فرآیند **«برکناری» (Derecognition)** می‌گویند.
سیستم باید در لحظه خروج، محاسبات زیر را انجام دهد:

1.  **توقف استهلاک:** استهلاک تا روز خروج محاسبه شود.
2.  **حذف دفتری:** بهای تمام شده و استهلاک انباشته از حساب‌ها پاک شوند.
3.  **محاسبه سود/زیان:** آیا از فروش این آهن قراضه سود کردیم یا ضرر؟

> **قانون طلایی سیستم:** دارایی خارج شده هرگز حذف (Delete) نمی‌شود؛ بلکه وضعیت آن به `Disposed` تغییر کرده و ارزش دفتری‌اش صفر می‌شود، اما سوابقش برای همیشه باقی می‌ماند.

---

## ۲. سناریوهای خروج (Disposal Scenarios)

ERP تابان ۴ سناریوی اصلی را پوشش می‌دهد که هر کدام منطق حسابداری متفاوتی دارند:

### الف) فروش (Sale)
* **سناریو:** فروش یک خودروی شرکت به شخص ثالث.
* **ویژگی‌ها:** جریان نقدینگی دارد (پول می‌گیریم). مشمول مالیات بر ارزش افزوده (VAT) می‌شود (در بخش خصوصی).
* **خروجی:** شناسایی سود/زیان غیرعملیاتی.

### ب) اسقاط و انهدام (Scrap)
* **سناریو:** یک پرینتر قدیمی که دیگر روشن نمی‌شود و ارزش تعمیر ندارد.
* **ویژگی‌ها:** جریان نقدینگی ندارد (یا بسیار ناچیز به عنوان ضایعات). نیاز به "گواهی فنی اسقاط" دارد.
* **خروجی:** شناسایی زیان (به اندازه ارزش دفتری باقیمانده).

### ج) اهدا / انتقال بلاعوض (Donation / Transfer)
* **سناریو (دولتی):** انتقال تجهیزات از وزارتخانه به یک دانشگاه دولتی.
* **ویژگی‌ها:** پولی رد و بدل نمی‌شود. در بخش دولتی طبق **ماده ۱۰۶ و ۱۰۷ قانون محاسبات عمومی** انجام می‌شود.
* **خروجی:** کاهش سرمایه یا هزینه اهدایا.

### د) مفقودی / سرقت قطعی (Loss / Write-off)
* **سناریو:** لپ‌تاپی که ۶ ماه پیش دزدیده شده و پلیس پرونده را بسته است.
* **ویژگی‌ها:** تبدیل "مفقودی موقت" به "خروج دائم".
* **خروجی:** شناسایی زیان حوادث.

---

## ۳. جریان فرآیند خروج (Disposal Workflow)

خروج دارایی یک تصمیم یک‌نفره نیست. در تابان این فرآیند به صورت "گردش کار" (Workflow) طراحی شده است:

### گام ۱: درخواست خروج (Initiation)
جمعدار یا مدیر واحد فنی، درخواست خروج را ثبت می‌کند.

* *علت:* "هزینه تعمیرات این دستگاه از قیمت نو آن بیشتر است."
* *وضعیت دارایی:* قفل می‌شود (Pending Disposal).

### گام ۲: کارشناسی فنی (Technical Inspection)
کارشناس فنی بازدید می‌کند و تایید می‌کند که "بله، این دستگاه قابل تعمیر نیست". (جلوگیری از فروش دارایی‌های سالم توسط پرسنل).

### گام ۳: تصویب (Approval / Commission)
* **بخش خصوصی:** تایید مدیر مالی و مدیرعامل.
* **بخش دولتی:** طرح در **«کمیسیون ماده ۲ اموال»**. ۳ نفر امضا می‌کنند تا اجازه خروج صادر شود.

### گام ۴: اجرا و صدور سند (Execution)
پس از تایید نهایی، دکمه `Post` فعال می‌شود و سند حسابداری صادر می‌گردد.

---

## ۴. منطق حسابداری و فرمول‌ها (Accounting Logic)

موتور حسابداری تابان برای محاسبه سند خروج از فرمول استاندارد زیر استفاده می‌کند:

**۱. محاسبه ارزش دفتری (NBV):**

$$NBV = \text{Cost} - \text{Accumulated Depreciation}$$

**۲. محاسبه سود/زیان (Gain/Loss):**

$$\text{Gain/Loss} = \text{Proceeds (Sales Price)} - \text{NBV} - \text{Disposal Expenses}$$

### سند حسابداری نمونه (فروش با سود):
فرض کنید دارایی ۱۰۰ واحد خرید شده، ۸۰ واحد مستهلک شده (ارزش دفتری ۲۰). به قیمت ۳۰ فروخته می‌شود.

| کد حساب | شرح حساب | بدهکار (Dr) | بستانکار (Cr) | منطق |
| :--- | :--- | :--- | :--- | :--- |
| ۱۰۱ | **بانک / صندوق** | ۳۰ | -- | پول دریافتی |
| ۱۲۲ | **استهلاک انباشته** | ۸۰ | -- | بستن حساب استهلاک (Reverse) |
| ۱۲۱ | **دارایی ثابت (بهای تمام شده)** | -- | ۱۰۰ | خارج کردن اصل دارایی |
| ۷۰۱ | **سود حاصل از فروش دارایی** | -- | **۱۰** | مابه‌التفاوت (Balancing Figure) |

> **نکته دولتی:** در سیستم نظام نوین مالی، معمولاً سود و زیان شناسایی نمی‌شود و طرف حساب‌ها حساب‌های "ارزش خالص" یا "تغییرات در ارزش" هستند.

---

## ۵. جزئیات فرم خروج (Form Details)

| عنوان فیلد | نوع | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **نوع خروج** | Enum | بله | فروش، اسقاط، اهدا، سرقت. |
| **دارایی** | Lookup | بله | انتخاب پلاک (فقط دارایی‌های فعال). |
| **تاریخ خروج** | Date | بله | تاریخ قطعیت معامله. استهلاک تا این روز محاسبه می‌شود. |
| **مشتری / تحویل‌گیرنده** | FK | شرطی | در حالت فروش یا انتقال، طرف حساب کیست؟ |
| **مبلغ فروش (Proceeds)** | Money | شرطی | مبلغی که فروخته‌ایم (بدون ارزش افزوده). |
| **ارزش افزوده (VAT)** | Money | شرطی | اگر فروش مشمول مالیات باشد. |
| **هزینه‌های خروج** | Money | خیر | هزینه کارشناسی، هزینه حمل تا محل اوراقی، هزینه آگهی روزنامه. |
| **شماره مجوز/سادا** | String | **دولتی** | کد مجوز خزانه‌داری کل کشور (اجباری برای دولتی). |

---

## ۶. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: فروش خودرو (بخش خصوصی)
شرکت یک وانت را می‌فروشد.

1.  کاربر "نوع خروج" را **فروش** انتخاب می‌کند.
2.  سیستم به ماژول "فروش" وصل می‌شود و یک **فاکتور فروش** رسمی صادر می‌کند (جهت محاسبه مالیات و سامانه مؤدیان).
3.  پس از تایید فاکتور، سند خروج دارایی اتوماتیک صادر می‌شود.

### سناریوی ۲: انتقال به انبار اسقاط (Scrap Yard)
۵۰ تا صندلی شکسته داریم. نمی‌فروشیم، فقط می‌خواهیم از اتاق‌ها جمع کنیم و بریزیم در انبار ضایعات.

1.  **نوع:** اسقاط.
2.  **عملیات:** سیستم ارزش دفتری صندلی‌ها را صفر می‌کند (زیان شناسایی می‌کند).
3.  **لجستیک:** همزمان یک "حواله انبار" صادر می‌شود که این اقلام را به عنوان **«کالای ضایعاتی»** (با واحد کیلوگرم) در انبار ضایعات رسید می‌کند. (تبدیل دارایی به موجودی کالا).

### سناریوی ۳: خروج از سادا (بخش دولتی)
اداره کل می‌خواهد یک سرور را به دانشگاه تهران منتقل کند.

1.  ثبت درخواست در تابان.
2.  دریافت "مجوز خروج" از وزارت دارایی.
3.  وارد کردن "شماره مجوز" در فرم خروج.
4.  سیستم تابان از طریق وب‌سرویس به **سامانه سادا** پیام می‌دهد که "پلاک X از لیست اموال این اداره کسر شود".

---

## ۷. تعامل با سایر بخش‌ها (Integration)

1.  **با انبار (Inventory):**
    * در سناریوی اسقاط، دارایی از "اموال" خارج و به "انبار ضایعات" وارد می‌شود.

2.  **با فروش (Sales):**
    * فروش دارایی در بخش خصوصی حتماً باید از طریق ماژول فروش رد شود تا فاکتور رسمی صادر گردد.

3.  **با دفتر کل (GL):**
    * پیچیده‌ترین اسناد حسابداری (مرکب) در این بخش صادر می‌شوند.

---

## ۸. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) چک کردن وابستگی‌ها (Dependency Check)
قبل از خروج، سیستم باید چک کند:

* آیا دارایی "جزء" (Component) دارد؟ (مثلاً مانیتوری که زیرمجموعه کامپیوتر است). اگر والد خارج شود، فرزندان هم باید تعیین تکلیف شوند.
* آیا دارایی در "امانت" کسی است؟

### ب) محاسبه استهلاک میان‌دوره (Partial Depreciation)
اگر دارایی در ۲۰‌م ماه فروخته شود، سیستم باید **اول** استهلاک آن ۲۰ روز را محاسبه و سند بزند، و **سپس** سند خروج را صادر کند.

* اگر این کار انجام نشود، محاسبه سود و زیان غلط می‌شود (چون استهلاک انباشته ۲۰ روز کم بوده).

### ج) برگشت از خروج (Undo Disposal)
اگر معامله فسخ شد چه؟

* پیاده‌سازی `Rollback` برای خروج بسیار سخت است.
* راهکار: صدور یک سند معکوس (Reversal) دستی و فعال‌سازی مجدد دارایی با وضعیت "Active".

---

## ۹. پرسش‌های متداول (FAQ)

**س: اگر دارایی را بفروشیم و سود کنیم، مالیاتش چه می‌شود؟**

* **پاسخ:** سود حاصل از فروش دارایی (Capital Gain) در ایران مشمول مالیات بر درآمد است. سیستم این سود را در سرفصل جداگانه‌ای (۷۰۱) ثبت می‌کند تا ممیز مالیاتی ببیند.

**س: آیا می‌توانیم چند دارایی را یکجا بفروشیم (مزایده فله‌ای)؟**

* **پاسخ:** بله. در فرم خروج، امکان انتخاب "چند پلاک" وجود دارد. کاربر یک "مبلغ کل فروش" وارد می‌کند و سیستم این مبلغ را به نسبت "ارزش دفتری" بین دارایی‌ها تسهیم می‌کند (Pro-rata) تا سود/زیان هر کدام جداگانه دربیاید.

**س: برای دارایی که قبلاً "کاملاً مستهلک شده" (ارزش دفتری = ۰)، سند خروج چطور است؟**

* **پاسخ:**
    * اگر دور انداخته شود: هیچ اثر مالی ندارد (سند حسابداری نیاز نیست، فقط در دفاتر اموال باطل می‌شود).
    * اگر فروخته شود: کل مبلغ فروش، **سود خالص** شناسایی می‌شود.