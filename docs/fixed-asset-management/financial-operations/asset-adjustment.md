# تعدیلات و تغییرات ریالی (Asset Adjustments & Revaluation)

**مسیر دسترسی:** `دارایی ثابت > عملیات مالی > اسناد تعدیل`
**نام فنی:** `AssetAdjustmentTransaction`

## ۱. مقدمه و فلسفه وجودی

یک دارایی ثبت شد، پلاک خورد و استهلاک آن شروع شد. آیا کار تمام است؟ خیر.
ممکن است ۶ ماه بعد:

1.  فاکتور حمل‌ونقل این دارایی تازه به دستمان برسد (افزایش بهای تمام شده).
2.  تورم باعث شود ارزش ساختمان ۱۰ برابر شود (تجدید ارزیابی).
3.  متوجه شویم عمر مفید را اشتباهاً ۱۰ سال زدیم و باید ۸ سال باشد (تغییر برآورد).
4.  موتور دستگاه بسوزد و ارزش آن به شدت افت کند (کاهش ارزش).

ماژول تعدیلات وظیفه دارد این تغییرات را اعمال کند و **اثرات آن را بر استهلاک آینده** محاسبه نماید.

---

## ۲. انواع تعدیلات (Adjustment Types)

در ERP تابان، تعدیلات به ۴ دسته اصلی تقسیم می‌شوند که هر کدام رفتار حسابداری متفاوتی دارند:

### الف) تعدیل بهای تمام شده (Cost Adjustment / Acquisition Adjustment)
* **کاربرد:** اصلاح قیمت خرید اولیه یا اضافه کردن هزینه‌های سرمایه‌ای بعدی (Capital Expenditures).
* **مثال:** نصب یک کولر گازی روی اتاقک نگهبانی (افزایش ارزش ساختمان) یا دریافت تخفیف دیرهنگام از فروشنده (کاهش ارزش).
* **اثر:** `بهای تمام شده جدید = بهای قدیم ± مبلغ تعدیل`.

### ب) تجدید ارزیابی (Revaluation) - *بسیار مهم در ایران*
* **کاربرد:** به‌روزرسانی ارزش دفتری دارایی به "ارزش منصفانه روز" (طبق نظر کارشناس رسمی دادگستری).
* **منطق:** در اقتصاد تورمی، دارایی که ۱۰ سال پیش ۱۰۰ میلیون خریده شده، الان ۱۰ میلیارد می‌ارزد. ترازنامه باید واقعیت را نشان دهد.
* **اثر حسابداری:** مابه التفاوت به حساب **«مازاد تجدید ارزیابی»** (در بخش حقوق صاحبان سهام) می‌رود، نه سود و زیان.

### ج) تغییر برآوردها (Change in Estimate)
* **کاربرد:** تغییر در "عمر مفید"، "نرخ استهلاک" یا "روش استهلاک".
* **منطق:** طبق استاندارد حسابداری، تغییر در برآورد باید **«آتی‌نگر» (Prospective)** باشد. یعنی گذشته را اصلاح نمی‌کنیم، بلکه استهلاک باقیمانده را بر سال‌های باقیمانده جدید سرشکن می‌کنیم.

### د) کاهش ارزش دائمی (Impairment)
* **کاربرد:** وقتی دارایی آسیب جدی می‌بیند یا تکنولوژی آن منسوخ می‌شود.
* **مثال:** یک دستگاه چاپ که مدل جدیدش آمده و دیگر کسی با این مدل کار نمی‌کند. ارزشش نصف می‌شود.
* **اثر:** کاهش فوری ارزش دفتری و شناسایی **«زیان کاهش ارزش»** در صورت سود و زیان.

---

## ۳. منطق محاسباتی (Recalculation Logic)

موتور استهلاک تابان پس از هر تعدیل، باید برنامه استهلاک (Depreciation Schedule) را بازآرایی کند.

**فرمول جدید برای ماه‌های باقی‌مانده:**

$$استهلاک ماهانه جدید = \frac{(ارزش دفتری تعدیل شده - ارزش اسقاط جدید)}{عمر مفید باقی‌مانده}$$

> **مثال:**
> 
> * دارایی ۱۰۰ واحد ارزش داشت. ۵۰ واحد مستهلک شده. (ارزش دفتری: ۵۰). عمر باقیمانده: ۵ سال.
> * **تعدیل:** ۲۰ واحد تعمیر اساسی اضافه شد.
> * **وضعیت جدید:** ارزش دفتری = ۷۰. عمر باقیمانده = ۵ سال.
> * **استهلاک سالانه جدید:** ۷۰ / ۵ = ۱۴ واحد (قبلاً ۱۰ واحد بود).

---

## ۴. جزئیات فرم تعدیل (Form Details)

این فرم شبیه یک سند حسابداری است اما فیلدهای تخصصی اموال دارد.

| عنوان فیلد | نوع | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **نوع تعدیل** | Enum | بله | (افزایش بها، کاهش بها، تجدید ارزیابی، تغییر نرخ، کاهش ارزش). |
| **دارایی** | Lookup | بله | انتخاب پلاک مورد نظر. |
| **تاریخ موثر** | Date | بله | تاریخ اعمال تغییر (مثلاً: تاریخ نامه کارشناس دادگستری). |
| **دفتر استهلاک** | Lookup | بله | این تغییر روی کدام دفتر اعمال شود؟ (معمولاً دفتر مالیاتی). |
| **مبلغ تعدیل** | Money | شرطی | اگر نوع تغییر ریالی باشد (مثلاً +۱۰,۰۰۰,۰۰۰ ریال). |
| **مقدار جدید** | Any | شرطی | اگر نوع تغییر پارامتر باشد (مثلاً عمر مفید جدید: ۱۲ سال). |
| **شرح/دلیل** | Text | بله | علت تعدیل (الزامی برای ممیزی). |
| **سند مرجع** | String | خیر | شماره فاکتور تعمیرات یا شماره نامه کارشناسی. |

---

## ۵. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: تجدید ارزیابی دارایی‌ها (بخش خصوصی/بورسی)
شرکت می‌خواهد سرمایه خود را از محل تجدید ارزیابی افزایش دهد.

1.  کارشناس رسمی، زمین کارخانه را که دفتری ۱ میلیارد است، ۱۰۰ میلیارد قیمت‌گذاری می‌کند.
2.  **ثبت در سیستم:**
    * نوع: تجدید ارزیابی.
    * مبلغ جدید: ۱۰۰,۰۰۰,۰۰۰,۰۰۰ ریال.
3.  **سند حسابداری:**
    * بدهکار: دارایی ثابت (زمین) [۹۹ میلیارد].
    * بستانکار: مازاد تجدید ارزیابی (حقوق صاحبان سهام) [۹۹ میلیارد].
4.  **اثر:** ارزش دارایی در ترازنامه به‌روز می‌شود. (زمین استهلاک ندارد، پس روی سود و زیان اثر ندارد).

### سناریوی ۲: تعمیر اساسی موتور (Capital Repair)
موتور کامیون با هزینه ۵۰ میلیون تعویض شده و باعث شده کامیون ۳ سال بیشتر کار کند.

1.  **ثبت در سیستم:** دو تغییر همزمان.
    * الف) نوع: افزایش بهای تمام شده (۵۰ میلیون).
    * ب) نوع: تغییر عمر مفید (افزایش ۳ سال به عمر باقیمانده).
2.  **نتیجه:** استهلاک ماهانه کامیون مجدداً محاسبه می‌شود.

### سناریوی ۳: اشتباه کاربری (Correction of Error)
حسابدار متوجه می‌شود فاکتور خرید پارسال را ۱۰ میلیون کمتر ثبت کرده است.

1.  **ثبت:** نوع "افزایش بهای تمام شده".
2.  **تاریخ موثر:** چون دوره پارسال بسته شده، تاریخ را "اول سال جاری" می‌زند.
3.  **سیستم:** ۱۰ میلیون به ارزش اضافه می‌کند و استهلاک عقب‌افتاده آن ۱۰ میلیون را (Catch-up) در ماه جاری جبران می‌کند.

---

## ۶. تعامل با سایر بخش‌ها (Integration)

1.  **با ماژول تدارکات (Invoicing):**
    * اگر فاکتوری ثبت شود که نوعش "سربار خرید دارایی" باشد، سیستم می‌تواند مستقیماً فرم تعدیل را باز کند و بپرسد: *"این هزینه حمل مربوط به کدام پلاک است؟"*

2.  **با دفتر کل (GL):**
    * هر نوع تعدیل، کدینگ حسابداری خاص خود را دارد:
        * افزایش بها -> بدهکار: دارایی / بستانکار: حساب‌های پرداختنی.
        * کاهش ارزش (Impairment) -> بدهکار: هزینه کاهش ارزش / بستانکار: ذخیره کاهش ارزش.

---

## ۷. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) اصل تغییر ناپذیری تاریخچه (Immutability of History)
وقتی مبلغ دارایی از ۱۰۰ به ۱۲۰ تغییر می‌کند:

* **نباید** فیلد `AcquisitionCost` را در جدول اصلی `UPDATE` کنید و مقدار قبلی را دور بریزید.
* **باید** یک رکورد در جدول `AssetValueHistory` درج کنید و مقدار "جاری" را آپدیت کنید. ما همیشه باید بتوانیم بگوییم "ارزش این دارایی در سال ۱۴۰۰ چقدر بود".

### ب) اعتبارسنجی منفی نشدن (Negative Value Check)
تعدیل کاهنده نباید باعث شود ارزش دفتری منفی شود.
* اگر ارزش دفتری فعلی ۱۰ میلیون است، کاربر نمی‌تواند ۱۲ میلیون "کاهش بها" ثبت کند.

### ج) ردیابی (Audit Trail)
برای تجدید ارزیابی، حتماً نام کاربر، تاریخ و IP ثبت‌کننده را لاگ کنید. این اسناد به شدت مورد توجه ممیزان مالیاتی است.

---

## ۸. پرسش‌های متداول (FAQ)

**س: تفاوت "تعمیر اساسی" (تعدیل) با "تعمیر جاری" (هزینه) چیست؟**

* **پاسخ:**
    * **تعمیر جاری:** فقط دستگاه را سالم نگه می‌دارد (تعویض روغن). -> ثبت در ماژول هزینه/نت.
    * **تعمیر اساسی:** عمر دستگاه را زیاد می‌کند یا ظرفیت تولید را بالا می‌برد (تعویض موتور). -> ثبت در ماژول تعدیلات (به دارایی اضافه می‌شود).

**س: آیا تجدید ارزیابی باعث می‌شود مالیات بیشتری بدهیم؟**

* **پاسخ:** طبق قوانین ایران، هزینه استهلاکِ ناشی از "مازاد تجدید ارزیابی" معمولاً به عنوان هزینه قابل قبول مالیاتی پذیرفته نمی‌شود (مگر تحت شرایط خاص قانون حداکثر استفاده از توان تولیدی). سیستم تابان باید بتواند این بخش از استهلاک را در گزارشات مالیاتی جدا کند (Permanent Difference).

**س: اگر عمر مفید را کم کنیم، چه می‌شود؟**

* **پاسخ:** استهلاک ماهانه به شدت افزایش می‌یابد (چون ارزش باقیمانده باید در زمان کمتری مستهلک شود). سیستم قبل از ثبت هشدار می‌دهد: *"این کار باعث افزایش چشمگیر هزینه استهلاک این ماه می‌شود."*