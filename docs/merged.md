
# مدیریت نگهداری و تعمیرات (Maintenance & Repair - CMMS)

**کد سند:** `DOC-PM-01`
**نام ماژول:** `PlantMaintenance`

## ۱. مقدمه و فلسفه وجودی

در یک سازمان تجهیز-محور (مانند کارخانه، شرکت حمل‌ونقل یا هتل)، خرابی تجهیزات یعنی **«توقف درآمد»**.
هدف این ماژول تغییر رویکرد سازمان از **«تعمیر پس از خرابی» (Firefighting)** به **«پیشگیری هوشمند» (Preventive)** است.

این ماژول به سه سوال کلیدی پاسخ می‌دهد:

1.  **چه کاری؟** (چه تجهیزاتی نیاز به سرویس دارند؟)
2.  **چه زمانی؟** (برنامه زمان‌بندی یا کارکرد).
3.  **با چه منابعی؟** (کدام قطعه یدکی و کدام تکنسین؟).

---

## ۲. مفاهیم پایه و ساختار داده (Master Data)

### ۲-۱. تجهیز (Equipment) vs دارایی (Asset)
این رایج‌ترین ابهام است. آیا این دو یکی هستند؟

* **دارایی (Asset):** نگاه مالی (پلاک اموال، استهلاک، ارزش دفتری). *مدیر: حسابدار.*
* **تجهیز (Equipment):** نگاه فنی (سریال فنی، نقشه، قطعات یدکی، دما، فشار). *مدیر: مهندس فنی.*
* **رابطه:** معمولاً ۱ به ۱ است، اما گاهی چند تجهیز (موتور، گیربکس) زیرمجموعه یک دارایی (کامیون) هستند.

### ۲-۲. درختواره مکان‌های فنی (Functional Locations)
ساختار سلسله‌مراتبی که نشان می‌دهد تجهیزات کجا نصب شده‌اند.

* کارخانه A -> سالن تولید -> خط بسته‌بندی -> دستگاه پرکن -> **تجهیز هدف (موتور)**.
* *مزیت:* اگر موتور تعویض شود، سوابق خرابی روی "محل دستگاه پرکن" باقی می‌ماند.

### ۲-۳. لیست قطعات (BOM - Bill of Materials)
لیست قطعات یدکی استاندارد برای هر دستگاه.

* مثال برای لیفتراک: (فیلتر روغن، لنت ترمز، تسمه دینام).
* *کاربرد:* تسریع در صدور درخواست کالا از انبار هنگام تعمیر.

---

## ۳. انواع استراتژی‌های تعمیرات (Maintenance Strategies)

سیستم تابان ۳ استراتژی اصلی را پشتیبانی می‌کند:

### الف) تعمیرات اضطراری (Breakdown / Corrective - CM)
* **سناریو:** دستگاه ناگهان خراب می‌شود (دود می‌کند).
* **فرآیند:** درخواست تعمیر -> تعمیر -> راه‌اندازی.
* **هدف:** کاهش زمان توقف (MTTR).

### ب) نت پیشگیرانه (Preventive Maintenance - PM)
* **سناریو:** سرویس‌های دوره‌ای برای جلوگیری از خرابی.
* **انواع:**
    * **مبتنی بر زمان (Time-based):** هر ۳ ماه یکبار.
    * **مبتنی بر عملکرد (Performance-based):** هر ۵۰۰۰ کیلومتر یا هر ۱۰۰۰ ساعت کارکرد.

### ج) نت مبتنی بر وضعیت (Condition-Based - CBM)
* **سناریو:** سنسور لرزش‌سنج هشدار می‌دهد که یاتاقان در حال خراب شدن است. (اتصال به IoT).

---

## ۴. چرخه اصلی کار: دستور کار (The Work Order Cycle)

قلب تپنده این ماژول، سند **«دستور کار» (Work Order)** است.



### گام ۱: درخواست تعمیر (Work Request)
* **کاربر:** اپراتور دستگاه، راننده یا کارمند اداری.
* **داده‌ها:** دستگاه خراب (کولر)، نوع خرابی (چکه می‌کند)، اولویت (فوری).
* **خروجی:** یک درخواست در کارتابل واحد فنی.

### گام ۲: صدور دستور کار (Work Order Creation)
* **کاربر:** برنامه‌ریز نت (Planner).
* **عملیات:** تایید درخواست و تبدیل آن به "دستور کار".
* **تخصیص:** تعیین تکنسین مسئول (آقای فنی)، قطعات مورد نیاز و زمان تخمینی.

### گام ۳: اجرا و ثبت عملکرد (Execution)
* **کاربر:** تکنسین (ترجیحاً روی موبایل).
* **ثبت‌ها:**
    * **زمان:** "من ۲ ساعت روی این دستگاه کار کردم."
    * **قطعه:** "یک واشر از انبار گرفتم و مصرف کردم."
    * **اقدام:** "نشتی لوله تعمیر شد."

### گام ۴: بستن فنی و مالی (Closing)
* دستور کار بسته می‌شود.
* هزینه‌ها محاسبه شده و به مرکز هزینه یا دارایی منتقل می‌شوند.

---

## ۵. جزئیات فرم دستور کار (Work Order Form)

این فرم جامع‌ترین فرم سیستم است که چندین ماژول را درگیر می‌کند.

| عنوان تب | محتوا و فیلدها | منطق بیزینسی |
| :--- | :--- | :--- |
| **هدر (Header)** | شماره، تجهیز، تاریخ شروع، اولویت، وضعیت (باز/بسته). | وضعیت دستگاه (در حال کار / متوقف) در اینجا ثبت می‌شود. |
| **عملیات (Tasks)** | چک‌لیست کارهایی که باید انجام شود (۱. بازدید روغن ۲. آچارکشی). | تکنسین باید این موارد را تیک بزند. |
| **قطعات (Parts)** | لیست قطعات یدکی مصرفی. | اتصال مستقیم به **انبار**. با تایید این تب، "حواله مصرف انبار" صادر می‌شود. |
| **نیروی انسانی (Labor)** | نام تکنسین + ساعت کارکرد. | محاسبه هزینه دستمزد و اتصال به **HR** (اضافه کار). |
| **هزینه (Cost)** | جمع هزینه مواد + دستمزد + پیمانکار. | تصمیم‌گیری برای CapEx یا OpEx (اتصال به **اموال**). |

---

## ۶. موتور نت پیشگیرانه (PM Engine)

این بخش "مغز متفکر" سیستم است که به صورت خودکار دستور کار تولید می‌کند.

### ۶-۱. تعریف برنامه (PM Plan)
کاربر تعریف می‌کند:

* **تجهیز:** دیزل ژنراتور.
* **تکرار:** هر ۱۰۰۰ ساعت کارکرد.
* **فعالیت:** تعویض روغن و فیلتر.

### ۶-۲. ثبت کارکرد (Meter Reading)
سیستم نیاز دارد بداند دستگاه چقدر کار کرده است.

* **روش دستی:** اپراتور هر روز عدد کنتور را وارد می‌کند.
* **روش اتوماتیک:** اتصال به PLC دستگاه.

### ۶-۳. تولید خودکار (Generation)
یک جاب شبانه (Nightly Job) اجرا می‌شود:

* *چک می‌کند:* آخرین سرویس در کارکرد ۴۰۰۰ بوده. الان کنتور ۵۰۰۵ است.
* *نتیجه:* شرط (۱۰۰۰ ساعت) پاس شد.
* *اقدام:* سیستم یک دستور کار "تعویض روغن" ایجاد و به کارتابل تکنسین می‌فرستد.

---

## ۷. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: تعمیرات اساسی (Major Overhaul) - اتصال به اموال
موتور کامیون تعمیر اساسی می‌شود (هزینه: ۲۰۰ میلیون).

1.  دستور کار صادر می‌شود. قطعات و پیمانکار ثبت می‌شوند.
2.  هنگام بستن دستور کار، مدیر فنی تیک **«سرمایه‌ای» (Capitalize)** را می‌زند.
3.  **نتیجه:** سیستم نت یک درخواست به ماژول "اموال" می‌فرستد تا این ۲۰۰ میلیون به بهای تمام شده کامیون اضافه شود.

### سناریوی ۲: تعمیر در محل (Field Service)
یک دستگاه پوز در فروشگاه مشتری خراب شده.

1.  تکنسین با اپلیکیشن موبایل اعزام می‌شود.
2.  لوکیشن تکنسین روی نقشه ثبت می‌شود.
3.  در محل، بارکد دستگاه را اسکن می‌کند، تعمیر را انجام می‌دهد و امضای دیجیتال مشتری را روی گوشی می‌گیرد.
4.  دستور کار بسته می‌شود.

---

## ۸. ملاحظات فنی برای توسعه‌دهندگان

### الف) ماشین وضعیت (State Machine)
وضعیت دستور کار پیچیده است:

`Draft` -> `Released` (منتشر شده برای اجرا) -> `In Process` -> `Work Done` (کار تمام، منتظر تایید) -> `Closed` (مالی بسته شد).
* **نکته:** قطعات انبار فقط در وضعیت `Released` رزرو می‌شوند و در `Work Done` حواله قطعی می‌خورند.

### ب) محاسبه هزینه (Cost Roll-up)
هزینه نهایی دستور کار شامل:

$$Cost = (\Sigma Material \times Price) + (\Sigma Hours \times Rate) + (External Service)$$

این عدد باید دقیق باشد چون مبنای محاسبات بهای تمام شده و دارایی است.

### ج) تقویم منابع (Resource Scheduling)
سیستم نباید به تکنسینی که مرخصی است کار ارجاع دهد. باید به تقویم HR متصل باشد.

---

## ۹. پرسش‌های متداول (FAQ)

**س: تفاوت "درخواست کار" (Request) با "دستور کار" (Order) چیست؟**

* **پاسخ:** "درخواست" یعنی "من یک مشکل دارم" (نیاز). "دستور کار" یعنی "این مشکل را با این روش حل کن" (مجوز اجرا و هزینه). هر درخواستی لزوماً تبدیل به دستور کار نمی‌شود (شاید رد شود).

**س: آیا بدون انبار می‌توانیم نت داشته باشیم؟**

* **پاسخ:** بله، اما فقط مدیریت نیروی انسانی و پیمانکار خواهد بود. مدیریت قطعات یدکی که بخش بزرگی از هزینه‌هاست از دست می‌رود.

**س: شاخص MTTR و MTBF چیست؟**

* **پاسخ:**
    * **MTBF (میانگین زمان بین خرابی‌ها):** نشان می‌دهد دستگاه چقدر "قابل اطمینان" است (هر چه بیشتر، بهتر).
    * **MTTR (میانگین زمان تعمیر):** نشان می‌دهد تیم فنی چقدر "سریع" است (هر چه کمتر، بهتر).
    * *سیستم تابان این‌ها را اتوماتیک محاسبه می‌کند.*

# تعدیلات و تغییرات ریالی (Asset Adjustments & Revaluation)

**مسیر دسترسی:** `دارایی ثابت > عملیات مالی > اسناد تعدیل`
**نام فنی:** `AssetAdjustmentTransaction`

## ۱. مقدمه و فلسفه وجودی

یک دارایی ثبت شد، پلاک خورد و استهلاک آن شروع شد. آیا کار تمام است؟ خیر.
ممکن است ۶ ماه بعد:

1.  فاکتور حمل‌ونقل این دارایی تازه به دستمان برسد (افزایش بهای تمام شده).
2.  تورم باعث شود ارزش ساختمان ۱۰ برابر شود (تجدید ارزیابی).
3.  متوجه شویم عمر مفید را اشتباهاً ۱۰ سال زدیم و باید ۸ سال باشد (تغییر برآورد).
4.  موتور دستگاه بسوزد و ارزش آن به شدت افت کند (کاهش ارزش).

ماژول تعدیلات وظیفه دارد این تغییرات را اعمال کند و **اثرات آن را بر استهلاک آینده** محاسبه نماید.

---

## ۲. انواع تعدیلات (Adjustment Types)

در ERP تابان، تعدیلات به ۴ دسته اصلی تقسیم می‌شوند که هر کدام رفتار حسابداری متفاوتی دارند:

### الف) تعدیل بهای تمام شده (Cost Adjustment / Acquisition Adjustment)
* **کاربرد:** اصلاح قیمت خرید اولیه یا اضافه کردن هزینه‌های سرمایه‌ای بعدی (Capital Expenditures).
* **مثال:** نصب یک کولر گازی روی اتاقک نگهبانی (افزایش ارزش ساختمان) یا دریافت تخفیف دیرهنگام از فروشنده (کاهش ارزش).
* **اثر:** `بهای تمام شده جدید = بهای قدیم ± مبلغ تعدیل`.

### ب) تجدید ارزیابی (Revaluation) - *بسیار مهم در ایران*
* **کاربرد:** به‌روزرسانی ارزش دفتری دارایی به "ارزش منصفانه روز" (طبق نظر کارشناس رسمی دادگستری).
* **منطق:** در اقتصاد تورمی، دارایی که ۱۰ سال پیش ۱۰۰ میلیون خریده شده، الان ۱۰ میلیارد می‌ارزد. ترازنامه باید واقعیت را نشان دهد.
* **اثر حسابداری:** مابه التفاوت به حساب **«مازاد تجدید ارزیابی»** (در بخش حقوق صاحبان سهام) می‌رود، نه سود و زیان.

### ج) تغییر برآوردها (Change in Estimate)
* **کاربرد:** تغییر در "عمر مفید"، "نرخ استهلاک" یا "روش استهلاک".
* **منطق:** طبق استاندارد حسابداری، تغییر در برآورد باید **«آتی‌نگر» (Prospective)** باشد. یعنی گذشته را اصلاح نمی‌کنیم، بلکه استهلاک باقیمانده را بر سال‌های باقیمانده جدید سرشکن می‌کنیم.

### د) کاهش ارزش دائمی (Impairment)
* **کاربرد:** وقتی دارایی آسیب جدی می‌بیند یا تکنولوژی آن منسوخ می‌شود.
* **مثال:** یک دستگاه چاپ که مدل جدیدش آمده و دیگر کسی با این مدل کار نمی‌کند. ارزشش نصف می‌شود.
* **اثر:** کاهش فوری ارزش دفتری و شناسایی **«زیان کاهش ارزش»** در صورت سود و زیان.

---

## ۳. منطق محاسباتی (Recalculation Logic)

موتور استهلاک تابان پس از هر تعدیل، باید برنامه استهلاک (Depreciation Schedule) را بازآرایی کند.

**فرمول جدید برای ماه‌های باقی‌مانده:**

$$استهلاک ماهانه جدید = \frac{(ارزش دفتری تعدیل شده - ارزش اسقاط جدید)}{عمر مفید باقی‌مانده}$$

> **مثال:**
> 
> * دارایی ۱۰۰ واحد ارزش داشت. ۵۰ واحد مستهلک شده. (ارزش دفتری: ۵۰). عمر باقیمانده: ۵ سال.
> * **تعدیل:** ۲۰ واحد تعمیر اساسی اضافه شد.
> * **وضعیت جدید:** ارزش دفتری = ۷۰. عمر باقیمانده = ۵ سال.
> * **استهلاک سالانه جدید:** ۷۰ / ۵ = ۱۴ واحد (قبلاً ۱۰ واحد بود).

---

## ۴. جزئیات فرم تعدیل (Form Details)

این فرم شبیه یک سند حسابداری است اما فیلدهای تخصصی اموال دارد.

| عنوان فیلد | نوع | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **نوع تعدیل** | Enum | بله | (افزایش بها، کاهش بها، تجدید ارزیابی، تغییر نرخ، کاهش ارزش). |
| **دارایی** | Lookup | بله | انتخاب پلاک مورد نظر. |
| **تاریخ موثر** | Date | بله | تاریخ اعمال تغییر (مثلاً: تاریخ نامه کارشناس دادگستری). |
| **دفتر استهلاک** | Lookup | بله | این تغییر روی کدام دفتر اعمال شود؟ (معمولاً دفتر مالیاتی). |
| **مبلغ تعدیل** | Money | شرطی | اگر نوع تغییر ریالی باشد (مثلاً +۱۰,۰۰۰,۰۰۰ ریال). |
| **مقدار جدید** | Any | شرطی | اگر نوع تغییر پارامتر باشد (مثلاً عمر مفید جدید: ۱۲ سال). |
| **شرح/دلیل** | Text | بله | علت تعدیل (الزامی برای ممیزی). |
| **سند مرجع** | String | خیر | شماره فاکتور تعمیرات یا شماره نامه کارشناسی. |

---

## ۵. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: تجدید ارزیابی دارایی‌ها (بخش خصوصی/بورسی)
شرکت می‌خواهد سرمایه خود را از محل تجدید ارزیابی افزایش دهد.

1.  کارشناس رسمی، زمین کارخانه را که دفتری ۱ میلیارد است، ۱۰۰ میلیارد قیمت‌گذاری می‌کند.
2.  **ثبت در سیستم:**
    * نوع: تجدید ارزیابی.
    * مبلغ جدید: ۱۰۰,۰۰۰,۰۰۰,۰۰۰ ریال.
3.  **سند حسابداری:**
    * بدهکار: دارایی ثابت (زمین) [۹۹ میلیارد].
    * بستانکار: مازاد تجدید ارزیابی (حقوق صاحبان سهام) [۹۹ میلیارد].
4.  **اثر:** ارزش دارایی در ترازنامه به‌روز می‌شود. (زمین استهلاک ندارد، پس روی سود و زیان اثر ندارد).

### سناریوی ۲: تعمیر اساسی موتور (Capital Repair)
موتور کامیون با هزینه ۵۰ میلیون تعویض شده و باعث شده کامیون ۳ سال بیشتر کار کند.

1.  **ثبت در سیستم:** دو تغییر همزمان.
    * الف) نوع: افزایش بهای تمام شده (۵۰ میلیون).
    * ب) نوع: تغییر عمر مفید (افزایش ۳ سال به عمر باقیمانده).
2.  **نتیجه:** استهلاک ماهانه کامیون مجدداً محاسبه می‌شود.

### سناریوی ۳: اشتباه کاربری (Correction of Error)
حسابدار متوجه می‌شود فاکتور خرید پارسال را ۱۰ میلیون کمتر ثبت کرده است.

1.  **ثبت:** نوع "افزایش بهای تمام شده".
2.  **تاریخ موثر:** چون دوره پارسال بسته شده، تاریخ را "اول سال جاری" می‌زند.
3.  **سیستم:** ۱۰ میلیون به ارزش اضافه می‌کند و استهلاک عقب‌افتاده آن ۱۰ میلیون را (Catch-up) در ماه جاری جبران می‌کند.

---

## ۶. تعامل با سایر بخش‌ها (Integration)

1.  **با ماژول تدارکات (Invoicing):**
    * اگر فاکتوری ثبت شود که نوعش "سربار خرید دارایی" باشد، سیستم می‌تواند مستقیماً فرم تعدیل را باز کند و بپرسد: *"این هزینه حمل مربوط به کدام پلاک است؟"*

2.  **با دفتر کل (GL):**
    * هر نوع تعدیل، کدینگ حسابداری خاص خود را دارد:
        * افزایش بها -> بدهکار: دارایی / بستانکار: حساب‌های پرداختنی.
        * کاهش ارزش (Impairment) -> بدهکار: هزینه کاهش ارزش / بستانکار: ذخیره کاهش ارزش.

---

## ۷. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) اصل تغییر ناپذیری تاریخچه (Immutability of History)
وقتی مبلغ دارایی از ۱۰۰ به ۱۲۰ تغییر می‌کند:

* **نباید** فیلد `AcquisitionCost` را در جدول اصلی `UPDATE` کنید و مقدار قبلی را دور بریزید.
* **باید** یک رکورد در جدول `AssetValueHistory` درج کنید و مقدار "جاری" را آپدیت کنید. ما همیشه باید بتوانیم بگوییم "ارزش این دارایی در سال ۱۴۰۰ چقدر بود".

### ب) اعتبارسنجی منفی نشدن (Negative Value Check)
تعدیل کاهنده نباید باعث شود ارزش دفتری منفی شود.
* اگر ارزش دفتری فعلی ۱۰ میلیون است، کاربر نمی‌تواند ۱۲ میلیون "کاهش بها" ثبت کند.

### ج) ردیابی (Audit Trail)
برای تجدید ارزیابی، حتماً نام کاربر، تاریخ و IP ثبت‌کننده را لاگ کنید. این اسناد به شدت مورد توجه ممیزان مالیاتی است.

---

## ۸. پرسش‌های متداول (FAQ)

**س: تفاوت "تعمیر اساسی" (تعدیل) با "تعمیر جاری" (هزینه) چیست؟**

* **پاسخ:**
    * **تعمیر جاری:** فقط دستگاه را سالم نگه می‌دارد (تعویض روغن). -> ثبت در ماژول هزینه/نت.
    * **تعمیر اساسی:** عمر دستگاه را زیاد می‌کند یا ظرفیت تولید را بالا می‌برد (تعویض موتور). -> ثبت در ماژول تعدیلات (به دارایی اضافه می‌شود).

**س: آیا تجدید ارزیابی باعث می‌شود مالیات بیشتری بدهیم؟**

* **پاسخ:** طبق قوانین ایران، هزینه استهلاکِ ناشی از "مازاد تجدید ارزیابی" معمولاً به عنوان هزینه قابل قبول مالیاتی پذیرفته نمی‌شود (مگر تحت شرایط خاص قانون حداکثر استفاده از توان تولیدی). سیستم تابان باید بتواند این بخش از استهلاک را در گزارشات مالیاتی جدا کند (Permanent Difference).

**س: اگر عمر مفید را کم کنیم، چه می‌شود؟**

* **پاسخ:** استهلاک ماهانه به شدت افزایش می‌یابد (چون ارزش باقیمانده باید در زمان کمتری مستهلک شود). سیستم قبل از ثبت هشدار می‌دهد: *"این کار باعث افزایش چشمگیر هزینه استهلاک این ماه می‌شود."*

# فرآیند پایان دوره و سال مالی (Period & Year-End Closing)

**مسیر دسترسی:** `دارایی ثابت > عملیات مالی > بستن دوره`
**نام فنی:** `FiscalPeriodClose`

## ۱. مقدمه و فلسفه وجودی

چرا باید دوره را ببندیم؟

1.  **ثبات داده‌ها (Data Consistency):** مدیر مالی گزارش دی‌ماه را به هیئت مدیره داده است. اگر فردا یک کاربر برود و یک دارایی در دی‌ماه ثبت کند، گزارش مدیر دروغ از آب در می‌آید\! بستن دوره یعنی "قفل کردن تاریخچه".
2.  **رعایت اصول حسابداری (Matching Principle):** هزینه‌های هر دوره باید در همان دوره شناسایی شوند. استهلاک دی‌ماه نباید در بهمن ثبت شود.
3.  **انتقال به سال جدید:** در پایان سال، مانده حساب‌ها باید بسته شده و به عنوان "موجودی اول دوره" به سال بعد منتقل شوند.

-----

## ۲. مراحل بستن دوره (The Closing Checklist)

در تابان، بستن دوره (مثلاً پایان شهریور) شامل ۴ گام اجباری است:

### گام ۱: کنترل عملیات باز (Operational Check)

سیستم اجازه بستن دوره را نمی‌دهد اگر کار نیمه‌تمامی وجود داشته باشد.

  * **چک‌لیست خودکار سیستم:**
      * آیا «دارایی پلاک‌گذاری نشده» (Pending) با تاریخ شهریور داریم؟ (باید تعیین تکلیف شود).
      * آیا «درخواست خروج» تایید نشده داریم؟
      * آیا «انتقال» در راه (In Transit) داریم؟

### گام ۲: اجرای استهلاک (Depreciation Run)

  * سیستم چک می‌کند: *"آیا برای تمام دارایی‌های فعال، سند استهلاک شهریور صادر شده است؟"*
  * اگر حتی یک دارایی جا مانده باشد، خطا می‌دهد.

### گام ۳: مغایرت‌گیری با دفتر کل (GL Reconciliation)

این مهم‌ترین گام کنترلی است. سیستم مانده "زیرسیستم اموال" را با مانده "حساب‌های معین در حسابداری" مقایسه می‌کند.

> **فرمول تراز:**
> `(جمع بهای تمام شده در کارت‌های دارایی)` **باید برابر باشد با** `(مانده حساب معین دارایی‌ها در GL)`

  * **اگر اختلاف باشد:** یعنی احتمالا کسی در ماژول حسابداری، دستی سند زده است (که ممنوع است\!). تا اختلاف رفع نشود، دوره بسته نمی‌شود.

### گام ۴: قفل دوره (Hard Close)

وقتی همه چیز تراز شد، کاربر دکمه **«بستن قطعی»** را می‌زند.

  * **نتیجه:** دیگر هیچ کاربری (حتی ادمین) نمی‌تواند سندی با تاریخ "شهریور" یا قبل از آن ثبت، ویرایش یا حذف کند.

-----

## ۳. فرآیند پایان سال مالی (Fiscal Year End)

پایان سال (مثلاً ۲۹ اسفند) پیچیده‌تر از پایان ماه است.

### ۳-۱. عملیات خاص دولتی (Public Sector)

  * **کنترل بودجه:** اعتبارات تملک دارایی‌های سرمایه‌ای در پایان سال می‌سوزند (یا به سنواتی منتقل می‌شوند). سیستم باید چک کند تمام خریدها سند شده باشند.
  * **انبارگردانی:** ثبت نتیجه شمارش پایان سال اجباری است.

### ۳-۲. انتقال مانده (Balance Carry-Forward)

در لحظه تحویل سال:

1.  استهلاک‌های انباشته سال جاری، تجمیع شده و به فیلد "استهلاک انباشته ابتدای دوره" سال بعد اضافه می‌شوند.
2.  ارزش دفتری دارایی‌ها به‌روزرسانی می‌شود.
3.  شمارنده اسناد (اگر تنظیم شده باشد که هر سال از ۱ شروع شود) ریست می‌شود.

-----

## ۴. جزئیات فرم مدیریت دوره‌ها (Form Details)

این فرم معمولاً در اختیار مدیر سیستم یا مدیر مالی است.

| عنوان فیلد | شرح و منطق بیزینسی |
| :--- | :--- |
| **سال مالی** | مثلاً ۱۴۰۲. |
| **دوره (ماه)** | مثلاً ۰۶ (شهریور). |
| **وضعیت دارایی ثابت** | **باز (Open):** ورود اطلاعات مجاز است. <br> **در حال بستن (On Hold):** فقط عملیات اصلاحی مجاز است (ورود جدید ممنوع). <br> **بسته شده (Closed):** هیچ عملیاتی مجاز نیست. |
| **آخرین محاسبه استهلاک** | تاریخ آخرین باری که موتور استهلاک اجرا شده. |
| **وضعیت مغایرت** | سبز (تراز) / قرمز (دارای مغایرت). |
| **کاربر قفل کننده** | چه کسی و در چه ساعتی دوره را بست؟ |

-----

## ۵. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: فاکتور جامانده (Late Invoice)

دوره "دی‌ماه" بسته شده است. تدارکات امروز فاکتوری می‌آورد که تاریخش ۲۸ دی است.

1.  کاربر می‌خواهد دارایی را ثبت کند.
2.  **سیستم خطا می‌دهد:** *"دوره مالی دی‌ماه بسته شده است. تاریخ سند باید در دوره باز (بهمن) باشد."*
3.  **راهکار:** کاربر مجبور است تاریخ ثبت را "۱ بهمن" بزند (حتی اگر فاکتور مال دی باشد)، تا استهلاک از بهمن شروع شود.

### سناریوی ۲: کشف اشتباه در دوره بسته شده (Reopening)

مدیر مالی متوجه می‌شود نرخ استهلاک یک گروه دارایی در ۳ ماه گذشته اشتباه بوده. دوره‌ها بسته شده‌اند.

1.  مدیر ارشد (با دسترسی خاص) دوره را موقتاً **"باز" (Reopen)** می‌کند.
2.  اسناد استهلاک ۳ ماه گذشته را **"معکوس" (Reverse)** می‌کند.
3.  اصلاحات را انجام می‌دهد.
4.  مجدداً محاسبه استهلاک می‌کند و دوره را می‌بندد.

> **نکته:** باز کردن دوره، ردپای حسابرسی (Audit Log) سنگینی به جا می‌گذارد و معمولاً نیاز به مجوز کتبی دارد.

-----

## ۶. تعامل با سایر بخش‌ها (Integration)

1.  **با دفتر کل (General Ledger):**

      * وضعیت دوره‌ها در ماژول دارایی باید با وضعیت دوره‌ها در دفتر کل هماهنگ باشد. معمولاً اول دارایی بسته می‌شود، بعد انبار، و در آخر دفتر کل.

2.  **با انبار (Inventory):**

      * سیستم اجازه نمی‌دهد دوره دارایی بسته شود اگر "حواله انباری" وجود داشته باشد که نوعش "دارایی" است اما هنوز در سیستم اموال ثبت نشده است (Capitalization Pending).

-----

## ۷. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) اعتبارسنجی تاریخ (Global Date Validation)

در تمام فرم‌های سیستم (خرید، فروش، انتقال، استهلاک)، یک تابع مشترک `CheckPeriodStatus(Date)` باید وجود داشته باشد.

  * این تابع قبل از هر `INSERT/UPDATE` چک می‌کند که آیا تاریخ مورد نظر در بازه باز قرار دارد یا خیر.

### ب) اسنپ‌شات پایان سال (Year-End Snapshot)

در لحظه بستن سال، پیشنهاد می‌شود یک کپی کامل از جدول `AssetMaster` در جدول آرشیو (مثلاً `AssetBalances_1402`) ذخیره کنید.

  * این کار باعث می‌شود گزارش‌گیری از سال‌های قبل (مثلاً ۵ سال پیش) بسیار سریع باشد و نیاز به محاسبه معکوس نداشته باشد.

-----

## ۸. پرسش‌های متداول (FAQ)

**س: آیا می‌توانیم برای یک دارایی خاص دوره را باز نگه داریم؟**

  * **پاسخ:** خیر. بستن دوره یک عملیات "سطح کلان" (Global) است. یا برای همه بسته است یا برای همه باز. حسابداری نمی‌تواند تکه‌تکه باشد.

**س: اگر دوره را نبندیم چه می‌شود؟**

  * **پاسخ:** سیستم کار می‌کند، اما ریسک دستکاری اطلاعات بالاست و گزارشات مالی قابل اتکا نیستند. همچنین ممکن است کاربر اشتباهاً برای یک ماه "دو بار" استهلاک بگیرد (اگر کنترل‌ها ضعیف باشند).

**س: تفاوت بستن "ماژولار" با بستن "دفتر کل" چیست؟**

  * **پاسخ:** در ERPهای بزرگ، هر ماژول (انبار، فروش، اموال) جداگانه بسته می‌شود.
      * ابتدا ماژول‌های عملیاتی (Sub-ledgers) بسته می‌شوند تا دیتا فیکس شود.
      * در نهایت ماژول دفتر کل (GL) بسته می‌شود تا ترازنامه بسته شود.

# کارت دارایی (Asset Master Data)

**مسیر دسترسی:** `دارایی ثابت > مدیریت دارایی‌ها > کارت دارایی`
**نام فنی:** `AssetMaster`

## ۱. مقدمه و فلسفه وجودی

کارت دارایی، **«پرونده جامع»** و **«منبع حقیقت» (Single Source of Truth)** برای هر قلم دارایی در سازمان است.
این فرم صرفاً یک صفحه برای نمایش اطلاعات نیست؛ بلکه یک **«داشبورد زنده»** است که وضعیت مالی، فیزیکی و فنی دارایی را در لحظه نشان می‌دهد.

در ERP تابان، کارت دارایی بر اساس اصل **۳۶۰ درجه** طراحی شده است:

1.  **چهره مالی:** چقدر خریدیم؟ چقدر می‌ارزد؟ (برای حسابدار)
2.  **چهره فیزیکی:** کجاست؟ دست کیست؟ (برای جمعدار)
3.  **چهره فنی:** مدلش چیست؟ کی سرویس شده؟ (برای مهندس فنی)

---

## ۲. آناتومی کارت دارایی (Structure & Tabs)

این فرم به دلیل حجم بالای اطلاعات، به چند زبانه (Tab) تقسیم می‌شود.

### ۲-۱. سربرگ (Header) - اطلاعات هویتی
این بخش همیشه ثابت است و تغییر نمی‌کند.

| عنوان فیلد | شرح و منطق بیزینسی |
| :--- | :--- |
| **شماره پلاک (Asset Tag)** | شناسه منحصر‌به‌فرد روی برچسب (مثلاً `IT-1403-005`). لینک اصلی به دنیای فیزیکی. |
| **نام دارایی** | عنوان گویا (مثلاً: لپ‌تاپ ایسوس مدل ZenBook). |
| **گروه دارایی** | لینک به درختواره (مثلاً: تجهیزات رایانه‌ای). *بسیاری از فیلدها را از اینجا به ارث می‌برد.* |
| **وضعیت (Status)** | وضعیت چرخه عمر: `فعال`، `راکد`، `تحت تعمیر`، `آماده فروش`، `اسقاط شده`. |
| **بارکد/سریال** | شماره سریال کارخانه سازنده (S/N) جهت ردیابی گارانتی. |
| **شناسه سادا** | **(مخصوص دولتی)** کد ۱۴ رقمی اموال دولتی که باید به وزارت دارایی گزارش شود. |

---

### ۲-۲. تب مالی و تحصیل (Financial & Acquisition)
اطلاعات ریالی که از "فرم تحصیل" آمده است.

| عنوان فیلد | نوع | شرح |
| :--- | :--- | :--- |
| **تاریخ تحصیل** | Date | روزی که مالک آن شدیم. |
| **تاریخ شروع استهلاک** | Date | معمولاً همان تاریخ تحصیل یا اول ماه بعد (قابل تنظیم). |
| **بهای تمام شده (Cost)** | Money | مبلغ خرید + هزینه‌های نصب. (این عدد ثابت است مگر تجدید ارزیابی شود). |
| **تامین‌کننده** | Link | فروشنده کالا (جهت خدمات پس از فروش). |
| **شماره سند خرید** | Link | لینک به فاکتور خرید یا سند حسابداری تحصیل. |

---

### ۲-۳. تب استهلاک و ارزش‌ها (Depreciation & Values)
این بخش "موتور محاسباتی" کارت است. اگر سازمان چند دفتری باشد، این تب به صورت گرید (جدول) نمایش داده می‌شود.



**ستون‌های جدول برای هر دفتر:**

1.  **نام دفتر:** (مثلاً دفتر مالیاتی).
2.  **روش استهلاک:** (مثلاً نزولی ماده ۱۴۹). *به ارث رسیده از طبقه دارایی.*
3.  **عمر مفید:** (مثلاً ۱۰ سال).
4.  **نرخ:** (مثلاً ۲۵٪).
5.  **ارزش دفتری لحظه‌ای (NBV):** `بهای تمام شده - استهلاک انباشته`. *این عدد زنده است.*
6.  **استهلاک انباشته:** کل پولی که تا امروز مستهلک شده.
7.  **هزینه سال جاری:** استهلاک امسال چقدر بوده؟

---

### ۲-۴. تب استقرار و مسئولیت (Location & Custody)
چه کسی پاسخگوی این دارایی است؟

| عنوان فیلد | شرح |
| :--- | :--- |
| **واحد جمعداری** | واحد سازمانی مسئول (مثلاً جمعداری مرکزی). |
| **محل استقرار** | آدرس فیزیکی دقیق (ساختمان A، طبقه ۲، اتاق ۲۰۵). |
| **تحویل گیرنده (Custodian)** | کارمندی که دارایی را تحویل گرفته (لینک به ماژول HR). |
| **مرکز هزینه (Cost Center)** | **حیاتی برای حسابداری.** هزینه استهلاک به پای کدام واحد نوشته شود؟ (مثلاً واحد فروش). |

> **نکته امنیتی:** این تب معمولاً قفل است و فقط از طریق "فرم نقل و انتقال" تغییر می‌کند تا تاریخچه (History) حفظ شود.

---

### ۲-۵. تب مشخصات فنی (Technical Specs)
این تب کاملاً **پویا (Dynamic)** است و بر اساس "گروه دارایی" تغییر می‌کند.

* اگر گروه "خودرو" باشد -> فیلدهای: شماره شاسی، شماره موتور، نوع سوخت، رنگ.
* اگر گروه "ملک" باشد -> فیلدهای: پلاک ثبتی، متراژ عرصه، متراژ اعیان.

---

### ۲-۶. تب اجزاء (Components) - استاندارد IFRS
برای دارایی‌های پیچیده که از چند بخش تشکیل شده‌اند (Component Accounting).

* **دارایی والد:** کامیون ولوو (پلاک ۱۰۰).
* **اجزاء:**
    * شاسی (پلاک ۱۰۰-۱) -> عمر ۲۰ سال.
    * موتور (پلاک ۱۰۰-۲) -> عمر ۵ سال.
    * لاستیک (پلاک ۱۰۰-۳) -> عمر ۲ سال.

---

## ۳. عملیات روی کارت (Actions)

در بالای فرم کارت دارایی، دکمه‌های عملیاتی وجود دارد که هر کدام یک فرآیند را استارت می‌زنند:

1.  **چاپ لیبل:** ارسال دستور چاپ به لیبل‌زن.
2.  **نقل و انتقال:** باز کردن فرم جابجایی (تغییر اتاق/فرد).
3.  **تغییر وضعیت:** مثلاً اعلام خرابی (تغییر وضعیت به "تحت تعمیر").
4.  **کاردکس گردش:** مشاهده تاریخچه تمام اتفاقات (کی خریده شد؟ کی تعمیر شد؟ کی جابجا شد؟).
5.  **تصاویر/پیوست:** آپلود عکس دارایی، اسکن فاکتور، کارت گارانتی.

---

## ۴. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: ردیابی دارایی مفقوده (دولتی)
حراست یک مانیتور پیدا کرده که پلاک ندارد، اما شماره سریال پشت آن هست.

1.  کاربر وارد لیست کارت دارایی می‌شود.
2.  شماره سریال را سرچ می‌کند.
3.  کارت پیدا می‌شود: "مانیتور ال‌جی، تحویل آقای محمدی، اتاق ۱۰۲".
4.  سیستم نشان می‌دهد که این دارایی در وضعیت "فعال" است (یعنی نباید در راهرو رها شده باشد!).

### سناریوی ۲: هشدار گارانتی (خصوصی)
مدیر فنی می‌خواهد بداند گارانتی کدام سرورها ماه آینده تمام می‌شود.

1.  در کارت دارایی، فیلد "تاریخ پایان گارانتی" (از تب فنی) پر شده است.
2.  گزارشی می‌گیرد از دارایی‌هایی که `WarrantyDate < NextMonth` است.

---

## ۵. تعامل با سایر بخش‌ها (Integration)

1.  **با تعمیرات (Maintenance):**
    * در کارت دارایی، دکمه "تاریخچه تعمیرات" وجود دارد که لیست تمام Work Orderهای صادر شده برای این دستگاه را از ماژول نت می‌خواند.

2.  **با بیمه:**
    * فیلد "شماره بیمه‌نامه" و "تاریخ انقضا" در کارت دارایی، به ماژول قراردادها لینک است.

---

## ۶. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) تاریخچه زمانی (Temporal Data / Audit Log)
کارت دارایی **نباید** فقط آخرین وضعیت را نگه دارد. ما نیاز داریم بدانیم "در تاریخ ۱ خرداد، این دارایی دست چه کسی بود؟".

* **راهکار:** استفاده از جدول `AssetHistory` یا ویژگی `Temporal Tables` در SQL Server. هر تغییری در فیلدهای کلیدی (محل، مسئول، مرکز هزینه) باید یک ورژن جدید در تاریخچه بسازد.

### ب) همزمانی (Concurrency)
اگر دو جمعدار هم‌زمان بخواهند یک دارایی را ویرایش کنند (مثلاً یکی محل را عوض کند، دیگری مسئول را)، سیستم باید از مکانیزم `Optimistic Locking` (چک کردن ورژن رکورد) استفاده کند تا تغییرات یکدیگر را بازنویسی نکنند.

### ج) ایندکس‌گذاری (Indexing)
چون جستجو روی این جدول بسیار زیاد است (با پلاک، با نام، با سریال، با تحویل‌گیرنده)، ایندکس‌های دیتابیس باید روی این ستون‌ها بهینه باشند.

---

## ۷. پرسش‌های متداول (FAQ)

**س: آیا می‌توانم نام دارایی را بعد از پلاک‌کوبی عوض کنم؟**

* **پاسخ:** بله، نام و توضیحات قابل ویرایش هستند. اما فیلدهای مالی (مثل بهای تمام شده) قفل هستند و فقط با "سند تعدیل" تغییر می‌کنند.

**س: اگر یک دارایی دزدیده شود، کارت آن را حذف کنیم؟**

* **پاسخ:** **هرگز!** در سیستم‌های مالی چیزی حذف نمی‌شود. شما وضعیت آن را به **«مفقود شده»** تغییر می‌دهید. دارایی همچنان در سیستم هست اما استهلاک آن متوقف می‌شود و در لیست اموال‌گردانی با رنگ قرمز نمایش داده می‌شود.

**س: شناسه سادا (دولتی) را از کجا بیاوریم؟**

* **پاسخ:** این شناسه توسط وب‌سرویس وزارت دارایی یا فایل اکسل مرجع ارائه می‌شود. در ERP تابان، کاتالوگ سادا بارگذاری شده و کاربر فقط کالا را انتخاب می‌کند تا کد ۱۴ رقمی در کارت بنشیند.

# گروه‌بندی دارایی‌های ثابت (Fixed Asset Categories)

**مسیر دسترسی:** `دارایی ثابت > پیکربندی > گروه‌های دارایی`
**نام فنی:** `AssetCategory`

## ۱. مقدمه و فلسفه وجودی

اگر سیستم دارایی ثابت را به یک «کتابخانه بزرگ» تشبیه کنیم، **گروه‌بندی دارایی‌ها** نقش «قفسه‌بندی و سیستم ده‌دهی دیویی» را بازی می‌کند. بدون یک ساختار درختی و منظم، مدیریت هزاران قلم دارایی (از یک خودکار تا یک توربین نیروگاهی) غیرممکن خواهد بود.

در ERP تابان، گروه‌بندی دارایی صرفاً یک «فولدر‌بندی» ساده جهت گزارش‌گیری نیست؛ بلکه یک **«ساختار هوشمند وراثتی» (Intelligent Inheritance Structure)** است. این یعنی وقتی شما قانونی را روی «سرشاخه» تعریف می‌کنید، تمام «زیرشاخه‌ها» و دارایی‌های متصل به آن، آن قانون را به ارث می‌برند.

### اهداف کلیدی این ماژول:

1.  **ارث‌بری ویژگی‌ها (Inheritance):** جلوگیری از ورود اطلاعات تکراری. (مثلاً همه خودروها عمر مفید ۱۰ سال دارند).
2.  **مدیریت مشخصات فنی (Dynamic Attributes):** تعریف ویژگی‌های منحصر‌به‌فرد برای هر نوع کالا (مثلاً خودرو نیاز به «شماره شاسی» دارد و لپ‌تاپ نیاز به «مدل CPU»).
3.  **تولید خودکار پلاک (Tagging logic):** تعیین پیشوند پلاک اموال بر اساس گروه (مثلاً پلاک‌های IT با `CMP` شروع شوند).

-----

## ۲. منطق سلسله‌مراتبی و ارث‌بری (Hierarchy & Inheritance Logic)

ساختار گروه‌ها در تابان به صورت **درختی (Tree Structure)** و نامحدود است. اما برای حفظ نظم، پیشنهاد می‌شود حداکثر تا ۴ سطح پیش بروید.

### اصل ارث‌بری (The Inheritance Rule)

قوی‌ترین ویژگی این فرم، منطق ارث‌بری است. تنظیماتی مثل «روش استهلاک»، «عمر مفید» و «مشخصات فنی» از والد به فرزند منتقل می‌شوند، مگر اینکه در سطح فرزند بازنویسی (Override) شوند.

> **مثال:**
>
>   * **سطح ۱ (والد):** گروه "تجهیزات رایانه‌ای" (عمر مفید: ۳ سال).
>       * **سطح ۲ (فرزند):** گروه "سرورها" (عمر مفید: ۵ سال - *بازنویسی شد*).
>       * **سطح ۲ (فرزند):** گروه "پرینترها" (عمر مفید: *همان ۳ سال والد را می‌گیرد*).

-----

## ۳. بخش‌های عملیاتی فرم (Form Details)

این فرم از دو بخش اصلی تشکیل شده است: **اطلاعات عمومی** و **مشخصات پویا**.

### ۳-۱. اطلاعات عمومی (General Info)

| عنوان فیلد (UI) | نام فنی (DB) | نوع داده | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :---: | :--- |
| **نام گروه** | `Name` | String | بله | عنوان نمایشی (مثلاً: وسایل نقلیه سنگین). |
| **کد گروه** | `Code` | String | بله | کد یونیک جهت گزارش‌گیری و تولید پلاک (مثلاً: `VEH-HVY`). |
| **گروه والد** | `ParentID` | FK | خیر | اگر خالی باشد، به عنوان "ریشه" (Root) در نظر گرفته می‌شود. |
| **طبقه دارایی پیش‌فرض** | `DefaultAssetClassID` | FK | خیر | اتصال به کدینگ حسابداری. هر دارایی که در این گروه ساخته شود، اتوماتیک این کلاس مالی را می‌گیرد. |
| **دنباله پلاک** | `TagSequenceID` | FK | خیر | تعیین می‌کند که شمارنده پلاک برای این گروه از چه عددی شروع شود (مثلاً سری ۵۰۰۰). |
| **پیشوند پلاک** | `TagPrefix` | String | خیر | کاراکتری که اول پلاک چاپ می‌شود (مثلاً `IT-` برای تجهیزات آی‌تی). |

-----

### ۳-۲. مشخصات فنی پویا (Dynamic Attributes)

این بخش نقطه تمایز یک ERP قدرتمند است. دارایی‌های مختلف، دیتای متفاوتی نیاز دارند. ما نمی‌توانیم در دیتابیس صدها ستون خالی ایجاد کنیم.
در این تب، ادمین سیستم تعریف می‌کند که **"هر کس دارایی‌ای از این گروه ایجاد کرد، باید چه سوالاتی را پاسخ دهد؟"**

**انواع داده قابل تعریف برای مشخصات:**

1.  **متنی (Text):** مثل "شماره موتور"، "رنگ".
2.  **عددی (Number):** مثل "ظرفیت موتور (cc)"، "تعداد سیلندر".
3.  **تاریخ (Date):** مثل "تاریخ انقضای گارانتی"، "تاریخ تعویض روغن".
4.  **لیست کشویی (Select):** مثل "نوع سوخت" (بنزینی/دیزلی).
5.  **بولی (Checkbox):** مثل "آیا دزدگیر دارد؟".

> **نکته ارث‌بری:** اگر در گروه والدِ "خودروها"، مشخصه "شماره شاسی" را تعریف کنید، تمام زیرگروه‌ها (سواری، کامیون، موتورسیکلت) این فیلد را خواهند داشت.

-----

## ۴. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: پیاده‌سازی کدینگ اموال دولتی (سادا)

در بخش دولتی، گروه‌بندی باید منطبق بر استاندارد وزارت دارایی باشد.

  * **گروه اصلی:** اموال منقول
      * **زیرگروه ۱:** وسایل نقلیه
          * **زیرگروه ۲:** زمینی
              * **زیرگروه ۳:** سواری (کد سادا: ۲۵۱۰۱)
                  * *مشخصات پویا:* شماره شاسی، شماره موتور، VIN.

### سناریوی ۲: مدیریت تجهیزات کارخانه (بخش خصوصی)

یک کارخانه نساجی می‌خواهد دستگاه‌هایش را مدیریت کند.

  * **گروه:** ماشین‌آلات تولیدی
      * **پیش‌فرض استهلاک:** روش نزولی (۱۰٪).
      * **پیش‌فرض پلاک:** شروع با `MAC-`.
      * **مشخصات پویا:**
          * توان مصرفی (عدد).
          * کشور سازنده (لیست).
          * تاریخ آخرین کالیبراسیون (تاریخ).

-----

## ۵. تعامل با سایر بخش‌ها (Integration)

1.  **هنگام ثبت دارایی جدید:**

      * کاربر ابتدا "گروه" را انتخاب می‌کند (مثلاً لپ‌تاپ).
      * سیستم بلافاصله فرم را تغییر می‌دهد و فیلدهای "CPU" و "RAM" را نشان می‌دهد (چون در گروه لپ‌تاپ تعریف شده‌اند).
      * سیستم کد حسابداری "تجهیزات رایانه‌ای" را پیش‌فرض انتخاب می‌کند.

2.  **هنگام پلاک‌کوبی:**

      * سیستم به تنظیمات گروه نگاه می‌کند: "پیشوند `LP` + شمارنده `۱۰۰۱`".
      * پلاک نهایی: `LP-1001`.

-----

## ۶. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) ساختار دیتابیس (Adjacency List vs. Nested Set)

برای ذخیره ساختار درختی، با توجه به اینکه عمق درخت دارایی‌ها معمولاً کم است، روش **Adjacency List** (رفرنس به ParentID) همراه با **CTE (Common Table Expressions)** برای کوئری‌های بازگشتی (Recursive) پیشنهاد می‌شود.

```sql
TABLE AssetCategory (
    ID INT PK,
    ParentID INT NULL FK,
    Name NVARCHAR(100),
    Lineage NVARCHAR(MAX) -- مثال: /1/5/12/ برای جستجوی سریع
);
```

### ب) ذخیره‌سازی مشخصات پویا (EAV vs. JSON)

برای ذخیره مقادیر ویژگی‌ها (Attributes)، دو رویکرد وجود دارد. برای ERP تابان، استفاده از **JSON** در دیتابیس‌های مدرن (SQL Server / PostgreSQL) توصیه می‌شود.

  * **تعریف الگو (در گروه):**
    ```json
    { "Attribute": "CPU", "Type": "String", "Required": true }
    ```
  * **ذخیره مقدار (در دارایی):**
    ```json
    { "CPU": "Core i7", "RAM": "16GB" }
    ```

### ج) اعتبارسنجی چرخشی (Circular Dependency Check)

سیستم باید هنگام ذخیره گروه، چک کند که یک گروه نمی‌تواند والدِ خودش یا والدِ پدرش باشد (جلوگیری از حلقه بی‌نهایت).

-----

## ۷. پرسش‌های متداول (FAQ)

**س: آیا می‌توانم یک دارایی را هم‌زمان در دو گروه قرار دهم؟**

  * **پاسخ:** خیر. هر دارایی باید دقیقاً **یک** والد (گروه) داشته باشد تا تکلیف ارث‌بری و حسابداری آن مشخص شود. اما می‌توانید از "تگ‌ها" (Tags) برای دسته‌بندی‌های جانبی استفاده کنید.

**س: اگر تنظیمات گروه را تغییر دهم (مثلاً عمر مفید را زیاد کنم)، آیا دارایی‌های قدیمی هم تغییر می‌کنند؟**

  * **پاسخ:** به صورت پیش‌فرض **خیر**. تغییرات روی دارایی‌های "جدید" اعمال می‌شود. برای اعمال روی قدیمی‌ها، باید یک "Batch Update" (بروزرسانی گروهی) اجرا کنید که سیستم معمولاً قبل از آن هشدار می‌دهد.

**س: تفاوت «گروه دارایی» با «طبقه دارایی» چیست؟**

  * **پاسخ:**
      * **گروه (Category):** جنبه **عملیاتی و فنی** دارد (درختواره، مشخصات فنی، پلاک).
      * **طبقه (Class):** جنبه **مالی و حسابداری** دارد (کدینگ حساب، نرخ مالیاتی).
      * *ارتباط:* هر گروه می‌تواند به یک طبقه لینک شود.

# طبقه دارایی (Asset Classes)

**مسیر دسترسی:** `دارایی ثابت > پیکربندی > طبقه‌های دارایی`
**نام فنی:** `AssetClass`

## ۱. مقدمه و فلسفه وجودی

در یک سیستم ERP یکپارچه، بزرگترین چالش، جدا کردن «پیچیدگی‌های حسابداری» از «کاربران عملیاتی» است.
جمعدار اموال (که مسئول فیزیک کالا است) لزوماً کدینگ حسابداری را نمی‌شناسد و نباید هم بشناسد. او فقط می‌داند که یک «خودرو» خریده است.

ماژول **طبقه دارایی** وظیفه دارد این دانش را در خود کپسوله کند. این ماژول به سیستم می‌گوید:

> *"هر وقت کسی دارایی‌ای از نوع **«وسایل نقلیه»** ثبت کرد، تو خودکار برو و در سند حسابداری، حساب معین **۱۲۱۰۱** را بدهکار کن و برای استهلاکش از حساب **۶۰۱۰۱** استفاده کن."*

### تفاوت کلیدی با «گروه دارایی» (Group vs. Class)

این رایج‌ترین سوال کاربران است:

  * **گروه (Category):** جنبه **عملیاتی و درختی** دارد. (مثال: لپ‌تاپ‌های گیمینگ، صندلی‌های چرخ‌دار). هدف: ارث‌بری مشخصات فنی و پلاک‌کوبی.
  * **طبقه (Class):** جنبه **مالی و مسطح** دارد. (مثال: تجهیزات رایانه‌ای، اثاثیه اداری). هدف: تعیین کدهای حسابداری و نرخ استهلاک مالیاتی.

> **نکته:** ممکن است ۱۰ «گروه» مختلف (لپ‌تاپ، سرور، پرینتر، اسکنر، مودم) همگی به ۱ «طبقه» واحد (تجهیزات رایانه‌ای) متصل باشند، چون از نظر حسابداری همه در یک سرفصل ثبت می‌شوند.

-----

## ۲. منطق نگاشت حسابداری (GL Mapping Logic)

مهم‌ترین وظیفه این فرم، ایجاد جدول نگاشت (Mapping Table) بین موجودیت‌های دارایی و کدهای دفتر کل (General Ledger) است.

این نگاشت تعیین می‌کند که موتور صدور سند (GL Engine) در هر رویداد چه آرتیکلی صادر کند:

| نوع حساب (Account Type) | کاربرد در سند | مثال کدینگ (بخش خصوصی) | مثال کدینگ (بخش دولتی/نظام نوین) |
| :--- | :--- | :--- | :--- |
| **بهای تمام شده (Asset Cost)** | هنگام خرید (تحصیل) | ۱۲۱۰۱ (وسایل نقلیه) | ۱۳۱۰۱ (دارایی ثابت-نقلیه) |
| **استهلاک انباشته (Accumulated Depr)** | هنگام محاسبه استهلاک | ۱۲۲۰۱ (ا.ا وسایل نقلیه) | ۱۳۲۰۱ (ا.ا وسایل نقلیه) |
| **هزینه استهلاک (Depr Expense)** | ماهانه (سود و زیان) | ۶۰۱۰۱ (هزینه استهلاک عملیاتی) | ۵۴۱۰۱ (هزینه استهلاک) |
| **مازاد تجدید ارزیابی (Revaluation Surplus)** | هنگام افزایش قیمت کارشناسی | ۳۱۵۰۱ (مازاد تجدید ارزیابی) | ۳۱۰۱۰ (تغییرات ارزش) |
| **سود/زیان واگذاری (Disposal Gain/Loss)** | هنگام فروش دارایی | ۷۰۱۰۲ (سود ناشی از فروش دارایی) | -- (معمولاً مستقیم به ارزش خالص) |

-----

## ۳. بخش‌های عملیاتی فرم (Form Details)

این فرم دارای دو بخش اصلی تنظیمات است:

### ۳-۱. اطلاعات عمومی و مالیاتی

| عنوان فیلد | شرح و منطق بیزینسی |
| :--- | :--- |
| **نام طبقه** | عنوان مالی (مثلاً: "تاسیسات و تجهیزات"). |
| **کد طبقه** | کد یونیک (مثلاً `CLS-005`). |
| **روش استهلاک پیش‌فرض** | **حیاتی.** روشی که طبق قانون مالیات‌ها (ماده ۱۴۹) یا استاندارد حسابداری مجاز است. <br> گزینه‌ها: *خط مستقیم، نزولی، نزولی هندسی، تعداد تولید.* |
| **عمر مفید / نرخ** | اگر روش خطی است: "۱۰ سال". اگر نزولی است: "۲۵ درصد". |
| **ارزش اسقاط (Salvage Value)** | درصد پیش‌فرض ارزش اسقاط (مثلاً در ایران معمولاً صفر در نظر می‌گیرند، اما در صنایع خاص ۱۰٪ است). |

### ۳-۲. نگاشت حساب‌ها (GL Accounts)

در این تب، کاربر باید برای هر سناریو، یک حساب معین انتخاب کند.

> **هوشمندی سیستم:** اگر پروفایل سازمان **«دولتی»** باشد، فیلدهای مربوط به "سود/زیان فروش" مخفی می‌شوند (چون کاربرد ندارند) و فیلدهای مربوط به "دارایی‌های انتقالی" فعال می‌شوند.

-----

## ۴. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: شرکت تولیدی (بخش خصوصی) - تفکیک مراکز هزینه

یک کارخانه می‌خواهد استهلاک ماشین‌آلات خط تولید را جدا از استهلاک کولرهای ساختمان اداری ببیند.

  * **تعریف طبقه ۱:** `ماشین‌آلات تولیدی`

      * حساب هزینه: **۶۰۲۰۰** (سربار ساخت - هزینه استهلاک).

  * **تعریف طبقه ۲:** `تجهیزات اداری`

      * حساب هزینه: **۶۰۱۰۰** (هزینه‌های اداری - هزینه استهلاک).

  * **نتیجه:** وقتی استهلاک ماهانه محاسبه می‌شود، سیستم به طور خودکار هزینه ماشین‌آلات را به "بهای تمام شده کالای ساخته شده" می‌برد و هزینه کولرها را به "سود و زیان اداری".

### سناریوی ۲: سازمان دولتی - الزام سادا

یک اداره کل باید کدینگ نظام نوین مالی را رعایت کند.

  * **تعریف طبقه:** `ساختمان‌ها و مستحدثات`
      * حساب دارایی: ۱۱۱۰۱ (ساختمان).
      * حساب طرف مقابل تحصیل: ۳۱۰۱۱ (تغییرات در ارزش خالص - تملک دارایی). *\<-- تفاوت مهم با بخش خصوصی که طرف مقابل "بانک/بستانکاران" است.*

-----

## ۵. تعامل با سایر بخش‌ها (Integration)

1.  **هنگام تعریف گروه دارایی:**

      * ادمین سیستم وقتی گروه "پژو پارس" را می‌سازد، آن را به طبقه "وسایل نقلیه" لینک می‌کند.
      * از این لحظه به بعد، هر پژویی که خریده شود، اتوماتیک سند حسابداری "وسایل نقلیه" می‌خورد.

2.  **هنگام بستن حساب‌ها (Period Close):**

      * موتور استهلاک برای هر دارایی نگاه می‌کند که به کدام "طبقه" وصل است.
      * حساب "هزینه" و "استهلاک انباشته" را از آن طبقه می‌خواند و سند می‌زند.

-----

## ۶. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) قفل کردن طبقه (Validation Rule)

سیستم نباید اجازه دهد کاربری «طبقه‌ای» را حذف کند که حتی **یک** دارایی فعال به آن متصل است. این کار باعث خرابی سندهای حسابداری آینده می‌شود (Orphaned Assets).

### ب) تغییر حساب در میانه سال (Audit Trail Risk)

اگر کاربر حساب معینِ یک طبقه را عوض کند (مثلاً حساب هزینه را از ۶۰۱ به ۶۰۲ تغییر دهد):

  * **رفتار سیستم:** تغییر باید فقط روی اسناد **آینده** اعمال شود. اسناد صادر شده قبلی نباید تغییر کنند (History Preservation).
  * **هشدار:** سیستم باید یک پیام هشدار جدی نمایش دهد: *"تغییر کد حساب باعث عدم یکنواختی در تراز آزمایشی امسال خواهد شد."*

### ج) جدول پیشنهادی (Schema)

```sql
TABLE AssetClass (
    ID INT PK,
    Name NVARCHAR(100),
    DepreciationMethod Enum (StraightLine, Declining, ...),
    UsefulLife INT,
    DecayRate DECIMAL, -- برای روش نزولی
    -- GL Accounts References
    GL_AssetCost_ID INT FK,
    GL_AccumDepr_ID INT FK,
    GL_DeprExpense_ID INT FK,
    GL_RevalSurplus_ID INT FK,
    GL_DisposalGainLoss_ID INT FK
);
```

-----

## ۷. پرسش‌های متداول (FAQ)

**س: آیا می‌توانم برای یک دارایی خاص، حساب متفاوتی نسبت به طبقه‌اش تعریف کنم؟**

  * **پاسخ:** در ERPهای استاندارد، **خیر**. این کار یکپارچگی سیستم را به هم می‌زند. اگر نیاز به حساب متفاوت دارید، باید یک «طبقه جدید» تعریف کنید (مثلاً "وسایل نقلیه لوکس").

**س: اگر نرخ مالیاتی تغییر کرد (قانون عوض شد) چه کنیم؟**

  * **پاسخ:** شما تنظیمات طبقه را ویرایش می‌کنید. سیستم برای دارایی‌های جدید نرخ جدید را اعمال می‌کند. برای دارایی‌های قدیم، باید فرآیند "تغییر پارامترهای استهلاک" (Depreciation Adjustment) را اجرا کنید.

**س: چرا "گروه دارایی" را مستقیماً به حساب‌ها وصل نکردیم؟ چرا موجودیت جدیدی به نام "طبقه" ساختیم؟**

  * **پاسخ:** چون "گروه‌ها" ممکن است خیلی ریز و تو در تو باشند (۱۰ سطح درختی). وصل کردن حساب به تک‌تک آن‌ها کابوس مدیریت است. "طبقه" یک لایه تجمیعی (Abstraction Layer) است که مدیریت مالی را ساده می‌کند.

# مدیریت بارکد و RFID (Asset Tagging System)

**مسیر دسترسی:** `دارایی ثابت > پیکربندی > تنظیمات چاپ و لیبل`
**نام فنی:** `AssetIdentificationSystem`

## ۱. مقدمه و فلسفه وجودی

در سیستم‌های مدرن، تایپ کردن دستی شماره اموال منسوخ شده است.
هدف این ماژول تبدیل **«پلاک اموال»** (یک رشته متنی در دیتابیس) به یک **«فرمت قابل خواندن توسط ماشین»** (Machine-Readable) است.

ERP تابان از دو تکنولوژی اصلی پشتیبانی می‌کند:

1.  **بارکد (Barcode/QR):** ارزان، ساده، اما نیازمند "دید مستقیم" (Line of Sight) برای اسکن.
2.  **RFID (Radio Frequency Identification):** گران‌تر، پیشرفته، با قابلیت اسکن از راه دور و بدون نیاز به دید مستقیم (خواندن ۱۰۰ کالا در ۳ ثانیه).

-----

## ۲. استانداردهای مورد پشتیبانی

### ۲-۱. بارکد دو بعدی (QR Code) - پیشنهاد پیش‌فرض

چرا QR کد بهتر از بارکد خطی (میله‌ای) است؟

  * **ظرفیت بالا:** می‌تواند علاوه بر شماره پلاک، نام دارایی، تاریخ خرید و لینک URL کاردکس را هم در خود ذخیره کند.
  * **تحمل خرابی:** اگر ۳۰٪ برچسب پاره یا مخدوش شود، باز هم قابل خواندن است.
  * **اسکن با موبایل:** برای خواندن آن نیازی به دستگاه گران‌قیمت نیست؛ هر گوشی موبایلی آن را می‌خواند.

### ۲-۲. تگ‌های RFID (استاندارد UHF Gen2)

مخصوص سازمان‌های بزرگ یا محیط‌های صنعتی.

  * **تگ‌های فلزی (Mount-on-Metal):** برای دارایی‌های فلزی (مثل سرورها یا ماشین‌آلات) باید از تگ‌های خاص ضخیم استفاده شود.
  * **کدگذاری (EPC):** شناسه دارایی (`AssetID`) باید به فرمت هگزادسیمال (Hex) تبدیل شده و در حافظه `EPC` تگ نوشته شود.

-----

## ۳. طراحی قالب لیبل (Label Designer)

این بخش به ادمین سیستم اجازه می‌دهد ظاهر برچسب اموال را طراحی کند.
سیستم تابان باید یک **Designer** داشته باشد (یا از فرمت‌های استاندارد پشتیبانی کند).

### اجزای یک لیبل استاندارد:

1.  **لوگوی سازمان:** (بالا راست).
2.  **نام سازمان:** (مثلاً: "وزارت نیرو - اداره کل برق").
3.  **عنوان دارایی:** (مثلاً: "صندلی گردان نیلپر").
4.  **شماره پلاک (خوانا):** متن درشت برای خواندن با چشم (مثلاً `1403-IT-505`).
5.  **ناحیه بارکد/QR:** جهت اسکن.
6.  **هشدار:** (مثلاً: "اموال دولتی - غیرقابل فروش").

> **نکته دولتی (سادا):** در بخش دولتی، درج عبارت "اموال دولتی" و استفاده از فرمت ۱۴ رقمی بارکد الزامی است.

-----

## ۴. فرآیند چاپ و تخصیص (Printing & Commissioning)

چاپ لیبل در ERP تابان صرفاً ارسال یک دستور به پرینتر نیست؛ بلکه یک فرآیند کنترلی است.

### سناریوی چاپ:

1.  **انتخاب:** کاربر در لیست دارایی‌ها، ۱۰ ردیف را انتخاب می‌کند.
2.  **تنظیمات چاپ:**
      * انتخاب پرینتر (مثلاً `Zebra ZT410` در اتاق سرور).
      * انتخاب قالب (مثلاً "قالب استاندارد ۵\*۳ سانت").
3.  **دستور چاپ:** سیستم کد `ZPL` (زبان پرینترهای زبرا) را تولید و ارسال می‌کند.

### سناریوی RFID (نوشتن روی تگ):

در RFID، پرینتر علاوه بر چاپ روی لیبل، باید اطلاعات را **درون چیپ** هم بنویسد (Encode).

  * اگر نوشتن روی چیپ با خطا مواجه شود، پرینتر به صورت خودکار روی لیبل عبارت `VOID` را چاپ می‌کند تا کاربر آن را دور بیندازد.

-----

## ۵. سخت‌افزار و یکپارچگی (Hardware Integration)

ERP تابان برای ارتباط با سخت‌افزار از یک سرویس واسط به نام **`Taban Print Agent`** استفاده می‌کند که روی کامپیوتر کلاینت نصب می‌شود.

### الف) پرینترهای لیبل‌زن (Label Printers)

  * پشتیبانی از پروتکل‌های استاندارد `ZPL II` (برای Zebra) و `TSPL` (برای مدل‌های اقتصادی).
  * امکان تنظیم دما (Darkness) و سرعت چاپ (Speed) از داخل نرم‌افزار.

### ب) هندهلدها و PDA (موبایل کامپیوترها)

  * اپلیکیشن موبایل تابان روی دستگاه‌های اندرویدی صنعتی (مثل برندهای Chainway یا Urovo) نصب می‌شود.
  * این دستگاه‌ها دارای ماژول سخت‌افزاری بارکدخوان و آنتن UHF هستند.
  * اپلیکیشن مستقیماً با SDK سخت‌افزار در ارتباط است (نه دوربین گوشی).

-----

## ۶. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: اموال‌گردانی رعدآسا (با RFID)

جمعدار وارد اتاق کنفرانس می‌شود. ۲۰ صندلی و ۱ میز کنفرانس و ۱ ویدئو پروژکتور در اتاق است.

1.  ماشه هندهلد RFID را فشار می‌دهد.
2.  در عرض ۳ ثانیه، تمام ۲۲ تگ موجود در اتاق خوانده می‌شوند (حتی آن‌هایی که زیر میز چسبیده‌اند).
3.  سیستم لیست خوانده شده را با "لیست دفتری اتاق" مقایسه می‌کند.
4.  پیام می‌دهد: *"تیک سبز\! همه اموال موجودند."*

### سناریوی ۲: شناسنامه دیجیتال (با QR Code)

مهندس تعمیرات جلوی یک دیزل ژنراتور ایستاده است. نمی‌داند آخرین بار کی روغن آن عوض شده.

1.  گوشی موبایلش را درمی‌آورد.
2.  QR Code روی دستگاه را اسکن می‌کند.
3.  لینک باز می‌شود و مستقیماً به صفحه "کارت دارایی" در ERP تابان می‌رود (نیاز به لاگین دارد).
4.  تب "تعمیرات" را می‌بیند و تاریخچه را چک می‌کند.

-----

## ۷. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) زبان ZPL (Zebra Programming Language)

برای چاپ سریع و با کیفیت در تیراژ بالا، نباید عکس (Image) بسازیم و به پرینتر بفرستیم. باید کد خام ZPL تولید کنیم.

  * **مزیت:** سرعت فوق‌العاده بالا، شفافیت متن و بارکد.
  * **مثال کد:**
    ```zpl
    ^XA
    ^FO50,50^ADN,36,20^FDMinistry of Power^FS
    ^FO50,100^BQN,2,10^FDQA,IT-1403-005^FS
    ^XZ
    ```

### ب) نگاشت Hex (RFID Hex Encoding)

چیپ‌های RFID معمولاً حافظه ۹۶ بیتی (یا ۱۲۸ بیتی) دارند و فقط هگزادسیمال قبول می‌کنند.

  * توسعه‌دهنده باید الگوریتمی بنویسد که `AssetID` (مثلاً ۱۰۰۵) را به یک رشته هگز یونیک تبدیل کند و ترجیحاً یک پیشوند شرکتی (Company Prefix) به آن اضافه کند تا با اموال همسایه تداخل نداشته باشد.

### ج) امنیت لینک (QR URL Security)

لینکی که در QR قرار می‌دهید نباید عمومی باشد.

  * **غلط:** `taban-erp.com/asset/1005` (اگر عمومی باشد، هر کسی اسکن کند اطلاعات محرمانه سازمان را می‌بیند).
  * **صحیح:** لینک باید به صفحه لاگین هدایت شود یا از یک توکن موقت با دسترسی محدود استفاده کند.

-----

## ۸. پرسش‌های متداول (FAQ)

**س: آیا می‌توانیم از پرینتر معمولی (A4) استفاده کنیم؟**

  * **پاسخ:** بله، برای سازمان‌های کوچک. سیستم خروجی PDF می‌دهد که روی کاغذ لیبل A4 (شیت‌های چسب‌دار) قابل چاپ است. اما دوام این لیبل‌ها کم است و در محیط صنعتی زود خراب می‌شوند.

**س: اگر برچسب کنده شد یا خراب شد چه کنیم؟**

  * **پاسخ:** در سیستم دکمه‌ای به نام **«چاپ مجدد» (Reprint)** وجود دارد. این دستور همان پلاک قبلی را دوباره چاپ می‌کند. (پلاک جدید صادر نمی‌شود).

**س: تگ RFID روی فلز کار نمی‌کند؟**

  * **پاسخ:** تگ‌های کاغذی معمولی روی فلز کار نمی‌کنند (فلز امواج را جذب می‌کند). برای دارایی‌های فلزی باید حتماً از تگ‌های مخصوص **Mount-on-Metal** (که لایه فوم یا سرامیک دارند) استفاده کنید.

# دفاتر استهلاک (Depreciation Books)

**مسیر دسترسی:** `دارایی ثابت > پیکربندی > دفاتر استهلاک`
**نام فنی:** `DepreciationBook`

## ۱. مقدمه و فلسفه وجودی

در دنیای واقعی مدیریت مالی، همیشه تضادی بین **«قانون»** و **«واقعیت»** وجود دارد.

  * **نگاه اداره مالیات (قانون):** طبق ماده ۱۴۹، عمر مفید یک کامپیوتر ۳ سال است. بعد از ۳ سال، هزینه استهلاک آن را به عنوان "هزینه قابل قبول مالیاتی" نمی‌پذیرد.
  * **نگاه مدیر کارخانه (واقعیت):** ما از این کامپیوتر ۵ سال استفاده می‌کنیم. اگر در گزارش سود و زیان داخلی، عمرش را ۳ سال بزنیم، در سال‌های ۴ و ۵ سودمان به طور کاذب بالا می‌رود (چون هزینه استهلاک نداریم)، در حالی که دستگاه هنوز دارد کار می‌کند و فرسوده می‌شود.

**راه حل ERP تابان چیست؟**
استفاده از **معماری چند دفتری (Multi-Book Architecture)**.
ما برای هر دارایی، چند دفتر استهلاک موازی باز می‌کنیم. مثل این است که دو حسابدار مختلف، هم‌زمان و بدون اطلاع از هم، دارند برای یک دستگاه محاسبات انجام می‌دهند.

### انواع رایج دفاتر:

1.  **دفتر مالیاتی/قانونی (Tax/Legal Book):** *اجباری.* محاسبات دقیقاً طبق قوانین کشور (استاندارد ۱۴۹ ایران). این دفتر مبنای صدور سند حسابداری و پرداخت مالیات است.
2.  **دفتر عملیاتی/داخلی (Corporate/Internal Book):** *اختیاری.* محاسبات طبق واقعیت فنی و سیاست‌های مدیریت. مبنای گزارش‌گیری داخلی و تحلیل سودآوری (ROI).
3.  **دفتر IFRS (بین‌المللی):** *اختیاری.* برای شرکت‌هایی که شریک خارجی دارند و باید طبق استاندارد جهانی گزارش دهند.

-----

## ۲. منطق عملکردی (Functional Logic)

در این ماژول، تعریف می‌کنیم که "قوانین بازی" برای هر دفتر چیست.

### لایه صدور سند (Posting Layer) - حیاتی‌ترین مفهوم

وقتی ما دو دفتر داریم (مالیاتی و داخلی)، آیا هر دو باید سند حسابداری صادر کنند؟

  * **خیر\!** اگر هر دو سند بزنند، هزینه استهلاک در ترازنامه "دو برابر" می‌شود.

سیستم تابان باید سه حالت را پشتیبانی کند:

1.  **پست‌کننده به دفتر کل (GL Posting):** فقط دفتر "مالیاتی" این تیک را دارد. اسناد این دفتر وارد ترازنامه اصلی می‌شود.
2.  **فقط گزارش‌گیری (Reporting Only):** دفتر "داخلی" معمولاً این‌طور است. سند صادر نمی‌کند، فقط در گزارشات مدیریتی دیده می‌شود.
3.  **پست‌کننده به لایه دوم (Custom Layer Posting):** (پیشرفته) سند صادر می‌کند، اما نه در دفتر کل اصلی، بلکه در یک "لایه تحلیلی" جداگانه برای مقاصد خاص.

-----

## ۳. بخش‌های عملیاتی فرم (Form Details)

| عنوان فیلد | شرح و منطق بیزینسی |
| :--- | :--- |
| **کد دفتر** | شناسه یونیک (مثلاً `TAX-BOOK` یا `CORP-BOOK`). |
| **شرح دفتر** | عنوان نمایشی (مثلاً: دفتر قانونی ماده ۱۴۹). |
| **آیا سند حسابداری صادر کند؟ (Post to GL)** | **بسیار مهم.** اگر `Bale` باشد، موتور استهلاک برای این دفتر سند مالی تولید می‌کند. معمولاً فقط برای یک دفتر فعال است. |
| **تقویم مالی (Fiscal Calendar)** | تعیین تقویم محاسبات (شمسی/میلادی). این قابلیت برای هلدینگ‌های چندملیتی حیاتی است. |
| **گردش تا ارزش اسقاط** | تنظیم می‌کند که آیا استهلاک تا رسیدن به صفر ادامه یابد یا تا رسیدن به "ارزش اسقاط". |
| **گرد کردن (Rounding)** | مبالغ استهلاک محاسبه شده چگونه گرد شوند؟ (مثلاً رند کردن به ۱ ریال یا ۱۰۰۰ ریال). |

-----

## ۴. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: استاندارد ایران (دو دفتری)

اکثر شرکت‌های بورسی و بزرگ ایرانی به این مدل نیاز دارند.

  * **دفتر A (دفتر مالیاتی):**
      * **قانون:** ماده ۱۴۹ ق.م.م.
      * **روش:** نزولی (طبق جدول دارایی).
      * **عمر مفید:** ۳ سال.
      * **صدور سند:** ✅ بله (چون دفاتر قانونی باید طبق این باشد).
  * **دفتر B (دفتر مدیریتی):**
      * **قانون:** سیاست داخلی شرکت.
      * **روش:** خط مستقیم (واقعی).
      * **عمر مفید:** ۵ سال.
      * **صدور سند:** ❌ خیر (فقط برای گزارش‌گیری در داشبورد مدیرعامل).

> **نتیجه:** مدیر مالی فرم اظهارنامه مالیاتی را از دفتر A می‌گیرد، اما مدیرعامل سود واقعی خط تولید را از دفتر B می‌بیند.

### سناریوی ۲: بخش دولتی (تک دفتری)

سازمان‌های دولتی معمولاً نیازی به تحلیل‌های پیچیده سودآوری ندارند و ملزم به رعایت "نظام نوین مالی" هستند.

  * **دفتر A (نظام نوین):**
      * **قانون:** بخشنامه‌های وزارت دارایی.
      * **صدور سند:** ✅ بله.
      * **نکته:** در این حالت فقط یک دفتر تعریف می‌شود.

-----

## ۵. تعامل با سایر بخش‌ها (Integration)

1.  **در فرم "طبقه دارایی" (Asset Class):**

      * ما برای هر طبقه، باید روش استهلاک را برای **تک‌تک دفترها** تعیین کنیم.
      * *مثال:* در طبقه "خودرو"، برای دفتر مالیاتی روش "نزولی" و برای دفتر داخلی روش "خط مستقیم" تنظیم می‌شود.

2.  **در فرم "کارت دارایی" (Asset Master):**

      * وقتی دارایی جدید ثبت می‌شود، تب "دفاتر استهلاک" به صورت خودکار بر اساس تنظیمات طبقه پر می‌شود.
      * کاربر می‌تواند برای یک دارایی خاص، تنظیمات یک دفتر را تغییر دهد (مثلاً عمر مفید دفتر داخلی را کم کند).

3.  **در موتور استهلاک (Depreciation Run):**

      * وقتی کاربر دکمه "محاسبه استهلاک دی‌ماه" را می‌زند، سیستم می‌پرسد: *"برای کدام دفتر؟"*
      * اگر دفتر مالیاتی انتخاب شود -\> سند حسابداری صادر می‌شود.
      * اگر دفتر داخلی انتخاب شود -\> فقط جداول گزارش‌گیری بروزرسانی می‌شوند.

-----

## ۶. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) ساختار داده (One-to-Many Relationship)

هر دارایی (`Asset`) یک رابطه یک‌به‌چند با جدول وضعیت دفاتر (`Asset_Book_Status`) دارد.

```sql
TABLE Asset_Book_Status (
    ID INT PK,
    AssetID INT FK,
    BookID INT FK, -- اشاره به دفتر مالیاتی یا داخلی
    
    -- هر دفتر وضعیت مالی مستقل خودش را دارد:
    AcquisitionCost DECIMAL, -- بهای تمام شده (ممکن است در دو دفتر متفاوت باشد!)
    AccumulatedDepr DECIMAL, -- استهلاک انباشته
    NetBookValue DECIMAL,    -- ارزش دفتری
    DeprMethod Enum,         -- روش استهلاک
    LifeYears INT            -- عمر مفید
);
```

> **نکته پیچیده:** چرا `AcquisitionCost` در دفاتر جداست؟
> گاهی طبق استانداردهای IFRS، برخی هزینه‌های نصب جزو بهای تمام شده می‌آیند، اما طبق قوانین مالیاتی ایران خیر. پس حتی "قیمت خرید" هم ممکن است در دو دفتر متفاوت ثبت شود.

### ب) پرفورمنس (Performance)

اگر سازمان ۱۰۰,۰۰۰ دارایی داشته باشد و ۳ دفتر استهلاک، موتور محاسبات باید ۳۰۰,۰۰۰ رکورد را پردازش کند. این فرآیند سنگین است و باید:

1.  در Background Job اجرا شود.
2.  از تراکنش‌های دسته‌ای (Batch Processing) استفاده کند.

-----

## ۷. پرسش‌های متداول (FAQ)

**س: آیا مجبوریم حتماً چند دفتر تعریف کنیم؟**

  * **پاسخ:** خیر. در تنظیمات اولیه (Wizard)، اگر پروفایل "ساده" انتخاب شود، سیستم به طور پیش‌فرض فقط یک دفتر (دفتر اصلی) می‌سازد و کاربر اصلاً متوجه پیچیدگی نمی‌شود. این قابلیت برای شرکت‌های بزرگ است.

**س: اگر در دفتر داخلی سند حسابداری نزنیم، پس فایده‌اش چیست؟**

  * **پاسخ:** فایده‌اش در **«گزارش‌های مقایسه‌ای»** است. شما گزارشی می‌گیرید که نشان می‌دهد: *"سود شرکت طبق قوانین مالیاتی ۱۰ میلیارد است، اما طبق واقعیت عملیاتی (دفتر داخلی) ۱۲ میلیارد است."* این دیدگاه برای هیئت مدیره طلاست.

**س: آیا می‌توانم دفتر داخلی را به تقویم میلادی و دفتر مالیاتی را به شمسی وصل کنم؟**

  * **پاسخ:** بله، این یکی از کاربردهای اصلی ERP تابان برای شرکت‌های خارجی فعال در ایران است. دفتر شمسی برای اداره مالیات ایران و دفتر میلادی برای گزارش‌دهی به شرکت مادر در خارج.

# تنظیمات پلاک‌دهی (Tagging Settings)

**مسیر دسترسی:** `دارایی ثابت > پیکربندی > تنظیمات پلاک‌دهی`
**نام فنی:** `AssetTaggingProfile`

## ۱. مقدمه و فلسفه وجودی

هر دارایی فیزیکی در سازمان (از یک صندلی اداری تا یک توربین گازی) نیاز به یک **«شناسه منحصر‌به‌فرد» (Unique Identifier)** دارد. این شناسه که روی یک برچسب (Label)، بارکد یا تگ RFID چاپ می‌شود، تنها راه ارتباطی بین «جنس موجود در اتاق» و «رکورد موجود در دیتابیس» است.

### چالش اصلی: دارایی یا هزینه؟ (The Capitalization Dilemma)
طبق قوانین مالیاتی و استانداردهای حسابداری، هر چیزی که خریده می‌شود لزوماً "دارایی ثابت" نیست.

* اگر شما یک "منگنه" بخرید، چون قیمتش کم است، همان لحظه **هزینه** می‌شود (اموال مصرفی/در حکم مصرفی).
* اگر شما یک "لپ‌تاپ" بخرید، چون قیمتش زیاد است و عمر طولانی دارد، **دارایی** می‌شود (اموال غیرمصرفی/سرمایه‌ای).

ماژول پلاک‌دهی تابان وظیفه دارد این تفکیک را به صورت اتوماتیک مدیریت کند و برای هر کدام، **سری پلاک متفاوتی** صادر کند.

> **چرا پلاک متفاوت؟**
> چون "اموال در حکم مصرفی" (Low-Value Assets) نیازی به محاسبه استهلاک ماهانه ندارند و در ترازنامه نمی‌آیند، اما همچنان باید کنترل فیزیکی شوند (که دزدیده نشوند). پس پلاک می‌خورند، اما پلاکی متفاوت از دارایی‌های سرمایه‌ای.

---

## ۲. منطق عملکردی (Functional Logic)

این فرم به عنوان یک «پروفایل» عمل می‌کند که به **«گروه‌های دارایی»** تخصیص داده می‌شود. یعنی شما می‌توانید برای گروه "IT" یک الگوی پلاک‌دهی داشته باشید و برای گروه "مبلمان" الگویی دیگر.

### الگوریتم تصمیم‌گیری سیستم:
هنگامی که کالایی وارد انبار می‌شود:

1.  سیستم **قیمت خرید** کالا را می‌خواند.
2.  آن را با **«حد نصاب معاملات» (Threshold)** تعریف شده برای سال جاری مقایسه می‌کند.
3.  **شاخه الف:** اگر `قیمت < حد نصاب` باشد -> کالا **«در حکم مصرفی»** است -> از **دنباله اعداد مصرفی** پلاک تولید می‌کند (مثلاً `EXP-1001`).
4.  **شاخه ب:** اگر `قیمت >= حد نصاب` باشد -> کالا **«دارایی سرمایه‌ای»** است -> از **دنباله اعداد غیرمصرفی** پلاک تولید می‌کند (مثلاً `CAP-5001`).

---

## ۳. بخش‌های عملیاتی فرم (Form Details)

| عنوان فیلد (UI) | نام فنی (DB) | نوع داده | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :---: | :--- |
| **نام پروفایل** | `Name` | String | بله | عنوان تنظیمات (مثلاً: الگوی پلاک‌دهی استاندارد ۱۴۰۳). |
| **دنباله اموال مصرفی** | `ExpensedSeqID` | FK | بله | انتخاب شمارنده (Number Sequence) برای دارایی‌های ارزان‌قیمت. (مثلاً سری ۱۰۰۰۰). |
| **دنباله اموال سرمایه‌ای** | `CapitalizedSeqID` | FK | بله | انتخاب شمارنده برای دارایی‌های اصلی و گران‌قیمت. (مثلاً سری ۲۰۰۰۰). |
| **قالب برچسب (Label Template)** | `LabelTemplateID` | FK | خیر | انتخاب طرح چاپ (ZPL/HTML) برای پرینتر لیبل‌زن (اینکه لوگو کجا باشد، بارکد کجا باشد). |
| **جداکننده (Separator)** | `SeparatorChar` | Char | خیر | کاراکتری که اجزای پلاک را جدا می‌کند (معمولاً خط تیره `-` یا اسلش `/`). |
| **شامل سال؟** | `IncludeYear` | Bool | خیر | آیا سال خرید در پلاک درج شود؟ (مثلاً `1403-0050`). |

---

## ۴. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: سازمان دولتی (رعایت سادا و برچسب اموال دولتی)
در بخش دولتی، پلاک‌کوبی بسیار سخت‌گیرانه است. معمولاً برچسب‌های اموال دولتی دارای یک فرمت خاص ۱۴ رقمی هستند.

* **تنظیمات:**
    * **نام:** الگوی دولتی.
    * **دنباله غیرمصرفی:** متصل به الگوی تولید کد ۱۴ رقمی سادا.
    * **نکته:** اموال "در حکم مصرفی" در دولت معمولاً پلاک نمی‌خورند یا برچسب متفاوتی (مثلاً رنگ زرد) دارند تا با اموال اساسی (برچسب سفید/آبی) اشتباه نشوند. سیستم تابان این دو سری را کاملاً جدا می‌کند.

### سناریوی ۲: شرکت خصوصی (هلدینگ)
یک هلدینگ می‌خواهد بداند هر دارایی متعلق به کدام شرکت تابعه است.

* **تنظیمات:**
    * تعریف چند "دنباله" متفاوت با پیشوندهای مختلف:
        * دنباله ۱: `TEH-` (برای دفتر تهران).
        * دنباله ۲: `SHZ-` (برای کارخانه شیراز).
    * در فرم "تنظیمات پلاک"، بسته به اینکه کاربر کدام شعبه است، دنباله مربوطه فراخوانی می‌شود.
    * **نتیجه:** پلاک `TEH-2005` نشان می‌دهد این میز متعلق به تهران است.

### سناریوی ۳: دارایی‌های خرد (Low Value Asset Tracking)
شرکت تصمیم می‌گیرد حتی "صندلی‌های پلاستیکی" و "ماشین‌حساب‌ها" را هم کنترل کند، اما نمی‌خواهد درگیر حسابداری استهلاک آن‌ها شود.

* **قیمت ماشین‌حساب:** ۵۰۰,۰۰۰ تومان (زیر حد نصاب).
* **رفتار سیستم:**
    1.  تشخیص می‌دهد که زیر حد نصاب است.
    2.  از دنباله "مصرفی" استفاده می‌کند: `LV-9005` (LV مخفف Low Value).
    3.  **سند حسابداری:** تمام مبلغ را در لحظه خرید به "هزینه ملزومات" می‌برد (نه دارایی ثابت).
    4.  **کنترل:** اما در سیستم جمعداری، پلاک `LV-9005` ثبت می‌شود و تحویل آقای کارمند می‌شود. اگر گم شود، کارمند مسئول است.

---

## ۵. تعامل با سایر بخش‌ها (Integration)

1.  **با ماژول حدنصاب‌ها (Capitalization Thresholds):**
    * این فرم به تنهایی کار نمی‌کند. این فرم **"موتور اجرا"** است، اما **"قانون"** از فرم «حد نصاب معاملات» می‌آید.
    * سیستم چک می‌کند تاریخ خرید (مثلاً ۱۴۰۲) در کدام بازه تاریخیِ حدنصاب‌ها قرار دارد و مبلغ سقف چقدر است.

2.  **با ماژول سیستم‌سازی (Number Sequences):**
    * در ERP تابان، یک ماژول مرکزی برای تولید شماره (فاکتور، سند، پلاک) وجود دارد. این فرم فقط به آن ماژول لینک می‌دهد (FK). این کار باعث می‌شود مدیریت شمارنده‌ها متمرکز باشد.

---

## ۶. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) تولید شماره بدون تکرار (Concurrency Safe)
تولید پلاک اموال در محیط‌های شلوغ (مثلاً وقتی ۱۰ انباردار همزمان دارند کالا رسید می‌کنند) چالش‌برانگیز است.

* **روش غلط:** `SELECT MAX(ID) + 1`. (باعث تکراری شدن پلاک می‌شود).
* **روش صحیح:** استفاده از `SEQUENCE` دیتابیس (در SQL Server یا Oracle) یا الگوی `Atomic Increment` در Redis. پلاک باید قبل از ذخیره نهایی رزرو شود.

### ب) تغییر حد نصاب در میانه سال
اگر قانون وسط سال عوض شود و حد نصاب تغییر کند:

* سیستم باید بر اساس **«تاریخ تحصیل» (Acquisition Date)** تصمیم بگیرد، نه تاریخ روز جاری.

### ج) چاپ لیبل (Barcode Printing)
* خروجی این ماژول معمولاً یک رشته متنی (String) است که به پرینترهای لیبل‌زن (مانند Zebra) ارسال می‌شود.
* پشتیبانی از فونت‌های فارسی در تولید تصویر بارکد/QR حیاتی است.

---

## ۷. پرسش‌های متداول (FAQ)

**س: اگر یک دارایی "در حکم مصرفی" (پلاک ارزان) بخورد، اما بعداً تصمیم بگیریم آن را "دارایی سرمایه‌ای" کنیم (Capitalize)، چه می‌شود؟**

* **پاسخ:** این یک عملیات "تغییر وضعیت" است. سیستم پلاک قبلی را باطل (یا لینک) می‌کند و یک پلاک جدید از سری "سرمایه‌ای" صادر می‌کند و سند حسابداری اصلاحی می‌زند (برگشت از هزینه -> ثبت دارایی).

**س: آیا می‌توانیم پلاک را دستی وارد کنیم؟ (برای دارایی‌های قدیم)**

* **پاسخ:** بله. در تنظیمات "دنباله اعداد"، یک تیک به نام `Allow Manual Entry` وجود دارد. این برای زمان استقرار سیستم (مهاجرت از اکسل به تابان) ضروری است تا پلاک‌های قدیمی روی وسایل حفظ شوند.

**س: آیا شماره پلاک باید حتماً عدد باشد؟**

* **پاسخ:** خیر. سیستم تابان از فرمت آلفانومریک (ترکیب حروف و عدد) پشتیبانی می‌کند. (مثال: `IT/1402/005`). این ساختار در "دنباله اعداد" تعریف می‌شود.

# روش‌های تحصیل دارایی ثابت (Acquisition Methods)

**مسیر دسترسی:** `دارایی ثابت > عملیات > تحصیل دارایی`
**نام فنی:** `AssetAcquisition`

## ۱. مقدمه و فلسفه وجودی

«تحصیل» (Acquisition) لحظه‌ای است که یک دارایی به صورت رسمی وارد چرخه عملیاتی و مالی سازمان می‌شود. این لحظه بسیار حیاتی است زیرا:

1.  **بهای تمام شده تاریخی (Historical Cost)** در این لحظه فریز می‌شود.
2.  **تاریخ شروع استهلاک** معمولاً از این تاریخ (یا ماه بعد) آغاز می‌گردد.
3.  **پلاک اموال** در این لحظه صادر می‌شود.

در ERP تابان، ماژول تحصیل به صورت **چند کاناله (Omni-Channel)** طراحی شده است تا تمام روش‌های ورود دارایی را پوشش دهد.

---

## ۲. انواع روش‌های تحصیل (Acquisition Channels)

سیستم ۵ روش استاندارد برای ایجاد دارایی دارد:

### ۲-۱. تحصیل از طریق انبار (From Inventory / Goods Issue)
**کاربرد:** رایج‌ترین روش برای تجهیزات اداری، ابزارآلات و وسایل نقلیه که ابتدا توسط انبار خریداری و رسید می‌شوند.

* **سناریو:** خرید ۱۰ عدد لپ‌تاپ توسط تدارکات.
* **جریان داده:**
    1.  تدارکات کالا را می‌خرد -> انبار «رسید» می‌کند (موجودی انبار: ۱۰ عدد).
    2.  واحد IT درخواست کالا می‌دهد -> انبار «حواله مصرف» می‌زند.
    3.  **تریگر سیستم:** سیستم تشخیص می‌دهد کالا "دارایی" است. به جای اینکه هزینه شود، فرم "تحصیل دارایی" باز می‌شود.
* **سند حسابداری (اتوماتیک):**
    * **بدهکار:** دارایی ثابت (۱۲۱۰۱)
    * **بستانکار:** موجودی کالا (۱۱۴۰۱)

### ۲-۲. خرید مستقیم (Direct Purchase / AP Invoice)
**کاربرد:** برای دارایی‌هایی که ماهیت فیزیکی قابل انبارش ندارند (زمین، ساختمان، نرم‌افزار، سرقفلی) یا مستقیماً در محل نصب می‌شوند.

* **سناریو:** خرید یک قطعه زمین یا لایسنس نرم‌افزار ERP.
* **جریان داده:**
    1.  فاکتور خرید مستقیماً در ماژول حسابداری/تدارکات ثبت می‌شود (بدون گردش انبار).
    2.  در هدر فاکتور، نوع خرید "دارایی ثابت" انتخاب می‌شود.
* **سند حسابداری:**
    * **بدهکار:** دارایی ثابت (۱۲۱۰۱)
    * **بستانکار:** حساب‌های پرداختنی / تامین‌کننده (۲۱۱۰۱)

### ۲-۳. دارایی در جریان تکمیل (Capitalization from CIP / Project)
**کاربرد:** پروژه‌های ساخت‌وساز یا خطوط تولید که ساخت آن‌ها زمان‌بر است.

* **سناریو:** ساخت یک سوله انبار که ۱ سال طول می‌کشد.
* **جریان داده:**
    1.  در طول سال، تمام هزینه‌ها (سیمان، آجر، حقوق کارگر) در کد حساب "دارایی در جریان تکمیل" جمع می‌شود.
    2.  در پایان پروژه، مدیر پروژه دکمه **«تکمیل دارایی» (Capitalize)** را می‌زند.
    3.  سیستم تمام هزینه‌های انباشته شده را جمع می‌کند و یک پلاک اموال "ساختمان" صادر می‌کند.
* **سند حسابداری:**
    * **بدهکار:** دارایی ثابت - ساختمان (۱۲۱۰۲)
    * **بستانکار:** دارایی در جریان تکمیل (۱۲۵۰۱)

### ۲-۴. تحصیل رایگان / اهدایی (Donation / Grant)
**کاربرد:** دریافت هدایا، موقوفات یا تجهیزات از سازمان‌های دیگر بدون پرداخت پول.

* **سناریو:** یک خیر مدرسه‌ساز، ۱۰ عدد کولر به مدرسه (سازمان دولتی) اهدا می‌کند.
* **چالش:** پولی پرداخت نشده، پس بهای تمام شده صفر است؟ خیر! طبق استاندارد باید به **«ارزش منصفانه» (Fair Value)** روز ثبت شود.
* **سند حسابداری (بخش خصوصی):**
    * **بدهکار:** دارایی ثابت
    * **بستانکار:** درآمد غیرعملیاتی (کمک‌های بلاعوض)
* **سند حسابداری (بخش دولتی):**
    * **بدهکار:** دارایی ثابت
    * **بستانکار:** تغییرات در ارزش خالص (درآمد اهدایی)

### ۲-۵. استقرار / موجودی اول دوره (Opening Balance)
**کاربرد:** هنگام راه‌اندازی نرم‌افزار تابان، برای ورود اطلاعات دارایی‌های قدیمی که سال‌ها پیش خریده شده‌اند.

* **ویژگی‌ها:**
    * تاریخ تحصیل در گذشته است (مثلاً سال ۱۳۹۵).
    * استهلاک انباشته تا امروز باید دستی وارد شود.
    * سند حسابداری صادر نمی‌شود (چون در سند افتتاحیه کل می‌آید) یا سند بالانس می‌خورد.

---

## ۳. جزئیات فرم تحصیل (The Acquisition Form)

این فرم ترکیبی از اطلاعات مالی و فیزیکی است.

| عنوان فیلد | نوع داده | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **روش تحصیل** | Enum | بله | انتخاب یکی از ۵ روش بالا (تأثیر مستقیم روی سند حسابداری دارد). |
| **تاریخ تحصیل** | Date | بله | تاریخی که دارایی "آماده بهره‌برداری" شده است. مبنای شروع استهلاک. |
| **بهای تمام شده** | Money | بله | جمع مبلغ خرید + حمل + نصب + راه‌اندازی + عوارض گمرکی. |
| **تامین‌کننده** | FK | شرطی | در روش "خرید مستقیم"، نام فروشنده برای ردیابی گارانتی ثبت می‌شود. |
| **شماره سند مرجع** | String | خیر | شماره فاکتور، شماره حواله انبار یا شماره پروژه. |
| **ارزش اسقاط** | Money | خیر | پیش‌بینی اینکه در پایان عمر چقدر می‌ارزد (مؤثر در فرمول استهلاک). |

---

## ۴. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: هزینه‌های پس از تحصیل (Subsequent Costs)
**سوال:** یک دستگاه پرس خریدیم (۱۰۰ میلیون). یک ماه بعد ۵ میلیون هزینه "نصب و فونداسیون" دادیم. این ۵ میلیون هزینه است یا دارایی؟

* **منطق تابان:** طبق استاندارد حسابداری، تا زمانی که دستگاه راه نیفتاده، تمام هزینه‌ها باید **Capitalize** شوند (به بهای دارایی اضافه شوند).
* **عملیات:** کاربر فرم "تحصیل تکمیلی" (Acquisition Adjustment) را باز می‌کند و ۵ میلیون را به پلاک قبلی اضافه می‌کند.
* **نتیجه:** بهای تمام شده دارایی می‌شود ۱۰۵ میلیون تومان.

### سناریوی ۲: خرید مجموعه‌ای (Bundle Purchase)
یک ست مبلمان اداری (شامل ۱ میز و ۴ صندلی) در یک فاکتور به مبلغ ۲۰ میلیون خریده شده است.

* **چالش:** ما ۵ پلاک اموال می‌خواهیم، اما ۱ قیمت کل داریم.
* **راهکار:** سیستم تابان قابلیت **«تسهیم هزینه» (Cost Allocation)** دارد.
    * کاربر ۵ قلم کالا ایجاد می‌کند.
    * مبلغ ۲۰ میلیون را وارد می‌کند.
    * سیستم می‌پرسد: "تسهیم بر چه اساس؟" (تعداد مساوی / یا وزنی).
    * اگر مساوی باشد: هر قلم ۴ میلیون تومان ثبت می‌شود.

---

## ۵. تعامل با سایر بخش‌ها (Integration)

1.  **ارتباط با بودجه (بخش دولتی):**
    * قبل از اینکه فرم تحصیل ذخیره شود، سیستم چک می‌کند: *"آیا برای سرفصل خرید ماشین‌آلات، اعتبار باقی‌مانده است؟"*
    * اگر بودجه نباشد، سیستم خطای بازدارنده (Hard Stop) می‌دهد.

2.  **ارتباط با پلاک‌دهی (Tagging):**
    * به محض زدن دکمه ذخیره، سیستم به تنظیمات "گروه دارایی" نگاه می‌کند و پلاک بعدی را رزرو و چاپ می‌کند.

---

## ۶. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) قفل تاریخ (Date Lock)
سیستم نباید اجازه دهد تاریخ تحصیل در "دوره مالی بسته شده" ثبت شود.

* *مثال:* الان در سال ۱۴۰۳ هستیم. کاربر نباید بتواند دارایی جدیدی با تاریخ ۱۴۰۱ ثبت کند (مگر در حالت استقرار)، چون حساب‌های ۱۴۰۱ بسته شده است.

### ب) نگهداری ارز (Multi-Currency)
اگر دارایی از خارج خریداری شده (مثلاً ۱۰,۰۰۰ یورو):

* باید **نرخ ارز در روز تحصیل** در دیتابیس ذخیره شود.
* تمام گزارشات حسابداری به "ریال" است، اما در کارت دارایی باید "بهای ارزی" هم نگهداری شود تا در صورت نیاز به "تجدید ارزیابی ارزی" (طبق استاندارد ۱۱) استفاده شود.

### ج) دیاگرام پیشنهادی جریان داده



---

## ۷. پرسش‌های متداول (FAQ)

**س: اگر دارایی را قسطی بخریم، آیا بهره اقساط جزو بهای دارایی است؟**

* **پاسخ:**
    * **استاندارد ایران:** خیر، هزینه‌های تأمین مالی معمولاً "هزینه دوره" هستند (مگر در دارایی‌های واجد شرایط خاص مثل ساخت نیروگاه).
    * **سیستم تابان:** به صورت پیش‌فرض، بهره را جدا می‌کند. اما اگر کاربر بخواهد، می‌تواند از طریق "تحصیل تکمیلی" بهره را به دارایی اضافه کند.

**س: تخفیفات نقدی خرید چه می‌شود؟**

* **پاسخ:** بهای تمام شده باید **«خالص»** ثبت شود. یعنی (قیمت کالا - تخفیف تجاری). سیستم تابان مبلغ نهایی فاکتور را می‌خواند.

**س: مالیات بر ارزش افزوده (VAT) چطور؟**

* **پاسخ:**
    * اگر شرکت بتواند VAT را پس بگیرد (اعتبار مالیاتی) -> جزو بهای دارایی **نیست**.
    * اگر شرکت معاف از مالیات باشد (نتواند پس بگیرد) -> VAT به بهای دارایی **اضافه می‌شود**.
    * *این لاجیک بر اساس "گروه مالیاتی" شرکت در تنظیمات تعیین می‌شود.*

# اهدا و انتقال بلاعوض (Donation & Gratuitous Transfer)

**مسیر دسترسی:** `دارایی ثابت > عملیات > اهدا و انتقال`
**نام فنی:** `AssetDonationProcess`

## ۱. مقدمه و فلسفه وجودی

چرا یک سازمان باید دارایی خود را رایگان بدهد؟

1.  **بخش دولتی (انتقال بین دستگاهی):** مالکیت تمام اموال دولتی با "حکومت" است. انتقال یک سرور از "وزارت نیرو" به "دانشگاه تهران"، صرفاً جابجایی جیب‌به‌جیب است و پولی نباید رد و بدل شود.
2.  **بخش خصوصی (مسئولیت اجتماعی - CSR):** یک کارخانه تصمیم می‌گیرد اتوبوس قدیمی خود را به مدرسه روستا اهدا کند.

در ERP تابان، این فرآیند باید طوری مدیریت شود که ضمن خروج دارایی از حساب‌ها، **«مستندات قانونی انتقال»** به دقت ثبت شود تا در آینده سازمان متهم به "حیف‌ومیل اموال" نشود.

> **نکته مهم:** این مستند مربوط به **خروج** (اهدا کردن) است. اگر سازمان دارایی را **دریافت** کند، مربوط به مستند "تحصیل دارایی" (بخش ۲-۴) می‌شود.

---

## ۲. سناریوهای قانونی (Legal Framework)

سیستم باید دو لاجیک کاملاً متفاوت را پشتیبانی کند:

### سناریوی الف: انتقال بین دستگاهی (مخصوص دولت)
* **مرجع قانونی:** مواد ۱۰۶ و ۱۰۷ قانون محاسبات عمومی کشور.
* **منطق:** اموال از یک امین اموال به امین اموال دستگاه دیگر منتقل می‌شود.
* **الزامات:** نیاز به "مجوز بالاترین مقام دستگاه" یا "مجوز وزارت امور اقتصادی و دارایی" (خزانه‌داری کل) دارد.
* **حسابداری:** شناسایی هزینه یا زیان ممنوع است. حساب‌های "تغییر در ارزش خالص" درگیر می‌شوند.

### سناریوی ب: اهدای خیریه (بخش خصوصی)
* **منطق:** دارایی به یک نهاد غیرانتفاعی واگذار می‌شود.
* **حسابداری:** ارزش دفتری دارایی به عنوان **«هزینه اهدا / کمک‌های بلاعوض»** شناسایی می‌شود.
* **مالیات:** طبق قانون مالیات‌ها، اگر گیرنده جزو نهادهای مجاز (مثل کمیته امداد، بهزیستی و...) باشد، این هزینه "قابل قبول مالیاتی" است؛ در غیر این صورت هزینه رد می‌شود.

---

## ۳. چرخه عملیات انتقال (The Workflow)

### گام ۱: درخواست و تصویب
* واحد متقاضی (یا گیرنده) درخواست می‌دهد.
* در بخش دولتی، نامه درخواست گیرنده در سیستم ثبت می‌شود.

### گام ۲: اخذ مجوز (Permit)
* **حیاتی برای دولت:** شماره و تاریخ "مجوز خزانه‌داری" یا "صورتجلسه هیئت وزیران" باید در سیستم ثبت شود. بدون این مجوز، خروج دارایی جرم است.

### گام ۳: صدور حواله خروج
* دارایی از محل استقرار خارج می‌شود.
* **فرم گیرنده:** نماینده سازمان مقصد باید "رسید تحویل" (فرم ۲۲ اموال) را امضا کند.

### گام ۴: سند حسابداری و خروج سیستمی
* دارایی از دفاتر حذف (`Disposed`) می‌شود.
* اطلاعات به سامانه سادا ارسال می‌گردد.

---

## ۴. منطق حسابداری (Accounting Logic)

تفاوت حسابداری دولتی و خصوصی در اینجا آشکار می‌شود:

### مدل بخش خصوصی (Private Sector)
فرض: دارایی به ارزش دفتری ۲۰ میلیون ریال به خیریه اهدا می‌شود.

| کد حساب | شرح حساب | بدهکار | بستانکار |
| :--- | :--- | :--- | :--- |
| ۶۱۰ | **هزینه کمک‌های بلاعوض (CSR)** | ۲۰ | -- |
| ۱۲۲ | استهلاک انباشته | ۸۰ | -- |
| ۱۲۱ | دارایی ثابت (بهای تمام شده) | -- | ۱۰۰ |

### مدل بخش دولتی (Nezam Novin Mali)
فرض: انتقال از وزارتخانه الف به وزارتخانه ب. (هیچ هزینه‌ای شناسایی نمی‌شود، چون دولت فقیرتر نشده، فقط مال جابجا شده).

| کد حساب | شرح حساب (نظام نوین) | بدهکار | بستانکار |
| :--- | :--- | :--- | :--- |
| ۳۱۰۱۵ | **تغییرات در ارزش خالص - واگذاری دارایی** | ۲۰ | -- |
| ۱۶۲۲ | استهلاک انباشته | ۸۰ | -- |
| ۱۶۲۱ | دارایی ثابت | -- | ۱۰۰ |

---

## ۵. جزئیات فرم اهدا (Form Details)

| عنوان فیلد | نوع | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **نوع واگذاری** | Enum | بله | (انتقال به دستگاه دولتی / اهدا به خیریه / انتقال به شرکت‌های تابعه). |
| **سازمان گیرنده** | Lookup | بله | انتخاب از لیست "مشتریان/تامین‌کنندگان" یا لیست "دستگاه‌های اجرایی". |
| **دارایی** | Lookup | بله | انتخاب پلاک. |
| **شماره مجوز** | String | **دولتی** | شماره نامه خزانه‌داری یا مصوبه هیئت مدیره. |
| **تاریخ مجوز** | Date | بله | تاریخ صدور مجوز. |
| **شناسه ملی گیرنده** | String | بله | جهت کنترل‌های مالیاتی و سادا. |
| **ارزش کارشناسی** | Money | خیر | برخی اوقات برای انتقال، ارزش روز دارایی ارزیابی می‌شود (جهت ثبت در دفاتر مقصد). |
| **پیوست‌ها** | File | بله | تصویر رسید امضا شده توسط تحویل‌گیرنده. |

---

## ۶. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: ادغام دو شرکت (M&A)
هلدینگ "تابان" دو شرکت زیرمجموعه (الف و ب) را ادغام می‌کند. تمام اموال شرکت الف باید به شرکت ب منتقل شود.

1.  **روش:** انتقال بلاعوض درون‌گروهی.
2.  **عملیات:** استفاده از قابلیت **«انتقال دسته‌ای» (Bulk Transfer)**. تمام ۵۰۰۰ قلم دارایی شرکت الف انتخاب و به شرکت ب منتقل می‌شوند.
3.  **مالی:** حساب‌های رابط بین دو شرکت (Inter-company) درگیر می‌شوند.

### سناریوی ۲: تجهیز مدارس (دولتی)
اداره کل نوسازی مدارس، ۱۰۰ عدد نیمکت را به "مدرسه شهید رجایی" می‌فرستد.

1.  چون مدرسه زیرمجموعه خود اداره است (کد دستگاه اجرایی یکی است)، این "اهدا" نیست، بلکه **"نقل و انتقال مکانی"** (جابجایی جمعدار) است.
2.  *اما* اگر به "دانشگاه آزاد" (که دستگاه مستقل است) بدهد، می‌شود **"انتقال بلاعوض"** و نیاز به مجوز دارد.
    * *سیستم تابان باید هوشمند باشد و بر اساس "کد دستگاه گیرنده" این تمایز را تشخیص دهد.*

---

## ۷. تعامل با سایر بخش‌ها (Integration)

1.  **با سامانه سادا (SADA Integration):**
    * مهم‌ترین بخش برای دولتی‌ها. وقتی دارایی منتقل می‌شود، وب‌سرویس سادا باید فراخوانی شود:
        * `Method: TransferAsset`
        * `SourceID: [کد دستگاه ما]`
        * `TargetID: [کد دستگاه گیرنده]`
        * `AssetID: [کد ۱۴ رقمی]`
    * *اگر سادا تایید نکند (مثلاً کد دستگاه گیرنده غلط باشد)، سیستم نباید سند خروج بزند.*

2.  **با دبیرخانه (Correspondence):**
    * لینک کردن شماره نامه مجوز به سیستم اتوماسیون اداری برای مشاهده متن نامه.

---

## ۸. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) اعتبارسنجی گیرنده (Recipient Validation)
در بخش دولتی، گیرنده حتماً باید دارای **«شناسه دستگاه اجرایی»** معتبر باشد. انتقال اموال دولتی به "اشخاص حقیقی" یا "شرکت‌های خصوصی" (بدون فروش) اکیداً ممنوع و جرم است.

* سیستم باید این Rule را چک کند: `If (Type == Gov_Transfer) AND (Recipient_Type != Government) -> Block`.

### ب) انتقال استهلاک (Depreciation Carry-over)
در انتقالات بین دولتی، گاهی لازم است "تاریخچه استهلاک" هم منتقل شود. یعنی دستگاه گیرنده بداند این دارایی ۵ سال کار کرده است.

* در این حالت، گزارش خروجی سیستم (حواله انتقال) باید شامل فیلدهای: `Cost`, `Accumulated Depr`, `Year Purchased` باشد.

### ج) بازگشت‌ناپذیری
وقتی سند انتقال صادر و دارایی در سادا به نام دستگاه دیگر خورد، بازگرداندن آن در سیستم ما تقریباً غیرممکن است (چون مالکیت قانونی تغییر کرده). پیام هشدار باید بسیار جدی باشد.

---

## ۹. پرسش‌های متداول (FAQ)

**س: آیا اهدای دارایی مشمول مالیات بر ارزش افزوده (VAT) است؟**

* **پاسخ:** در قانون ایران، "عرضه کالا به صورت بلاعوض" نیز مشمول مالیات است (مگر به وزارتخانه‌ها). بنابراین اگر یک شرکت خصوصی به یک شخص اهدا کند، باید VAT آن را خودش به دارایی بپردازد (فاکتور صادر می‌شود اما مبلغ از جیب شرکت می‌رود).

**س: اگر مجوز خزانه‌داری هنوز نیامده باشد، می‌توانیم دارایی را بفرستیم؟**

* **پاسخ:** از نظر سیستمی می‌توان سند "امانی" (نقل و انتقال موقت) زد تا مجوز بیاید. اما سند "اهدا/خروج قطعی" نباید صادر شود، چون هنوز مالکیت منتقل نشده است.

**س: ارزش دفتری دارایی صفر است (مستهلک شده). آیا برای اهدا نیاز به مجوز دارد؟**

* **پاسخ:** بله! در دولت، "پلاک اموال" مهم است نه ارزش ریالی. حتی یک صندلی مستهلک شده هم جزو بیت‌المال است و بدون مجوز نمی‌توان آن را به کسی بخشید.

# مفقودی و سرقت قطعی (Lost & Stolen Assets / Write-off)

**مسیر دسترسی:** `دارایی ثابت > عملیات > مفقودی و حوادث`
**نام فنی:** `AssetLossProcess`

## ۱. مقدمه و فلسفه وجودی

در چرخه حیات دارایی، مفقودی یک **«رویداد غیرمترقبه»** است.
سیستم ERP تابان باید بتواند دو فاز این رویداد را مدیریت کند:

1.  **فاز تعلیق (Suspension):** زمانی که دارایی گم شده اما هنوز امید به پیدا شدنش هست (یا پرونده در کلانتری باز است). در این فاز دارایی "خارج" نمی‌شود، بلکه "فریز" می‌شود.
2.  **فاز خروج قطعی (Write-off):** زمانی که ناامید شده‌ایم (یا رای دادگاه صادر شده) و باید دارایی را از ترازنامه حذف و زیان شناسایی کنیم.

---

## ۲. چرخه عملیات (The Workflow)

این فرآیند معمولاً طولانی‌مدت است و برخلاف فروش، در یک لحظه انجام نمی‌شود.

### گام ۱: اعلام مفقودی (Flagging)
* **منشأ:** معمولاً خروجیِ "اموال‌گردانی" (کسری) یا گزارش حراست است.
* **اقدام:** تغییر وضعیت دارایی به **«مفقود / تحت پیگیری»**.
* **اثر:** توقف محاسبه استهلاک (طبق تنظیمات) و قفل شدن نقل‌وانتقال.

### گام ۲: تحقیقات و کمیته انضباطی (Investigation)
* بررسی می‌شود که آیا "قصور جمعدار/کارمند" مطرح است یا "سرقت بیرونی"؟
* ثبت شماره پرونده انتظامی (پلیس) یا صورتجلسه حراست در سیستم.

### گام ۳: تعیین تکلیف مالی (Resolution)
سه حالت ممکن است رخ دهد:

* **الف) پیدا شد:** دارایی به وضعیت "فعال" برمی‌گردد.
* **ب) مقصر دارد:** کارمند باید خسارت بدهد (تبدیل دارایی به بدهی پرسنل).
* **ج) مقصر ندارد (فورس ماژور):** شرکت/سازمان زیان را می‌پذیرد (Write-off).

### گام ۴: صدور سند خروج (Execution)
حذف نهایی دارایی از دفاتر اموال و حسابداری.

---

## ۳. منطق حسابداری (Accounting Logic)

این بخش پیچیده‌ترین حالت حسابداری خروج را دارد، زیرا پای "بیمه" و "جریمه کارمند" وسط می‌آید.

### سناریوی ۱: سرقت بدون مقصر (زیان کامل)
لپ‌تاپ از شرکت دزدیده شده، دزد پیدا نشده و بیمه هم نداریم.

* **ارزش دفتری:** ۲۰ میلیون ریال.
* **سند:**
    * بدهکار: استهلاک انباشته (۸۰)
    * **بدهکار: زیان ناشی از سرقت/حوادث (۲۰)**
    * بستانکار: دارایی ثابت (۱۰۰)

### سناریوی ۲: قصور کارمند (بدهی پرسنل)
کارمند دوربین عکاسی شرکت را در سفر شخصی گم کرده است. کمیته انضباطی حکم داده که باید "ارزش روز" دوربین (۵۰ میلیون) را بپردازد. (ارزش دفتری دوربین ۱۰ میلیون بوده).

* **سند:**
    * بدهکار: استهلاک انباشته (۹۰)
    * **بدهکار: حساب‌های دریافتنی غیرتجاری - وام و بدهی کارکنان (۵۰)** <-- *ایجاد طلب از کارمند*
    * بستانکار: دارایی ثابت (۱۰۰)
    * **بستانکار: سایر درآمدها (۴۰)** <-- *سود شناسایی می‌شود چون جریمه بیشتر از ارزش دفتری بوده*

### سناریوی ۳: پوشش بیمه (Insurance Claim)
خودرو تصادف کرده و "توتا‌ل‌لاس" (Total Loss) شده. بیمه مبلغ خسارت را می‌دهد.

* این سناریو دقیقاً شبیه **«فروش دارایی به بیمه»** رفتار می‌شود. مبلغ دریافتی از بیمه جایگزین "مبلغ فروش" می‌شود.

---

## ۴. جزئیات فرم مفقودی (Form Details)

| عنوان فیلد | نوع | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **دارایی** | Lookup | بله | انتخاب پلاک (معمولاً از لیست کسری‌های اموال‌گردانی). |
| **تاریخ حادثه** | Date | بله | تاریخی که مفقودی کشف شده. |
| **نوع حادثه** | Enum | بله | سرقت، مفقودی در محل، آتش‌سوزی، حوادث طبیعی. |
| **وضعیت پرونده** | Enum | بله | تحت بررسی / ارجاع به بیمه / ارجاع به دادگاه / مختومه. |
| **مقصر حادثه** | Lookup | خیر | لینک به پرسنل (اگر قصور محرز شده باشد). |
| **مبلغ بازیافتی** | Money | خیر | مبلغی که بیمه یا کارمند پرداخت می‌کند. |
| **شماره صورتجلسه** | String | بله | شماره گزارش پلیس ۱۱۰ یا گزارش حراست. |
| **پیوست‌ها** | File | بله | اسکن گزارش پلیس (اجباری برای بستن حساب). |

---

## ۵. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: زنده شدن مرده (Zombie Asset)
یک مانیتور پارسال "مفقود" اعلام شد و سند خروجش صادر شد (زیان شناسایی شد).
امسال در انبارگردانی، در کمد یک کارمند پیدا می‌شود!

1.  **عملیات:** ثبت سند **«تحصیل دارایی (یافت شده)»**.
2.  **ارزش‌گذاری:** با ارزش کارشناسی روز یا ارزش اسمی (۱ ریال) ثبت می‌شود.
3.  **حسابداری:** طرف حساب، "درآمد ناشی از شناسایی دارایی" (یا تعدیلات سنواتی) خواهد بود.

### سناریوی ۲: کسری انبارگردانی دولتی
در وزارتخانه، ۱۰ صندلی کم آمده.

1.  طبق ماده قانون، جمعدار مسئول جبران خسارت است.
2.  سیستم سند خروج می‌زند.
3.  همزمان یک نامه به سیستم حقوق و دستمزد (Payroll) می‌فرستد تا مبلغ خسارت از حقوق ماهانه جمعدار کسر شود.

### سناریوی ۳: سرقت در جریان ساخت (CIP Theft)
کابل‌های مسی یک پروژه نیمه‌کاره دزدیده شده.

1.  چون هنوز "دارایی ثابت" نشده و در حساب "پروژه" است، استهلاک ندارد.
2.  مبلغ کابل‌های دزدیده شده مستقیماً از حساب "دارایی در جریان تکمیل" کسر و به "زیان حوادث" منتقل می‌شود.

---

## ۶. تعامل با سایر بخش‌ها (Integration)

1.  **با منابع انسانی (HR / Payroll):**
    * اگر گزینه "جریمه پرسنل" فعال شود، سیستم باید یک وام/کسورات برای کارمند در ماژول حقوق ایجاد کند.

2.  **با حساب‌های انتظامی (Off-Balance Sheet):**
    * در سازمان‌های دولتی، وقتی پرونده به دادگاه می‌رود، دارایی از دفاتر خارج می‌شود اما در "حساب‌های انتظامی" (طرف حساب‌های انتظامی) باز می‌ماند تا رای دادگاه بیاید. سیستم باید این حسابداری سایه (Shadow Accounting) را پشتیبانی کند.

---

## ۷. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) تعلیق دارایی (Asset Suspension Logic)
وقتی وضعیت دارایی `Lost - Pending` است:

* نباید در لیست "اموال‌گردانی دور بعد" بیاید (چون می‌دانیم نیست).
* نباید برایش "استهلاک" محاسبه شود (مگر اینکه تنظیمات بگوید ادامه بده).
* نباید اجازه "نقل و انتقال" داشته باشد.

### ب) محرمانگی (Privacy & Security)
اطلاعات مربوط به "سرقت" و "مقصرین" حساس است.

* دسترسی به این فرم باید محدود به مدیران ارشد و حراست باشد. جمعدار عادی نباید بتواند گزارش پلیس را ببیند یا پاک کند.

### ج) تاریخ موثر (Effective Date Backdating)
اگر سرقت امروز کشف شود اما دزد اعتراف کند که ۶ ماه پیش دزدیده:

* سیستم باید بتواند استهلاک ۶ ماه گذشته را (که اشتباهاً محاسبه شده) برگشت دهد (Reversal).

---

## ۸. پرسش‌های متداول (FAQ)

**س: اگر بیمه پول خسارت را ۶ ماه بعد بدهد، سند چطور صادر می‌شود؟**

* **پاسخ:**
    * ماه ۱ (زمان سرقت): دارایی خارج می‌شود و کل مبلغ به حساب "حساب‌های دریافتنی از بیمه" (یا حساب‌های متفرقه) می‌رود.
    * ماه ۶ (دریافت چک): حساب دریافتنی بستانکار و بانک بدهکار می‌شود. اگر بیمه کمتر داد، مابه‌التفاوت زیان می‌شود.

**س: آیا مفقودی نیاز به تایید سادا (دولت) دارد؟**

* **پاسخ:** بله. در سامانه سادا گزینه‌ای برای "اعلام مفقودی/سرقت" وجود دارد. تا زمانی که پلیس تایید نکند، سادا اجازه حذف نهایی پلاک را نمی‌دهد.

**س: تفاوت "کسری انبارگردانی" با "مفقودی" چیست؟**

* **پاسخ:** "کسری" یک وضعیت موقت در حین شمارش است (شاید در اتاق بغلی باشد). "مفقودی" یک وضعیت تثبیت شده پس از پایان جستجو است که منجر به سند مالی می‌شود.

# فروش و مزایده دارایی (Asset Sale & Auction)

**مسیر دسترسی:** `دارایی ثابت > عملیات > فروش و مزایده`
**نام فنی:** `AssetSaleProcess`

## ۱. مقدمه و تفاوت‌های کلیدی

در ERP تابان، فروش دارایی به دو روش انجام می‌شود:

1.  **فروش مستقیم (Direct Sale):** مشتری مشخص است، قیمت توافق شده و فاکتور صادر می‌شود (معمولاً در بخش خصوصی).
2.  **مزایده عمومی (Public Auction):** خریدار مشخص نیست. دارایی به بالاترین پیشنهاد فروخته می‌شود (الزام قانونی بخش دولتی و شرکت‌های بزرگ).

### چالش اصلی: ارتباط با ماژول فروش (Sales Integration)
آیا برای فروش یک میز کهنه، باید در ماژول فروش "پیش‌فاکتور" و "حواله خروج" صادر کنیم؟

* **پاسخ:**
    * در **سیستم یکپارچه کامل**، بله. زیرا فروش دارایی مشمول **مالیات بر ارزش افزوده (VAT)** است و باید در سامانه مؤدیان ثبت شود.
    * ماژول دارایی ثابت تابان، نقش "تامین‌کننده" را برای ماژول فروش بازی می‌کند.

---

## ۲. چرخه عملیات مزایده (Auction Workflow)

این بخش مخصوص سازمان‌های دولتی و هلدینگ‌های بزرگ است که فروش اموال بدون تشریفات مزایده در آن‌ها ممنوع است.



### گام ۱: قیمت‌گذاری کارشناسی (Evaluation)
قبل از مزایده، دارایی باید توسط کارشناس رسمی دادگستری قیمت‌گذاری شود.

* **فیلد:** `ExpertPrice` (قیمت پایه کارشناسی).
* **کنترل:** قیمت فروش نمی‌تواند از قیمت پایه کمتر باشد (مگر در مزایده نوبت دوم).

### گام ۲: برگزاری مزایده (Auction Event)
یک پرونده مزایده در سیستم باز می‌شود.

* **اقلام:** لیست ۵۰ خودروی مازاد.
* **سپرده شرکت در مزایده:** ثبت ضمانت‌نامه‌ها یا فیش‌های واریزی شرکت‌کنندگان.

### گام ۳: ثبت پاکت‌ها و تعیین برنده (Bidding)
پیشنهادات (پاکت ب) در سیستم ثبت می‌شوند.

* سیستم به صورت اتوماتیک بالاترین قیمت را به عنوان **برنده (Winner)** مشخص می‌کند.
* سپرده نفرات اول و دوم نگهداری و بقیه آزاد می‌شود.

---

## ۳. چرخه فروش و صدور فاکتور (Sales & Invoicing)

پس از مشخص شدن خریدار (چه در مذاکره مستقیم، چه برنده مزایده)، فرآیند مالی آغاز می‌شود:

### مرحله ۱: صدور فاکتور فروش دارایی (Asset Invoice)
یک فاکتور فروش صادر می‌شود که اقلام آن "کالا" نیستند، بلکه "پلاک‌های اموال" هستند.

| شرح کالا | تعداد | مبلغ واحد | مالیات (VAT) | جمع کل |
| :--- | :--- | :--- | :--- | :--- |
| خودروی پژو پارس (پلاک ۱۲۳) | ۱ | ۳,۵۰۰,۰۰۰,۰۰۰ | ۳۵۰,۰۰۰,۰۰۰ | ۳,۸۵۰,۰۰۰,۰۰۰ |

> **نکته:** درآمد حاصل از این فاکتور به حساب "فروش" نمی‌رود، بلکه به حساب واسط **«وجوه حاصل از فروش دارایی»** می‌رود.

### مرحله ۲: دریافت وجه (Receipt)
خریدار مبلغ را واریز می‌کند و سند دریافت در خزانه‌داری ثبت می‌شود.

### مرحله ۳: سند قطعی خروج (Disposal Posting)
پس از تسویه حساب، سیستم سند نهایی خروج را در ماژول اموال صادر می‌کند:

1.  حذف بهای تمام شده دارایی.
2.  حذف استهلاک انباشته.
3.  بستن حساب واسط فروش.
4.  شناسایی **سود/زیان ناشی از واگذاری**.

---

## ۴. منطق حسابداری (Accounting Entries)

بیایید یک سناریوی کامل را بررسی کنیم.

* **دارایی:** بهای تمام شده ۱۰۰ ریال، استهلاک انباشته ۸۰ ریال (ارزش دفتری ۲۰).
* **فروش:** به مبلغ ۳۰ ریال + ۳ ریال مالیات (جمعاً ۳۳ ریال).

### الف) سند فاکتور فروش (در ماژول فروش صادر می‌شود):
| کد حساب | شرح | بدهکار | بستانکار |
| :--- | :--- | :--- | :--- |
| ۱۲۰ | حساب‌های دریافتنی (مشتری) | ۳۳ | -- |
| ۲۲۰ | مالیات بر ارزش افزوده فروش | -- | ۳ |
| **۲۹۰** | **حساب واسط واگذاری دارایی** | -- | **۳۰** |
*(دقت کنید: هنوز دارایی از دفاتر خارج نشده، فقط پول طلبکار شدیم).*

### ب) سند خروج دارایی (در ماژول اموال صادر می‌شود):
| کد حساب | شرح | بدهکار | بستانکار |
| :--- | :--- | :--- | :--- |
| **۲۹۰** | **حساب واسط واگذاری دارایی** | **۳۰** | -- |
| ۱۲۲ | استهلاک انباشته | ۸۰ | -- |
| ۱۲۱ | دارایی ثابت (بهای تمام شده) | -- | ۱۰۰ |
| ۷۰۱ | **سود ناشی از فروش دارایی** | -- | **۱۰** |

*(در اینجا حساب واسط ۲۹۰ صفر می‌شود و سود ۱۰ ریالی شناسایی می‌گردد).*

---

## ۵. جزئیات فرم فروش (Form Details)

این فرم پل ارتباطی بین "اموال" و "فروش" است.

| عنوان فیلد | نوع | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **نوع فروش** | Enum | بله | فروش مستقیم / مزایده. |
| **مشتری** | Lookup | بله | انتخاب مشتری از ماژول CRM/فروش. |
| **شماره مزایده** | String | شرطی | اگر نوع مزایده باشد. |
| **لیست دارایی‌ها** | Grid | بله | انتخاب پلاک‌هایی که فروخته می‌شوند. |
| **مبلغ فروش** | Money | بله | مبلغ توافق شده (بدون مالیات). |
| **هزینه‌های فروش** | Money | خیر | هزینه کارشناسی، آگهی روزنامه، کمیسیون حراج (این هزینه‌ها از سود فروش کسر می‌شوند). |
| **فاکتور رسمی؟** | Bool | بله | آیا نیاز به صدور فاکتور رسمی مالیاتی است؟ |

---

## ۶. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: فروش ضایعاتی (Bulk Scrap Sale)
کارخانه ۱۰۰۰ عدد صندلی و میز شکسته دارد. این‌ها را دانه‌دانه نمی‌فروشد، بلکه "کیلویی" به خریدار ضایعات می‌دهد.

1.  **انتخاب:** انتخاب ۱۰۰۰ پلاک در فرم خروج.
2.  **قیمت‌گذاری:** مبلغ کل قرارداد (مثلاً ۵۰ میلیون تومان) وارد می‌شود.
3.  **تسهیم:** سیستم ۵۰ میلیون را به نسبت ارزش دفتری (یا مساوی) بین ۱۰۰۰ قلم تقسیم می‌کند تا سند حسابداری تراز شود.

### سناریوی ۲: تعویض (Trade-in)
شرکت یک کامیون قدیمی می‌دهد و یک کامیون نو می‌خرد و مابه‌التفاوت را می‌پردازد.

* این عملیات در تابان شامل دو سند جداگانه است:
    1.  **سند فروش:** فروش کامیون قدیمی به شرکت خودروساز (شناسایی سود/زیان).
    2.  **سند خرید:** خرید کامیون نو به قیمت کامل (ثبت دارایی جدید).
* *نکته:* تهاتر مانده حساب مشتری/فروشنده در خزانه‌داری انجام می‌شود.

### سناریوی ۳: مزایده دولتی (سامانه ستاد)
سازمان دولتی اموال را در "سامانه تدارکات الکترونیکی دولت (ستاد)" می‌فروشد.

1.  خروجی اکسل لیست اموال از ERP تابان گرفته می‌شود.
2.  در سامانه ستاد بارگذاری می‌شود.
3.  پس از مشخص شدن برنده در ستاد، نام برنده و مبلغ نهایی در تابان وارد شده و سند خروج صادر می‌شود.

---

## ۷. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) قفل دارایی در حین مزایده (Auction Lock)
وقتی دارایی وارد "لیست مزایده" شد، وضعیت آن باید به `Locked for Auction` تغییر کند.

* در این حالت: نقل و انتقال، تعمیرات، و تغییر وضعیت ممنوع است.
* اگر مزایده برنده نداشت، وضعیت به `Active` یا `Idle` برمی‌گردد.

### ب) محاسبه مالیات (VAT Calculation)
محاسبه مالیات فروش دارایی پیچیده است.

* برخی دارایی‌ها (مثل خودروهای سواری در قانون جدید ایران) معافیت‌های خاص یا نرخ‌های خاص دارند.
* سیستم باید از تنظیمات "گروه مالیاتی دارایی" (Tax Group) استفاده کند، نه تنظیمات عمومی کالا.

### ج) اعتبارسنجی خریدار
در مزایده‌ها، خریدار نباید از "کارکنان دولت" یا "بستگان مدیران" باشد (قانون منع مداخله).

* سیستم می‌تواند کدملی برنده را با لیست سیاه یا لیست پرسنل چک کند و هشدار دهد.

---

## ۸. پرسش‌های متداول (FAQ)

**س: اگر دارایی را به صورت قسطی بفروشیم چه می‌شود؟**

* **پاسخ:** سند خروج همان لحظه تحویل صادر می‌شود و سود شناسایی می‌گردد. اقساط مربوط به ماژول "خزانه‌داری" و پیگیری مطالبات است. خروج دارایی معطل قسط آخر نمی‌ماند.

**س: هزینه‌های برگزاری مزایده (آگهی روزنامه) را چطور ثبت کنیم؟**

* **پاسخ:** این هزینه‌ها در سند خروج به عنوان "هزینه واگذاری" ثبت می‌شوند و مستقیماً از "سود حاصل از فروش" کسر می‌گردند (Net Gain).

**س: اگر برنده مزایده انصراف داد، سپرده‌اش چه می‌شود؟**

* **پاسخ:** سپرده ضبط می‌شود (درآمد متفرقه). سپس سیستم نفر دوم را به عنوان برنده پیشنهاد می‌دهد یا مزایده تجدید می‌شود. دارایی از سیستم خارج نمی‌شود.

# اسقاط و انهدام دارایی (Asset Scrapping & Destruction)

**مسیر دسترسی:** `دارایی ثابت > عملیات > اسقاط و انهدام`
**نام فنی:** `AssetScrapProcess`

## ۱. مقدمه و فلسفه وجودی

چرا اسقاط فرآیندی جداگانه است؟

1.  **جنبه فنی:** اسقاط نیاز به «گواهی فنی» دارد. کسی باید تایید کند که "این دستگاه واقعاً غیرقابل تعمیر است".
2.  **جنبه انبار:** وقتی یک میز می‌شکند، از "لیست اموال" خارج می‌شود اما لاشه آهنی آن وارد "انبار ضایعات" می‌شود. این تغییر ماهیت (از دارایی ثابت به موجودی کالا) باید مدیریت شود.
3.  **جنبه قانونی (دولتی):** انهدام اموال دولتی تشریفات سخت‌گیرانه‌ای دارد (کمیسیون ماده ۱۰۸) تا از حیف‌ومیل بیت‌المال جلوگیری شود.

---

## ۲. چرخه عملیات اسقاط (The Scrapping Workflow)

این چرخه در ERP تابان ۴ مرحله دارد:

### مرحله ۱: اعلام خرابی و اسقاط (Technical Condemnation)
واحد فنی یا جمعدار اعلام می‌کند: "این پرینتر سوخته و هزینه تعمیرش بیشتر از خرید نو است."

* **وضعیت دارایی:** به `Pending Scrap` (در انتظار اسقاط) تغییر می‌کند.

### مرحله ۲: کارشناسی و تایید (Verification)
* **بخش خصوصی:** تایید مدیر فنی.
* **بخش دولتی:** بازدید "کمیسیون اسقاط". اعضا باید لاشه را رؤیت کنند و صورتجلسه کنند.

### مرحله ۳: عملیات فیزیکی (Physical Disposition)
دارایی از محل استقرار (مثلاً اتاق ۱۰۲) جمع‌آوری شده و به **«محوطه اسقاط / انبار ضایعات»** منتقل می‌شود.

* *نکته سیستمی:* اگر لاشه ارزش داشته باشد (مثلاً مس، آهن)، در این مرحله یک سند "رسید انبار ضایعات" صادر می‌شود.

### مرحله ۴: عملیات مالی (Financial Write-off)
صدور سند حسابداری برای حذف ارزش دفتری و شناسایی زیان.

---

## ۳. منطق حسابداری (Accounting Logic)

اسقاط معمولاً منجر به **زیان** می‌شود، مگر اینکه دارایی کاملاً مستهلک شده باشد.

### سناریوی ۱: اسقاط بدون ارزش لاشه (Total Loss)
یک میز چوبی شکسته که باید سوزانده یا دور ریخته شود.

* **ارزش دفتری:** ۱۰ میلیون ریال (بهای تمام شده ۲۰ - استهلاک ۱۰).
* **سند حسابداری:**
    * بدهکار: استهلاک انباشته (۱۰)
    * **بدهکار: زیان ناشی از اسقاط دارایی (۱۰)**
    * بستانکار: دارایی ثابت (۲۰)

### سناریوی ۲: اسقاط با ارزش لاشه (Recycling Value)
یک کابل مسی فشار قوی که سوخته، اما مس آن کیلویی ارزش دارد.

* **ارزش دفتری:** ۱۰ میلیون ریال.
* **ارزش کارشناسی ضایعات:** ۲ میلیون ریال.
* **سند حسابداری:**
    * بدهکار: استهلاک انباشته (۱۰)
    * **بدهکار: موجودی کالا / انبار ضایعات (۲)** <-- *دارایی تبدیل به موجودی شد*
    * **بدهکار: زیان ناشی از اسقاط (۸)**
    * بستانکار: دارایی ثابت (۲۰)

> **نکته:** آن ۲ میلیون تومان "موجودی ضایعات" بعداً در یک مزایده فله‌ای فروخته می‌شود و سودش شناسایی می‌گردد.

---

## ۴. جزئیات فرم اسقاط (Form Details)

| عنوان فیلد | نوع | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **دارایی** | Lookup | بله | انتخاب پلاک. |
| **تاریخ اسقاط** | Date | بله | تاریخ صورتجلسه انهدام. |
| **علت اسقاط** | Enum | بله | (فرسودگی کامل، حوادث غیرمترقبه، عدم کارایی فنی، هزینه تعمیر بالا). |
| **گواهی فنی** | File | بله | تصویر نامه کارشناس فنی که "غیرقابل تعمیر بودن" را تایید کرده. |
| **روش امحاء** | Enum | خیر | (دفن، سوزاندن، فروش ضایعاتی، بازیافت). |
| **ارزش لاشه (Scrap Value)** | Money | خیر | اگر قرار است به انبار ضایعات برود، ارزش تخمینی آن چقدر است؟ |
| **انبار مقصد** | Lookup | شرطی | اگر ارزش لاشه > ۰ باشد، باید انبار ضایعات انتخاب شود. |

---

## ۵. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: انهدام اسناد و تجهیزات حساس (بخش امنیتی/بانکی)
یک هارد سرور بانکی باید اسقاط شود. نمی‌توان آن را فروخت (خطر نشت اطلاعات).

1.  **روش:** انهدام فیزیکی (خرد کردن/Shattering).
2.  **فرآیند:** نماینده حراست حضور می‌یابد. هارد خرد می‌شود.
3.  **ثبت در سیستم:** گزینه "انهدام کامل" انتخاب می‌شود. ارزش لاشه "صفر" ثبت می‌شود. عکس قطعات خرد شده پیوست می‌شود.

### سناریوی ۲: خودروهای فرسوده (دولتی)
یک سازمان دولتی تعدادی خودروی پلاک قرمز دارد که عمرشان تمام شده.

1.  طبق قانون، این خودروها نباید فروخته شوند (تا دوباره وارد خیابان نشوند).
2.  باید به مراکز اسقاط تحویل داده شوند و "گواهی اسقاط" دریافت شود.
3.  در سیستم تابان، شماره "گواهی اسقاط" ثبت می‌شود و خودرو از دفاتر حذف می‌گردد.

### سناریوی ۳: تفکیک قطعات (Cannibalization)
یک لیفتراک خراب می‌شود. تعمیر نمی‌شود، اما لاستیک‌ها و موتورش سالم است.

1.  **اقدام:** اسقاط لیفتراک اصلی.
2.  **تفکیک:**
    * بدنه فلزی -> انبار ضایعات (کیلویی).
    * موتور -> انبار قطعات یدکی (به عنوان قطعه دست دوم رسید می‌شود).
    * لاستیک -> انبار قطعات یدکی.
3.  **اثر مالی:** ارزش این قطعات بازیافتی از "زیان اسقاط" کم می‌کند.

---

## ۶. تعامل با سایر بخش‌ها (Integration)

1.  **با انبار (Inventory):**
    * مهم‌ترین تعامل اینجاست. تبدیل "پلاک اموال" به "کد کالای انبار" (SKU). سیستم باید اجازه دهد کاربر کد کالای ضایعاتی را انتخاب کند.

2.  **با نگهداری و تعمیرات (Maintenance):**
    * معمولاً درخواست اسقاط از دلِ ماژول تعمیرات بیرون می‌آید (وقتی که کارشناس می‌زند: *Beyond Economic Repair*).

---

## ۷. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) سند مرکب (Composite Transaction)
در اسقاط با ارزش لاشه، سیستم باید همزمان دو کار انجام دهد:

1.  در ماژول اموال: دارایی را `Disposed` کند.
2.  در ماژول انبار: یک `Goods Receipt` (رسید ضایعات) صادر کند.
* این دو عملیات باید در یک `Database Transaction` باشند.

### ب) کنترل استهلاک (Full Depreciation check)
بسیاری از شرکت‌ها اجازه اسقاط دارایی را نمی‌دهند مگر اینکه کاملاً مستهلک شده باشد (NBV = 0).

* سیستم باید یک `Warning` (هشدار) بدهد: *"این دارایی هنوز ۱۰ میلیون ارزش دفتری دارد. آیا از اسقاط و شناسایی زیان مطمئن هستید؟"*

### ج) پیوست اجباری (Mandatory Attachment)
برای جلوگیری از تقلب (فروختن دارایی سالم و ثبت آن به عنوان اسقاط)، سیستم می‌تواند تنظیم شود که "آپلود عکس لاشه" اجباری باشد.

---

## ۸. پرسش‌های متداول (FAQ)

**س: آیا زیان ناشی از اسقاط، هزینه قابل قبول مالیاتی است؟**

* **پاسخ:** در قانون مالیات‌های ایران، "زیان دفتری" ناشی از حوادث یا اسقاط معمولاً با ارائه مستندات قوی (صورتجلسه، عکس، تایید کارشناس) پذیرفته می‌شود. اگر مستندات ناقص باشد، ممیز آن را رد می‌کند. به همین دلیل بخش "پیوست‌ها" در تابان حیاتی است.

**س: اگر دارایی را اسقاط کردیم و ۶ ماه بعد فهمیدیم اشتباه شده (گم شده بود، اسقاط نبود)، چه کنیم؟**

* **پاسخ:** عملیات اسقاط (چون سند انبار تولید کرده) برگشت‌ناپذیر است.
    * راهکار: باید یک دارایی جدید (با روش تحصیل "استقرار/یافت شده") ایجاد کنید و با ارزش کارشناسی روز ثبت نمایید.

**س: تکلیف "پلاک اموال" چه می‌شود؟**

* **پاسخ:** پلاک فیزیکی باید امحاء شود. در سیستم، شماره پلاک "بایگانی" می‌شود و هرگز به دارایی دیگری تخصیص داده نمی‌شود (برای حفظ یکپارچگی تاریخی).

# خروج و برکناری دارایی (Asset Disposal & Retirement)

**مسیر دسترسی:** `دارایی ثابت > عملیات > خروج و فروش دارایی`
**نام فنی:** `AssetDisposalTransaction`

## ۱. مقدمه و فلسفه وجودی

یک دارایی به دلایل مختلفی از سازمان خارج می‌شود: شاید فروخته شود، شاید اسقاط شود (آهن قراضه)، شاید دزدیده شود و شاید به سازمان دیگری اهدا گردد.

در حسابداری، به این فرآیند **«برکناری» (Derecognition)** می‌گویند.
سیستم باید در لحظه خروج، محاسبات زیر را انجام دهد:

1.  **توقف استهلاک:** استهلاک تا روز خروج محاسبه شود.
2.  **حذف دفتری:** بهای تمام شده و استهلاک انباشته از حساب‌ها پاک شوند.
3.  **محاسبه سود/زیان:** آیا از فروش این آهن قراضه سود کردیم یا ضرر؟

> **قانون طلایی سیستم:** دارایی خارج شده هرگز حذف (Delete) نمی‌شود؛ بلکه وضعیت آن به `Disposed` تغییر کرده و ارزش دفتری‌اش صفر می‌شود، اما سوابقش برای همیشه باقی می‌ماند.

---

## ۲. سناریوهای خروج (Disposal Scenarios)

ERP تابان ۴ سناریوی اصلی را پوشش می‌دهد که هر کدام منطق حسابداری متفاوتی دارند:

### الف) فروش (Sale)
* **سناریو:** فروش یک خودروی شرکت به شخص ثالث.
* **ویژگی‌ها:** جریان نقدینگی دارد (پول می‌گیریم). مشمول مالیات بر ارزش افزوده (VAT) می‌شود (در بخش خصوصی).
* **خروجی:** شناسایی سود/زیان غیرعملیاتی.

### ب) اسقاط و انهدام (Scrap)
* **سناریو:** یک پرینتر قدیمی که دیگر روشن نمی‌شود و ارزش تعمیر ندارد.
* **ویژگی‌ها:** جریان نقدینگی ندارد (یا بسیار ناچیز به عنوان ضایعات). نیاز به "گواهی فنی اسقاط" دارد.
* **خروجی:** شناسایی زیان (به اندازه ارزش دفتری باقیمانده).

### ج) اهدا / انتقال بلاعوض (Donation / Transfer)
* **سناریو (دولتی):** انتقال تجهیزات از وزارتخانه به یک دانشگاه دولتی.
* **ویژگی‌ها:** پولی رد و بدل نمی‌شود. در بخش دولتی طبق **ماده ۱۰۶ و ۱۰۷ قانون محاسبات عمومی** انجام می‌شود.
* **خروجی:** کاهش سرمایه یا هزینه اهدایا.

### د) مفقودی / سرقت قطعی (Loss / Write-off)
* **سناریو:** لپ‌تاپی که ۶ ماه پیش دزدیده شده و پلیس پرونده را بسته است.
* **ویژگی‌ها:** تبدیل "مفقودی موقت" به "خروج دائم".
* **خروجی:** شناسایی زیان حوادث.

---

## ۳. جریان فرآیند خروج (Disposal Workflow)

خروج دارایی یک تصمیم یک‌نفره نیست. در تابان این فرآیند به صورت "گردش کار" (Workflow) طراحی شده است:

### گام ۱: درخواست خروج (Initiation)
جمعدار یا مدیر واحد فنی، درخواست خروج را ثبت می‌کند.

* *علت:* "هزینه تعمیرات این دستگاه از قیمت نو آن بیشتر است."
* *وضعیت دارایی:* قفل می‌شود (Pending Disposal).

### گام ۲: کارشناسی فنی (Technical Inspection)
کارشناس فنی بازدید می‌کند و تایید می‌کند که "بله، این دستگاه قابل تعمیر نیست". (جلوگیری از فروش دارایی‌های سالم توسط پرسنل).

### گام ۳: تصویب (Approval / Commission)
* **بخش خصوصی:** تایید مدیر مالی و مدیرعامل.
* **بخش دولتی:** طرح در **«کمیسیون ماده ۲ اموال»**. ۳ نفر امضا می‌کنند تا اجازه خروج صادر شود.

### گام ۴: اجرا و صدور سند (Execution)
پس از تایید نهایی، دکمه `Post` فعال می‌شود و سند حسابداری صادر می‌گردد.

---

## ۴. منطق حسابداری و فرمول‌ها (Accounting Logic)

موتور حسابداری تابان برای محاسبه سند خروج از فرمول استاندارد زیر استفاده می‌کند:

**۱. محاسبه ارزش دفتری (NBV):**

$$NBV = \text{Cost} - \text{Accumulated Depreciation}$$

**۲. محاسبه سود/زیان (Gain/Loss):**

$$\text{Gain/Loss} = \text{Proceeds (Sales Price)} - \text{NBV} - \text{Disposal Expenses}$$

### سند حسابداری نمونه (فروش با سود):
فرض کنید دارایی ۱۰۰ واحد خرید شده، ۸۰ واحد مستهلک شده (ارزش دفتری ۲۰). به قیمت ۳۰ فروخته می‌شود.

| کد حساب | شرح حساب | بدهکار (Dr) | بستانکار (Cr) | منطق |
| :--- | :--- | :--- | :--- | :--- |
| ۱۰۱ | **بانک / صندوق** | ۳۰ | -- | پول دریافتی |
| ۱۲۲ | **استهلاک انباشته** | ۸۰ | -- | بستن حساب استهلاک (Reverse) |
| ۱۲۱ | **دارایی ثابت (بهای تمام شده)** | -- | ۱۰۰ | خارج کردن اصل دارایی |
| ۷۰۱ | **سود حاصل از فروش دارایی** | -- | **۱۰** | مابه‌التفاوت (Balancing Figure) |

> **نکته دولتی:** در سیستم نظام نوین مالی، معمولاً سود و زیان شناسایی نمی‌شود و طرف حساب‌ها حساب‌های "ارزش خالص" یا "تغییرات در ارزش" هستند.

---

## ۵. جزئیات فرم خروج (Form Details)

| عنوان فیلد | نوع | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **نوع خروج** | Enum | بله | فروش، اسقاط، اهدا، سرقت. |
| **دارایی** | Lookup | بله | انتخاب پلاک (فقط دارایی‌های فعال). |
| **تاریخ خروج** | Date | بله | تاریخ قطعیت معامله. استهلاک تا این روز محاسبه می‌شود. |
| **مشتری / تحویل‌گیرنده** | FK | شرطی | در حالت فروش یا انتقال، طرف حساب کیست؟ |
| **مبلغ فروش (Proceeds)** | Money | شرطی | مبلغی که فروخته‌ایم (بدون ارزش افزوده). |
| **ارزش افزوده (VAT)** | Money | شرطی | اگر فروش مشمول مالیات باشد. |
| **هزینه‌های خروج** | Money | خیر | هزینه کارشناسی، هزینه حمل تا محل اوراقی، هزینه آگهی روزنامه. |
| **شماره مجوز/سادا** | String | **دولتی** | کد مجوز خزانه‌داری کل کشور (اجباری برای دولتی). |

---

## ۶. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: فروش خودرو (بخش خصوصی)
شرکت یک وانت را می‌فروشد.

1.  کاربر "نوع خروج" را **فروش** انتخاب می‌کند.
2.  سیستم به ماژول "فروش" وصل می‌شود و یک **فاکتور فروش** رسمی صادر می‌کند (جهت محاسبه مالیات و سامانه مؤدیان).
3.  پس از تایید فاکتور، سند خروج دارایی اتوماتیک صادر می‌شود.

### سناریوی ۲: انتقال به انبار اسقاط (Scrap Yard)
۵۰ تا صندلی شکسته داریم. نمی‌فروشیم، فقط می‌خواهیم از اتاق‌ها جمع کنیم و بریزیم در انبار ضایعات.

1.  **نوع:** اسقاط.
2.  **عملیات:** سیستم ارزش دفتری صندلی‌ها را صفر می‌کند (زیان شناسایی می‌کند).
3.  **لجستیک:** همزمان یک "حواله انبار" صادر می‌شود که این اقلام را به عنوان **«کالای ضایعاتی»** (با واحد کیلوگرم) در انبار ضایعات رسید می‌کند. (تبدیل دارایی به موجودی کالا).

### سناریوی ۳: خروج از سادا (بخش دولتی)
اداره کل می‌خواهد یک سرور را به دانشگاه تهران منتقل کند.

1.  ثبت درخواست در تابان.
2.  دریافت "مجوز خروج" از وزارت دارایی.
3.  وارد کردن "شماره مجوز" در فرم خروج.
4.  سیستم تابان از طریق وب‌سرویس به **سامانه سادا** پیام می‌دهد که "پلاک X از لیست اموال این اداره کسر شود".

---

## ۷. تعامل با سایر بخش‌ها (Integration)

1.  **با انبار (Inventory):**
    * در سناریوی اسقاط، دارایی از "اموال" خارج و به "انبار ضایعات" وارد می‌شود.

2.  **با فروش (Sales):**
    * فروش دارایی در بخش خصوصی حتماً باید از طریق ماژول فروش رد شود تا فاکتور رسمی صادر گردد.

3.  **با دفتر کل (GL):**
    * پیچیده‌ترین اسناد حسابداری (مرکب) در این بخش صادر می‌شوند.

---

## ۸. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) چک کردن وابستگی‌ها (Dependency Check)
قبل از خروج، سیستم باید چک کند:

* آیا دارایی "جزء" (Component) دارد؟ (مثلاً مانیتوری که زیرمجموعه کامپیوتر است). اگر والد خارج شود، فرزندان هم باید تعیین تکلیف شوند.
* آیا دارایی در "امانت" کسی است؟

### ب) محاسبه استهلاک میان‌دوره (Partial Depreciation)
اگر دارایی در ۲۰‌م ماه فروخته شود، سیستم باید **اول** استهلاک آن ۲۰ روز را محاسبه و سند بزند، و **سپس** سند خروج را صادر کند.

* اگر این کار انجام نشود، محاسبه سود و زیان غلط می‌شود (چون استهلاک انباشته ۲۰ روز کم بوده).

### ج) برگشت از خروج (Undo Disposal)
اگر معامله فسخ شد چه؟

* پیاده‌سازی `Rollback` برای خروج بسیار سخت است.
* راهکار: صدور یک سند معکوس (Reversal) دستی و فعال‌سازی مجدد دارایی با وضعیت "Active".

---

## ۹. پرسش‌های متداول (FAQ)

**س: اگر دارایی را بفروشیم و سود کنیم، مالیاتش چه می‌شود؟**

* **پاسخ:** سود حاصل از فروش دارایی (Capital Gain) در ایران مشمول مالیات بر درآمد است. سیستم این سود را در سرفصل جداگانه‌ای (۷۰۱) ثبت می‌کند تا ممیز مالیاتی ببیند.

**س: آیا می‌توانیم چند دارایی را یکجا بفروشیم (مزایده فله‌ای)؟**

* **پاسخ:** بله. در فرم خروج، امکان انتخاب "چند پلاک" وجود دارد. کاربر یک "مبلغ کل فروش" وارد می‌کند و سیستم این مبلغ را به نسبت "ارزش دفتری" بین دارایی‌ها تسهیم می‌کند (Pro-rata) تا سود/زیان هر کدام جداگانه دربیاید.

**س: برای دارایی که قبلاً "کاملاً مستهلک شده" (ارزش دفتری = ۰)، سند خروج چطور است؟**

* **پاسخ:**
    * اگر دور انداخته شود: هیچ اثر مالی ندارد (سند حسابداری نیاز نیست، فقط در دفاتر اموال باطل می‌شود).
    * اگر فروخته شود: کل مبلغ فروش، **سود خالص** شناسایی می‌شود.

# مخارج پس از تحصیل (Subsequent Expenditures)

**مسیر دسترسی:** `دارایی ثابت > عملیات > مخارج پس از تحصیل` (یا در فرم تعدیلات)
**نام فنی:** `AssetSubsequentExpenditure`

## ۱. مقدمه: دوراهی بزرگ (The Great Dilemma)

وقتی شما برای یک دارایی خرج می‌کنید (مثلاً موتور کامیون را تعمیر می‌کنید)، سیستم ERP تابان باید به یک سوال حیاتی پاسخ دهد:

> **«آیا این پول "هزینه جاری" است یا "سرمایه‌گذاری مجدد"؟»**

1.  **مخارج جاری (Revenue Expenditure / OpEx):** خرج‌هایی که فقط دارایی را در وضعیت عملیاتی نگه می‌دارند (مثل تعویض روغن، تعویض لنت، رنگ‌آمیزی دیوار).
    * *رفتار:* به عنوان **هزینه تعمیر و نگهداری** در صورت سود و زیان ثبت می‌شود.
2.  **مخارج سرمایه‌ای (Capital Expenditure / CapEx):** خرج‌هایی که باعث **بهبود** دارایی می‌شوند (افزایش عمر، افزایش ظرفیت، کاهش هزینه عملیاتی).
    * *رفتار:* به **بهای تمام شده دارایی** اضافه شده (Capitalize) و در سال‌های آینده مستهلک می‌شود.

---

## ۲. منطق تصمیم‌گیری (Decision Logic)

سیستم باید بر اساس فلوچارت زیر (استاندارد حسابداری ۱۱) رفتار کند:



* **شرط ۱:** آیا عمر مفید دارایی زیاد شده؟ (بله -> CapEx)
* **شرط ۲:** آیا ظرفیت تولید یا کیفیت محصول بالا رفته؟ (بله -> CapEx)
* **شرط ۳:** آیا هزینه قابل توجه است؟ (اصل اهمیت). اگر هزینه ناچیز باشد، حتی اگر عمر را زیاد کند، معمولاً جاری تلقی می‌شود.

---

## ۳. انواع مخارج پس از تحصیل

در ERP تابان، کاربر باید یکی از انواع زیر را انتخاب کند تا سیستم بداند چه سند حسابداری صادر کند:

### الف) تعمیر و نگهداری جزئی (Repairs & Maintenance)
* **ماهیت:** جلوگیری از خرابی یا رفع خرابی سطحی.
* **مثال:** سرویس دوره‌ای آسانسور، تعویض لامپ، پنچرگیری.
* **سند حسابداری:**
    * بدهکار: هزینه تعمیر و نگهداری (سود و زیان).
    * بستانکار: بانک / حساب‌های پرداختنی.
* **اثر بر دارایی:** هیچ (ارزش دفتری تغییر نمی‌کند).

### ب) تعمیرات اساسی / نوسازی (Major Overhaul / Renovation)
* **ماهیت:** بازسازی کلی که عمر دارایی را احیا می‌کند.
* **مثال:** تعویض کامل موتور کشتی، بازسازی کلی ساختمان (لوله‌کشی و سیم‌کشی مجدد).
* **سند حسابداری:**
    * بدهکار: دارایی ثابت (افزایش بها).
    * بستانکار: بانک.
* **اثر بر دارایی:** بهای تمام شده افزایش می‌یابد + عمر مفید (احتمالاً) بازنگری می‌شود.

### ج) الحاق و گسترش (Additions)
* **ماهیت:** اضافه کردن یک بخش فیزیکی جدید به دارایی موجود.
* **مثال:** اضافه کردن یک طبقه به ساختمان، اضافه کردن رم ۴ گیگ به لپ‌تاپ.
* **سند حسابداری:** افزایش بهای دارایی (یا ایجاد یک "جزء" جدید).

### د) تعویض قطعات اصلی (Replacement of Parts)
* **ماهیت:** برداشتن یک قطعه گران‌قیمت قدیمی و گذاشتن قطعه نو.
* **نکته پیشرفته (استاندارد IFRS):** در اینجا باید ارزش دفتری قطعه *قدیمی* حذف شود و ارزش قطعه *نو* اضافه شود. (اگر سیستم حسابداری اجزاء نداشته باشد، معمولاً فقط مابه‌التفاوت اضافه می‌شود یا به عنوان تعمیر اساسی ثبت می‌شود).

---

## ۴. جزئیات فرم ثبت مخارج (Form Details)

این فرم ترکیبی از ماژول "تدارکات" و "اموال" است.

| عنوان فیلد | نوع | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **دارایی** | Lookup | بله | انتخاب پلاک اموال. |
| **نوع مخارج** | Enum | بله | جاری (OpEx) / سرمایه‌ای (CapEx). |
| **شرح هزینه** | Text | بله | مثلاً: "تعویض گیربکس دستگاه تراش". |
| **مبلغ هزینه** | Money | بله | مبلغ فاکتور تعمیرات/خرید قطعه. |
| **تامین‌کننده** | Lookup | خیر | تعمیرکار یا فروشنده قطعه. |
| **آیا عمر مفید تغییر کرد؟** | Bool | شرطی | (فقط در CapEx) اگر بله، عمر جدید چقدر است؟ |
| **شماره فاکتور / دستور کار** | Link | خیر | لینک به ماژول تدارکات یا نت (CMMS). |

---

## ۵. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: تعویض هارد سرور (OpEx vs CapEx)
هارد سرور سوخته و با یک هارد مشابه تعویض می‌شود (هزینه ۵ میلیون).

* **تحلیل:** آیا عمر سرور زیاد شد؟ خیر. آیا ظرفیت زیاد شد؟ خیر (جایگزین شد).
* **انتخاب کاربر:** **«هزینه جاری»**.
* **نتیجه:** ۵ میلیون تومان به حساب "هزینه تعمیرات تجهیزات رایانه‌ای" می‌رود.

### سناریوی ۲: ارتقای سرور (Upgrade)
روی همان سرور قبلی، ۳۲ گیگ رم اضافه می‌کنیم تا سرعتش بالا برود (هزینه ۲۰ میلیون).

* **تحلیل:** بهبود عملکرد (Performance Improvement).
* **انتخاب کاربر:** **«مخارج سرمایه‌ای (الحاق)»**.
* **نتیجه:** ۲۰ میلیون به بهای تمام شده سرور اضافه می‌شود. استهلاک ماهانه سرور از ماه بعد افزایش می‌یابد (چون پایه استهلاک زیاد شده).

### سناریوی ۳: تعمیر اساسی ساختمان (Renovation)
سیستم گرمایش مرکزی ساختمان اداری با هزینه ۱ میلیارد تومان کلاً عوض می‌شود.

1.  **انتخاب:** مخارج سرمایه‌ای.
2.  **عملیات تکمیلی:** کاربر عمر مفید تاسیسات ساختمان را هم ۵ سال تمدید می‌کند.
3.  **نتیجه:** ارزش دفتری ساختمان ۱ میلیارد زیاد می‌شود، اما چون عمر مفید هم زیاد شده، ممکن است هزینه استهلاک ماهانه تغییر زیادی نکند (پخش شدن مبلغ در زمان طولانی‌تر).

---

## ۶. تعامل با سایر بخش‌ها (Integration)

### ۶-۱. با ماژول نگهداری و تعمیرات (CMMS) - حیاتی
این نقطه اتصال، رویای مدیران فنی و مالی است.

1.  مهندس فنی یک **«دستور کار» (Work Order)** باز می‌کند: "تعمیر اساسی توربین".
2.  قطعات و دستمزد در دستور کار ثبت می‌شود (جمعاً ۵۰۰ میلیون).
3.  مهندس فنی هنگام بستن دستور کار، تیک **«تعمیر اساسی (Major Overhaul)»** را می‌زند.
4.  **سیستم:** به جای اینکه ۵۰۰ میلیون را هزینه کند، یک فرم "مخارج سرمایه‌ای" در کارتابل اموال ایجاد می‌کند.
5.  حسابدار اموال فقط تایید می‌کند.

### ۶-۲. با انبار (Inventory)
اگر قطعه‌ای از انبار خارج شود (حواله مصرف) که گران‌قیمت باشد:

* سیستم بر اساس **"حد نصاب"** می‌تواند پیشنهاد دهد که این قطعه باید روی دارایی مادر Capitalize شود، نه اینکه صرفاً مصرف شود.

---

## ۷. منطق محاسباتی (Recalculation Engine)

پس از ثبت یک خرج سرمایه‌ای (CapEx)، موتور استهلاک باید فرمول زیر را اجرا کند:

$$هزینه استهلاک جدید = \frac{(\text{ارزش دفتری قبل} + \text{مخارج سرمایه‌ای جدید} - \text{ارزش اسقاط})}{عمر مفید باقیمانده (جدید یا قدیم)}$$

> **نکته:** این تغییر "آتی‌نگر" است و استهلاک ماه‌های قبل را تغییر نمی‌دهد.

---

## ۸. پرسش‌های متداول (FAQ)

**س: اگر هزینه‌ای "سرمایه‌ای" باشد اما مبلغش کم باشد (مثلاً ۱۰۰ هزار تومان)، چه کنیم؟**

* **پاسخ:** طبق اصل **«اهمیت» (Materiality)** در حسابداری، شرکت‌ها یک "کف قیمتی" تعیین می‌کنند. اگر هزینه زیر آن مبلغ باشد، حتی اگر عمر را زیاد کند، به عنوان "هزینه جاری" ثبت می‌شود تا پیچیدگی محاسبات کم شود.

**س: در بخش دولتی (نظام نوین)، تعمیرات اساسی چگونه ثبت می‌شود؟**

* **پاسخ:** در دولت، معمولاً از سرفصل بودجه "تملک دارایی‌های سرمایه‌ای" برای تعمیرات اساسی استفاده می‌شود. سیستم باید اجازه دهد کد بودجه مربوطه انتخاب شود و حساب "دارایی" بدهکار شود.

**س: آیا می‌توانم مخارج سرمایه‌ای را روی "دارایی کاملاً مستهلک شده" انجام دهم؟**

* **پاسخ:** بله. این کار باعث می‌شود ارزش دفتری دارایی از صفر (یا ۱ ریال) به مبلغ هزینه انجام شده افزایش یابد و دارایی دوباره "زنده" شود و برای آن استهلاک جدید محاسبه گردد (معمولاً همراه با بازنگری عمر مفید).

# اموال‌گردانی و ممیزی دارایی (Asset Physical Count)

**مسیر دسترسی:** `دارایی ثابت > عملیات > اموال‌گردانی`
**نام فنی:** `AssetPhysicalInventory`

## ۱. مقدمه و فلسفه وجودی

در طول سال مالی، اتفاقات زیادی می‌افتد: صندلی‌ها بین اتاق‌ها جابجا می‌شوند، یک مانیتور خراب به انبار می‌رود و شاید یک پرینتر دزدیده شود، بدون اینکه کسی در سیستم ثبت کند.
نتیجه؟ **«مغایرت» (Discrepancy)** بین دفاتر حسابداری و واقعیت فیزیکی.

ماژول اموال‌گردانی تابان وظیفه دارد این شکاف را پر کند. این ماژول یک **«عکس فوری» (Snapshot)** از وضعیت موجود می‌گیرد، آن را با دفاتر مقایسه می‌کند و به مدیران می‌گوید چه چیزی کم یا زیاد است.

### اهداف اصلی:
1.  **کشف کسری (Deficit):** دارایی‌هایی که باید باشند، اما نیستند (احتمال سرقت).
2.  **کشف اضافی (Surplus):** دارایی‌هایی که هستند، اما پلاک ندارند یا در سیستم نیستند.
3.  **اصلاح محل استقرار:** به‌روزرسانی مکان واقعی دارایی‌ها.

---

## ۲. چرخه عملیات اموال‌گردانی (The Counting Workflow)

فرآیند اموال‌گردانی در تابان ۴ مرحله استاندارد دارد:

### مرحله ۱: برنامه‌ریزی و ایجاد دوره (Planning)
مدیر اموال یک "دوره شمارش" باز می‌کند.

* **محدوده (Scope):** کل سازمان؟ یا فقط "ساختمان مرکزی"؟ یا فقط "تجهیزات IT"؟
* **تیم شمارش:** چه کسانی مجاز به شمارش هستند؟
* **روش شمارش:**
    * **شمارش باز (Open Count):** شمارشگر لیست دارایی‌های مورد انتظار را در هندهلد می‌بیند.
    * **شمارش کور (Blind Count):** شمارشگر لیست را نمی‌بیند (برای جلوگیری از تقلب) و فقط اسکن می‌کند.

### مرحله ۲: شمارش میدانی (Execution)
تیم شمارش با استفاده از **«اپلیکیشن موبایل تابان»** (روی هندهلد یا گوشی) وارد اتاق‌ها می‌شوند.

1.  بارکد مکان (QR روی درب اتاق) را اسکن می‌کنند.
2.  شروع به اسکن کردن پلاک‌های داخل اتاق می‌کنند (با بارکدخوان یا RFID).
3.  اگر دارایی پلاک نداشت یا مخدوش بود، امکان ثبت دستی یا عکس‌برداری وجود دارد.

### مرحله ۳: مغایرت‌گیری سیستمی (Comparison)
سیستم به صورت اتوماتیک داده‌های اسکن شده را با دیتابیس مقایسه می‌کند و دارایی‌ها را در ۴ دسته قرار می‌دهد:

1.  **تطبیق کامل (Matched):** در سیستم بود، در اتاق هم پیدا شد. ✅
2.  **کسری (Missing/Deficit):** در سیستم باید در این اتاق می‌بود، اما پیدا نشد. ❌
3.  **اضافی (Surplus):** پلاک در این اتاق پیدا شد، اما طبق سیستم باید جای دیگری می‌بود (جابجایی ثبت نشده). ⚠️
4.  **ناشناس (Unknown):** پلاکی اسکن شده که اصلاً در دیتابیس وجود ندارد! ❓

### مرحله ۴: تعیین تکلیف و بستن (Reconciliation)
مدیر گزارش مغایرت را می‌بیند و تصمیم می‌گیرد:

* برای **کسری‌ها**: یا "اعلام مفقودی/سرقت" می‌کند یا "سند خروج" می‌زند.
* برای **اضافی‌ها (جابجا شده)**: سیستم پیشنهاد می‌دهد: *"آیا محل استقرار این‌ها در سیستم به محل جدید آپدیت شود؟"* با یک کلیک، محل اصلاح می‌شود.
* برای **ناشناس‌ها**: دستور پلاک‌کوبی جدید صادر می‌شود.

---

## ۳. جزئیات فرم اموال‌گردانی (Form Details)

این فرم دارای یک "هدر" (تنظیمات دوره) و یک "گرید عملیاتی" (لیست شمارش) است.

| عنوان فیلد | شرح و منطق بیزینسی |
| :--- | :--- |
| **عنوان دوره** | مثلاً: "اموال‌گردانی پایان سال ۱۴۰۲ - ساختمان شماره ۱". |
| **تاریخ شروع/پایان** | بازه زمانی مجاز برای شمارش. |
| **وضعیت دوره** | `برنامه‌ریزی شده` -> `در حال شمارش` -> `تکمیل شده` -> `بسته شده`. |
| **مسئول شمارش** | نام جمعدار یا تیم پیمانکار. |
| **تعداد دفتری** | تعداد کل دارایی‌هایی که سیستم انتظار دارد پیدا کند (مثلاً ۱۰۰۰ عدد). |
| **تعداد شمارش شده** | تعداد واقعی اسکن شده (مثلاً ۹۸۰ عدد). |
| **درصد پیشرفت** | نوار گرافیکی وضعیت پیشرفت شمارش. |

---

## ۴. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: کشف جابجایی خودسرانه (Private Sector)
کارمند واحد فروش، بدون اطلاع جمعدار، صندلی‌اش را با صندلی واحد مالی عوض کرده است.

1.  در اموال‌گردانی واحد مالی، صندلی آقای X پیدا می‌شود.
2.  سیستم هشدار می‌دهد: *"این پلاک متعلق به واحد فروش است ولی در واحد مالی پیدا شد (اضافی در محل)."*
3.  **اقدام:** مدیر تایید می‌کند و سیستم به صورت اتوماتیک محل استقرار را به "واحد مالی" تغییر می‌دهد (انتقال سیستمی).

### سناریوی ۲: سرعت RFID (Public Sector)
یک دانشگاه دولتی با ۱۰,۰۰۰ میز و صندلی. شمارش دستی ۲ ماه طول می‌کشد.

1.  تگ RFID زیر میزها چسبیده است.
2.  جمعدار با هندهلد در راهرو راه می‌رود.
3.  در عرض ۳ روز، کل ۱۰,۰۰۰ قلم خوانده می‌شود.
4.  سیستم لیست ۲۰ میز "کسری" را چاپ می‌کند تا حراست پیگیری کند.

### سناریوی ۳: دارایی‌های مخدوش
جمعدار پلاکی را می‌بیند که بارکدش پاره شده.

1.  در اپلیکیشن موبایل، گزینه "جستجوی دستی" را می‌زند.
2.  شماره پلاک (که عددش خواناست) را وارد می‌کند.
3.  سیستم تایید می‌کند.
4.  جمعدار تیک **"نیاز به چاپ مجدد"** را در اپلیکیشن می‌زند تا بعداً لیبل جدید صادر شود.

---

## ۵. تعامل با سایر بخش‌ها (Integration)

1.  **با اپلیکیشن موبایل (Mobile App):**
    * این ماژول بدون اپلیکیشن تقریباً بی‌معنی است. داده‌ها به صورت آنلاین (Wi-Fi) یا آفلاین (Batch Sync) بین سرور و هندهلد تبادل می‌شوند.

2.  **با حسابداری (GL Adjustment):**
    * اگر در پایان دوره، کسری‌ها تایید شوند (یعنی دزدی یا گم شدن قطعی باشد)، سیستم به ماژول حسابداری فرمان می‌دهد که سند **«زیان ناشی از کسری انبار/اموال»** را صادر کند.

3.  **با ماژول تعمیرات:**
    * اگر جمعدار حین شمارش ببیند دستگاهی خراب است، می‌تواند در همان لحظه در اپلیکیشن، وضعیت "خراب" را ثبت کند تا به کارتابل تعمیرات برود.

---

## ۶. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) فریز کردن موجودی (Inventory Freeze / Snapshot)
این مهم‌ترین چالش فنی است.

* وقتی دکمه "شروع شمارش" زده می‌شود، سیستم باید یک کپی از وضعیت دارایی‌ها (Location فعلی) در جدول `InventorySnapshot` ذخیره کند.
* **چرا؟** چون اگر در حینِ ۳ روز شمارش، کسی در سیستم دارایی جدیدی ثبت کند یا انتقالی انجام دهد، نباید محاسبات مغایرت بهم بریزد. مقایسه همیشه با "لحظه شروع" انجام می‌شود.

### ب) همگام‌سازی آفلاین (Offline Sync)
در زیرزمین‌ها و انبارها معمولاً وای‌فای آنتن نمی‌دهد.

* اپلیکیشن باید دیتابیس داخلی (SQLite/Realm) داشته باشد.
* لیست را دانلود کند، شمارش انجام شود و وقتی به شبکه وصل شد، نتیجه را آپلود کند.

### ج) موقعیت‌یاپی سلسله‌مراتبی (Location Hierarchy)
شمارش باید به تفکیک "اتاق" باشد.

* اگر ۱۰۰ تا صندلی درست باشد اما همگی در اتاق‌های غلط باشند، گزارش کلی می‌گوید "کسری نداریم"، اما گزارش دقیق می‌گوید "۱۰۰٪ جابجایی داریم". سیستم باید دقت در سطح اتاق (Room-Level Accuracy) داشته باشد.

---

## ۷. پرسش‌های متداول (FAQ)

**س: اگر یک دارایی را پیدا کنیم که پلاک ندارد، چه کنیم؟**

* **پاسخ:** در اپلیکیشن گزینه‌ای به نام "ثبت دارایی ناشناس" وجود دارد. شما عکس آن را می‌گیرید و موقتاً ثبت می‌کنید. بعداً مدیر اموال بررسی می‌کند که آیا این دارایی جدید است یا پلاک قدیمش کنده شده است.

**س: آیا حین اموال‌گردانی، عملیات نقل و انتقال در سیستم قفل می‌شود؟**

* **پاسخ:**
    * **روش سخت‌گیرانه (دولتی):** بله، تا پایان شمارش هیچ‌کس حق جابجایی سیستمی ندارد.
    * **روش منعطف (خصوصی):** خیر، اما سیستم هشداری می‌دهد که "این دارایی در لیست شمارش باز است".

**س: چند بار در سال باید اموال‌گردانی کنیم؟**

* **پاسخ:** سیستم محدودیتی ندارد. می‌توانید "اموال‌گردانی پیوسته" (Cycle Counting) داشته باشید؛ یعنی هر هفته فقط ۵٪ اموال را بشمارید، به طوری که در پایان سال همه چیز یک بار شمرده شده باشد. (این روش مدرن و پیشنهادی تابان است).

# تغییر وضعیت دارایی (Asset Status Change)

**مسیر دسترسی:** `دارایی ثابت > عملیات > تغییر وضعیت`
**نام فنی:** `AssetStatusChange`

## ۱. مقدمه و فلسفه وجودی

دارایی‌های ثابت همیشه در حال کار (Active) نیستند.

* ممکن است یک دستگاه خراب شود و ۶ ماه در تعمیرگاه باشد.
* ممکن است یک خودرو دزدیده شود و وضعیتش نامشخص باشد.
* ممکن است یک خط تولید متوقف شود و ماشین‌آلاتش "راکد" شوند.

ماژول **تغییر وضعیت** وظیفه دارد این تغییرات فیزیکی را به **منطق‌های سیستمی** (مثل توقف استهلاک یا قفل کردن نقل‌وانتقال) ترجمه کند.
بدون این ماژول، گزارشات مالی "دروغ" می‌گویند (مثلاً برای دستگاهی که دزدیده شده، همچنان هزینه استهلاک شناسایی می‌کنند!).

---

## ۲. چرخه حیات و وضعیت‌های استاندارد (State Lifecycle)

ERP تابان از وضعیت‌های استاندارد زیر پشتیبانی می‌کند. هر وضعیت، رفتار سیستم را تغییر می‌دهد:

| وضعیت (Status) | شرح بیزینسی | آیا استهلاک محاسبه می‌شود؟ | آیا قابل انتقال است؟ |
| :--- | :--- | :---: | :---: |
| **فعال (Active)** | وضعیت عادی. دارایی در حال استفاده است. | ✅ بله | ✅ بله |
| **راکد / بلااستفاده (Idle)** | دارایی سالم است اما فعلاً استفاده نمی‌شود (در انبار خوابیده). | ✅ بله (طبق استاندارد ۱۱) | ✅ بله |
| **در دست تعمیر (Under Repair)** | دارایی موقتاً از دسترس خارج شده (نزد تعمیرکار). | ✅ بله (معمولاً) | ❌ خیر (قفل) |
| **نگهداری برای فروش (Held for Sale)** | تصمیم قطعی برای فروش گرفته شده. منتظر خریدار. | ❌ **خیر (متوقف)** | ❌ خیر |
| **مفقود / سرقت (Lost/Stolen)** | دارایی وجود ندارد، اما هنوز از دفاتر حذف نشده (بلاتکلیف). | ❌ **خیر (تعلیق)** | ❌ خیر |
| **اسقاط شده (Scrapped)** | دارایی از دفاتر حذف شده (لاشه). | -- (پایان عمر) | -- |
| **فروخته شده (Sold)** | دارایی از دفاتر حذف شده (خروج). | -- (پایان عمر) | -- |

> **نکته مهم قانونی (ایران):** طبق استانداردهای حسابداری ایران، دارایی **«راکد»** همچنان مستهلک می‌شود (چون فرسودگی ناشی از گذشت زمان دارد)، مگر اینکه رسماً به طبقه **«نگهداری برای فروش»** (مبحث دارایی‌های غیرجاری نگهداری شده برای فروش) منتقل شود.

---

## ۳. منطق عملکردی فرم (Functional Logic)

این فرم صرفاً یک ویرایشگر نیست؛ بلکه یک "تراکنش" (Transaction) است.

### ۳-۱. تاریخ مؤثر (Effective Date)
کاربر باید مشخص کند این تغییر وضعیت **از چه تاریخی** رخ داده است.

* *مثال:* امروز (۱۵ مهر) متوجه شدیم دستگاه از ۱ مهر خراب بوده است.
* **اثر:** موتور استهلاک باید هوشمند باشد و اگر استهلاک مهرماه را حساب کرده، آن را اصلاح (Reverse) کند یا تعدیل نماید.

### ۳-۲. مستندات مثبته
تغییر وضعیت "الکی" نیست! سیستم برای برخی وضعیت‌ها مدرک می‌خواهد:

* تغییر به **سرقت** -> اجبار به آپلود "صورتجلسه پلیس/حراست".
* تغییر به **اسقاط** -> اجبار به آپلود "نظریه کارشناس فنی".
* تغییر به **راکد** -> (در دولتی) اجبار به ثبت در سامانه سادا به عنوان "مازاد".

---

## ۴. جزئیات فرم تغییر وضعیت (Form Details)

| عنوان فیلد | نوع داده | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **شماره سند** | String | قفل | تولید خودکار (مثلاً `STC-1403-101`). |
| **دارایی** | Lookup | بله | انتخاب دارایی (فقط دارایی‌هایی که هنوز در دفاتر موجودند). |
| **وضعیت جاری** | Enum | قفل | وضعیت فعلی را نشان می‌دهد (مثلاً: فعال). |
| **وضعیت جدید** | Enum | بله | انتخاب وضعیت مقصد (مثلاً: راکد). |
| **تاریخ تغییر** | Date | بله | تاریخ وقوع رخداد. |
| **علت تغییر** | Enum | بله | (خرابی فنی، مازاد بر نیاز، دستور مدیریت، سرقت). |
| **توضیحات** | Text | خیر | شرح جزئیات (مثلاً: موتور سوخت و فعلاً قطعه یدکی ندارد). |
| **پیوست‌ها** | File | شرطی | مدارک ضمیمه. |

---

## ۵. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: آماده‌سازی برای مزایده (بخش دولتی/خصوصی)
شرکت تصمیم می‌گیرد ۱۰ خودرو را بفروشد. مزایده ۲ ماه طول می‌کشد.

1.  **اقدام:** تغییر وضعیت خودروها از "فعال" به **"نگهداری برای فروش"**.
2.  **اثر مالی:** سیستم محاسبه استهلاک را برای این خودروها **متوقف** می‌کند (تا ارزش دفتری ثابت بماند و سود/زیان فروش دقیق محاسبه شود).
3.  **اثر عملیاتی:** این خودروها دیگر در لیست "انتقال به پرسنل" نمایش داده نمی‌شوند (قفل می‌شوند).

### سناریوی ۲: سرقت نامشخص (Legal Limbo)
یک لپ‌تاپ از اتاق کنفرانس دزدیده شده. حراست در حال پیگیری است و هنوز دزد پیدا نشده.

1.  **اقدام:** تغییر وضعیت به **"مفقود/سرقت"**.
2.  **اثر مالی:** دارایی از حساب‌های عملیاتی خارج و به "حساب‌های انتظامی" (یا وضعیت تعلیق) می‌رود. استهلاک متوقف می‌شود.
3.  **نتیجه نهایی:** ۶ ماه بعد اگر پیدا شد -> وضعیت برمی‌گردد به "فعال". اگر پیدا نشد -> تغییر وضعیت به "خروج نهایی" (Write-off).

### سناریوی ۳: تعمیرات اساسی (Overhaul)
توربین نیروگاه برای تعمیرات اساسی (اورهال) باز می‌شود و ۳ ماه خاموش است.

1.  **اقدام:** تغییر وضعیت به **"در دست تعمیر"**.
2.  **اثر:** در این مدت جمعدار نمی‌تواند آن را به کسی تحویل دهد.
3.  **نکته:** استهلاک در زمان تعمیرات اساسی (اگر منجر به توقف تولید شود) ممکن است طبق سیاست شرکت متوقف شود یا ادامه یابد. (این یک تنظیم در `Depreciation Profile` است).

---

## ۶. تعامل با سایر بخش‌ها (Integration)

1.  **با ماژول نگهداری و تعمیرات (CMMS):**
    * وقتی در ماژول تعمیرات، یک "دستور کار" (Work Order) باز می‌شود، سیستم می‌تواند به صورت خودکار وضعیت دارایی را در FAM به "در دست تعمیر" تغییر دهد.
    * وقتی تعمیر تمام شد، وضعیت به "فعال" برمی‌گردد.

2.  **با سامانه سادا (بخش دولتی):**
    * اگر وضعیت دارایی دولتی به **"راکد" (مازاد)** تغییر کند، ERP تابان باید این تغییر را از طریق وب‌سرویس به سادا مخابره کند تا وزارت دارایی بداند این دستگاه مازاد است و شاید بخواهد به اداره دیگری منتقل کند.

---

## ۷. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) تاریخچه وضعیت (State History Pattern)
هرگز روی فیلد `Status` در جدول `AssetMaster` دستور `UPDATE` نزنید بدون اینکه سابقه را نگه دارید.

* جدول `AssetStatusHistory` باید تمام تغییرات را با `UserID` و `Timestamp` ذخیره کند.
* این تاریخچه برای گزارش "کارکرد دارایی" (Availability Report) حیاتی است. (دستگاه چند درصد سال در دسترس بوده؟).

### ب) اعتبارسنجی ماتریسی (State Transition Matrix)
همه تغییر وضعیت‌ها مجاز نیستند.

* **غلط:** تغییر از "اسقاط شده" به "فعال" (زنده کردن مرده!).
* **غلط:** تغییر از "فروخته شده" به "راکد".
* **صحیح:** سیستم باید یک ماتریس داشته باشد که بگوید از وضعیت A به کدام وضعیت‌ها می‌توان رفت.

### ج) بازگشت به عقب (Rollback Logic)
اگر کاربری اشتباهاً وضعیت را "سرقت" زد و فردا پشیمان شد:

* باید امکان "ابطال سند تغییر وضعیت" وجود داشته باشد، به شرطی که سند حسابداری نهایی صادر نشده باشد.

---

## ۸. پرسش‌های متداول (FAQ)

**س: تفاوت "راکد" (Idle) با "اسقاط" (Scrapped) چیست؟**

* **پاسخ:**
    * **راکد:** دارایی **سالم** است، فقط فعلاً کاری برایش نداریم. هنوز ارزش دارد و در ترازنامه است.
    * **اسقاط:** دارایی **خراب و غیرقابل استفاده** است (آهن قراضه). باید از ترازنامه خارج شود.

**س: آیا تغییر وضعیت سند حسابداری صادر می‌کند؟**

* **پاسخ:**
    * تغییراتی مثل "فعال به راکد" معمولاً سند مالی ندارند (فقط اثر محاسباتی دارند).
    * اما تغییر به "نگهداری برای فروش" در استانداردهای IFRS ممکن است نیاز به سند تجدید طبقه‌بندی (Reclassification) داشته باشد. در ایران معمولاً سند نمی‌خورد تا لحظه فروش قطعی.

**س: اگر دارایی "در دست تعمیر" باشد، می‌توانیم آن را اموال‌گردانی کنیم؟**

* **پاسخ:** بله، اما در لیست اموال‌گردانی جلوی آن تیک "نزد تعمیرکار" می‌خورد و جمعدار به جای دیدن خودِ کالا، "رسید تعمیرگاه" را اسکن یا رویت می‌کند.

# نقل و انتقال دارایی (Asset Transfer)

**مسیر دسترسی:** `دارایی ثابت > عملیات > نقل و انتقال`
**نام فنی:** `AssetTransferRequest`

## ۱. مقدمه و فلسفه وجودی

در چرخه عمر دارایی، «تحصیل» فقط یک بار اتفاق می‌افتد، اما «انتقال» ممکن است صدها بار رخ دهد. عدم ثبت دقیق انتقالات، منجر به دو فاجعه سازمانی می‌شود:

1.  **فاجعه فیزیکی (گم شدن اموال):** در زمان اموال‌گردانی، دارایی در اتاق X نیست و مسئول اتاق می‌گوید "من دو ماه پیش دادم به واحد تدارکات"، اما هیچ سندی وجود ندارد.
2.  **فاجعه مالی (هزینه اشتباه):** واحد "فروش" از یک پرینتر گران‌قیمت استفاده می‌کند، اما هزینه استهلاک آن هنوز به پای واحد "اداری" نوشته می‌شود. این یعنی سود و زیان مراکز هزینه غلط است.

ماژول نقل و انتقال تابان، فرآیند را از حالت "کاغذی و شفاهی" به یک **"فرآیند دیجیتال با تایید دوطرفه"** تبدیل می‌کند.

---

## ۲. ابعاد انتقال (Dimensions of Transfer)

در ERP تابان، یک انتقال می‌تواند شامل تغییر در یک یا چند بُعد زیر باشد:

### الف) انتقال مسئولیت / جمعداری (Custody Transfer)
* **تغییر:** دارایی از "آقای رضایی" گرفته شده و به "خانم حسینی" تحویل داده می‌شود.
* **اهمیت:** مسئولیت حقوقی حفظ و نگهداری کالا منتقل می‌شود. اگر کالا بشکند، نفر جدید مسئول است.
* **سند خروجی:** صورتجلسه تحویل و تحول (رسید امانی).

### ب) انتقال مکانی (Location Transfer)
* **تغییر:** دارایی از "ساختمان مرکزی - طبقه ۱" به "انبار شماره ۲" می‌رود.
* **اهمیت:** برای تیم اموال‌گردانی و حراست مهم است تا بدانند برای شمارش کالا کجا بروند.

### ج) انتقال مالی / مرکز هزینه (Financial/Cost Center Transfer)
* **تغییر:** دارایی از واحد "تولید" به واحد "آموزش" منتقل می‌شود.
* **اهمیت:** **بسیار حیاتی برای حسابداری.** از ماه آینده، هزینه استهلاک این دستگاه باید از سرفصل "سربار تولید" کسر و به "هزینه‌های اداری/آموزشی" اضافه شود.

---

## ۳. فرآیند "دست‌دهی دیجیتال" (The Handshake Protocol)

در سیستم‌های قدیمی، جمعدار مبدأ فقط ثبت می‌کرد "فرستادم رفت!".
اما در تابان، انتقال یک تراکنش **سه‌مرحله‌ای** است تا هیچ‌کس نتواند زیر بار مسئولیت شانه خالی کند:

1.  **درخواست (Request):** مبدأ (یا مدیر اموال) درخواست انتقال را ثبت می‌کند.
    * *وضعیت دارایی:* `In Transit` (در راه).
2.  **تایید ارسال (Send):** دارایی فیزیکی از اتاق خارج می‌شود.
3.  **تایید دریافت (Acknowledge):** مقصد (تحویل‌گیرنده جدید) در کارتابل خود دکمه **«تحویل گرفتم»** را می‌زند.
    * *تنها در این لحظه است که نام مسئول در "کارت دارایی" تغییر می‌کند.*

> **نکته امنیتی:** تا زمانی که مقصد تایید نکرده، مسئولیت کالا همچنان با فرستنده (یا واحد حمل‌ونقل) است.

---

## ۴. جزئیات فرم انتقال (Form Details)

| عنوان فیلد | نوع داده | الزامی؟ | شرح و منطق بیزینسی |
| :--- | :--- | :--- | :--- |
| **شماره سند** | String | قفل | تولید خودکار (مثلاً `TRN-1403-500`). |
| **تاریخ انتقال** | Date | بله | تاریخ واقعی جابجایی. (مؤثر در محاسبات استهلاک). |
| **دارایی(ها)** | List | بله | انتخاب یک یا چند پلاک برای انتقال گروهی. |
| **از جمعدار / به جمعدار** | FK | بله | مسئول قدیم و جدید. |
| **از محل / به محل** | FK | بله | لوکیشن قدیم و جدید. |
| **از مرکز هزینه / به مرکز هزینه** | FK | شرطی | اگر انتقال بین واحدی باشد، تغییر مرکز هزینه الزامی است. |
| **علت انتقال** | Enum | خیر | (تعمیرات، تغییر ساختار، مازاد بر نیاز، امانت). |
| **شرح/توضیحات** | Text | خیر | ثبت وضعیت سلامت کالا هنگام تحویل (مثلاً: "پایه صندلی لق است"). |

---

## ۵. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: جابجایی پرسنل (تغییر اتاق)
آقای محمدی از واحد فروش به واحد بازرگانی منتقل می‌شود و لپ‌تاپش را هم با خود می‌برد.

* **نوع انتقال:** فقط "مکان" و "مرکز هزینه" عوض می‌شود. "جمعدار" (خود آقای محمدی) ثابت است.
* **اثر:** هزینه استهلاک لپ‌تاپ از این به بعد پای واحد بازرگانی نوشته می‌شود.

### سناریوی ۲: امانت دادن به بیرون (Lending)
یک پروژه موقت با پیمانکار داریم و ۱۰ عدد تبلت به آن‌ها امانت می‌دهیم.

* **نوع انتقال:** انتقال به "طرف حساب تجاری" (Business Partner).
* **محل جدید:** "محل پیمانکار".
* **جمعدار جدید:** نماینده پیمانکار.
* **نکته:** دارایی همچنان در ترازنامه ماست و استهلاکش محاسبه می‌شود، اما در "لیست اموال موجود در شرکت" فیلتر می‌شود.

### سناریوی ۳: برگشت به انبار (Return to Store)
میز خانم منشی اضافه است و به انبار اسقاط/راکد فرستاده می‌شود.

* **محل جدید:** انبار مرکزی.
* **تحویل گیرنده:** انباردار.
* **وضعیت:** تغییر اتوماتیک وضعیت دارایی از `Active` به `Idle` (راکد).

---

## ۶. اثرات مالی و حسابداری (Accounting Impact)

این بخش مهم‌ترین تفاوت انتقال فیزیکی با انتقال ERP است.

### تغییر مرکز هزینه (Cost Center Change Logic)
اگر دارایی در وسط ماه (مثلاً ۱۵‌م) منتقل شود، هزینه استهلاک آن ماه چطور محاسبه می‌شود؟

سیستم تابان از دو استاندارد پشتیبانی می‌کند (قابل تنظیم در پروفایل):

1.  **استاندارد دقیق (Day-based):**
    * ۱۵ روز اول: هزینه برای مرکز قدیم.
    * ۱۵ روز دوم: هزینه برای مرکز جدید.
2.  **استاندارد ماهانه (Period-based) - رایج در ایران:**
    * اگر انتقال قبل از ۱۵م باشد -> کل ماه برای مرکز جدید.
    * اگر بعد از ۱۵م باشد -> کل ماه برای مرکز قدیم.
    * *یا:* تغییر همیشه از **اول ماه بعد** اعمال شود.

> **نکته:** انتقال معمولاً "سند حسابداری" (Voucher) تولید نمی‌کند، مگر اینکه مراکز هزینه در دو "شعبه مستقل" (Legal Entities) باشند که نیاز به صدور فاکتور داخلی (Inter-company Invoice) داشته باشد.

---

## ۷. تفاوت‌های دولتی و خصوصی

### بخش دولتی (Public Sector)
* **فرم‌های قانونی:** سیستم باید قابلیت چاپ **«فرم ۱۱ اموال»** (حواله انتقالی) و **«فرم ۲۲»** (صورتجلسه تحویل و تحول) را دقیقاً با فرمت وزارت دارایی داشته باشد.
* **تایید ذیحساب:** انتقالات بین ساختمان‌های اصلی، ممکن است نیاز به تایید امین اموال و ذیحساب داشته باشد.

### بخش خصوصی (Private Sector)
* **چابکی:** انتقالات معمولاً با تایید مدیر واحد مبدأ و مقصد انجام می‌شود.
* **تمرکز:** بیشتر روی تغییر "مرکز هزینه" حساس هستند تا بودجه‌بندی واحدها درست دربیاید.

---

## ۸. ملاحظات فنی برای توسعه‌دهندگان

### الف) تاریخچه تغییرناپذیر (Immutable History)
جدول `AssetTransferHistory` باید لاگ کامل را نگه دارد.

* رکورد قبلی در جدول `AssetMaster` پاک نمی‌شود؛ بلکه یک رکورد جدید در جدول هیستوری درج می‌شود.

### ب) انتقال گروهی (Batch Transfer)
کاربر باید بتواند ۱۰۰ صندلی سالن کنفرانس را انتخاب کند و با یک کلیک همه را به سالن شماره ۲ منتقل کند.

* **UI:** قابلیت Multi-select در گرید.
* **Backend:** اجرای تراکنش در یک حلقه (Loop) یا Bulk Insert.

### ج) امضای دیجیتال (Digital Signature)
در نسخه موبایل (اپلیکیشن جمعداری)، تحویل‌گیرنده می‌تواند روی صفحه گوشی امضا کند. تصویر امضا باید در دیتابیس (به عنوان پیوست سند انتقال) ذخیره شود.

---

## ۹. پرسش‌های متداول (FAQ)

**س: اگر دارایی در حین انتقال گم شود چه؟**

* **پاسخ:** وضعیت دارایی در سیستم `In Transit` است. اگر مقصد تحویل نگیرد، مسئولیت با فرستنده یا شرکت حمل‌ونقل است. در نهایت باید سند "مفقودی" ثبت شود.

**س: آیا می‌توانیم دارایی را به یک "واحد سازمانی" بدهیم نه یک "شخص"؟**

* **پاسخ:** در سیستم تابان، هر دارایی باید حتماً یک **مسئول حقیقی** (Person) داشته باشد. حتی اگر به واحد "دبیرخانه" می‌دهید، باید "مسئول دبیرخانه" به عنوان تحویل‌گیرنده ثبت شود. (اموال بدون صاحب ممنوع است).

**س: تاریخ انتقال را می‌توانم در گذشته بزنم؟**

* **پاسخ:**
    * اگر فقط تغییر مکان است: بله.
    * اگر تغییر مرکز هزینه است: فقط تا زمانی که "سند استهلاک" آن دوره صادر نشده باشد. اگر استهلاک خرداد محاسبه و بسته شده، نمی‌توانید انتقالی با تاریخ خرداد ثبت کنید (چون سند هزینه قبلاً صادر شده).

# موتور محاسبات استهلاک (Depreciation Calculation Engine)

**مسیر دسترسی:** `دارایی ثابت > عملیات > محاسبه استهلاک`
**نام فنی:** `DepreciationRun`

## ۱. مقدمه و فلسفه وجودی

دارایی‌های ثابت بر اثر "گذشت زمان"، "استفاده" و "تکنولوژی" فرسوده می‌شوند. حسابداری باید این فرسودگی فیزیکی را به **هزینه ریالی** تبدیل کند.

موتور استهلاک تابان یک ماشین‌حساب ساده نیست؛ بلکه یک **موتور پردازش دسته‌ای (Batch Processing Engine)** است که می‌تواند در عرض چند دقیقه، محاسبات پیچیده هزاران دارایی را برای "دفاتر مختلف" (مالیاتی/داخلی) انجام دهد و سند حسابداری صادر کند.

### اصول کلیدی موتور:
1.  **دقت زمانی:** پشتیبانی از محاسبات روزانه (Daily) و ماهانه (Monthly).
2.  **چند دفتری:** توانایی محاسبه همزمان برای دفتر مالیاتی (طبق قانون) و دفتر مدیریتی (طبق واقعیت).
3.  **جلوگیری از منفی شدن:** ارزش دفتری (NBV) هرگز نباید از "ارزش اسقاط" کمتر شود.

---

## ۲. روش‌های محاسباتی (Supported Methods)

ERP تابان از ۴ روش استاندارد جهانی و ایران پشتیبانی می‌کند:

### الف) خط مستقیم (Straight Line - SL)
* **منطق:** استهلاک در طول عمر دارایی ثابت است. رایج‌ترین روش در ایران.
* **فرمول:**
  
    $$هزینه = \frac{(بهای تمام شده - ارزش اسقاط)}{عمر مفید}$$

### ب) نزولی (Declining Balance - DB)
* **منطق:** استهلاک در سال‌های اول بیشتر است. (مناسب برای ماشین‌آلات و خودروها). منطبق با اصلاحیه ماده ۱۴۹ ق.م.م.
* **فرمول:**
  
    $$هزینه = ارزش دفتری اول دوره \times نرخ$$

* **نکته:** وقتی ارزش دفتری به حدی برسد که روش خطی به صرفه‌تر باشد، سیستم می‌تواند اتوماتیک سوئیچ کند (Switch over).

### ج) تعداد تولید / کارکرد (Units of Production)
* **منطق:** استهلاک بر اساس "میزان کارکرد" است نه زمان.
* **سناریو:** یک کامیون معدن که عمرش ۳۰۰,۰۰۰ کیلومتر است. اگر یک ماه خوابیده باشد، استهلاکش صفر است.
* **پیش‌نیاز:** باید ماهانه کارکرد (کنتور) دستگاه در سیستم ثبت شود.

### د) مجموع سنوات (Sum of Years' Digits)
* **منطق:** روشی نزولی که کمتر استفاده می‌شود اما برخی صنایع خاص به آن نیاز دارند.

---

## ۳. چرخه عملیات پایان ماه (The Monthly Run)

حسابدار اموال در پایان هر ماه (یا سال)، فرآیند زیر را طی می‌کند:

### گام ۱: ایجاد پیشنهاد (Create Proposal)
کاربر دوره مالی (مثلاً "دی ۱۴۰۲") را انتخاب می‌کند. سیستم محاسبات را انجام می‌دهد اما **سند نمی‌زند**.

* خروجی این مرحله یک "لیست پیش‌نویس" است.
* کاربر چک می‌کند: *"چرا استهلاک لیفتراک صفر شده؟"* -> *"آهان، چون وضعیتش راکد بود."*

### گام ۲: بررسی و اصلاح (Review)
اگر خطایی باشد (مثلاً عمر مفید تمام شده ولی هنوز مستهلک می‌شود)، کاربر باید برگردد و در "کارت دارایی" اصلاحات (Adjustment) انجام دهد و دوباره محاسبه کند.

### گام ۳: تایید و صدور سند (Post)
با زدن دکمه `Post`، موتور حسابداری فعال می‌شود:

1.  استهلاک محاسبه شده در کارت دارایی (فیلد "استهلاک انباشته") می‌نشیند.
2.  سند حسابداری (Voucher) در دفتر کل صادر می‌شود.

---

## ۴. منطق‌های پیچیده (Advanced Logic)

### ۴-۱. قرارداد زمانی (Proration Convention)
اگر دارایی را در **۱۵‌م ماه** بخریم، استهلاک این ماه چطور حساب می‌شود؟

* **روش دقیق (Actual Days):** دقیقاً برای ۱۵ روز محاسبه می‌شود.
* **روش ماهانه (Monthly):**
    * اگر خرید قبل از ۱۵م باشد -> کل ماه محاسبه می‌شود.
    * اگر خرید بعد از ۱۵م باشد -> از ماه بعد شروع می‌شود.
* **روش سالانه (Half-Year):** (رایج در آمریکا، کمتر در ایران) ۶ ماه اول حساب می‌شود.

> سیستم تابان قابلیت تنظیم این قانون را در سطح "دفتر استهلاک" دارد.

### ۴-۲. تعدیلات (Adjustments)
اگر وسط سال (مثلاً برج ۴)، ارزش دارایی تجدید ارزیابی شود یا عمر مفیدش از ۱۰ سال به ۱۲ سال تغییر کند:

* سیستم از برج ۴ به بعد، بر اساس **«ارزش دفتری جدید»** و **«عمر باقیمانده جدید»** قسط‌ها را دوباره می‌چیند (Recalculate).

### ۴-۳. توقف استهلاک (Suspension)
برای دارایی‌هایی که وضعیتشان به **"نگهداری برای فروش"** تغییر کرده، موتور به صورت خودکار استهلاک را صفر در نظر می‌گیرد، حتی اگر کاربر اشتباهاً آن‌ها را در لیست محاسبه قرار دهد.

---

## ۵. جزئیات فرم محاسبه (Run Dialog)

| عنوان فیلد | الزامی؟ | شرح |
| :--- | :--- | :--- |
| **تاریخ سند (Posting Date)** | بله | تاریخی که سند در حسابداری ثبت می‌شود (مثلاً ۳۰/۱۰/۱۴۰۲). |
| **تا تاریخ (Depreciation To)** | بله | محاسبات تا چه روزی انجام شود؟ |
| **دفتر استهلاک** | بله | برای کدام دفتر محاسبه کنیم؟ (مالیاتی یا داخلی). |
| **شرح سند** | خیر | مثلاً: "هزینه استهلاک دارایی‌های ثابت - دی ماه". |
| **خلاصه سازی؟ (Summarize)** | بله | آیا برای هر دارایی یک سطر سند بزند (خیر) یا برای هر مرکز هزینه تجمیع کند (بله)؟ *پیشنهاد: بله.* |
| **فیلترها** | خیر | امکان اجرا برای یک "گروه خاص" یا "مرکز هزینه خاص". |

---

## ۶. سناریوهای کاربردی (Use Cases)

### سناریوی ۱: استفاده از "سپر مالیاتی" (بخش خصوصی)
شرکت سودده است و می‌خواهد مالیات کمتری بدهد.

* مدیر مالی روش استهلاک ماشین‌آلات جدید را **«نزولی»** انتخاب می‌کند.
* **نتیجه:** در سال‌های اول، هزینه استهلاک بسیار بالاست -> سود کاهش می‌یابد -> مالیات کمتر می‌شود.
* موتور تابان این محاسبات نمایی را دقیق انجام می‌دهد.

### سناریوی ۲: دارایی‌های فصلی (کارخانجات قند/رب)
کارخانه فقط ۳ ماه در سال کار می‌کند.

* روش استهلاک: **«میزان تولید»**.
* در ۹ ماه بیکاری، استهلاک ماشین‌آلات صفر است (چون تولید صفر است).
* این روش باعث می‌شود قیمت تمام شده محصول در فصل تولید واقعی‌تر باشد.

---

## ۷. تعامل با سایر بخش‌ها (Integration)

1.  **با دفتر کل (GL Integration):**
    * خروجی نهایی یک سند است:
        * **بدهکار:** هزینه استهلاک (کد معین از "طبقه دارایی" + کد تفصیلی از "مرکز هزینه").
        * **بستانکار:** استهلاک انباشته (کد معین از "طبقه دارایی").

2.  **با بهای تمام شده (Cost Accounting):**
    * هزینه استهلاک محاسبه شده، مستقیماً به عنوان **«سربار ساخت»** به ماژول بهای تمام شده محصول تزریق می‌شود.

---

## ۸. ملاحظات فنی برای توسعه‌دهندگان (Developer Notes)

### الف) پردازش موازی (Parallel Processing)
محاسبه ۱۰,۰۰۰ دارایی برای ۱۲ ماه، یعنی ۱۲۰,۰۰۰ عملیات ریاضی.

* نباید روی Thread اصلی UI اجرا شود.
* باید از `Task` یا `Background Job` استفاده شود و کاربر در نوتیفیکیشن نتیجه را ببیند.

### ب) خاصیت بازگشت‌پذیری (Idempotency)
اگر کاربر اشتباهاً دکمه محاسبه را ۲ بار زد، نباید استهلاک ۲ بار سند بخورد!

* سیستم باید چک کند: *"آیا برای این ماه قبلاً سند صادر شده؟"*
* اگر بله -> خطا بدهد یا پیشنهاد "حذف سند قبلی و محاسبه مجدد" بدهد.

### ج) خطای گرد کردن (Rounding Errors)
در محاسبات مالی، `100 / 3 * 3` نباید بشود `99.99`.

* همیشه از نوع داده `DECIMAL` (با ۴ رقم اعشار) استفاده کنید و در مرحله آخر (قبل از صدور سند) طبق تنظیمات دفتر گرد کنید (Round). مابه التفاوت گرد کردن معمولاً در آخرین ماه سال تسویه می‌شود.

---

## ۹. پرسش‌های متداول (FAQ)

**س: اگر استهلاک ماهی را فراموش کنیم (مثلاً تیر جا بیفتد) و در مرداد محاسبه کنیم چه می‌شود؟**

* **پاسخ:** موتور هوشمند تابان، "Catch-up" می‌کند. یعنی در مرداد متوجه می‌شود تیر محاسبه نشده، پس استهلاک تیر + مرداد را در یک سند (یا دو سند جدا) محاسبه می‌کند.

**س: آیا می‌توانیم سند استهلاک را دستی تغییر دهیم؟**

* **پاسخ:** **خیر.** سندهای سیستمی (System Generated) معمولاً قفل هستند. اگر اشتباه است، باید محاسبه را `Reverse` (معکوس) کنید، اطلاعات دارایی را اصلاح کنید و دوباره محاسبه کنید.

**س: دارایی که "کاملاً مستهلک شده" (Fully Depreciated) چه می‌شود؟**

* **پاسخ:** ارزش دفتری‌اش به ۱ ریال (یا ارزش اسقاط) می‌رسد و استهلاک متوقف می‌شود. اما دارایی همچنان در لیست "فعال" می‌ماند تا زمانی که رسماً "اسقاط" یا "فروخته" شود.

# مدیریت اموال و دارایی‌های ثابت (Fixed Asset Management)

## ۱. مقدمه و فلسفه وجودی

در ترازنامه هر سازمان بالغ، چه یک وزارتخانه دولتی باشد و چه یک هلدینگ تولیدی، سرفصل **«دارایی‌های ثابت مشهود» (Non-Current Assets)** معمولاً سنگین‌ترین وزن را از نظر ارزش ریالی دارد. زمین‌ها، ساختمان‌ها، ماشین‌آلات تولید، سرورهای گران‌قیمت و ناوگان حمل‌ونقل، موتور محرک عملیات سازمان هستند.

ماژول **«مدیریت دارایی ثابت» (FAM)** در ERP تابان، پاسخی جامع به یک چالش دوگانه و همیشگی است:

> **«چگونه هم‌زمان هم کنترل فیزیکی (این دارایی کجاست و دست کیست؟) و هم کنترل مالی (ارزش دفتری این دارایی چقدر است؟) را با دقت صد در صد و منطبق با قوانین مدیریت کنیم؟»**

### تفاوت با کالای مصرفی
برخلاف موجودی کالا (Inventory) که گردش سریعی دارد، دارایی‌های ثابت **«عمر طولانی»** دارند. آن‌ها «متولد» می‌شوند (خرید)، «پیر» می‌شوند (استهلاک)، ممکن است «بیمار» شوند (خرابی/تعمیر) و در نهایت «می‌میرند» (اسقاط/فروش). سیستم FAM تابان، **پرونده هویتی و پزشکی** این موجودات را در تمام طول عمرشان مدیریت می‌کند.

---

## ۲. معماری دوگانه: یک سیستم، دو دنیا (Hybrid Architecture)

بزرگترین مزیت رقابتی ماژول FAM در ERP تابان، معماری **«پیکربندی‌پذیر» (Configurable)** آن است. این سیستم در هسته خود دارای یک سوئیچ هوشمند است که بر اساس **«پروفایل سازمان»**، رفتار سیستم را تغییر می‌دهد.



### جدول مقایسه رفتار سیستم در دو پروفایل

| ویژگی / بُعد | پروفایل بخش دولتی (Public Sector) | پروفایل بخش خصوصی (Private Sector) |
| :--- | :--- | :--- |
| **هدف اصلی** | **تطبیق قانونی (Compliance):** رعایت قانون محاسبات عمومی و حفظ بیت‌المال. | **سودآوری (Profitability):** مدیریت بازده دارایی (ROA) و استفاده از سپر مالیاتی. |
| **مرجع محاسباتی** | نظام نوین مالی بخش عمومی (VAM) + دستورالعمل‌های دیوان محاسبات. | استانداردهای حسابداری (استاندارد ۱۱ و ۱۷) + قانون مالیات‌ها (ماده ۱۴۹). |
| **اتصال به دولت** | **اجباری:** اتصال به سامانه جامع اموال دستگاه‌های اجرایی (**سادا**). | **اختیاری/مالیاتی:** اتصال به سامانه مؤدیان (فقط در زمان فروش دارایی). |
| **کنترل بودجه** | **سخت‌گیرانه:** خرید بدون کد اعتبار مصوب (تامین اعتبار) غیرممکن است. | **مدیریتی:** خرید بر اساس بودجه عملیاتی (CapEx) انجام می‌شود. |
| **فرآیند خروج** | **بروکراتیک:** انتقال طبق ماده ۱۰۶/۱۰۷، نیاز به مجوز وزارت دارایی، بدون شناسایی سود/زیان. | **تجاری:** فروش بر اساس تصمیم مدیریت، شناسایی سود و زیان ناشی از فروش. |
| **الگوی پلاک‌دهی** | الزامات خاص برچسب اموال دولتی (کدینگ ۱۴ رقمی کالا). | کدینگ داخلی شرکت یا هلدینگ. |

---

## ۳. اکوسیستم یکپارچه (Integration Ecosystem)

ماژول دارایی ثابت یک جزیره جدا افتاده نیست؛ بلکه **«نقطه تلاقی»** چهار زیرسیستم اصلی دیگر در ERP تابان است.



### ۱. ارتباط با زنجیره تامین (Procurement & Inventory)
* **لحظه تشخیص:** وقتی انباردار «رسید انبار» صادر می‌کند، سیستم بر اساس **«حد نصاب معاملات»** و **«کدینگ کالا»** تشخیص می‌دهد که این کالا مصرفی نیست و باید پلاک بخورد.
* **مثال:** خرید ۱۰ عدد لپ‌تاپ. انبار رسید می‌کند -> سیستم FAM بلافاصله ۱۰ رکورد «دارایی در انتظار پلاک» ایجاد می‌کند.

### ۲. ارتباط با حسابداری (General Ledger)
* **ترجمه مالی:** هر اتفاق فیزیکی باید به یک «سند حسابداری» تبدیل شود.
* **عملیات خودکار:**
    * خرید دارایی -> سند تحصیل (بدهکار: دارایی ثابت / بستانکار: حساب‌های پرداختنی).
    * استهلاک ماهانه -> سند هزینه (بدهکار: هزینه استهلاک / بستانکار: استهلاک انباشته).

### ۳. ارتباط با نگهداری و تعمیرات (EAM / Maintenance)
* **هزینه‌های سرمایه‌ای (CapEx):** اگر موتور یک کامیون تعویض شود (تعمیر اساسی)، ماژول تعمیرات هزینه را اعلام می‌کند و FAM آن را به ارزش دارایی اضافه می‌کند (تجدید ارزیابی فنی).
* **تعیین وضعیت:** اگر واحد فنی گزارش دهد "دستگاه غیرقابل تعمیر است"، وضعیت دارایی در FAM به صورت اتوماتیک به "پیشنهاد اسقاط" تغییر می‌کند.

### ۴. ارتباط با منابع انسانی (HR)
* **جمعداری:** هر دارایی باید یک «تحویل گیرنده» داشته باشد.
* **فرآیند خروج پرسنل:** سیستم HR هنگام تسویه حساب کارمند، به صورت خودکار از FAM استعلام می‌گیرد که "آیا پلاک اموالی به نام این شخص مانده است؟".

---

## ۴. چرخه حیات دارایی (Asset Lifecycle)

مدیریت دارایی در تابان یک خط مستقیم نیست، بلکه یک چرخه پویا شامل ۶ مرحله است:

1.  **برنامه‌ریزی (Planning):** درخواست خرید، امکان‌سنجی و تامین اعتبار (لینک به بودجه).
2.  **تحصیل (Acquisition):** ورود دارایی به سازمان (خرید، ساخت، اهدا) و پلاک‌کوبی.
3.  **بهره‌برداری (Operation):** تخصیص به پرسنل، جابجایی بین واحدها، تعمیرات و نگهداری.
4.  **ارزش‌گذاری (Valuation):**
    * **استهلاک:** کاهش ارزش دفتری در طول زمان.
    * **تجدید ارزیابی:** افزایش ارزش دارایی (Revaluation) در شرایط تورمی.
5.  **ممیزی (Audit):** اموال‌گردانی دوره‌ای (با بارکدخوان/RFID) برای کشف مغایرت فیزیکی و دفتری.
6.  **تعیین تکلیف (Disposal):** تصمیم‌گیری برای پایان عمر (فروش، اسقاط، انتقال، اهدا).

---

## ۵. تعاریف کلیدی و واژه‌نامه (Glossary)

برای ایجاد زبان مشترک بین تیم فنی (Developers) و تیم کسب‌وکار (Business)، تعاریف زیر استاندارد شده‌اند:

* **واحد جمعداری (Asset Department):** واحد سازمانی مسئول نگهداری فیزیکی (مثلاً "جمعداری ساختمان مرکزی" یا "جمعداری کارخانه").
* **پلاک اموال (Asset Tag):** شناسه منحصر‌به‌فرد فیزیکی (برچسب/بارکد/QR) که روی کالا نصب می‌شود.
* **طبقه دارایی (Asset Class):** دسته‌بندی مالی که کدینگ حسابداری (معین دارایی، معین استهلاک، معین هزینه) را تعیین می‌کند (مثلاً: وسایل نقلیه، اثاثیه اداری).
* **مرکز هزینه (Cost Center):** واحدی که دارایی در آنجا "کار می‌کند" و هزینه استهلاک به پای آن نوشته می‌شود (مثلاً: واحد فروش، خط تولید ۲).
* **ارزش دفتری (Net Book Value - NBV):** فرمول: `بهای تمام شده تاریخی - استهلاک انباشته - ذخیره کاهش ارزش`.
* **دارایی در جریان تکمیل (CIP):** پروژه‌هایی که هنوز آماده بهره‌برداری نیستند (مثل ساختمان نیمه‌کاره) و استهلاک ندارند.
* **حد نصاب دارایی (Capitalization Threshold):** مبلغی که قانون (یا سیاست شرکت) تعیین می‌کند که زیر آن مبلغ، کالا "هزینه" است و بالای آن "دارایی".

---

## ۶. ساختار منو (Menu Structure)

### 🗂 ماژول مدیریت اموال و دارایی‌های ثابت

#### 🔹 ۱. پیشخوان و کارتابل (Dashboard)
* **کارتابل اموال:** (درخواست‌های پلاک‌کوبی، درخواست‌های خروج، تایید مغایرت‌ها).
* **داشبورد مدیریتی:** (نمودار وضعیت سلامت، ارزش دفتری کل، دارایی‌های راکد، هشدارهای بیمه).

#### 🔹 ۲. عملیات دارایی (Asset Operations)
* **تحصیل و ایجاد:**
    * فراخوانی از انبار (Asset from Inventory)
    * خرید مستقیم / ایجاد دستی (Direct Acquisition)
    * ثبت دارایی‌های پروژه‌ای (Capitalize CIP)
* **مدیریت پرونده:** (جستجو، مشاهده کاردکس، ویرایش اطلاعات).
* **نقل و انتقال:** (تغییر تحویل‌گیرنده، تغییر مرکز هزینه، تغییر محل استقرار).
* **اموال‌گردانی:** (ایجاد دوره شمارش، ورود اطلاعات شمارش، مغایرت‌گیری).

#### 🔹 ۳. فرآیندهای مالی (Financial Processes)
* **محاسبه استهلاک:** (اجرای موتور استهلاک ماهانه).
* **تجدید ارزیابی:** (ثبت ارزش کارشناسی جدید و صدور سند مازاد).
* **تعدیلات:** (اصلاح نرخ، تغییر روش استهلاک، اصلاح بهای تمام شده).
* **بستن دوره مالی اموال.**

#### 🔹 ۴. خروج و کنارگذاری (Retirement & Disposal)
* **ثبت رخداد:** (اعلام خرابی، سرقت، مازاد، پایان عمر).
* **کارتابل تصمیم‌گیری:** (پنل کمیسیون اموال برای تعیین روش خروج).
* **اجرای خروج:** (فروش مزایده‌ای، اسقاط و انهدام، انتقال، اهدا، پیگیری حقوقی).

#### 🔹 ۵. گزارشات (Reports)
* **گزارشات قانونی:** (فرم ۱۶۶ مالیاتی، فرم‌های ۱۰ و ۱۱ اموال دولتی).
* **گزارشات تحلیلی:** (کاردکس ریالی، گزارش مرور دارایی‌ها، پیش‌بینی استهلاک).
* **گزارشات مغایرت:** (مغایرت انبار و اموال، مغایرت حسابداری).

#### 🔹 ۶. تنظیمات و اطلاعات پایه (Settings)
* **پروفایل سازمان:** (سوئیچ دولتی/خصوصی).
* **تعاریف پایه:** (گروه‌ها، طبقات، روش‌های استهلاک، دفاتر استهلاک).
* **تنظیمات پلاک:** (الگوی شماره‌دهی، طراحی لیبل بارکد).
* **موتور قوانین:** (تنظیمات هشدارهای خروج و نگهداری).

---

## ۷. مثال کاربردی (Use Case Scenario)

**سناریو:** خرید یک "سرور محاسباتی" به ارزش ۵۰۰ میلیون تومان.

1.  **در بخش دولتی:**
    * سیستم چک می‌کند آیا "بودجه تجهیزات تملک دارایی‌های سرمایه‌ای" اعتبار دارد؟
    * پس از خرید، پلاک اموال دولتی (برچسب ۱۴ رقمی) می‌خورد.
    * اطلاعات از طریق وب‌سرویس به سامانه **سادا** ارسال می‌شود.
    * هزینه استهلاک صرفاً جنبه دفتری دارد و سود و زیان دستگاه را تحت تاثیر قرار نمی‌دهد.

2.  **در بخش خصوصی:**
    * سیستم چک می‌کند آیا خرید توجیه اقتصادی (ROI) دارد؟
    * پلاک داخلی شرکت می‌خورد.
    * حسابدار روش استهلاک "نزولی" را انتخاب می‌کند تا در سال‌های اول هزینه بیشتری شناسایی کرده و **مالیات کمتری** پرداخت کند (استراتژی سپر مالیاتی).
