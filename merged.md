


# بنگاه اقتصادی (Legal Entity)

بنگاه اقتصادی، یک موجودیت حقوقی مستقل است که گزارش مالی خودش را دارد. هر بنگاه اقتصادی، اطلاعات مالی و ترازنامه مستقل خودش را ثبت و نگهداری می‌کند. به عبارت دیگر، هر بنگاه اقتصادی نمایانگر یک شرکت مستقل و قانونی است.

---

## کاربردهای بنگاه اقتصادی

### ۱. حسابداری مستقل

هر بنگاه اقتصادی دارای دفاتر حسابداری، دفتر کل و حساب‌های مالی مخصوص به خود است. این استقلال به شرکت اجازه می‌دهد تا صورت‌های مالی قانونی خود را به طور کامل و جداگانه تهیه کند.

### ۲. نمایندگی قانونی بنگاه اقتصادی

بنگاه اقتصادی یک واحد مستقل قانونی است که می‌تواند با اشخاص ثالث (مانند مشتریان و تأمین‌کنندگان) وارد قرارداد شود.

### ۳. مبنای تراکنش‌ها

تمامی تراکنش‌های مربوط به حسابداری مالی (FI) در سطح بنگاه اقتصادی ثبت، ذخیره و ارزیابی می‌شوند. به عبارت دیگر بدون ایجاد بنگاه اقتصادی، شما نمی‌توانید سند حسابداری ثبت کنید.

### ۴. چارچوب سازمانی

بنگاه اقتصادی، اولین و یکی از مهم‌ترین واحدهای ساختاری در ماژول‌های مالی تابان است و سایر واحدها مانند واحدهای عملیاتی به آن مرتبط می‌شوند.

---

## مثال: شرکت خودروسازی فرضی — «ایران خودرو» (نمونه آموزشی)

فرض کنید قصد داریم ساختار بنگاه‌های اقتصادی برای ایران خودرو را در نرم‌افزار تابات مدل کنیم. ایران خودرو واحدهای مختلف تولید، فروش و خدمات دارد و برای مدیریت مالی، هر واحد می‌تواند یک بنگاه اقتصادی جداگانه داشته باشد.

### جدول بنگاه‌های اقتصادی (نمونه)

| کد  | نام بنگاه اقتصادی         | کشور | ارز   | زبان | Chart of Accounts | Fiscal Year         | شناسه مالیاتی / شناسه ملی | توضیح کاربرد                                         |
|-----:|--------------------------|:-----:|:-----:|:----:|:------------------:|:-------------------:|:--------------------------:|-----------------------------------------------------|
| 1000 | ایران خودرو مرکزی         | IR    | IRR   | FA   | FA                 | 1403-1404 (شمسی)    | 1234567890                 | دفتر مرکزی، مدیریت کل، گزارش مالی اصلی              |
| 1100 | کارخانه تهران            | IR    | IRR   | FA   | FA                 | 1403-1404           | 1234567891                 | خط تولید خودرو در تهران، ثبت هزینه‌ها و خرید قطعات |
| 1200 | کارخانه تبریز           | IR    | IRR   | FA   | FA                 | 1403-1404           | 1234567892                 | خط تولید خودرو در تبریز                             |
| 2000 | بخش فروش و بازاریابی     | IR    | IRR   | FA   | FA                 | 1403-1404           | 1234567893                 | ثبت فاکتورهای فروش و مدیریت نمایندگی‌ها            |
| 3000 | خدمات پس از فروش         | IR    | IRR   | FA   | FA                 | 1403-1404           | 1234567894                 | تعمیرات و گارانتی خودروها                           |

---

## مثال عملی در تابان

1. **خرید قطعات توسط کارخانه تهران:**

   - سند مالی برای بنگاه اقتصادی **1100** ثبت می‌شود.

2. **ثبت هزینه‌های اداری دفتر مرکزی:**

   - سند برای بنگاه اقتصادی **1000** ثبت می‌شود.

3. **فروش خودرو به مشتری:**

   - فاکتور فروش برای بنگاه اقتصادی **2000** ثبت می‌شود.

4. **انجام خدمات گارانتی:**

   - هزینه و درآمد مربوطه برای بنگاه اقتصادی **3000** ثبت می‌شود.

---

## نکات مهم

- هر بنگاه اقتصادی ترازنامه و صورت سود و زیان مستقل دارد.
- کارخانه‌ها به یک بنگاه اقتصادی متصل هستند (یا می‌توانند بنگاه مستقل داشته باشند بسته به مدل سازمانی).
- بخش‌های فروش و خدمات می‌توانند بنگاه اقتصادی مستقل داشته باشند تا مدیریت مالی دقیق‌تری فراهم شود.

---


# مکان عملیاتی (Operating Unit)

مکان عملیاتی، یک واحد سازمانی عملیاتی در تابان است که یک **_مکان فیزیکی_** (مانند یک کارخانه، انبار، دفتر، مرکز توزیع یا شعبه فروش) را نشان می‌دهد. بر خلاف بنگاه اقتصادی که یک شخص حقوقی و مالی است، مکان عملیاتی یک واحد لجستیکی و عملیاتی است که در آن فرآیندهای کسب‌وکار روزمره مدیریت می‌شوند.

## کاربردهای مکان عملیاتی

### مدیریت موجودی
تمامی مواد و کالاها در سطح مکان عملیاتی نگهداری و مدیریت می‌شوند. هر مکان عملیاتی دارای انبارها و مکان‌های ذخیره‌سازی مخصوص به خود است.

### برنامه‌ریزی تولید
برنامه‌ریزی تولید، از جمله برنامه‌ریزی نیاز مواد (MRP) و سفارشات تولید، در سطح مکان عملیاتی انجام می‌شود.

### خرید و تدارکات
فرآیندهای خرید (Procurement) و دریافت کالاها به یک مکان عملیاتی خاص مربوط می‌شوند.

### مدیریت هزینه‌ها
در برخی موارد، ارزش‌گذاری مواد و هزینه‌های مربوط به تولید می‌تواند به صورت مخصوص مکان عملیاتی انجام شود.

### نگهداری و تعمیرات
برنامه‌ریزی و اجرای کارهای نگهداری و تعمیرات تجهیزات در سطح واحد‌های عملیاتی صورت می‌گیرد.

## ارتباط مکان عملیاتی با بنگاه اقتصادی

هر مکان عملیاتی همیشه به یک بنگاه اقتصادی اختصاص داده می‌شود. یک بنگاه اقتصادی می‌تواند چندین مکان عملیاتی داشته باشد، اما یک مکان عملیاتی تنها می‌تواند به یک بنگاه اقتصادی مرتبط باشد. این ارتباط به تابان امکان می‌دهد تا هزینه‌های عملیاتی یک مکان فیزیکی را با حساب‌های مالی مربوط به یک بنگاه اقتصادی (شخص حقوقی) پیوند دهد.

## خلاصه

- مکان عملیاتی جایی است که **کالا تولید، ذخیره (انبار)، توزیع می‌شود** یا خدمات پس از فروش یا فعالیت های اداری و مدیریتی در آن رخ می دهد.

- مکان عملیاتی، واحدی است که کاری در آن انجام می شود، نه مالی، اما تحت بنگاه اقتصادی فعالیت می‌کند.

- مکان عملیاتی می‌تواند یک **کارخانه، انبار یا مرکز تعمیر و خدمات** باشد.

- هر مکان عملیاتی **به یک** **بنگاه اقتصادی** **وصل می‌شود** و اسناد مالی آن از طریق بنگاه اقتصادی ثبت می‌شود.

- هر مکان عملیاتی می‌تواند چند **انبار** داشته باشد (انبارهای مختلف در همان مکان عملیاتی).

## مثال عملی مکان عملیاتی در ایران خودرو (با شعب و خدمات)

| کد مکان عملیاتی | نام مکان عملیاتی | کد بنگاه اقتصادی | نوع فعالیت | توضیح کاربرد |
| --- | --- | --- | --- | --- |
| 1100 | کارخانه تهران | 1000 | تولید | تولید خودروهای سواری |
| 1200 | کارخانه تبریز | 1000 | تولید | تولید خودروهای تجاری |
| 1300 | مرکز خدمات پس از فروش تهران | 3000 | خدمات | تعمیرات و گارانتی خودروها |
| 1400 | مرکز خدمات پس از فروش اصفهان | 3000 | خدمات | تعمیرات و گارانتی خودروها |
| 1500 | دفتر مرکزی اداری | 1000 | اداری | مدیریت مالی و اداری کل شرکت |
| 1600 | شعبه فروش تهران | 2000 | فروش | فروش خودرو و فاکتور مشتریان |
| 1700 | شعبه فروش اصفهان | 2000 | فروش | فروش خودرو و پشتیبانی مشتریان |

### نکات کلیدی از مثال بالا

- **مکان عملیاتی** **می‌تواند فعالیت اداری داشته باشد**

    - مثل مکان عملیاتی 1500 که دفتر مرکزی است.

- **مکان عملیاتی** **می‌تواند خدمات پس از فروش داشته باشد**

    - مکان عملیاتی 1300 و 1400 برای تعمیرات و گارانتی خودروها هستند.

- **مکان عملیاتی** **به** **بنگاه اقتصادی** **وصل است**

    - مکان عملیاتی تولیدی (1100، 1200) به بنگاه اقتصادی  1000

    - مکان عملیاتی خدمات (1300، 1400) به بنگاه اقتصادی  3000

    - مکان عملیاتی فروش (1600، 1700) به بنگاه اقتصادی  2000

- **شعب فروش و خدمات**

    - حتی اگر فقط فروش یا خدمات انجام دهند، مکان عملیاتی تعریف می‌شوند تا بتوان عملیات، موجودی کالا و فاکتورها را در تابان مدیریت کرد.

# به مستندات ERP تابان خوش‌آمدید

مستندات در حال به روزرسانی است...


# نوع بسته‌بندی کالا (Package Type)

---

## ۱. هدف

هدف از این فرم، تعریف و مدیریت انواع **بسته‌های فیزیکی** است که کالاها در آن‌ها قرار می‌گیرند.  
هر نوع بسته‌بندی صرفاً مشخص‌کننده‌ی **شکل یا جنس ظرف** کالا است (مثل کیسه، کارتن، قوطی، بطری) و برای استفاده در تعریف کالا، BOM، و عملیات بسته‌بندی مرسوله‌ها کاربرد دارد.  

در این سطح، جزئیات ابعادی یا ظرفیتی تعریف نمی‌شود — این اطلاعات در سطح کالا (Product Master) یا نوع بسته مرسوله (Shipment Package Type) نگهداری می‌شود.

---

## ۲. محل دسترسی در سیستم

**ماژول:** مدیریت موجودی (Inventory Management)  
**مسیر:**  
`مدیریت موجودی / تعاریف پایه / نوع بسته‌بندی کالا`

> *در صورتی که سیستم دارای ماژول مدیریت حمل‌ونقل (Transportation Management) یا WMS باشد، از داده‌های این فرم در فرآیند بسته‌بندی و بارگیری نیز استفاده می‌شود.*

---

## ۳. تعریف

**نوع بسته‌بندی کالا (Package Type)** نشان‌دهنده‌ی نوع فیزیکی یا جنس بسته‌ای است که کالا در آن عرضه می‌شود.  
این تعریف صرفاً جنبه‌ی طبقه‌بندی دارد و در منطق محاسباتی وزن، حجم یا ظرفیت دخالتی ندارد.  

**مثال‌ها:**

- کیسه ۲۵ کیلویی  
- جعبه مقوایی  
- قوطی فلزی  
- بطری پلاستیکی  
- کارتن ۱۲ تایی  
- سطل پلاستیکی  

---

## ۴. کاربردها

- در زمان **تعریف کالا** برای مشخص کردن نوع بسته‌بندی کالا (مثلاً “خوراک دام کیسه‌ای”).  
- در **BOM (صورت مواد)** برای تعیین نیاز به مواد بسته‌بندی (مثل کیسه خالی یا کارتن).  
- در **انبار و حمل‌ونقل** برای نمایش نوع بسته در اسناد مرسوله و لیبل‌گذاری.  
- در **گزارشات آماری** جهت تفکیک کالاها بر اساس نوع بسته (مثلاً درصد کالاهای فله‌ای در مقابل بسته‌ای).

---

## ۵. فیلدهای اطلاعاتی

| نام فیلد                             | نوع داده          | توضیح                                                 |
| ------------------------------------ | ----------------- | ----------------------------------------------------- |
| **کد نوع بسته‌بندی**                  | متنی / عددی       | شناسه یکتا برای هر نوع بسته‌بندی (مثلاً `PKG_001`)      |
| **نام نوع بسته‌بندی**                 | متنی              | عنوان نوع بسته‌بندی (مثلاً کیسه، کارتن، بطری)           |
| **جنس بسته‌بندی**                     | انتخابی           | مقوایی، پلاستیکی، فلزی، شیشه‌ای، پارچه‌ای و ...         |
| **قابلیت بازیافت**                   | بولین (بله / خیر) | مشخص می‌کند آیا بسته قابل بازیافت است یا خیر           |
| **قابلیت چندبار استفاده (Reusable)** | بولین             | آیا این بسته می‌تواند مجدداً برای بسته‌بندی استفاده شود  |
| **توضیحات**                          | متنی              | توضیحات تکمیلی در مورد نوع بسته‌بندی                   |
| **وضعیت فعال**                       | بولین             | تعیین می‌کند که نوع بسته‌بندی در حال استفاده است یا خیر |

---

## ۶. نکات کاربردی

1. ابعاد، وزن یا ظرفیت بسته‌بندی در این فرم تعریف نمی‌شود — این موارد باید در سطح **کالا (Product Master)** مشخص شوند.  
2. اگر یک کالا در چند نوع بسته مختلف تولید می‌شود (مثلاً ۱۰ کیلویی و ۲۵ کیلویی)، هرکدام باید **کالای جداگانه** باشد که به نوع بسته‌بندی مربوطه لینک دارد.  
3. نوع بسته‌بندی را می‌توان در **BOM کالا** نیز استفاده کرد تا مقدار مصرف بسته خالی کنترل شود.  
4. اگر در آینده نیاز به جزئیات فیزیکی بسته دارید (ابعاد، وزن خالی و غیره)، می‌توانید آن را در یک جدول توسعه‌ای جداگانه با ارتباط یک‌به‌یک اضافه کنید.

---

## ۷. مثال کاربردی

| کد      | نام                | جنس          | قابلیت بازیافت | وضعیت |
| ------- | ------------------ | ------------ | -------------- | ----- |
| PKG_001 | کیسه ۲۵ کیلویی     | پلی‌پروپیلن   | بله            | فعال  |
| PKG_002 | کارتن مقوایی       | مقوایی       | بله            | فعال  |
| PKG_003 | بطری ۱ لیتری       | PET پلاستیکی | بله            | فعال  |
| PKG_004 | سطل فلزی ۱۰ کیلویی | فلزی         | خیر            | فعال  |
| PKG_005 | قوطی کنسرو         | فلزی         | بله            | فعال  |

---

## ۸. ارتباط با سایر ماژول‌ها

| ماژول مرتبط                                    | نوع ارتباط     | توضیح                                    |
| ---------------------------------------------- | -------------- | ---------------------------------------- |
| **مدیریت کالا (Product Master)**               | استفاده مستقیم | انتخاب نوع بسته‌بندی در تعریف کالا        |
| **مدیریت موجودی (Inventory)**                  | وابسته         | گزارش‌گیری از کالاها بر اساس نوع بسته‌بندی |
| **مدیریت تولید (Production / BOM)**            | وابسته         | تعیین نوع بسته خالی به عنوان جزء BOM     |
| **مدیریت انبار (WMS)**                         | تحلیلی         | جهت لیبل‌گذاری و آماده‌سازی سفارش          |
| **مدیریت حمل‌ونقل (Transportation Management)** | تحلیلی         | نمایش نوع بسته در اسناد حمل              |

---

## ۹. خطاها و هشدارهای احتمالی

| خطا / هشدار                    | علت                            | راه‌حل                                         |
| ------------------------------ | ------------------------------ | --------------------------------------------- |
| «نوع بسته‌بندی انتخاب نشده است» | کالا بدون نوع بسته‌بندی ثبت شده | در تعریف کالا، نوع بسته‌بندی را انتخاب کنید    |
| «نوع بسته‌بندی غیرفعال است»     | وضعیت فعال = خیر               | وضعیت را فعال کنید یا نوع دیگری انتخاب نمایید |
| «نوع بسته‌بندی تکراری است»      | نام یا کد مشابه قبلاً تعریف شده | از نام یکتا استفاده کنید                      |

---

## ۱۰. توسعه‌های آتی (پیشنهادی)

- افزودن فیلدهای اختیاری مثل **وزن خالی بسته**، **ابعاد استاندارد بسته**، و **ظرفیت حجمی**.  
- افزودن **کد شناسایی بارکد بسته‌بندی (Package Barcode)** جهت ردیابی در WMS.  
- امکان تعریف **گروه بسته‌بندی (Package Category)** برای تفکیک بسته‌های مصرفی، چندبارمصرف و صادراتی.

---

# قابلیت‌ها (Capabilities)

---

## ۱. هدف

هدف از این فرم، تعریف **مهارت‌های خاص** (برای منابع انسانی) یا **مشخصات فنی ویژه** (برای ماشین‌آلات) است. این قابلیت‌ها به سیستم اجازه می‌دهند تا در زمان برنامه‌ریزی، اطمینان حاصل کند که عملیات تولید به منبعی با توانایی لازم تخصیص داده می‌شود.

---

## ۲. محل دسترسی در سیستم

**ماژول:** برنامه‌ریزی و کنترل تولید (Production Management)

**مسیر:**
`برنامه ریزی و کنترل تولید / تعاریف پایه / قابلیت‌ها`

---

## ۳. تعریف

**قابلیت (Capability)** یک برچسب (Tag) یا یک مشخصه کیفی است که یک توانایی خاص را توصیف می‌کند. این تعریف به تنهایی کاربردی نیست، بلکه باید به «منبع» (Resource) تخصیص داده شود و در «فرآیند تولید» (Routing) به عنوان یک الزام درخواست شود.

**مثال‌ها:**

* **مهارت انسانی:** جوشکاری گرید A، گواهینامه اپراتوری لیفتراک، تخصص کار با مواد شیمیایی
* **مشخصه فنی دستگاه:** توانایی برش فولاد ۷ میلی‌متر، دقت تراشکاری ۰.۰۱ میکرون، قابلیت میکس با ویسکوزیته بالا

---

## ۴. کاربردها

* **تعریف منبع:** مشخص کردن اینکه «علی احمدی» دارای قابلیت «جوشکاری گرید A» است.
* **تعریف فرآیند تولید (Routing):** مشخص کردن اینکه عملیات «جوشکاری فریم» *نیازمند* قابلیت «جوشکاری گرید A» است.
* **برنامه‌ریزی و زمان‌بندی (Scheduling):** موتور برنامه‌ریزی (Scheduler) هنگام تخصیص کار، فقط منابعی را انتخاب می‌کند که *هم* نوع منبع درستی داشته باشند (مثلاً «اپراتور جوشکار») و *هم* قابلیت مورد نیاز (مثلاً «جوشکاری گرید A») را دارا باشند.

---

## ۵. فیلدهای اطلاعاتی

| نام فیلد | نوع داده | توضیح |
| :--- | :--- | :--- |
| **کد قابلیت** | متنی / عددی | شناسه یکتا برای هر قابلیت (مثلاً `CAP-001`) |
| **نام قابلیت** | متنی | عنوان توصیفی قابلیت (مثلاً «جوشکاری گرید A») |
| **نوع قابلیت** | انتخابی | جهت دسته‌بندی (مثلاً: مهارت انسانی، گواهینامه، مشخصه فنی) |
| **توضیحات** | متنی | توضیحات تکمیلی |
| **وضعیت فعال** | بولین | تعیین می‌کند که این قابلیت قابل استفاده است یا خیر |

---

## ۶. نکات کاربردی

* «قابلیت» را با «نوع منبع» اشتباه نگیرید. **نوع منبع (Resource Type)** یک گروه عمومی است (مانند «جوشکار»)، اما **قابلیت (Capability)** یک مهارت خاص در آن گروه است (مانند «جوشکاری گرید A»).
* سعی کنید نام‌گذاری قابلیت‌ها واضح و استاندارد باشد تا در تعریف فرآیندها دچار ابهام نشوید.

---

## ۷. مثال کاربردی

| کد | نام | نوع قابلیت | وضعیت |
| :--- | :--- | :--- | :--- |
| CAP-001 | جوشکاری گرید A | گواهینامه | فعال |
| CAP-002 | برش فولاد ۷mm | مشخصه فنی | فعال |
| CAP-003 | اپراتوری لیفتراک | مهارت انسانی | فعال |
| CAP-004 | میکس مواد پودری | مشخصه فنی | غیرفعال |

---

## ۸. ارتباط با سایر ماژول‌ها

| ماژول مرتبط | نوع ارتباط | توضیح |
| :--- | :--- | :--- |
| **منبع (Resource)** | استفاده مستقیم | تخصیص قابلیت‌ها به یک منبع (ارتباط چندبه‌چند) |
| **فرآیند تولید (Routing)** | استفاده مستقیم | تعریف قابلیت‌های مورد نیاز برای یک عملیات |
| **برنامه‌ریزی تولید** | وابسته | فیلتر کردن منابع بر اساس قابلیت‌های مورد نیاز |

---

## ۹. خطاها و هشدارهای احتمالی

| خطا / هشدار | علت | راه‌حل |
| :--- | :--- | :--- |
| «کد قابلیت تکراری است» | کد وارد شده قبلاً استفاده شده | از کد یکتا استفاده کنید |
| «قابلیت غیرفعال است» | در تعریف فرآیند، از قابلیتی استفاده شده که فعال نیست | قابلیت را فعال کنید یا از قابلیت دیگری استفاده نمایید |
| «هیچ منبعی با این قابلیت یافت نشد» | (خطای زمان‌بندی) عملیاتی نیاز به قابلیتی دارد که هیچ منبع آزادی آن را ندارد | منابع دارای آن قابلیت را بررسی کنید (وضعیت، تقویم) یا آن را به یک منبع جدید تخصیص دهید |

---

## ۱۰. توسعه‌های آتی (پیشنهادی)

* افزودن **تاریخ اعتبار (Expiry Date)** برای قابلیت‌هایی مانند گواهینامه‌ها.
* افزودن **سطح مهارت (Skill Level)** (مثلاً مبتدی، متوسط، متخصص) برای قابلیت‌های انسانی.

# مفهوم: قواعد تخصیص (Dispatching Rules)

---

## ۱. هدف

هدف از این مستند، تشریح **منطق تصمیم‌گیری** موتور برنامه‌ریزی (Scheduler) است. قواعد تخصیص (Dispatching) به این سوال حیاتی پاسخ می‌دهند: «برای انجام یک عملیات، چندین منبع واجد شرایط (کاندیدا) در مرکز کار وجود دارد. سیستم **کدام یک** از آن‌ها را باید انتخاب کند؟»

---

## ۲. محل دسترسی در سیستم

این یک فرم ورود داده **نیست**، بلکه یک **مفهوم (Concept)** و مجموعه‌ای از **تنظیمات (Settings)** است که معمولاً در این بخش‌ها یافت می‌شود:
**ماژول:** مدیریت تولید (Production Management)
**مسیر احتمالی:**
`مدیریت تولید / تنظیمات / پارامترهای برنامه‌ریزی تولید`
یا
`مدیریت تولید / تعاریف پایه / مراکز کاری` (به عنوان تنظیم پیش‌فرض برای هر مرکز کار)

---

## ۳. تعریف

**قواعد تخصیص (Dispatching Rules)** مجموعه‌ای از منطق‌های اولویت‌بندی هستند که سیستم برای **مرتب‌سازی** لیست منابع کاندیدا و انتخاب بهترین گزینه از بین آن‌ها استفاده می‌کند. این فرآیند پس از آن انجام می‌شود که سیستم منابع را بر اساس الزامات عملیات (نوع منبع، قابلیت‌ها، تقویم و وضعیت) **فیلتر** کرده است.

### منطق دو مرحله‌ای تخصیص:

1.  **فیلتر کردن (Filtering):**
    * سیستم به «مرکز کار» تعریف شده در عملیات نگاه می‌کند و *تمام* منابع (Resources) داخل آن را لیست می‌کند.
    * **حذف ۱:** منابعی که «نوع منبع» آن‌ها با «نوع منبع» مورد نیاز عملیات مطابقت *ندارد*، حذف می‌شوند.
    * **حذف ۲:** منابعی که «قابلیت‌های» مورد نیاز عملیات را *ندارند*، حذف می‌شوند.
    * **حذف ۳:** منابعی که «وضعیت» آن‌ها «خراب» یا «در دست تعمیر» است، حذف می‌شوند.
    * **خروجی:** لیستی از منابع کاندیدا که *می‌توانند* این کار را انجام دهند.

2.  **مرتب‌سازی (Sorting) - (قاعده تخصیص واقعی):**
    * سیستم لیست کاندیداها را بر اساس «قاعده تخصیص» فعال، مرتب کرده و اولین گزینه را انتخاب می‌کند.

---

## ۴. کاربردها (انواع قواعد)

در نسخه MVP، سیستم ممکن است فقط از یک قاعده (مثلاً اولین در دسترس) استفاده کند، اما درک این قواعد برای توسعه‌های آتی ضروری است.

| نام قاعده | منطق (توضیح) | الگوریتم مرتب‌سازی | کاربرد |
| :--- | :--- | :--- | :--- |
| **اولین در دسترس (First Available)** | کار را در سریع‌ترین زمان ممکن *شروع* کن. | منابع را بر اساس **زودترین زمان آزاد** (Earliest Start Time) مرتب می‌کند. | رایج‌ترین و ساده‌ترین قاعده. |
| **سریع‌ترین منبع (Fastest)** | کار را با بالاترین سرعت *انجام* بده تا زمان کل عملیات کمینه شود. | منابع را بر اساس **ضریب عملکرد (Performance)** (نزولی) مرتب می‌کند. | عالی برای مدیریت گلوگاه‌ها (Bottlenecks). |
| **کم‌هزینه‌ترین منبع (Least Cost)** | بهای تمام شده سفارش را به حداقل برسان. | منابع را بر اساس **نرخ هزینه (Cost Rate)** (صعودی) مرتب می‌کند. | زمانی که هزینه‌های عملیاتی متغیر است. |
| **اولویت‌بندی دستی (Priority)** | همیشه از منبع ارجح (مثلاً اپراتور ارشد) استفاده کن. | منابع را بر اساس یک فیلد **اولویت (Priority)** (که به منبع اضافه می‌شود) مرتب می‌کند. | برای اولویت‌بندی منابع استراتژیک. |

---

## ۵. فیلدهای اطلاعاتی (مفهومی)

این بخش در تنظیمات سیستم خواهد بود (نه یک فرم داده‌ای):

| تنظیم | نوع داده | توضیح |
| :--- | :--- | :--- |
| **قاعده تخصیص پیش‌فرض** | انتخابی (از لیست قواعد) | قاعده‌ای که سیستم به صورت سراسری استفاده می‌کند (مثلاً: «اولین در دسترس») |
| **اجازه لغو در مرکز کار** | بولین | آیا مدیر می‌تواند برای یک مرکز کار خاص، قاعده متفاوتی تنظیم کند؟ |

---

## ۶. نکات کاربردی

* درک تفاوت بین «فیلتر کردن» و «مرتب‌سازی» کلیدی است. یک منبع ممکن است «سریع‌ترین» باشد (در مرتب‌سازی برنده شود)، اما اگر «قابلیت» لازم را نداشته باشد (در فیلتر رد شود)، اصلاً در رقابت شرکت داده نمی‌شود.
* برای MVP، تمرکز بر روی قاعده **«اولین در دسترس (First Available)»** کافی و کارآمد است.

---

## ۷. مثال کاربردی (سناریوی تصمیم‌گیری)

* **عملیات:** جوشکاری (نیاز به: نوع منبع 'اپراتور جوشکار'، قابلیت 'گرید A')
* **مرکز کار:** WC-WELD
* **منابع کاندیدا (پس از فیلتر کردن وضعیت و تقویم):**
    1.  `علی احمدی`: قابلیت 'گرید A', نرخ هزینه ۱۰۰, ضریب عملکرد ۱.۲ (سریع)، **آزاد از ساعت ۱۰:۰۰**
    2.  `رضا حسینی`: قابلیت 'گرید A', نرخ هزینه ۸۰, ضریب عملکرد ۱.۰ (استاندارد)، **آزاد از ساعت ۰۹:۰۰**
    3.  `کاربر سوم`: قابلیت 'گرید B', ... (این کاربر در مرحله فیلتر کردن حذف می‌شود)

* **نتایج انتخاب بر اساس قواعد مختلف:**
    * **قاعده «اولین در دسترس»:** سیستم **رضا حسینی** را انتخاب می‌کند (چون ساعت ۰۹:۰۰ آزاد است).
    * **قاعده «سریع‌ترین منبع»:** سیستم **علی احمدی** را انتخاب می‌کند (چون ضریب عملکرد ۱.۲ دارد، حتی اگر لازم باشد تا ۱۰:۰۰ صبر کند).
    * **قاعده «کم‌هزینه‌ترین منبع»:** سیستم **رضا حسینی** را انتخاب می‌کند (چون نرخ هزینه ۸۰ دارد).

---

## ۸. ارتباط با سایر ماژول‌ها

| ماژول مرتبط | نوع ارتباط | توضیح |
| :--- | :--- | :--- |
| **منبع (Resource)** | خواندن داده | اطلاعات (وضعیت، تقویم، ضریب، هزینه، قابلیت) را از منبع می‌خواند |
| **مرکز کار (Work Center)** | خواندن تنظیم | قاعده پیش‌فرض ممکن است از مرکز کار خوانده شود |
| **فرآیند تولید (Routing)** | خواندن داده | الزامات (نوع منبع، قابلیت‌ها) را از عملیات می‌خواند |
| **برنامه‌ریزی تولید** | موتور اجرایی | این منطق، هسته اصلی موتور زمان‌بندی (Scheduler) است |

---

## ۹. خطاها و هشدارهای احتمالی

| خطا / هشدار | علت | راه‌حل |
| :--- | :--- | :--- |
| «هیچ منبع واجد شرایطی یافت نشد» | (خطای زمان‌بندی) پس از مرحله فیلتر، هیچ منبعی باقی نمانده است | بررسی کنید که آیا منابعی با «نوع» و «قابلیت» مورد نیاز در آن مرکز کار، «فعال» بوده و «تقویم» معتبر دارند یا خیر |
| «قاعده تخصیص تعریف نشده» | (خطای سیستمی) پارامتر پیش‌فرض سیستم تنظیم نشده است | در تنظیمات تولید، یک قاعده پیش‌فرض (مثلاً First Available) تنظیم کنید |

---

## ۱۰. توسعه‌های آتی (پیشنهادی)

* امکان تعریف **قواعد ترکیبی** (مثلاً اول «کم‌هزینه‌ترین» و در صورت تساوی، «اولین در دسترس»).
* امکان تعریف **قواعد به ازای هر عملیات** در خود Routing.

# منابع (Resources)

---

## ۱. هدف

هدف از این فرم، تعریف **فرد، دستگاه، ابزار یا مکان** مشخصی است که در فرآیند تولید، کاری را انجام می‌دهد و دارای **ظرفیت محدود** و **تقویم کاری** است. این موجودیت، قلب تپنده ماژول برنامه‌ریزی و زمان‌بندی تولید است.

---

## ۲. محل دسترسی در سیستم

**ماژول:** برنامه‌ریزی و کنترل تولید (Production Management)

**مسیر:**
`برنامه‌ریزی و کنترل تولید / تعاریف پایه / منابع`

---

## ۳. تعریف

**منبع (Resource)** یک موجودیت اجرایی و قابل زمان‌بندی در کارخانه است. برخلاف «نوع منبع» که کلی است (مانند «ماشین CNC»)، منبع، یک نمونه خاص و فیزیکی است (مانند «ماشین CNC-01» با شماره سریال Y). سیستم برای این منبع، زمان رزرو می‌کند و هزینه‌های آن را محاسبه می‌نماید.

---

## ۴. کاربردها

* **مدیریت ظرفیت:** تعریف دقیق تقویم کاری، راندمان و ظرفیت هر منبع.
* **برنامه‌ریزی و زمان‌بندی:** موتور زمان‌بندی (Scheduler) سفارش‌های تولید را بر اساس در دسترس بودن این منابع، زمان‌بندی می‌کند.
* **بهای تمام شده:** محاسبه هزینه واقعی تولید بر اساس نرخ هزینه (Cost Rate) تعریف شده برای منبع و زمان صرف شده آن.
* **تخصیص در مرکز کار:** گروه‌بندی منابع در مراکز کاری (مثلاً «CNC-01» و «CNC-02» هر دو در «کارگاه تراش» هستند).

---

## ۵. فیلدهای اطلاعاتی

| نام فیلد | نوع داده | توضیح |
| :--- | :--- | :--- |
| **کد / نام منبع** | متنی | شناسه یکتا (مثلاً `CNC-01`، `علی احمدی`) |
| **نوع منبع (Resource Type)** | انتخابی (از فرم نوع منبع) | گروهی که این منبع به آن تعلق دارد (مثلاً «ماشین تراش CNC») |
| **تقویم کاری (Working Calendar)** | انتخابی | الگوی زمانی که مشخص می‌کند منبع اصولاً چه زمانی در دسترس است (مثلاً «شیفت روز شنبه تا چهارشنبه») |
| **راندمان (Efficiency)** | درصدی (۰-۱۰۰) | درصد زمانی که منبع *واقعاً* برای کار در دسترس است (از کل زمان تقویم). (مثال: ۹۰٪) |
| **ضریب عملکرد (Performance)** | عددی (مثلاً ۱.۰) | فاکتور سرعت منبع نسبت به استاندارد. (۱.۰ = استاندارد، ۱.۲ = ۲۰٪ سریع‌تر) |
| **ظرفیت (Capacity)** | عددی | حداکثر ظرفیت قابل استفاده همزمان منبع. |
| **واحد ظرفیت (Capacity UoM)** | انتخابی | واحدی که عدد ظرفیت را توصیف می‌کند (مثلاً «کار/Task»، «کیلوگرم»، «عدد») |
| **نرخ هزینه (Cost Rate)** | عددی (پولی) | هزینه استفاده از این منبع به ازای واحد اندازه‌گیری هزینه. |
| **واحد اندازه‌گیری نرخ هزینه** | انتخابی | واحدی که نرخ هزینه بر اساس آن محاسبه می‌شود (مثلاً «ساعت»، «نفر-ساعت») |
| **قابلیت‌ها (Capabilities)** | انتخابی (چندتایی) | لیست مهارت‌ها یا مشخصات فنی که این منبع دارد. |
| **وضعیت (Status)** | انتخابی | وضعیت جاری منبع (مثلاً: آماده به کار، در حال کار، خراب، در دست تعمیر) |
| **نوع فعالیت (Activity Type)** | انتخابی (آینده) | (توسعه آتی) اتصال به ماژول بهای تمام شده برای تعیین سرفصل هزینه (مثلاً «دستمزد مستقیم») |

---

## ۶. نکات کاربردی

1.  **تفاوت راندمان و ضریب عملکرد (بسیار مهم):**
    * **راندمان (Efficiency):** بر *زمان تقویم* تأثیر می‌گذارد. اگر تقویم ۸ ساعت و راندمان ۹۰٪ باشد، سیستم می‌داند که فقط ۸‎ / ۰.۹ =  ۷.۲ ساعت از این منبع برای برنامه‌ریزی در دسترس است (۱۰۰‎٪ - ۹۰٪ = ۱۰٪ زمان صرف توقفات برنامه‌ریزی شده، استراحت و ... می‌شود).
    * **ضریب عملکرد (Performance):** بر *زمان اجرا* تأثیر می‌گذارد. اگر زمان استاندارد یک کار ۱ ساعت باشد و منبعی با ضریب ۱.۲ (۲۰٪ سریع‌تر) آن را انجام دهد، ‎۱ / ۱.۲ = ۰.۸۳ ساعت طول می‌کشد. اگر ضریب ۰.۸ (۲۰٪ کندتر) باشد، ‎۱ / ۰.۸ = ۱.۲۵ ساعت طول می‌کشد.

2.  **ظرفیت و واحد آن:**
    * برای یک ماشین CNC که در لحظه ۱ کار انجام می‌دهد: ظرفیت = ۱، واحد = کار (Task).
    * برای یک کوره که همزمان ۱۵ قطعه را می‌پزد: ظرفیت = ۱۵، واحد = عدد (Piece).
    * برای یک میکسر ۲۰۰۰ کیلویی: ظرفیت = ۲۰۰۰، واحد = کیلوگرم (Kg).

---

## ۷. مثال کاربردی

| نام | نوع منبع | تقویم | راندمان | ضریب عملکرد | ظرفیت | واحد ظرفیت | نرخ هزینه (تومان) | واحد هزینه |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| CNC-01 | ماشین تراش CNC | ۲ شیفت | ۸۵٪ | ۱.۰ | ۱ | کار (Task) | ۱,۵۰۰,۰۰۰ | ساعت |
| علی احمدی | اپراتور ماهر | اداری | ۹۵٪ | ۱.۲ (سریع‌تر) | ۱ | کار (Task) | ۹۰,۰۰۰ | ساعت |
| Mixer-B | میکسر بچ | ۲۴/۷ | ۹۰٪ | ۱.۰ | ۲۰۰۰ | کیلوگرم (Kg) | ۵۰۰,۰۰۰ | ساعت |
| Kureh-A | کوره پخت | ۱ شیفت | ۸۰٪ | ۰.۹ (کندتر) | ۱۵ | عدد (Piece) | ۷۰۰,۰۰۰ | ساعت |

---

## ۸. ارتباط با سایر ماژول‌ها

| ماژول مرتبط | نوع ارتباط | توضیح |
| :--- | :--- | :--- |
| **مرکز کار (Work Center)** | استفاده مستقیم | هر منبع به یک یا چند مرکز کار تخصیص می‌یابد |
| **نوع منبع (Resource Type)** | وابسته | هر منبع باید یک نوع داشته باشد |
| **قابلیت (Capability)** | وابسته | هر منبع می‌تواند چندین قابلیت داشته باشد  |
| **برنامه‌ریزی تولید** | استفاده مستقیم | رزرو کردن زمان و ظرفیت این منبع |
| **بهای تمام شده (Costing)** | وابسته | محاسبه هزینه‌های واقعی تولید بر اساس نرخ هزینه |

---

## ۹. خطاها و هشدارهای احتمالی

| خطا / هشدار | علت | راه‌حل |
| :--- | :--- | :--- |
| «منبع تقویم کاری ندارد» | تقویم کاری انتخاب نشده است | یک تقویم کاری معتبر برای منبع انتخاب کنید |
| «ظرفیت منبع صفر است» | مقدار ظرفیت ۰ وارد شده | ظرفیت واقعی منبع را (حداقل ۱) وارد کنید |
| «منبع در وضعیت خراب است» | (خطای زمان‌بندی) وضعیت منبع "خراب" یا "تعمیر" است | وضعیت منبع را به‌روز کنید یا از منبع دیگری استفاده کنید |
| «راندمان یا ضریب عملکرد نامعتبر» | مقادیر خارج از محدوده (مثلاً منفی) وارد شده | مقادیر معتبر (مثلاً ۹۰٪ یا ۱.۰) وارد کنید |

---

## ۱۰. توسعه‌های آتی (پیشنهادی)

* فعال‌سازی فیلد **«نوع فعالیت» (Activity Type)** برای یکپارچگی کامل با ماژول بهای تمام شده.
* افزودن **تاریخچه وضعیت (Status History)** برای تحلیل زمان‌های توقف (Downtime).
* افزودن **برنامه تعمیرات و نگهداری (Maintenance Schedule)** برای مسدود کردن خودکار تقویم منبع.

# انواع منبع (Resource Types)

---

## ۱. هدف

هدف از این فرم، **گروه‌بندی منطقی** منابع (اعم از انسانی و ماشین‌آلات) است که عملکرد مشابهی دارند. این دسته‌بندی، اساس تعریف نیازمندی‌ها در «فرآیند تولید» (Routing) است.

---

## ۲. محل دسترسی در سیستم

**ماژول:** برنامه‌ریزی و کنترل تولید (Production Management)

**مسیر:**
`برنامه‌ریزی و کنترل تولید / تعاریف پایه / انواع منابع`

---

## ۳. تعریف

**نوع منبع (Resource Type)** یک دسته‌بندی کلی برای منابع تولیدی است. در «فرآیند تولید»، شما مشخص نمی‌کنید که عملیات *دقیقاً* باید توسط «ماشین CNC-01» انجام شود، بلکه مشخص می‌کنید که به *یک* «ماشین تراش CNC» نیاز دارید.

**مثال‌ها:**

* ماشین‌های تراش CNC
* اپراتورهای ماهر
* دستگاه‌های جوشکاری
* میکسرها
* خطوط بسته‌بندی

---

## ۴. کاربردها

* **تعریف منبع (Resource):** هر منبع (مانند «CNC-01») باید به یک نوع منبع (مانند «ماشین تراش CNC») تعلق داشته باشد.
* **تعریف فرآیند تولید (Routing):** در تعریف عملیات، به جای اشاره به یک منبع خاص، به «نوع منبع» مورد نیاز اشاره می‌شود.
* **گزارش‌گیری:** تحلیل میزان استفاده، هزینه، یا بار کاری بر اساس انواع منابع (مثلاً مجموع ساعات کارکرد «اپراتورهای ماهر»).

---

## ۵. فیلدهای اطلاعاتی

| نام فیلد | نوع داده | توضیح |
| :--- | :--- | :--- |
| **کد نوع منبع** | متنی / عددی | شناسه یکتا (مثلاً `RT-CNC`) |
| **نام نوع منبع** | متنی | عنوان توصیفی (مثلاً «ماشین تراش CNC») |
| **نوع اصلی** | انتخابی | دسته‌بندی اصلی (مثلاً: ماشین، انسان، ابزار، مکان) |
| **توضیحات** | متنی | توضیحات تکمیلی |
| **وضعیت فعال** | بولین | تعیین می‌کند که این نوع منبع قابل استفاده است یا خیر |

---

## ۶. نکات کاربردی

* این موجودیت بسیار ساده است و هدف آن فقط **طبقه‌بندی** است.
* «نوع منبع» را با «مرکز کار» (Work Center) اشتباه نگیرید. مرکز کار یک *مکان فیزیکی* یا *گروه منطقی* از منابع است (مانند «کارگاه تراش»)، در حالی که نوع منبع، *دسته* خود منبع است (مانند «ماشین تراش»).

---

## ۷. مثال کاربردی

| کد | نام | نوع اصلی | وضعیت |
| :--- | :--- | :--- | :--- |
| RT-CNC | ماشین تراش CNC | ماشین | فعال |
| RT-OP-S | اپراتور ماهر | انسان | فعال |
| RT-MIX | میکسر بچ | ماشین | فعال |
| RT-FORK | لیفتراک | ماشین | فعال |

---

## ۸. ارتباط با سایر ماژول‌ها

| ماژول مرتبط | نوع ارتباط | توضیح |
| :--- | :--- | :--- |
| **منبع (Resource)** | استفاده مستقیم | هر منبع باید یک نوع منبع داشته باشد (ارتباط Many-to-One) |
| **فرآیند تولید (Routing)** | استفاده مستقیم | تعریف نیازمندی عملیات بر اساس نوع منبع |

---

## ۹. خطاها و هشدارهای احتمالی

| خطا / هشدار | علت | راه‌حل |
| :--- | :--- | :--- |
| «کد تکراری است» | کد وارد شده قبلاً استفاده شده | از کد یکتا استفاده کنید |
| «نوع منبع غیرفعال است» | در تعریف منبع یا فرآیند، از نوعی استفاده شده که فعال نیست | نوع منبع را فعال کنید یا از نوع دیگری استفاده نمایید |

---

## ۱۰. توسعه‌های آتی (پیشنهادی)

* افزودن **واحد اندازه‌گیری پیش‌فرض ظرفیت** (مثلاً «ماشین تراش» ظرفیتش بر اساس «کار (Task)» و «میکسر» بر اساس «کیلوگرم» است).
* افزودن **نرخ هزینه استاندارد (Standard Cost Rate)** برای این گروه.

# سناریوهای محاسباتی (نحوه کارکرد موتور زمان‌بندی)

این بخش نحوه استفاده ترکیبی از موجودیت‌های فوق (منبع، فرآیند تولید، ضریب عملکرد، راندمان و ...) را در عمل نشان می‌دهد.

---

## سناریو ۱: تولید گسسته (تولید دوچرخه با منابع همزمان)

**سفارش تولید: ۱۰ عدد «دوچرخه مدل M-200»**

### ۱. تعریف فرآیند تولید
* **فرآیند تولید:** فرآیند تولید دوچرخه M-200
* **مقدار پایه:** ۱
* **واحد:** عدد

### ۲. تعریف عملیات (عملیات ۲۰: جوشکاری فریم)
* **منابع مورد نیاز:**
    * **ردیف ۱ (دستگاه):**
        * نوع منبع: دستگاه جوشکاری
        * مقدار: ۱
        * مبنای زمان راه‌اندازی: **ثابت برای کل سفارش**
        * زمان راه‌اندازی استاندارد: ۵ دقیقه (تنظیم دستگاه برای کل سفارش)
        * مبنای زمان اجرا: **به ازای هر واحد** (چون مقدار پایه ۱ است)
        * زمان اجرای استاندارد: ۱۲ دقیقه (زمان استاندارد جوشکاری برای ۱ فریم)
        * میزان مصرف ظرفیت: ۱ کار (Task)
    * **ردیف ۲ (اپراتور):**
        * نوع منبع: اپراتور جوشکار
        * مقدار: ۱
        * قابلیت‌های مورد نیاز: گرید A
        * مبنای زمان راه‌اندازی: **ثابت برای کل سفارش**
        * زمان راه‌اندازی استاندارد: ۲ دقیقه (پوشیدن لباس ایمنی)
        * مبنای زمان اجرا: **به ازای هر واحد**
        * زمان اجرای استاندارد: ۱۳ دقیقه (زمان استاندارد اپراتور برای ۱ فریم)
        * میزان مصرف ظرفیت: ۱ کار (Task)

### ۳. تعریف منابع موجود (کاندیداها)
* منبع: دستگاه جوشکاری ۰۱، **ضریب عملکرد (Performance): ۱.۰**
* منبع: دستگاه جوشکاری ۰۲، **ضریب عملکرد (Performance): ۱.۲** (۲۰٪ سریع‌تر)
* منبع: اپراتور علی احمدی، **ضریب عملکرد (Performance): ۱.۰**، راندمان (Efficiency): ۹۰٪
* منبع: اپراتور رضا حسینی، **ضریب عملکرد (Performance): ۰.۸** (۲۰٪ کندتر)، راندمان (Efficiency): ۹۰٪

### ۴. محاسبات زمان‌بندی (Scheduler)
فرض کنیم موتور برنامه‌ریزی (بر اساس قواعد تخصیص) ترکیب {دستگاه جوشکاری ۰۲, رضا حسینی} را انتخاب می‌کند.

1.  **محاسبه زمان استاندارد (برای ۱۰ واحد):**
    * زمان راه‌اندازی استاندارد ماشین = ۵ دقیقه (ثابت)
    * زمان اجرای استاندارد ماشین = ۱۰ واحد * ۱۲ دقیقه (به ازای واحد) = ۱۲۰ دقیقه
    * **کل زمان استاندارد ماشین = ۵ + ۱۲۰ = ۱۲۵ دقیقه**
    * ---
    * زمان راه‌اندازی استاندارد اپراتور = ۲ دقیقه (ثابت)
    * زمان اجرای استاندارد اپراتور = ۱۰ واحد * ۱۳ دقیقه (به ازای واحد) = ۱۳۰ دقیقه
    * **کل زمان استاندارد اپراتور = ۲ + ۱۳۰ = ۱۳۲ دقیقه**

2.  **محاسبه زمان واقعی (Actual Time) بر اساس ضریب عملکرد:**
    * **زمان واقعی دستگاه (جوشکاری ۰۲، ضریب ۱.۲):**
        * زمان واقعی = زمان استاندارد / ضریب عملکرد
        * زمان واقعی = ۱۲۵ دقیقه / ۱.۲ = **۱۰۴.۱۷ دقیقه** (۱ ساعت و ۴۴ دقیقه)
    * **زمان واقعی اپراتور (رضا حسینی، ضریب ۰.۸):**
        * زمان واقعی = زمان استاندارد / ضریب عملکرد
        * زمان واقعی = ۱۳۲ دقیقه / ۰.۸ = **۱۶۵ دقیقه** (۲ ساعت و ۴۵ دقیقه)

3.  **محاسبه زمان کل عملیات (همزمانی منابع):**
    * چون هر دو منبع (ماشین و اپراتور) برای انجام کار *همزمان* مورد نیاز هستند، مدت زمان کل عملیات برابر با **حداکثر (MAX)** زمان واقعی آن دو است.
    * Total Operation Duration = MAX (104.17 دقیقه , 165 دقیقه) = **۱۶۵ دقیقه**
    * *نتیجه:* هر دو منبع (دستگاه ۰۲ و رضا حسینی) به مدت ۱۶۵ دقیقه اشغال خواهند بود.

4.  **محاسبه زمان رزرو شده در تقویم (بر اساس راندمان):**
    * زمان واقعی اپراتور ۱۶۵ دقیقه بود.
    * Calendar Time = Actual Time / Efficiency
    * Calendar Time = ۱۶۵ دقیقه / ۰.۹ (راندمان ۹۰٪ رضا حسینی) = **۱۸۳.۳۳ دقیقه**
    * *نتیجه:* سیستم ۱۸۳.۳۳ دقیقه از تقویم کاری رضا حسینی را برای این کار رزرو می‌کند (۱۶۵ دقیقه کار واقعی + ۱۸.۳۳ دقیقه زمان غیرمفید پیش‌بینی شده). (محاسبه راندمان برای دستگاه نیز به همین ترتیب اعمال می‌شود).

---

## سناریو ۲: تولید بچ (خوراک طیور - میکسر بچ)

**سفارش تولید: ۳۰۰۰ کیلوگرم «خوراک A»**

### ۱. تعریف فرآیند تولید
* **فرآیند تولید:** فرآیند خوراک A
* **مقدار پایه:** ۱۰۰۰
* **واحد:** کیلوگرم

### ۲. تعریف عملیات (میکس کردن)
* **منابع مورد نیاز (ردیف ۱):**
    * نوع منبع: میکسر بچ
    * مقدار: ۱
    * مبنای زمان راه‌اندازی: **ثابت به ازای هر بچ**
    * زمان راه‌اندازی استاندارد: ۱۵ دقیقه (زمان تمیزکاری به ازای هر بچ)
    * مبنای زمان اجرا: **ثابت به ازای هر بچ**
    * زمان اجرای استاندارد: ۳۰ دقیقه (زمان میکس استاندارد برای یک بچ)
    * میزان مصرف ظرفیت: ۱۰۰۰ کیلوگرم (مصرف ظرفیت بر اساس مقدار پایه فرآیند تولید)

### ۳. تعریف منابع
* منبع: "Mixer-A", ضریب عملکرد = ۱.۰, **ظرفیت (Capacity) = 1000 kg**
* منبع: "Mixer-B", ضریب عملکرد = ۱.۰, **ظرفیت (Capacity) = 2000 kg**

### ۴. محاسبات زمان‌بندی (Scheduler)
موتور برنامه‌ریزی سفارش را به **Mixer-B** (ظرفیت بالاتر) تخصیص می‌دهد.

1.  **محاسبه تعداد بچ‌ها:**
    * مقدار سفارش: ۳۰۰۰ کیلوگرم
    * ظرفیت منبع (Mixer-B): ۲۰۰۰ کیلوگرم
    * تعداد بچ = گرد کردن رو به بالا (مقدار سفارش / ظرفیت منبع)
    * تعداد بچ = Ceiling (3000 / 2000) = Ceiling (1.5) = **۲ بچ**
    * (بچ اول: ۲۰۰۰ کیلوگرم، بچ دوم: ۱۰۰۰ کیلوگرم)

2.  **محاسبه زمان استاندارد (برای ۲ بچ):**
    * *نکته: زمان‌ها «به ازای هر بچ» هستند.*
    * Total Standard Setup Time = ۲ بچ * ۱۵ دقیقه (به ازای بچ) = ۳۰ دقیقه
    * Total Standard Run Time = ۲ بچ * ۳۰ دقیقه (به ازای بچ) = ۶۰ دقیقه
    * Total Standard Time = ۳۰ + ۶۰ = **۹۰ دقیقه**

3.  **محاسبه زمان واقعی (Actual Time):**
    * چون ضریب عملکرد (PF) = 1.0 است، زمان واقعی = زمان استاندارد = **۹۰ دقیقه**.

---

## سناریو ۳: تولید پیوسته (خوراک طیور - اکسترودر)

**سفارش تولید: ۸۰۰۰ کیلوگرم «خوراک اکسترود B»**

### ۱. تعریف فرآیند تولید
* **فرآیند تولید:** فرآیند خوراک اکسترود B
* **مقدار پایه:** ۱۰۰۰
* **واحد:** کیلوگرم

### ۲. تعریف عملیات (اکسترود کردن)
* **منابع مورد نیاز (ردیف ۱):**
    * نوع منبع: خط اکسترودر
    * مقدار: ۱
    * مبنای زمان راه‌اندازی: **ثابت برای کل سفارش**
    * زمان راه‌اندازی استاندارد: ۱۲۰ دقیقه (گرم شدن و تنظیمات اولیه خط)
    * مبنای زمان اجرا: **به ازای مقدار پایه فرآیند تولید**
    * زمان اجرای استاندارد: ۶۰ دقیقه (زمان استاندارد تولید ۱۰۰۰ کیلوگرم)
    * میزان مصرف ظرفیت: ۱ کار (Task)

### ۳. تعریف منابع
* منبع: "Extruder-01", ضریب عملکرد = ۱.۰
* منبع: "Extruder-02", **ضریب عملکرد = ۱.۲۵** (۲۵٪ سریع‌تر)

### ۴. محاسبات زمان‌بندی (Scheduler)
موتور برنامه‌ریزی سفارش را به **Extruder-02** (سریع‌تر) تخصیص می‌دهد.

1.  **محاسبه زمان استاندارد (برای ۸۰۰۰ کیلوگرم):**
    * Standard Setup Time = ۱۲۰ دقیقه (چون «ثابت برای کل سفارش» است)
    * ---
    * *محاسبه ضریب تبدیل مقدار:*
    * (Order Qty / Basis Qty) = ۸۰۰۰ کیلوگرم / ۱۰۰۰ کیلوگرم = ۸
    * Standard Run Time = (ضریب تبدیل) * (زمان اجرای استاندارد)
    * Standard Run Time = ۸ * ۶۰ دقیقه = ۴۸۰ دقیقه
    * ---
    * Total Standard Time = ۱۲۰ دقیقه (Setup) + ۴۸۰ دقیقه (Run) = **۶۰۰ دقیقه**

2.  **محاسبه زمان واقعی (Actual Time) بر اساس ضریب عملکرد:**
    * منبع: "Extruder-02" (PF = 1.25)
    * Actual Setup = ۱۲۰ دقیقه / ۱.۲۵ = ۹۶ دقیقه
    * Actual Run = ۴۸۰ دقیقه / ۱.۲۵ = ۳۸۴ دقیقه
    * Total Operation Duration = ۹۶ + ۳۸۴ = **۴۸۰ دقیقه** (۸ ساعت)

3.  **زمان رزرو شده در تقویم (با راندمان ۹۰٪):**
    * Calendar Time = Actual Time / Efficiency
    * Calendar Time = ۴۸۰ دقیقه / ۰.۹ = **۵۳۳.۳۳ دقیقه**

# مراکز کار (Work Centers)

---

## ۱. هدف

هدف از این فرم، تعریف یک **مکان فیزیکی یا منطقی** در کارخانه است که در آن یک یا چند عملیات تولیدی انجام می‌شود. مراکز کاری، **منابع (Resources)** را گروه‌بندی می‌کنند و به عنوان واحد اصلی برای زمان‌بندی و تجمیع هزینه‌ها (سربار) عمل می‌کنند و منطق انتخاب منبع (قاعده تخصیص) را مشخص می‌کنند.

---

## ۲. محل دسترسی در سیستم

**ماژول:** برنامه‌ریزی و کنترل تولید (Production Management)

**مسیر:**
`برنامه‌ریزی و کنترل تولید / تعاریف پایه / مراکز کار`

---

## ۳. تعریف

**مرکز کار (Work Center)** یک واحد سازمانی در سطح واحد عملیاتی (Operating Unit) است. این مرکز می‌تواند یک دستگاه واحد، گروهی از دستگاه‌های مشابه (مانند «کارگاه تراش»)، یا یک خط مونتاژ باشد. در «فرآیند تولید» (Routing)، عملیات به مراکز کاری تخصیص داده می‌شوند.

**مثال‌ها:**

* کارگاه تراش (شامل: CNC-01, CNC-02, علی احمدی)
* سالن میکس (شامل: Mixer-A, Mixer-B)
* ایستگاه جوشکاری
* خط بسته‌بندی نهایی

---

## ۴. کاربردها

* **گروه‌بندی منابع:** تخصیص منابع (ماشین و انسان) به یک مکان یا گروه کاری مشخص.
* **برنامه‌ریزی و زمان‌بندی:** عملیات تولید به یک مرکز کار تخصیص می‌یابد. سپس موتور زمان‌بندی، بر اساس **قاعده تخصیص** تعریف شده برای این مرکز کار، یک منبع **در دسترس** از داخل آن مرکز کار را انتخاب می‌کند.
* **تعیین منطق بهینه‌سازی:** مشخص کردن اینکه آیا این مرکز کار باید بر اساس **سریع‌ترین زمان شروع**، **سریع‌ترین منبع** یا **کم‌هزینه‌ترین منبع**، عملیات‌ها را تخصیص دهد.
* **بهای تمام شده (آینده):** تجمیع هزینه‌های سربار (مانند برق سالن، استهلاک) در سطح مرکز کار، و سپس سرشکن کردن آن بر روی سفارش‌های تولیدی که از آن عبور کرده‌اند (از طریق فیلد «مرکز هزینه»).

---

## ۵. فیلدهای اطلاعاتی

| نام فیلد | نوع داده | توضیح |
| :--- | :--- | :--- |
| **کد مرکز کار** | متنی / عددی | شناسه یکتا (مثلاً `WC-CUT`) |
| **نام مرکز کار** | متنی | عنوان توصیفی (مثلاً «کارگاه برشکاری») |
| **مکان عملیاتی (Operating Unit)** | انتخابی | واحد سازمانی بالاتر (مثلاً «کارخانه تولید خوراک طیور») |
| **تقویم کار (Work Calendar)** | انتخابی | تقویم کاری پیش‌فرض برای این مرکز کار (می‌تواند توسط تقویم منابع زیرمجموعه لغو شود) |
| **منابع در دسترس (Resources)** | انتخابی (چندتایی) | لیستی از منابع (Resources) که در این مرکز کار فعالیت می‌کنند |
| **قاعده تخصیص (Dispatching Rule)** | انتخابی | (بسیار مهم) منطق انتخاب منبع از بین منابع در دسترس. (مثلاً: «اولین در دسترس»، «سریع‌ترین منبع»، «کم‌هزینه‌ترین») |
| **مرکز هزینه (Cost Center)** | انتخابی (آینده) | (توسعه آتی) اتصال به ماژول مالی برای تجمیع هزینه‌های سربار |

---

## ۶. نکات کاربردی
* **اهمیت قاعده تخصیص:** این فیلد مستقیماً بر خروجی زمان‌بندی تأثیر می‌گذارد.
	* «اولین در دسترس» (First Available): رایج‌ترین قاعده. کار را به اولین منبعی می‌دهد که آزاد است تا کار هرچه سریع‌تر شروع شود.
	* «سریع‌ترین منبع» (Fastest Resource): برای گلوگاه‌ها (Bottlenecks) حیاتی است. کار را به منبعی با بالاترین «ضریب عملکرد» 	(Performance Factor) می‌دهد، حتی اگر لازم باشد چند ساعت برای آزاد شدن آن صبر کند.
* **تنظیم پیش‌فرض سراسری:** معمولاً یک «قاعده تخصیص» پیش‌فرض در «تنظیمات ماژول تولید» تعریف می‌شود (مثلاً «اولین در دسترس»). فیلد موجود در این فرم (مرکز کار) به شما اجازه می‌دهد تا برای مراکز کاری خاص و حساس (مانند گلوگاه‌ها)، این قانون سراسری را لغو (Override) کرده و از منطق دیگری (مانند «سریع‌ترین منبع») استفاده کنید.
* **تخصیص منابع:** یک **منبع (Resource)** می‌تواند در *چند* مرکز کار وجود داشته باشد (مثلاً یک اپراتور ماهر که هم در مرکز کار «تراشکاری» و هم «فرزکاری» کار می‌کند).
* **مالی:** **مرکز کار** قلب اتصال بین مهندسی (Routing) و مالی (Costing) است. اگرچه فیلد «مرکز هزینه» در MVP آتی است، اما ساختار باید بر این اساس بنا شود.
* **اولویت تقویم:** تقویم مرکز کار به عنوان یک الگوی کلی عمل می‌کند، اما در محاسبات دقیق زمان‌بندی، **تقویم هر منبع** اولویت دارد.

---

## ۷. مثال کاربردی

| کد | نام | مکان عملیاتی | تقویم کار | قاعده تخصیص | منابع در دسترس |
| :--- | :--- | :--- | :--- | :--- | :--- |
| WC-TRASH | کارگاه تراش | کارخانه A | ۲ شیفت | سریع‌ترین منبع | {CNC-01, CNC-02, علی احمدی, رضا حسینی} |
| WC-MIX | سالن میکس | کارخانه B | ۲۴/۷ | اولین در دسترس | {Mixer-A, Mixer-B} |
| WC-WELD | ایستگاه جوشکاری | کارخانه A | ۱ شیفت | اولین در دسترس | {دستگاه جوش ۰۱, دستگاه جوش ۰۲, علی احمدی} |
| WC-PACK | خط بسته‌بندی | کارخانه B | ۲ شیفت | کم‌هزینه‌ترین منبع | {خط بسته بندی ۰۱, اپراتور بسته بندی ۰۱} |

> *توجه:* در مثال بالا، «علی احمدی» در دو مرکز کار (`WC-TRASH` و `WC-WELD`) حضور دارد. همچنین «کارگاه تراش» به عنوان گلوگاه، طوری تنظیم شده که همیشه منابع سریع‌تر را انتخاب کند، در حالی که سایر مراکز کاری از قواعد استاندارد یا مبتنی بر هزینه استفاده می‌کنند.

---

## ۸. ارتباط با سایر ماژول‌ها

| ماژول مرتبط | نوع ارتباط | توضیح |
| :--- | :--- | :--- |
| **منبع (Resource)** | استفاده مستقیم | تخصیص منابع به مراکز کاری |
| **فرآیند تولید (Routing)** | استفاده مستقیم | تخصیص هر عملیات به یک مرکز کار |
| **مالی (Costing)** | وابسته (آینده) | اتصال به «مرکز هزینه» برای محاسبه سربار |
| **برنامه‌ریزی تولید** | وابسته | خواندن «قاعده تخصیص» از این فرم برای تصمیم‌گیری |

---

## ۹. خطاها و هشدارهای احتمالی

| خطا / هشدار | علت | راه‌حل |
| :--- | :--- | :--- |
| «مرکز کار فاقد منبع است» | مرکز کاری تعریف شده اما هیچ منبعی به آن تخصیص نیافته | حداقل یک منبع (Resource) به مرکز کار اضافه کنید |
| «قاعده تخصیص انتخاب نشده» | فیلد قاعده تخصیص خالی است | یک قاعده (حداقل «اولین در دسترس») انتخاب کنید یا سیستم را طوری تنظیم کنید که از پیش‌فرض سراسری استفاده کند |
| «مرکز کار در فرآیند تولید استفاده شده» | (هنگام حذف) این مرکز کار در یک یا چند Routing فعال استفاده شده | ابتدا آن را از تمام فرآیندهای تولید حذف کنید |
| «مرکز کار تقویم ندارد» | تقویم کاری پیش‌فرض انتخاب نشده | یک تقویم کاری برای مرکز کار انتخاب کنید |

---

## ۱۰. توسعه‌های آتی (پیشنهادی)

* فعال‌سازی فیلد **«مرکز هزینه» (Cost Center)** و یکپارچگی کامل با ماژول مالی.
* افزودن **قواعد تخصیص ترکیبی** (مثلاً: اول کم‌هزینه‌ترین، و در صورت تساوی، سریع‌ترین).
* تعریف **نرخ‌های سربار (Overhead Rates)** مستقیم برای مرکز کار.

تمرکز روی چه محصولی، چه زمانی و چه مقدار تولید شود.

1. فرم برنامه تولید اصلی (Master Production Schedule - MPS)
هدف:
برنامه تولید اصلی (MPS) برنامه‌ریزی سطح بالا برای تولید محصولات نهایی است که تقاضای بازار (بر اساس پیش‌بینی یا سفارش‌های فروش) را با ظرفیت تولید هماهنگ می‌کند. MPS ورودی اصلی برای MRP است و تعیین می‌کند چه محصولی، چه مقدار، و در چه زمانی تولید شود.
محل در منو:

ماژول: برنامه‌ریزی و کنترل تولید (Manufacturing / PP / MRP / MES)
زیرمنو: برنامه‌ریزی > برنامه تولید اصلی (MPS)

امکانات فرم MPS:

ایجاد برنامه تولید (Create MPS):

تعریف برنامه تولید برای یک بازه زمانی (هفتگی، ماهانه).
تخصیص محصولات نهایی بر اساس سفارش‌های فروش یا پیش‌بینی تقاضا.


ویرایش/مشاهده برنامه (Edit/View MPS):

نمایش برنامه در قالب جدولی یا گانت چارت.
فیلتر بر اساس محصول، تاریخ، یا وضعیت.


تأیید برنامه (Approve MPS):

تأیید برنامه توسط مدیر تولید برای ارسال به MRP.


گزارش‌گیری (Reports):

گزارش تقاضای برنامه‌ریزی‌شده (Planned Demand).
گزارش انحرافات برنامه (Plan vs. Actual).


یکپارچگی با سایر ماژول‌ها:

مدیریت فروش (Sales/CRM): دریافت داده‌های سفارش فروش (Sales Order) یا پیش‌بینی تقاضا (Forecast).
مدیریت انبار (Inventory): بررسی موجودی محصولات نهایی.
مدیریت اطلاعات پایه (MDM): استفاده از داده‌های محصول و BOM.



فیلدهای اطلاعاتی:

محصول (Product): کد محصول (از MDM/Item Grouping) یا نام محصول.
مقدار برنامه‌ریزی‌شده (Planned Quantity): تعداد محصول نهایی مورد نیاز (مثلاً 1000 کیلوگرم).
بازه زمانی (Time Period): تاریخ شروع و پایان تولید (مثلاً هفته 45 سال 2025).
منبع تقاضا (Demand Source): نوع تقاضا (سفارش فروش، پیش‌بینی، یا تقاضای داخلی).

مثال: Sales Order ID یا Forecast ID.


اولویت (Priority): اولویت تولید (بالا، متوسط، پایین) برای مدیریت سفارش‌های فوری.
وضعیت (Status): وضعیت برنامه (Draft, Approved, Released).
مکان تولید (Operating Unit): کارخانه یا سایت تولید (از MDM/Organizational Structure).
یادداشت‌ها (Notes): توضیحات اضافی (مثلاً برای تولید سفارشی).

ویژگی‌های پیشرفته:

پیش‌بینی تقاضا (Demand Forecasting): امکان وارد کردن پیش‌بینی‌های آماری یا AI-driven (مانند استفاده از xAI API).
برنامه‌ریزی چندمحصولی: پشتیبانی از برنامه‌ریزی همزمان چند محصول با وابستگی‌ها (مانند در SAP PP).
مدیریت محدودیت‌ها (Constraint Management): نمایش هشدار برای محدودیت‌های ظرفیت یا مواد.
نمایش گانت چارت: نمایش گرافیکی برنامه تولید برای بازه‌های زمانی.

یکپارچگی:

ورودی: داده‌های تقاضا از Sales/CRM، موجودی از Inventory، و محصولات از MDM.
خروجی: برنامه MPS به عنوان ورودی برای MRP و CRP/APS.

# فرمول‌های‌ تولید (Bill of Materials - BOMs)

---

## ۱. هدف

هدف از این فرم، تعریف دقیق **مواد، قطعات و زیرمجموعه‌هایی** است که برای تولید یک محصول مشخص (یا نیمه‌ساخته) مورد نیاز است. BOM به سوال «محصول **از چه چیزی** ساخته می‌شود؟» پاسخ می‌دهد.

---

## ۲. محل دسترسی در سیستم

**ماژول:** برنامه‌ریزی و کنترل تولید (Production Management)

**مسیر:**
`برنامه‌ریزی و کنترل تولید / مهندسی تولید / فرمول‌های تولید (BOM)`

---

## ۳. تعریف

**فرمول تولید (BOM)** یک لیست ساختاریافته (معروف به «درخت محصول») است که شامل تمام اجزای مورد نیاز برای تولید یک «مقدار پایه» (Basis Quantity) از محصول نهایی است. این سند، ستون فقرات برنامه‌ریزی مواد (MRP) و محاسبه بهای تمام شده مواد است.

این فرم از دو بخش اصلی تشکیل شده است:

۱. **سربرگ (Header):** اطلاعات کلی BOM (برای کدام محصول و چه مقداری).
۲. **اجزا (Components):** لیست مواد و قطعات مورد نیاز.

---

## ۴. کاربردها

* **برنامه‌ریزی تأمین مواد (MRP):** محاسبه دقیق نیازمندی‌های مواد اولیه بر اساس سفارش‌های تولید.
* **صدور حواله انبار:** تعیین اینکه چه موادی و به چه مقدار باید از انبار برای یک سفارش تولید صادر شود.
* **بهای تمام شده:** محاسبه هزینه مواد مستقیم (Direct Material Cost) برای محصول نهایی.
* **مهندسی محصول:** نگهداری سوابق دقیق از ساختار محصولات.

---

## ۵. فیلدهای اطلاعاتی

### بخش سربرگ (BOM Header)

| نام فیلد | نوع داده | توضیح |
| :--- | :--- | :--- |
| **نام (Name)** | متنی | یک نام توصیفی (مثلاً «لیست مواد دوچرخه M-200») |
| **محصول (Product)** | انتخابی (از کالاها) | محصول نهایی (والد) که این BOM آن را تعریف می‌کند (مثلاً «دوچرخه M-200») |
| **مقدار پایه (Basis Quantity)** | عددی | این لیست مواد برای چه مقداری از محصول تعریف شده است (مثلاً: ۱) |
| **واحد مقدار پایه** | انتخابی (از UoM) | واحد اندازه‌گیری مقدار پایه (مثلاً «عدد»، «کیلوگرم») |
| **وضعیت (Status)** | انتخابی | وضعیت BOM (مثلاً: در حال طراحی، تایید شده، بایگانی شده) |
| **نسخه (Version Number)** | متنی (آینده) | (توسعه آتی) برای مدیریت تغییرات مهندسی (ECM) |
| **تاریخ اعتبار (Valid From/To)** | تاریخ (آینده) | (توسعه آتی) محدوده زمانی اعتبار این نسخه از BOM |

### بخش اجزا (BOM Components / Lines)

| نام فیلد | نوع داده | توضیح |
| :--- | :--- | :--- |
| **قطعه/ماده (Component)** | انتخابی (از کالاها) | ماده اولیه یا قطعه نیمه‌ساخته مورد نیاز (مثلاً «لاستیک») |
| **مقدار (Quantity)** | عددی | چه مقدار از این قطعه برای «مقدار پایه» محصول لازم است (مثلاً: ۲) |
| **واحد اندازه‌گیری (UoM)** | انتخابی (از UoM) | واحد اندازه‌گیری قطعه (مثلاً «عدد»، «کیلوگرم»، «متر») |
| **شماره عملیات تخصیص (Op. Seq.)** | عددی | **(بسیار مهم)** شماره عملیاتی از «فرآیند تولید» (Routing) که این ماده باید در آنجا مصرف شود |
| **درصد ضایعات (Scrap %)** | درصدی | درصد ضایعات پیش‌بینی شده برای این ماده (برای افزایش درخواست از انبار) |

---

## ۶. نکات کاربردی

1.  **اهمیت مقدار پایه:** تمام مقادیر اجزا (Lines) باید نسبت به «مقدار پایه» (سربرگ) تعریف شوند. اگر مقدار پایه ۱ (عدد) دوچرخه باشد، مقدار لاستیک ۲ (عدد) است. اگر مقدار پایه ۱۰۰۰ (کیلوگرم) خوراک طیور باشد، مقدار ذرت ۴۰۰ (کیلوگرم) است.
2.  **اهمیت شماره عملیات تخصیص:** این فیلد، BOM (چه چیزی) را به Routing (چگونه) متصل می‌کند. این فیلد به سیستم می‌گوید که «لوله فریم» باید در عملیات ۱۰ (برشکاری) در دسترس باشد، نه در عملیات ۳۰ (رنگ‌آمیزی).
3.  **ضایعات (Scrap):** اگر برای تولید ۱ دوچرخه (مقدار پایه) به ۲ متر لوله نیاز دارید (مقدار) اما ۵٪ ضایعات برشکاری دارید، باید در فیلد ضایعات ۵٪ را وارد کنید. سیستم هنگام برنامه‌ریزی، ‎۲ / ۱.۰۵ = ۲.۱ متر لوله درخواست خواهد کرد.

---

## ۷. مثال کاربردی

**سناریو: تولید ۱ عدد «دوچرخه M-200»**

**سربرگ (Header):**

* **نام:** BOM دوچرخه M-200
* **محصول:** دوچرخه M-200 (کد P-100)
* **مقدار پایه:** ۱
* **واحد:** عدد
* **وضعیت:** تایید شده

**اجزا (Components):**

| قطعه/ماده (کد کالا) | مقدار | واحد | شماره عملیات تخصیص | ضایعات |
| :--- | :--- | :--- | :--- | :--- |
| فریم (P-101) | ۱ | عدد | ۲۰ (مونتاژ) | ۰٪ |
| لاستیک (C-200) | ۲ | عدد | ۲۰ (مونتاژ) | ۱٪ |
| لوله فریم (R-300) | ۳ | متر | ۱۰ (برشکاری) | ۵٪ |
| رنگ قرمز (R-301) | ۰.۵ | کیلوگرم | ۳۰ (رنگ‌آمیزی) | ۲٪ |

---

## ۸. ارتباط با سایر ماژول‌ها

| ماژول مرتبط | نوع ارتباط | توضیح |
| :--- | :--- | :--- |
| **مدیریت کالا (Product Master)** | استفاده مستقیم | هم برای محصول والد و هم برای اجزای فرزند |
| **فرآیند تولید (Routing)** | وابسته (بسیار قوی) | اتصال از طریق «شماره عملیات تخصیص» |
| **برنامه‌ریزی تولید (MRP)** | استفاده مستقیم | مبنای محاسبه نیازمندی‌های مواد |
| **انبار (Inventory)** | وابسته | مبنای صدور حواله خروج مواد اولیه |
| **بهای تمام شده (Costing)** | وابسته | مبنای محاسبه هزینه مواد محصول |

---

## ۹. خطاها و هشدارهای احتمالی

| خطا / هشدار | علت | راه‌حل |
| :--- | :--- | :--- |
| «محصول والد فاقد BOM است» | (خطای برنامه‌ریزی) تلاش برای تولید محصولی که BOM ندارد | BOM معتبر و «تایید شده» برای محصول ایجاد کنید |
| «شماره عملیات تخصیص نامعتبر» | شماره عملیاتی وارد شده که در Routing متصل به این BOM وجود ندارد | شماره عملیات را در BOM یا Routing اصلاح کنید |
| «BOM چرخه‌ای (Circular)» | محصول A به B نیاز دارد، و محصول B به A نیاز دارد | ساختار BOM را اصلاح کنید تا چرخه از بین برود |
| «مقدار قطعه صفر است» | مقدار یکی از اجزا ۰ وارد شده | مقدار صحیح را وارد کنید یا ردیف را حذف کنید |

---

## ۱۰. توسعه‌های آتی (پیشنهادی)

* فعال‌سازی **مدیریت نسخه (Versioning)** و **تاریخ اعتبار** برای مدیریت تغییرات مهندسی (ECM).
* افزودن **نوع آیتم (Item Type)** در ردیف‌ها (مثلاً: ماده اولیه، کالای نیمه‌ساخته، محصول جانبی (By-product)، محصول مشترک (Co-product)).
* پشتیبانی از **BOM فانتوم (Phantom BOM)** برای زیرمجموعه‌هایی که تولید یا انبارش مستقل ندارند.

# فرآیند‌های تولید (Routings)

---

## ۱. هدف

هدف از این فرم، تعریف **مراحل، عملیات و توالی** مورد نیاز برای ساخت یک محصول است. فرآیند تولید به سوال «محصول **چگونه** ساخته می‌شود؟» پاسخ می‌دهد و مشخص می‌کند که در هر مرحله، چه کاری، کجا (در کدام مرکز کار) و با چه منابعی (نوع منبع) انجام شود.

---

## ۲. محل دسترسی در سیستم

**ماژول:** برنامه‌ریزی و کنترل تولید (Production Management)

**مسیر:**
`برنامه‌ریزی و کنترل تولید / مهندسی تولید/ فرآیندهای تولید (Routing)`

---

## ۳. تعریف

**فرآیند تولید (Routing)** سند مهندسی اصلی است که توالی عملیات (Operations) را برای تولید یک «مقدار پایه» (Basis Quantity) از محصول مشخص می‌کند. هر عملیات شامل اطلاعاتی در مورد مرکز کار مورد نیاز، انواع منابع، و زمان‌های استاندارد (آماده‌سازی و اجرا) است.

این فرم از دو بخش اصلی تشکیل شده است:

۱. **سربرگ (Header):** اطلاعات کلی فرآیند (برای کدام محصول و کدام BOM).
۲. **عملیات (Operations):** لیست گام‌های اجرایی و نیازمندی‌های منابع آن‌ها.

---

## ۴. کاربردها

* **برنامه‌ریزی و زمان‌بندی (Scheduling):** مبنای اصلی محاسبه زمان شروع و پایان هر عملیات و کل سفارش تولید.
* **برنامه‌ریزی ظرفیت (CRP):** محاسبه بار کاری (Load) مورد نیاز برای هر مرکز کار و منبع.
* **بهای تمام شده:** محاسبه هزینه‌های مستقیم کار (Labor) و سربار ساخت (Overhead) بر اساس زمان‌های عملیات و نرخ هزینه منابع.
* **راهنمای کارگاه:** ارائه دستورالعمل گام‌به‌گام به اپراتورهای سطح کارگاه.

---

## ۵. فیلدهای اطلاعاتی

### بخش سربرگ (Routing Header)

| نام فیلد | نوع داده | توضیح |
| :--- | :--- | :--- |
| **نام (Name)** | متنی | یک نام توصیفی (مثلاً «فرآیند تولید خوراک طیور») |
| **محصول (Product)** | انتخابی (از کالاها) | محصول نهایی که این فرآیند آن را تولید می‌کند |
| **مقدار پایه (Basis Quantity)** | عددی | این فرآیند برای چه مقداری از محصول تعریف شده است (مثلاً ۱۰۰۰ کیلوگرم) |
| **واحد مقدار پایه** | انتخابی (از UoM) | واحد اندازه‌گیری مقدار پایه (مثلاً «کیلوگرم») |
| **فرمول تولید (BOM)** | انتخابی (از BOMs) | مشخص می‌کند این فرآیند از کدام BOM برای مصرف مواد استفاده می‌کند |
| **وضعیت (Status)** | انتخابی | وضعیت (مثلاً: در حال طراحی، تایید شده، بایگانی شده) |
| **نسخه (Version Number)** | متنی (آینده) | (توسعه آتی) برای مدیریت تغییرات مهندسی |
| **تاریخ اعتبار (Valid From/To)** | تاریخ (آینده) | (توسعه آتی) محدوده زمانی اعتبار این نسخه |

### بخش عملیات (Operations / Lines)

| نام فیلد | نوع داده | توضیح |
| :--- | :--- | :--- |
| **ترتیب (Sequence)** | عددی | ترتیب اجرای عملیات (مثلاً ۱۰، ۲۰، ۳۰). **این شماره به BOM لینک می‌شود.** |
| **نام عملیات (Name)** | متنی | عنوان عملیات (مثلاً «میکس نهایی»، «برشکاری لوله‌ها») |
| **مرکز کار (Work Center)** | انتخابی | مکانی که این عملیات در آن انجام می‌شود (مثلاً «سالن میکس») |
| **زمان صف (Queue Time)** | عددی (زمان) | (اختیاری) زمان استاندارد انتظار قطعه *قبل* از شروع آماده‌سازی |
| **زمان انتظار (Wait Time)** | عددی (زمان) | (اختیاری) زمان استاندارد انتظار قطعه *بعد* از اتمام اجرا (مثلاً زمان خشک شدن) |
| **زمان انتقال (Move Time)** | عددی (زمان) | (اختیاری) زمان انتقال به عملیات بعدی |

### بخش منابع مورد نیاز (Resource Requirements) - (زیرمجموعه هر عملیات)

| نام فیلد | نوع داده | توضیح |
| :--- | :--- | :--- |
| **نوع منبع (Resource Type)** | انتخابی | چه نوع منبعی نیاز است؟ (مثلاً «ماشین تراش CNC» یا «اپراتور ماهر») |
| **مقدار (Quantity)** | عددی | چند واحد از این نوع منبع نیاز است؟ (مثلاً ۱ ماشین، ۲ اپراتور) |
| **مبنای زمان آماده‌سازی** | انتخابی | ثابت برای سفارش / ثابت برای بچ / به ازای واحد |
| **زمان آماده‌سازی (Setup)** | عددی (زمان) | زمان استاندارد آماده‌سازی (مثلاً ۱۵ دقیقه) |
| **مبنای زمان اجرا** | انتخابی | به ازای مقدار پایه / ثابت برای بچ / به ازای واحد |
| **زمان اجرا (Run Time)** | عددی (زمان) | زمان استاندارد اجرا (مثلاً ۳۰ دقیقه برای «مقدار پایه») |
| **میزان مصرف ظرفیت** | عددی | این عملیات چه مقدار از ظرفیت منبع را اشغال می‌کند؟ (مثلاً ۱ «کار» یا ۱۰۰۰ «کیلوگرم») |
| **قابلیت‌های مورد نیاز** | انتخابی (چندتایی) | (اختیاری) مهارت‌های خاص مورد نیاز از آن نوع منبع |

---

## ۶. نکات کاربردی

1.  **اتصال BOM و Routing:** اتصال حیاتی از طریق فیلد «ترتیب (Sequence)» در عملیات و «شماره عملیات تخصیص» در اجزای BOM برقرار می‌شود.
2.  **زمان‌ها و مقدار پایه:** زمان اجرا (Run Time) معمولاً برای «مقدار پایه» سربرگ فرآیند تولید تعریف می‌شود. مثال: اگر مقدار پایه ۱۰۰۰ کیلوگرم و زمان اجرا ۳۰ دقیقه باشد، یعنی تولید ۱۰۰۰ کیلوگرم ۳۰ دقیقه طول می‌کشد. سیستم برای سفارش ۲۰۰۰ کیلویی، ‎۲ * ۳۰ = ۶۰ دقیقه زمان اجرا محاسبه می‌کند (اگر مبنای زمان «به ازای مقدار پایه» باشد).
3.  **زمان‌های صف، انتظار، انتقال:** این زمان‌ها به زمان کل فرآیند (Lead Time) اضافه می‌شوند اما ظرفیت منبع را اشغال نمی‌کنند (مثلاً زمان خشک شدن رنگ).

---

## ۷. مثال کاربردی

**سناریو: تولید ۱ عدد «دوچرخه M-200»** (متصل به مثال BOM)

**سربرگ (Header):**

* **نام:** فرآیند تولید دوچرخه M-200
* **محصول:** دوچرخه M-200 (کد P-100)
* **مقدار پایه:** ۱
* **واحد:** عدد
* **فرمول تولید (BOM):** BOM دوچرخه M-200
* **وضعیت:** تایید شده

**عملیات (Operations):**

| ترتیب (Seq) | نام عملیات | مرکز کار | زمان انتظار (دقیقه) |
| :--- | :--- | :--- | :--- |
| ۱۰ | برشکاری لوله‌ها | WC-TRASH | ۰ |
| ۲۰ | مونتاژ و جوشکاری فریم | WC-WELD | ۰ |
| ۳۰ | رنگ‌آمیزی | WC-PAINT | ۱۲۰ (خشک شدن) |

**منابع مورد نیاز (Resource Requirements) برای عملیات ۱۰ (برشکاری):**

| نوع منبع | مقدار | مبنای زمان راه‌اندازی | زمان راه‌اندازی (دقیقه) | مبنای زمان اجرا | زمان اجرا (دقیقه) | مصرف ظرفیت |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| ماشین تراش CNC | ۱ | ثابت سفارش | ۱۰ | به ازای واحد | ۵ | ۱ (کار) |
| اپراتور ماهر | ۱ | ثابت سفارش | ۵ | به ازای واحد | ۵ | ۱ (کار) |

**منابع مورد نیاز (Resource Requirements) برای عملیات ۲۰ (جوشکاری):**

| نوع منبع | مقدار | مبنای زمان راه‌اندازی | زمان راه‌اندازی (دقیقه) | مبنای زمان اجرا | زمان اجرا (دقیقه) | قابلیت مورد نیاز |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| دستگاه جوشکاری | ۱ | ثابت سفارش | ۵ | به ازای واحد | ۱۲ | - |
| اپراتور جوشکار | ۱ | ثابت سفارش | ۲ | به ازای واحد | ۱۳ | جوشکاری گرید A |

---

## ۸. ارتباط با سایر ماژول‌ها

| ماژول مرتبط | نوع ارتباط | توضیح |
| :--- | :--- | :--- |
| **فرمول تولید (BOM)** | وابسته (بسیار قوی) | اتصال از طریق «شماره عملیات تخصیص» |
| **مرکز کار (Work Center)** | استفاده مستقیم | هر عملیات به یک مرکز کار تخصیص می‌یابد |
| **نوع منبع (Resource Type)** | استفاده مستقیم | تعریف نیازمندی‌های هر عملیات |
| **برنامه‌ریزی تولید** | استفاده مستقیم | مبنای ایجاد سفارش‌های تولید و زمان‌بندی |
| **بهای تمام شده (Costing)** | وابسته | مبنای محاسبه هزینه دستمزد و سربار |

---

## ۹. خطاها و هشدارهای احتمالی

| خطا / هشدار | علت | راه‌حل |
| :--- | :--- | :--- |
| «عملیات فاقد مرکز کار است» | مرکز کاری برای یک عملیات انتخاب نشده | مرکز کار مرتبط را انتخاب کنید |
| «عملیات فاقد نیازمندی منبع است» | برای یک عملیات، هیچ نوع منبعی تعریف نشده | حداقل یک ردیف نیازمندی منبع (Resource Req) تعریف کنید |
| «زمان اجرا یا آماده‌سازی صفر است» | زمان‌های استاندارد وارد نشده‌اند | زمان‌های استاندارد را بر اساس مهندسی صنایع وارد کنید |
| «ترتیب عملیات تکراری است» | دو عملیات با Sequence یکسان (مثلاً هر دو ۱۰) | از شماره‌های ترتیب یکتا استفاده کنید |

---

## ۱۰. توسعه‌های آتی (پیشنهادی)

* افزودن فیلد **«خروجی واقعی مرحله» (Yield Quantity)** برای مدیریت ضایعات در هر مرحله.
* افزودن **«مقدار ارسال به مرحله بعد» (Send Ahead Qty)** برای همپوشانی عملیات‌ها (Overlapping).
* امکان تعریف **عملیات‌های پیمانکاری (Subcontracting)**.


# نوع وسیله نقلیه (Vehicle Type)

---

## ۱. هدف
هدف از این فرم، تعریف و مدیریت انواع وسایل نقلیه‌ای است که برای **حمل و ارسال کالاها** در فرآیندهای فروش، توزیع یا حمل‌ونقل داخلی شرکت استفاده می‌شوند.  
هر نوع وسیله نقلیه دارای ظرفیت مشخص وزنی و حجمی است که در زمان **برنامه‌ریزی حمل (Shipment Planning)** برای تخصیص مرسوله‌ها مورد استفاده قرار می‌گیرد.

---

## ۲. محل دسترسی در سیستم
**ماژول:** حمل‌ونقل و لجستیک  
**مسیر:**  
`حمل‌ونقل و لجستیک / تعاریف پایه / انواع وسیله نقلیه`

---

## ۳. تعریف
نوع وسیله نقلیه، مشخص‌کننده‌ی **مدل کلی خودرو یا تجهیز حمل** است که شرکت برای انتقال کالا از انبار به مقصد مشتری یا بین شعب استفاده می‌کند.  

**مثال‌ها:**

- تریلی ۲۵ تنی  
- کامیون ۱۰ تنی  
- ایسوزو ۶ تنی  
- وانت پیکان  
- نیسان آبی  
- کامیونت یخچال‌دار  

---

## ۴. کاربرد
- در زمان ایجاد **مرسوله (Shipment)** برای تعیین نوع وسیله مورد استفاده.  
- در **برنامه‌ریزی حمل و بارگیری** برای بررسی ظرفیت وزنی و حجمی خودروها.  
- برای **گزارش‌گیری و تحلیل‌های حمل‌ونقل** (مثل میانگین ظرفیت استفاده‌شده در ماه).  
- در فرآیندهای **تخصیص راننده و وسیله نقلیه** به مرسوله‌ها.

---

## ۵. فیلدهای اطلاعاتی

| نام فیلد | نوع داده | توضیح |
|-----------|-----------|--------|
| **کد نوع وسیله نقلیه** | عددی / متنی | شناسه یکتا برای هر نوع وسیله نقلیه (مثلاً `VEH_001`) |
| **نام وسیله نقلیه** | متنی | نام رایج وسیله نقلیه (مثلاً تریلی ۲۵ تنی، کامیون ۱۰ تنی) |
| **ظرفیت وزنی (Weight Capacity)** | عددی (تن / کیلوگرم) | حداکثر وزن قابل حمل توسط وسیله |
| **ظرفیت حجمی (Volume Capacity)** | عددی (متر مکعب) | حداکثر حجم کالا که وسیله می‌تواند حمل کند *(اختیاری)* |
| **نوع کاربری وسیله نقلیه (Vehicle Usage Type)** | انتخابی | معمولی، یخچال‌دار، تانکری، روباز , مسقف، کمپرسی و … |
| **وضعیت فعال (Active)** | بولین (بله / خیر) | مشخص می‌کند آیا وسیله برای تخصیص در دسترس است یا خیر |
| **توضیحات (Description)** | متنی | توضیحات تکمیلی در مورد نوع وسیله نقلیه |

---

## ۶. نکات کاربردی

1. اگر شرکت چند نوع تریلی دارد (مثلاً ۲۵ تنی و ۱۸ تنی)، برای هرکدام یک **رکورد جداگانه** تعریف کنید.  
2. ظرفیت وزنی در زمان محاسبه بارگیری استفاده می‌شود؛ بنابراین مقدار آن باید با داده‌های واقعی مطابقت داشته باشد.  
3. فیلد “وضعیت فعال” را زمانی غیرفعال کنید که نوع وسیله از چرخه حمل حذف شده است.  
4. در صورت نیاز به محاسبات دقیق‌تر، می‌توانید در آینده فیلدهایی مثل **تعداد محور، طول بارگیر، یا مصرف سوخت** اضافه کنید.  

---

## ۷. مثال کاربردی

| کد | نام | ظرفیت وزنی | نوع کاربری | وضعیت |
|----|------|--------------|-----------|---------|
| VH_001 | تریلی ۲۵ تنی | ۲۵ تن | معمولی | فعال |
| VH_002 | کامیون ۱۰ تنی | ۱۰ تن | مسقف | فعال |
| VH_003 | نیسان آبی | ۲ تن | روباز | فعال |
| VH_004 | ایسوزو یخچال‌دار | ۶ تن | یخچال‌دار | فعال |

---

## ۸. ارتباط با سایر ماژول‌ها

| ماژول مرتبط | نوع ارتباط | توضیح |
|---------------|--------------|--------|
| **مرسوله (Shipment)** | استفاده مستقیم | انتخاب نوع وسیله نقلیه در زمان ایجاد مرسوله |
| **برنامه‌ریزی حمل (Transportation Planning)** | وابسته | استفاده از ظرفیت وسیله برای زمان‌بندی و تخصیص حمل |
| **مدیریت انبار (Warehouse)** | وابسته | برای تعیین نحوه بارگیری کالا در انبار |
| **گزارشات لجستیک** | تحلیلی | نمایش حجم حمل بر اساس نوع وسیله نقلیه |

---

## ۹. خطاها و هشدارهای احتمالی

| خطا / هشدار | علت | راه‌حل |
|---------------|--------|---------|
| «ظرفیت وزنی تعریف نشده است» | مقدار ظرفیت وارد نشده | در فرم نوع وسیله نقلیه ظرفیت را تکمیل کنید |
| «وسیله نقلیه غیرفعال است» | وضعیت فعال = خیر | وضعیت را فعال کنید یا وسیله دیگری انتخاب کنید |
| «بار بیشتر از ظرفیت وسیله است» | وزن مرسوله از ظرفیت وسیله بیشتر است | مرسوله را بین چند وسیله تقسیم کنید |


# مفهوم و فرم: بانک‌ها (Banks)

---

## ۱. مفهوم

موجودیت «بانک» یک تعریف پایه و بسیار ساده در سیستم است. این موجودیت صرفاً لیستی از نام بانک‌هایی را که سازمان با آن‌ها یا مشتریان و تأمین‌کنندگان سازمان با آن‌ها کار می‌کنند، نگهداری می‌کند.

* **هدف:** این فرم به عنوان یک فهرست (List) برای انتخاب در فرم‌های دیگر (مانند تعریف حساب بانکی شرکت یا ثبت چک دریافتی از مشتری) عمل می‌کند.
* **مثال:** بانک ملت، بانک سامان، بانک ملی ایران، بانک پاسارگاد و ...

---

## ۲. فرم: تعریف بانک (Bank Definition)

این فرم معمولاً در بخش تعاریف پایه ماژول خزانه‌داری یا حسابداری قرار دارد.

**مسیر:**
`خزانه‌داری / تعاریف پایه / بانک‌ها`

### فیلدهای اطلاعاتی فرم

| نام فیلد         | نوع داده  | اجباری | توضیح                                                                        | مثال             |
| :--------------- | :-------- | :----- | :--------------------------------------------------------------------------- | :--------------- |
| **کد بانک**      | متنی/عددی | بله    | یک شناسه یکتا برای بانک (می‌تواند کد سوئیفت یا کد استاندارد بانک مرکزی باشد). | `012` (بانک ملت) |
| **نام بانک**     | متنی      | بله    | نام کامل و رسمی بانک.                                                        | `بانک ملت`       |
| **نام اختصاری**  | متنی      | خیر    | نام کوتاه یا رایج بانک.                                                      | `ملت`            |
| **لوگو (آیکون)** | تصویر     | خیر    | لوگوی بانک برای نمایش بهتر در گزارش‌ها و فرم‌ها.                               | ``               |
| **وضعیت فعال**   | بولین     | بله    | مشخص می‌کند آیا این بانک در لیست‌های انتخابی نمایش داده شود یا خیر.            | `فعال`           |

---

## ۳. کاربرد در سیستم

* هنگام تعریف «حساب بانکی» (متعلق به شرکت)، شما از این لیست، بانکِ صاحب حساب را انتخاب می‌کنید.
* هنگام ثبت «چک دریافتی» از مشتری، شما بانک صادرکننده آن چک را از این لیست انتخاب می‌کنید.
* هنگام ثبت «چک پرداختی» به تأمین‌کننده، شما بانک مقصد (در صورت نیاز) را مشخص می‌کنید.

# مفهوم و فرم: حساب‌های بانکی (Bank Accounts)

---

## ۱. مفهوم

این موجودیت یکی از **مهم‌ترین** تعاریف پایه در ماژول خزانه‌داری و حسابداری است. «حساب بانکی» در ERP تابان، نماینده یک حساب بانکی *واقعی* متعلق به یکی از **بنگاه‌های اقتصادی** شرکت شما است.

* **هدف:** مدیریت موجودی ریالی/ارزی، ردیابی تراکنش‌ها و تعریف دسته چک‌ها.
* **جایگاه در حسابداری:** هر حساب بانکی در تابان باید به یک سرفصل معین در **دفتر کل (GL)** (مثلاً: «موجودی نقد - بانک ملت شعبه مرکزی») متصل باشد. تمامی واریزها و برداشت‌ها از این حساب بانکی، به صورت خودکار سرفصل GL متناظر را بدهکار یا بستانکار می‌کنند.

> **نکته کلیدی:** یک حساب بانکی در ERP تابان، هم یک موجودیت خزانه‌داری (برای مدیریت موجودی و چک) و هم یک موجودیت حسابداری (به عنوان یک حساب معین) است.

---

## ۲. فرم: تعریف حساب بانکی (Bank Account Definition)

**مسیر:**
`خزانه‌داری / تعاریف پایه / حساب‌های بانکی`

### فیلدهای اطلاعاتی فرم

| نام فیلد | نوع داده | اجباری | توضیح | مثال |
| :--- | :--- | :--- | :--- | :--- |
| **بنگاه اقتصادی** | انتخابی (FK) | بله | بنگاه اقتصادی (شرکت) که مالک این حساب است. | `1000 - ایران خودرو مرکزی` |
| **کد حساب (داخلی)** | متنی/عددی | بله | یک شناسه کوتاه و یکتا در داخل سیستم تابان. | `MEL-100` |
| **نام حساب** | متنی | بله | نام توصیفی حساب برای استفاده در گزارش‌ها. | `حساب جاری - بانک ملت مرکزی` |
| **بانک** | انتخابی (FK) | بله | بانکی که حساب در آن قرار دارد (از فرم بانک‌ها). | `بانک ملت` |
| **شعبه بانک** | انتخابی (FK) | بله | شعبه‌ای که حساب در آن افتتاح شده (از فرم شعب). | `شعبه مرکزی` |
| **شماره حساب** | متنی | بله | شماره حساب رسمی. | `1-2345678-90` |
| **شماره شبا (IBAN)** | متنی | بله | شماره شبا جهت انتقالات بانکی (با اعتبارسنجی ساختار). | `IR...` |
| **نوع حساب** | انتخابی | بله | (جاری، پس‌انداز، ارزی، ...). | `جاری` |
| **ارز (Currency)** | انتخابی (FK) | بله | ارز پایه حساب. | `IRR` |
| **حساب معین (GL)** | انتخابی (FK) | بله | **(بسیار مهم)** سرفصل حسابداری در دفتر کل که موجودی این حساب را نشان می‌دهد. | `11010101 - بانک ملت مرکزی` |
| **حساب موقت (GL)** | انتخابی (FK) | خیر | (پیشرفته) سرفصل واسط برای مغایرت بانکی (در صورت نیاز). | `...` |
| **وضعیت** | انتخابی | بله | (فعال، مسدود، بسته شده). | `فعال` |
| **تاریخ افتتاح** | تاریخ | خیر | | `1400/01/01` |
| **موجودی اولیه** | عددی | خیر | (فقط در زمان استقرار) موجودی اولیه در تاریخ استقرار. | `1,000,000,000` |

---

## ۳. کاربرد در سیستم

* این حساب، مبدأ «پرداخت‌ها» و مقصد «دریافت‌ها» در **سند دریافت و پرداخت** است.
* موجودی این حساب با هر تراکنش (واریز، برداشت، پاس شدن چک) به‌روز می‌شود.
* **دسته چک‌ها** (Checkbooks) فقط برای حساب‌هایی از نوع «جاری» که به این فرم معرفی شده‌اند، تعریف می‌شوند.
* در فرآیند **مغایرت بانکی**، تراکنش‌های ثبت شده برای این حساب با صورتحساب واقعی بانک تطبیق داده می‌شود.

#  مفهوم و فرم: شعب بانک‌ها (Banks Branches)

---

## ۱. مفهوم

موجودیت «شعبه بانک» اطلاعات دقیق‌تری در مورد هر شعبه‌ای که شرکت در آن حساب دارد یا با آن در ارتباط است، ارائه می‌دهد. این اطلاعات هم برای حساب‌های خود شرکت و هم برای ردیابی چک‌های مشتریان (جهت وصول) کاربرد دارد.

* **هدف:** نگهداری اطلاعات آدرس، کد شعبه و اطلاعات تماس شعب بانکی.
* **ارتباط:** هر شعبه بانک (Bank Branch) الزاماً به یک «بانک» (Bank) از فرم قبلی مرتبط است. (ارتباط یک به چند از بانک به شعبه).

---

## ۲. فرم: تعریف شعبه بانک (Bank Branch Definition)

**مسیر:**
`خزانه‌داری / تعاریف پایه / بانک‌ها و شعب / تعریف شعب`

### فیلدهای اطلاعاتی فرم

| نام فیلد        | نوع داده     | اجباری | توضیح                                              | مثال                 |
| :-------------- | :----------- | :----- | :------------------------------------------------- | :------------------- |
| **بانک (Bank)** | انتخابی (FK) | بله    | بانکی که این شعبه به آن تعلق دارد (از فرم بانک‌ها). | `بانک ملت`           |
| **کد شعبه**     | متنی/عددی    | بله    | کد شناسایی شعبه که توسط بانک ارائه می‌شود.          | `12345`              |
| **نام شعبه**    | متنی         | بله    | نام رسمی شعبه.                                     | `شعبه مرکزی`         |
| **استان**       | انتخابی      | خیر    | استان محل استقرار شعبه.                            | `تهران`              |
| **شهر**         | انتخابی      | خیر    | شهر محل استقرار شعبه.                              | `تهران`              |
| **آدرس**        | متنی         | خیر    | آدرس دقیق شعبه.                                    | `خیابان انقلاب، ...` |
| **تلفن**        | متنی         | خیر    | شماره تماس شعبه.                                   | `021-66...`          |
| **وضعیت فعال**  | بولین        | بله    |                                                    | `فعال`               |

---

## ۳. کاربرد در سیستم

* هنگام تعریف «حساب بانکی» شرکت، شما شعبه‌ای که در آن حساب افتتاح شده را از این لیست انتخاب می‌کنید.
* هنگام ثبت «چک دریافتی» از مشتری، شعبه صادرکننده چک را برای سهولت در فرآیند وصول (واگذاری به بانک) در این فرم ثبت می‌کنید.

# مفهوم و فرم: صندوق‌ها و تنخواه‌گردان‌ها (Petty Cash Funds)

---

## ۱. مفهوم

«صندوق» (Petty Cash) نماینده وجوه نقد فیزیکی (اسکناس) است که برای پوشش هزینه‌های جزئی و روزمره در اختیار یک فرد (تنخواه‌گردان) یا یک بخش قرار می‌گیرد.

* **هدف:** مدیریت نقدینگی فیزیکی، ردیابی هزینه‌های انجام شده از محل تنخواه و فرآیند شارژ مجدد (Replenishment) آن.
* **ارتباط با ساختار سازمانی:** همانطور که در مستندات تابان اشاره شد، صندوق‌ها برخلاف حساب‌های بانکی (که به بنگاه اقتصادی متصل‌اند)، معمولاً به یک **مکان عملیاتی** (مانند کارخانه، دفتر اداری) و یک **فرد مسئول (تنخواه‌گردان)** مرتبط می‌شوند.
* **جایگاه در حسابداری:** هر صندوق نیز مانند حساب بانکی، باید به یک سرفصل معین در **دفتر کل (GL)** (مثلاً: «صندوق دفتر مرکزی» یا «تنخواه آقای رضایی») متصل باشد.

---

## ۲. فرم: تعریف صندوق (Petty Cash Definition)

**مسیر:**
`خزانه‌داری / تعاریف پایه / صندوق‌ها و تنخواه`

### فیلدهای اطلاعاتی فرم

| نام فیلد                | نوع داده     | اجباری | توضیح                                          | مثال                       |
| :---------------------- | :----------- | :----- | :--------------------------------------------- | :------------------------- |
| **کد صندوق**            | متنی/عددی    | بله    | شناسه یکتای صندوق در سیستم.                    | `PC-10`                    |
| **نام صندوق**           | متنی         | بله    | نام توصیفی.                                    | `صندوق دفتر مرکزی اداری`   |
| **مکان عملیاتی**        | انتخابی (FK) | بله    | مکانی که این صندوق در آن قرار دارد.            | `1500 - دفتر مرکزی اداری`  |
| **مسئول (تنخواه‌گردان)** | انتخابی (FK) | بله    | کارمند یا شخصی که مسئول صندوق است.             | `علی احمدی`                |
| **بنگاه اقتصادی**       | انتخابی (FK) | بله    | بنگاه اقتصادی که مالک این نقدینگی است.         | `1000 - ایران خودرو مرکزی` |
| **ارز (Currency)**      | انتخابی (FK) | بله    | ارز پایه صندوق.                                | `IRR`                      |
| **حساب معین (GL)**      | انتخابی (FK) | بله    | **(بسیار مهم)** سرفصل حسابداری در دفتر کل.     | `11020101 - صندوق مرکزی`   |
| **سقف تنخواه**          | عددی         | خیر    | حداکثر مبلغی که این صندوق می‌تواند نگهداری کند. | `500,000,000`              |
| **وضعیت**               | انتخابی      | بله    | (فعال، غیرفعال).                               | `فعال`                     |
| **موجودی اولیه**        | عددی         | خیر    | (فقط در زمان استقرار) موجودی اولیه نقد.        | `10,000,000`               |

---

## ۳. کاربرد در سیستم

* این صندوق می‌تواند به عنوان مبدأ (در پرداخت‌های نقدی) یا مقصد (در دریافت‌های نقدی) در **سند دریافت و پرداخت** انتخاب شود.
* هنگامی که تنخواه‌گردان هزینه‌هایی را ثبت می‌کند (مثلاً خرید ملزومات اداری)، این هزینه‌ها از موجودی صندوق کسر می‌شوند.
* فرآیند «شارژ تنخواه» (Replenishment) معمولاً با یک سند پرداخت (مثلاً صدور چک در وجه تنخواه‌گردان یا انتقال از حساب بانکی به صندوق) انجام می‌شود که موجودی صندوق را افزایش می‌دهد.

# مفهوم و فرم: دسته چک‌ها (Checkbooks)

---

## ۱. مفهوم

در سیستم بانکی ایران، مدیریت دسته چک و شماره سریال برگه‌های چک اهمیت حیاتی دارد. موجودیت «دسته چک» در تابان، نماینده یک دسته چک فیزیکی است که توسط بانک به یکی از **حساب‌های بانکی** شرکت (که در فرم قبل تعریف شد) تخصیص یافته است.

* **هدف:** ردیابی وضعیت هر برگ چک (از زمان تخصیص تا صدور، پاس شدن، یا ابطال) و جلوگیری از صدور چک با شماره تکراری.
* **ارتباط:** هر دسته چک (Checkbook) الزاماً به یک «حساب بانکی» (Bank Account) از نوع جاری متصل است.

---

## ۲. فرم: تعریف دسته چک (Checkbook Definition)

**مسیر:**
`خزانه‌داری / تعاریف پایه / حساب‌های بانکی / دسته چک‌ها`
(این فرم معمولاً به صورت یک تب یا زیرمجموعه در فرم «حساب بانکی» قابل دسترسی است)

### فیلدهای اطلاعاتی فرم

| نام فیلد | نوع داده | اجباری | توضیح | مثال |
| :--- | :--- | :--- | :--- | :--- |
| **حساب بانکی** | انتخابی (FK) | بله | حسابی که این دسته چک به آن تعلق دارد. | `جاری - بانک ملت مرکزی` |
| **شناسه دسته چک** | متنی | بله | یک نام یا کد برای این دسته چک (مثلا کد صیادی). | `دسته چک صیادی 1403` |
| **سریال شروع** | عددی | بله | شماره سریال اولین برگ چک در این دسته. | `1001` |
| **سریال پایان** | عددی | بله | شماره سریال آخرین برگ چک در این دسته. | `1050` |
| **تعداد برگ** | عددی | خودکار | (سریال پایان - سریال شروع) + 1 | `50` |
| **پیشوند/پسوند سریال** | متنی | خیر | در صورتی که شماره سریال دارای بخش حرفی ثابت باشد. | `الف/` |
| **تاریخ دریافت** | تاریخ | بله | تاریخ تحویل دسته چک از بانک. | `1403/01/10` |
| **وضعیت دسته چک** | انتخابی | بله | (فعال، تمام شده، باطل شده). | `فعال` |

---

## ۳. فرآیند خودکار: ایجاد اسناد چک (Check Documents)

پس از ذخیره این فرم، سیستم باید به صورت خودکار، به تعداد برگ‌های چک (مثلاً ۵۰ برگ)، رکوردهایی را در جدول «اسناد چک» (Check Documents) با وضعیت اولیه **«خام» (Unused)** یا **«در دست»** ایجاد کند.

* رکورد ۱: حساب ملت، سریال ۱۰۰۱، وضعیت: خام
* رکورد ۲: حساب ملت، سریال ۱۰۰۲، وضعیت: خام
* ...
* رکورد ۵۰: حساب ملت، سریال ۱۰۵0، وضعیت: خام

این کار باعث می‌شود که در زمان صدور چک (در سند پرداخت)، کاربر فقط بتواند از سریال‌های «خام» موجود انتخاب کند و سیستم به طور خودکار وضعیت آن برگ چک را به «صادر شده» (Issued) تغییر دهد. (این فرآیند در فرم «مدیریت چک» توضیح داده می‌شود).

# روش‌های پرداخت/دریافت (Payment Methods)

-----

## ۱. مفهوم

این موجودیت، یک تعریف پایه‌ی «تنظیماتی» (Configuration) است که نحوه انجام تراکنش‌های مالی را در سیستم تعریف می‌کند. تمامی اسناد دریافت و پرداخت باید بر اساس یکی از این روش‌ها صادر شوند.

  * **هدف:** استانداردسازی فرآیندها، کنترل فیلدهای اجباری در فرم «سند دریافت و پرداخت»، و استفاده در «برنامه پرداخت خودکار».

-----

## ۲. فرم: تعریف روش‌های پرداخت/دریافت

**مسیر:**
`خزانه‌داری / تعاریف پایه / تنظیمات پرداخت / روش‌های پرداخت`

### فیلدهای اطلاعاتی فرم

| نام فیلد         | نوع داده  | اجباری | توضیح                                                                                                                                                                                         | مثال                                                                                                                    |
| :--------------- | :-------- | :----- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------- |
| **کد روش**       | متنی/عددی | بله    | شناسه یکتا (مثلاً `C`, `P`, `N`).                                                                                                                                                              | `P`                                                                                                                     |
| **نام**          | متنی      | بله    | *(اصلاحیه)* نام توصیفی روش.                                                                                                                                                                   | `انتقال پایا`                                                                                                           |
| **نوع تراکنش**   | انتخابی   | بله    | (پرداختنی، دریافتنی، هردو، انتقال داخلی).                                                                                                                                                     | `پرداختنی`                                                                                                              |
| **طبقه‌بندی**     | انتخابی   | بله    | (چک، حواله بانکی، نقد، ...).                                                                                                                                                                  | `حواله بانکی`                                                                                                           |
| **کنترل فیلدها** | تنظیمات   | بله    | *(توضیح کامل)* این یک تنظیم کلیدی است که رفتار فرم «سند پرداخت» را کنترل می‌کند. مشخص می‌کند که بر اساس این روش، کدام فیلدها باید اجباری (Required)، اختیاری (Optional) یا مخفی (Hidden) باشند. | مثال ۱: برای «پایا»، فیلد «شماره شبا» اجباری است. <br> مثال ۲: برای «چک»، بخش «اطلاعات دسته چک» باید فعال و اجباری شود. |


# ماژول خزانه‌داری (Treasury): اهداف، جایگاه و یکپارچگی

---

## ۱. هدف و تعریف ماژول خزانه‌داری

ماژول خزانه‌داری (Treasury) در ERP تابان، به عنوان **قلب مدیریت نقدینگی** سازمان عمل می‌کند. این ماژول مسئولیت مدیریت، ردیابی، و گزارش‌دهی تمامی وجوه نقد (شامل حساب‌های بانکی و صندوق‌ها) و اسناد بهادار (مانند چک‌های دریافتی و پرداختی) را بر عهده دارد.

هدف اصلی این ماژول، اطمینان از سلامت جریان نقدینگی، بهینه‌سازی منابع مالی و ارائه گزارش‌های دقیق برای تصمیم‌گیری‌های مالی است.

### اهداف کلیدی (Key Objectives)

* **مدیریت نقدینگی (Liquidity Management):** ردیابی دقیق و لحظه‌ای موجودی هر حساب بانکی، صندوق و تنخواه.
* **مدیریت اسناد بهادار (Document Management):** مدیریت کامل چرخه عمر (Lifecycle) چک‌های دریافتی (از دریافت تا واگذاری و وصول) و چک‌های پرداختی (از صدور تا پاس شدن).
* **تسویه حساب (Settlement):** اطمینان از تسویه دقیق فاکتورهای خرید (AP) و فروش (AR) با دریافت‌ها و پرداخت‌های مرتبط.
* **گزارش‌دهی و کنترل (Reporting & Control):** ارائه گزارش‌های حیاتی مانند مغایرت بانکی، جریان وجوه نقد، و وضعیت چک‌ها.

---

## ۲. جایگاه در ساختار سازمانی تابان (بنگاه و مکان)

ماژول خزانه‌داری به شدت به ساختار سازمانی تعریف شده در مستندات پایه تابان وابسته است:

### الف) بنگاه اقتصادی (Legal Entity) و خزانه‌داری

همانطور که در مستندات تابان ذکر شده، **بنگاه اقتصادی** یک موجودیت حقوقی مستقل با گزارش‌های مالی مستقل است.

> **قانون کلیدی خزانه‌داری:** **حساب‌های بانکی** (Bank Accounts) و **دسته چک‌ها** (Checkbooks) در سطح **بنگاه اقتصادی** تعریف و تملک می‌شوند.

* از آنجایی که ترازنامه و صورت‌های مالی در سطح بنگاه اقتصادی تهیه می‌شود، حساب بانکی که یکی از اقلام اصلی دارایی‌های جاری است، باید متعلق به یک بنگاه اقتصادی مشخص باشد.
* **مثال:** اگر «ایران خودرو مرکزی» (کد 1000) و «بخش فروش و بازاریابی» (کد 2000) دو بنگاه اقتصادی جداگانه باشند، هر کدام باید حساب‌های بانکی، دسته چک‌ها و اسناد مالی مجزای خود را در سیستم داشته باشند. نمی‌توان چکی را از حساب بنگاه 1000 برای پرداخت فاکتور بنگاه 2000 (مگر در فرآیندهای مالی بین شرکتی) استفاده کرد.

### ب) مکان عملیاتی (Operating Unit) و خزانه‌داری

**مکان عملیاتی** یک مکان فیزیکی (مانند کارخانه، انبار یا دفتر) است که در آن فرآیندهای لجستیکی و عملیاتی رخ می‌دهد.

> **قانون کلیدی خزانه‌داری:** **صندوق‌ها (Petty Cash)** و **تنخواه‌گردان‌ها** معمولاً در سطح **مکان عملیاتی** مدیریت می‌شوند.

* در حالی که حساب‌های بانکی ماهیت حقوقی دارند، صندوق‌ها ماهیت فیزیکی و مکانی دارند.
* **مثال:** برای پوشش هزینه‌های نقدی روزمره «کارخانه تهران» (مکان عملیاتی 1100) یا «دفتر مرکزی اداری» (مکان 1500)، یک «صندوق» یا «تنخواه» در سیستم تعریف می‌شود که به آن مکان عملیاتی و یک فرد مسئول (تنخواه‌گردان) مرتبط است.

---

## ۳. قانون طلایی: یکپارچگی با حسابداری مالی (FI)

ماژول خزانه‌داری نمی‌تواند و نباید بدون اتصال لحظه‌ای و خودکار به ماژول حسابداری مالی (FI) کار کند.

> **قانون طلایی یکپارچگی:** **هیچ تراکنشی در خزانه‌داری (تغییر موجودی بانک یا صندوق) نباید رخ دهد، مگر آنکه یک سند حسابداری (Journal Entry) معادل و خودکار در دفتر کل (GL) ثبت شود.**

این یکپارچگی از طریق **نگاشت حساب‌ها (Account Mapping)** در تعاریف پایه تضمین می‌شود:

1.  **حساب بانکی:** هر «حساب بانکی» در خزانه‌داری (مثلاً `MEL-100 - بانک ملت مرکزی`) به یک حساب معین در دفتر کل (مثلاً `11010101 - موجودی نقد - بانک ملت`) متصل است.
2.  **صندوق:** هر «صندوق» (مثلاً `PC-10 - صندوق دفتر مرکزی`) به یک حساب معین در دفتر کل (مثلاً `11020101 - صندوق مرکزی`) متصل است.
3.  **طرف حساب:** هر مشتری به حساب معین «حساب‌های دریافتنی» (AR) و هر تأمین‌کننده به «حساب‌های پرداختنی» (AP) متصل است.

---

## ۴. ارتباط جامع با سایر ماژول‌ها (جریان‌های فرآیندی)

ماژول خزانه‌داری، «مجری» نهایی فرآیندهای مالی است که در ماژول‌های دیگر آغاز می‌شوند.

### الف) یکپارچگی با فروش (Sales - SD)

فرآیند فروش (صدور فاکتور) نیاز به «دریافت» وجه را ایجاد می‌کند.

* **فرآیند:** ماژول فروش، «سفارش فروش» و سپس «فاکتور فروش» را صادر می‌کند. این فاکتور یک «آیتم باز» (Open Item) بدهکار در حساب مشتری در ماژول AR (حساب‌های دریافتنی) ایجاد می‌کند.
* **اتصال:** مشتری وجه فاکتور را پرداخت می‌کند (نقدی، چک، یا حواله).
* **عملیات خزانه‌داری:** کاربر یک **«سند دریافت» (Receipt Document)** در خزانه‌داری ثبت می‌کند.
* **مثال (دریافت نقدی بابت فاکتور):**
    * *عملیات:* دریافت 10,000,000 ریال وجه نقد از «مشتری الف» بابت فاکتور `F-901` و واریز به «صندوق مرکزی».
    * *تأثیر خزانه‌داری:* موجودی `صندوق مرکزی` 10,000,000 افزایش می‌یابد.
    * *تأثیر تسویه:* فاکتور `F-901` به وضعیت «تسویه شده» (Cleared) در می‌آید.
    * *سند حسابداری خودکار (FI):*
        * **بدهکار (Debit):** 10,000,000 - `11020101 - صندوق مرکزی` (دارایی (نقد) افزایش یافت)
        * **بستانکار (Credit):** 10,000,000 - `12010101 - حساب‌های دریافتنی - مشتری الف` (دارایی (طلب) کاهش یافت)

### ب) یکپارچگی با خرید و تدارکات (Purchasing - MM)

فرآیند خرید (دریافت فاکتور) نیاز به «پرداخت» وجه را ایجاد می‌کند.

* **فرآیند:** ماژول خرید، «سفارش خرید» (PO) و سپس «فاکتور خرید» (Purchase Invoice) را ثبت می‌کند. این فاکتور یک «آیتم باز» بستانکار در حساب تأمین‌کننده در ماژول AP (حساب‌های پرداختنی) ایجاد می‌کند.
* **اتصال:** شرکت می‌خواهد وجه فاکتور را پرداخت کند.
* **عملیات خزانه‌داری:** کاربر یک **«سند پرداخت» (Payment Document)** در خزانه‌داری ثبت می‌کند.
* **مثال (پرداخت با چک بابت فاکتور):**
    * *عملیات:* صدور چک به مبلغ 50,000,000 ریال از «بانک ملت» در وجه «تأمین‌کننده ب» بابت فاکتور `P-750`.
    * *تأثیر خزانه‌داری:* یک برگ چک از «دسته چک بانک ملت» (مثلاً سریال 1001) از وضعیت «خام» به «صادر شده» (Issued) تغییر می‌کند.
    * *تأثیر تسویه:* فاکتور `P-750` به وضعیت «تسویه شده» در می‌آید.
    * *سند حسابداری خودکار (FI) - در زمان صدور چک:*
        * **بدهکار (Debit):** 50,000,000 - `21010101 - حساب‌های پرداختنی - تأمین‌کننده ب` (بدهی ما تسویه شد)
        * **بستانکار (Credit):** 50,000,000 - `21030101 - اسناد پرداختنی` (یک بدهی جدید (چک) ایجاد شد)
    * *سند حسابداری خودکار (FI) - در زمان پاس شدن چک (از طریق مغایرت بانکی):*
        * **بدهکار (Debit):** 50,000,000 - `21030101 - اسناد پرداختنی` (بدهی چک بسته شد)
        * **بستانکار (Credit):** 50,000,000 - `11010101 - بانک ملت` (موجودی بانک (دارایی) کاهش یافت)

### ج) مدیریت چک و حسابداری (مثال‌های پیچیده)

عملیات داخلی خزانه‌داری نیز مستقیماً با حسابداری در ارتباط است:

* **مثال ۱: واگذاری چک دریافتی به بانک (جهت خواباندن به حساب)**
    * *عملیات:* چکی که قبلاً از مشتری دریافت شده و در «صندوق» (نزد صندوق) نگهداری می‌شد، به «بانک ملت» جهت وصول تحویل داده می‌شود.
    * *تأثیر خزانه‌داری:* وضعیت چک از «نزد صندوق» به «در جریان وصول» (In Collection) تغییر می‌کند.
    * *سند حسابداری خودکار (FI):* (این یک انتقال دارایی است)
        * **بدهکار (Debit):** `11030102 - اسناد در جریان وصول` (حساب واسط بانکی)
        * **بستانکار (Credit):** `11030101 - اسناد دریافتنی (نزد صندوق)`

* **مثال ۲: وصول (پاس شدن) همان چک**
    * *عملیات:* بانک اعلام می‌کند چک مشتری وصول و مبلغ به حساب واریز شد.
    * *تأثیر خزانه‌داری:* وضعیت چک «پاس شده» (Cleared) می‌شود. **موجودی واقعی بانک ملت افزایش می‌یابد.**
    * *سند حسابداری خودکار (FI):*
        * **بدهکار (Debit):** `11010101 - بانک ملت` (موجودی بانک (دارایی) افزایش یافت)
        * **بستانکار (Credit):** `11030102 - اسناد در جریان وصول` (حساب واسط بسته شد)

### د) یکپارچگی داخلی (شارژ تنخواه)

* **فرآیند:** انتقال وجه بین حساب‌های داخلی شرکت.
* **مثال (شارژ صندوق از بانک):**
    * *عملیات:* انتقال 5,000,000 ریال از «بانک ملت» به «صندوق مرکزی» جهت شارژ تنخواه.
    * *تأثیر خزانه‌داری:* موجودی «بانک ملت» 5,000,000 کاهش و موجودی «صندوق مرکزی» 5,000,000 افزایش می‌یابد.
    * *سند حسابداری خودکار (FI):* (این یک جابجایی دارایی است)
        * **بدهکار (Debit):** 5,000,000 - `11020101 - صندوق مرکزی` (دارایی صندوق افزایش یافت)
        * **بستانکار (Credit):** 5,000,000 - `11010101 - بانک ملت` (دارایی بانک کاهش یافت)

---

## ۵. خلاصه جریان اطلاعات (Data Flow Summary)

1.  **ماژول‌های عملیاتی (SD/MM):** فاکتورهای فروش و خرید، **نیاز** به دریافت یا پرداخت را ایجاد می‌کنند.
2.  **ماژول خزانه‌داری (Treasury):** **عملیات** دریافت و پرداخت را از طریق اسناد (نقد، چک، حواله) مدیریت و **اجرا** می‌کند.
3.  **ماژول حسابداری (FI):** **تأثیر مالی** این عملیات را به صورت خودکار در دفتر کل (GL) **ثبت** کرده و مبنای گزارش‌های مالی (ترازنامه، سود و زیان) را فراهم می‌کند.
4.  **ماژول داده‌های پایه (MDM):** اطمینان می‌دهد که این عملیات در چارچوب ساختار سازمانی صحیح (بنگاه اقتصادی و مکان عملیاتی) انجام می‌شود.

# مفهوم و فرم: مغایرت بانکی (Bank Reconciliation)

---

## ۱. مفهوم

مغایرت بانکی فرآیندی است که در پایان هر دوره مالی (معمولاً ماهانه) انجام می‌شود تا تراکنش‌های ثبت‌شده در ERP تابان (در سرفصل GL حساب بانکی) با صورتحساب ارائه‌شده توسط بانک تطبیق داده شود.

* **هدف:** شناسایی و رفع اختلافات بین سوابق شرکت و سوابق بانک.
* **دلایل اختلاف (مغایرت):**
    1.  **چک‌های معوق (Outstanding Checks):** چک‌های پرداختی که شرکت صادر کرده اما هنوز توسط تأمین‌کننده به بانک ارائه نشده‌اند (در ERP ثبت شده، در بانک نه).
    2.  **سپرده‌های در راه (Deposits in Transit):** وجوهی (مانند چک‌های مشتریان) که شرکت به بانک واگذار کرده اما هنوز توسط بانک وصول و به حساب اضافه نشده‌اند (در ERP ثبت شده، در بانک نه).
    3.  **کارمزدهای بانکی (Bank Fees):** هزینه‌هایی که بانک مستقیماً از حساب کسر کرده اما شرکت هنوز آن‌ها را ثبت نکرده (در بانک ثبت شده، در ERP نه).
    4.  **سود بانکی (Interest Earned):** مبالغی که بانک به حساب واریز کرده (در بانک ثبت شده، در ERP نه).
    5.  **اشتباهات (Errors):** اشتباهات ثبت در هر یک از طرفین.

---

## ۲. فرم: میزکار مغایرت بانکی (Bank Reconciliation Workbench)

**مسیر:**
`خزانه‌داری / عملیات دوره‌ای / مغایرت بانکی`

### رابط کاربری (UX)

1.  **انتخاب حساب:** کاربر «حساب بانکی» (مثلاً بانک ملت مرکزی) و «بازه زمانی» (مثلاً دی ماه 1403) را انتخاب می‌کند.
2.  **ورود اطلاعات بانک:**
    * **روش ۱ (دستی):** کاربر «موجودی نهایی» طبق صورتحساب بانک را دستی وارد می‌کند.
    * **روش ۲ (بارگذاری فایل):** کاربر فایل اکسل یا فایل استاندارد صورتحساب بانک (CSV/Excel) را در سیستم بارگذاری می‌کند.
3.  **نمایش تطبیقی (Reconciliation View):**
    * سیستم یک نمای دو ستونی یا سه ستونی ارائه می‌دهد:
        * **ستون ۱: تراکنش‌های ثبت شده در تابان (ERP)**
        * **ستون ۲: تراکنش‌های ثبت شده در صورتحساب بانک (Bank Statement)**
    * سیستم به صورت هوشمند (بر اساس تاریخ و مبلغ) سعی می‌کند تراکنش‌های مشابه را با هم «تطبیق» (Match) دهد.

4.  **فرآیند مغایرت‌گیری:**
    * **تراکنش‌های تطبیق‌یافته (Matched):** به صورت سبز رنگ نمایش داده می‌شوند و کاربر آن‌ها را تأیید می‌کند.
    * **تراکنش‌های مغایر (Unmatched):**
        * *موجود در ERP، ناموجود در بانک:* (مانند چک معوق). کاربر این موارد را به عنوان «مغایرت باز» علامت‌گذاری می‌کند تا به دوره بعد منتقل شوند.
        * *موجود در بانک، ناموجود در ERP:* (مانند کارمزد). کاربر باید مستقیماً از همین فرم، برای این موارد «سند حسابداری» یا «سند خزانه‌داری» (مثلاً سند پرداخت بابت کارمزد) صادر کند.

5.  **نتیجه نهایی:**
    * `موجودی ERP (دفتر کل)`
    * `+ موارد بستانکار ثبت نشده در ERP (مثل سود)`
    * `- موارد بدهکار ثبت نشده در ERP (مثل کارمزد)`
    * `= موجودی واقعی ERP (Adjusted Book Balance)`
    * ---
    * `موجودی صورتحساب بانک`
    * `+ سپرده‌های در راه`
    * `- چک‌های معوق`
    * `= موجودی واقعی بانک (Adjusted Bank Balance)`

    > **هدف نهایی: موجودی واقعی ERP = موجودی واقعی بانک**

6.  **بستن مغایرت:** پس از تراز شدن، کاربر دوره مغایرت را «نهایی» و «قفل» می‌کند.

# صورتحساب‌های بانکی (Bank Statements)
توضیح: موجودیت Header برای فایلی که از بانک دریافت می‌کنید (برای مغایرت‌گیری).

فیلدها:

Statement_ID (PK)

Bank_Account_ID (FK)

Statement_Date

Opening_Balance

Closing_Balance

ردیف صورتحساب بانکی (Bank Statement Line)

توضیح: ردیف‌های داخل فایل صورتحساب بانک.

فیلدها:

Statement_Line_ID (PK)

Statement_ID (FK)

Transaction_Date

Amount_Debit

Amount_Credit

Description (شرحی که بانک می‌زند)

Reconciled (Boolean - آیا این ردیف مغایرت‌گیری شده؟)

# اسناد چک (Check Documents)

توضیح: ردیابی وضعیت هر برگ چک به صورت مجزا.

فیلدها:

Check_ID (PK)

Checkbook_ID (FK - از کدام دسته چک)

Serial_Number (شماره سریال چک)

Payment_Doc_ID (FK - این چک برای کدام سند پرداخت صادر شد)

Due_Date (تاریخ سررسید چک)

Amount (مبلغ)

Payee_Name (نام گیرنده)

Status (وضعیت چک: صادرشده، درجریان‌وصول، پاس‌شده، برگشتی، باطل‌شده)


## ۱. مفهوم

رأس‌گیری (یا سررسید واقعی) یک ابزار مالی و محاسباتی است که عمدتاً در مذاکرات فروش اعتباری (مخصوصاً در ایران) استفاده می‌شود. هدف این ابزار، محاسبه یک **تاریخ سررسید واحد (تاریخ رأس)** برای مجموعه‌ای از پرداخت‌ها (چک‌ها) با مبالغ و تاریخ‌های سررسید متفاوت است.

* **هدف:**
    1.  **مذاکره فروش:** تیم فروش از این ابزار استفاده می‌کند تا بررسی کند آیا برنامه پرداخت پیشنهادی مشتری (مثلاً ۳ چک در ۳ تاریخ مختلف) معادل پیشنهاد فروش نقدی شرکت (با احتساب درصد بهره) هست یا خیر.
    2.  **محاسبه تاریخ واحد:** یافتن یک تاریخ که اگر کل مبلغ در آن تاریخ پرداخت می‌شد، ارزش مالی آن (با در نظر گرفتن نرخ بهره) برابر با ارزش فعلی چک‌های پراکنده بود.

---

## ۲. منطق محاسباتی (فرمول)

رأس‌گیری بر اساس مفهوم «ارزش پول در زمان» و میانگین وزنی محاسبه می‌شود.

1.  **تاریخ مبنا (Base Date):** اولین قدم، انتخاب یک تاریخ مبنا (معمولاً تاریخ فاکتور یا تاریخ روز) است.
2.  **محاسبه روزها (Days):** محاسبه تعداد روزهای فاصله هر چک از تاریخ مبنا.
3.  **محاسبه (مبلغ * روز):** حاصلضرب مبلغ هر چک در تعداد روزهای آن.
4.  **محاسبه مجموع:** جمع کل مبالغ ( $\sum M$ ) و جمع کل (مبلغ * روز) ( $\sum (M \times D)$ ).
5.  **محاسبه رأس (به روز):**
    $D_{avg} = \frac{\sum (M_i \times D_i)}{\sum M_i}$
    * $D_{avg}$: میانگین موزون روزها (رأس چک‌ها به روز)
    * $M_i$: مبلغ چک $i$
    * $D_i$: تعداد روزهای چک $i$ از تاریخ مبنا

6.  **محاسبه تاریخ رأس:**
    **تاریخ رأس = تاریخ مبنا + $D_{avg}$ (روز)**

---

## ۳. فرم: ابزار محاسبه‌گر رأس چک (Ras Giri Calculator)

این یک فرم عملیاتی نیست، بلکه یک «ابزار کمکی» (Utility) است که معمولاً در ماژول فروش یا خزانه‌داری در دسترس است.

**مسیر:**
`خزانه‌داری / ابزارها / محاسبه‌گر رأس چک`
یا
`فروش / عملیات / سفارش فروش (دکمه ابزار رأس‌گیری)`

### فیلدهای اطلاعاتی فرم

| نام فیلد                     | نوع داده | توضیح                                                    |
| :--------------------------- | :------- | :------------------------------------------------------- |
| **تاریخ مبنا (Base Date)**   | تاریخ    | (اجباری) تاریخی که محاسبات بر اساس آن انجام می‌شود.       |
| **نرخ بهره/تنزیل (سالیانه)** | درصدی    | (اختیاری) برای محاسبات ارزش فعلی یا مقایسه با فروش نقدی. |

### گرید (Grid) ورود چک‌ها

| ردیف                     | مبلغ چک (M)   | تاریخ سررسید | تعداد روز (D) (خودکار)   | مبلغ * روز (M\*D) (خودکار) |
| :----------------------- | :------------ | :----------- | :----------------------- | :------------------------- |
| ۱                        | `100,000,000` | `1403/11/01` | ۳۰ (فرض مبنا 1403/10/01) | 3,000,000,000              |
| ۲                        | `200,000,000` | `1403/12/01` | ۶۰                       | 12,000,000,000             |
| *... (افزودن ردیف جدید)* |               |              |                          |                            |

### بخش نتایج (Results)

| نام فیلد                       | نوع داده | توضیح                                     |
| :----------------------------- | :------- | :---------------------------------------- |
| **مجموع مبالغ ( $\sum M$ )**   | عددی     | `300,000,000`                             |
| **مجموع (مبلغ * روز)**         | عددی     | `15,000,000,000`                          |
| **رأس (به روز) ( $D_{avg}$ )** | عددی     | $15,000,000,000 / 300,000,000 = 50$ (روز) |
| **تاریخ رأس چک‌ها**             | تاریخ    | `1403/10/01 + 50 روز = 1403/11/20`        |

---

## ۴. کاربرد

تیم فروش با دیدن «تاریخ رأس» (در مثال ما: 1403/11/20) متوجه می‌شود که دریافت این دو چک، معادل دریافت یک چک ۳۰۰ میلیونی در تاریخ ۲۰ بهمن است. حال می‌تواند این تاریخ را با سیاست‌های فروش اعتباری شرکت مقایسه کند.

# مفهوم و فرم: مدیریت چک (Check Management)

---

## ۱. مفهوم

با توجه به اهمیت بالای چک در سیستم مالی ایران، تابان نیازمند یک مرکز فرماندهی (داشبورد) برای ردیابی **چرخه عمر (Lifecycle)** تمامی چک‌های دریافتی و پرداختی است.

* **هدف:** مدیریت عملیات مرتبط با چک (واگذاری، وصول، برگشت) و به‌روزرسانی خودکار وضعیت چک و اسناد حسابداری مرتبط.

این ماژول باید دو بخش مجزا داشته باشد:

1.  **مدیریت چک‌های دریافتی (از مشتریان)**
2.  **مدیریت چک‌های پرداختی (به تأمین‌کنندگان)**

---

## ۲. فرم: داشبورد مدیریت چک‌های دریافتی (Received Checks)

این فرم لیستی از تمام چک‌های دریافتی را نشان می‌دهد که وضعیت آن‌ها «نهایی» نشده است (یعنی پاس نشده یا برگشت نخورده است).

**مسیر:**
`خزانه‌داری / عملیات / مدیریت چک‌های دریافتی`

### رابط کاربری (UX) و فیلترها

* **فیلترها:** بر اساس وضعیت چک (نزد صندوق، در جریان وصول)، تاریخ سررسید (از... تا...)، مشتری، بنگاه اقتصادی.
* **نمایش جدولی:**

| انتخاب | شماره چک | سررسید       | مبلغ    | بانک  | مشتری    | وضعیت فعلی        |
| :----- | :------- | :----------- | :------ | :---- | :------- | :---------------- |
| []     | `12345`  | `1403/10/20` | 100,000 | ملت   | شرکت الف | **نزد صندوق**     |
| []     | `67890`  | `1403/10/22` | 250,000 | سامان | شرکت ب   | **در جریان وصول** |

### عملیات قابل انجام (Actions)

کاربر یک یا چند چک را از لیست انتخاب کرده و یکی از عملیات زیر را اجرا می‌کند:

1.  **واگذاری به بانک (Deposit):**
    * *عملیات:* کاربر چک‌هایی که «نزد صندوق» هستند را انتخاب می‌کند.
    * *فرم بازشو:* «تاریخ واگذاری» و «حساب بانکی مقصد» (کدام حساب شرکت) را انتخاب می‌کند.
    * *نتیجه:* وضعیت چک به «در جریان وصول» (In Collection) تغییر می‌یابد و سند حسابداری (موقت) ثبت می‌شود.

2.  **اعلام وصول (Clear):**
    * *عملیات:* کاربر چک‌هایی که «در جریان وصول» هستند را انتخاب می‌کند.
    * *فرم بازشو:* «تاریخ وصول» را وارد می‌کند.
    * *نتیجه:* وضعیت چک به «پاس شده» (Cleared) تغییر می‌یابد. موجودی حساب بانکی شرکت *واقعاً* افزایش می‌یابد و سند حسابداری نهایی ثبت می‌شود.

3.  **اعلام برگشت (Bounce):**
    * *عملیات:* کاربر چک‌هایی که «در جریان وصول» هستند را انتخاب می‌کند.
    * *فرم بازشو:* «تاریخ برگشت» و «دلیل برگشت» را وارد می‌کند.
    * *نتیجه:* وضعیت چک به «برگشتی» (Bounced) تغییر می‌یابد. چک از حساب بانکی خارج و به حساب «اسناد دریافتنی برگشتی» (در GL) و حساب مشتری منتقل می‌شود.

4.  **عودت چک (Return to Customer):**
    * *عملیات:* (معمولاً برای چک‌های برگشتی یا قبل از واگذاری)
    * *نتیجه:* چک از سیستم خارج و حساب مشتری مجدداً بدهکار می‌شود.

---

## ۳. فرم: داشبورد مدیریت چک‌های پرداختی (Issued Checks)

این فرم مشابه بخش قبلی است اما برای چک‌هایی که شرکت صادر کرده است.

**مسیر:**
`خزانه‌داری / عملیات / مدیریت چک‌های پرداختی`

### رابط کاربری (UX) و عملیات

* **نمایش جدولی:** لیستی از چک‌های «صادر شده» که هنوز «پاس نشده‌اند».

| شماره سریال | سررسید       | مبلغ    | حساب بانکی (مبدأ) | در وجه (تأمین‌کننده) | وضعیت فعلی   |
| :---------- | :----------- | :------ | :---------------- | :------------------ | :----------- |
| `1001`      | `1403/10/25` | 500,000 | بانک ملت          | شرکت ج              | **صادر شده** |

### عملیات قابل انجام (Actions)

1.  **اعلام پاس شدن (Clear):**
    * *عملیات:* این معمولاً از طریق «مغایرت بانکی» یا ثبت دستی انجام می‌شود.
    * *فرم بازشو:* «تاریخ پاس شدن» را وارد می‌کند.
    * *نتیجه:* وضعیت چک به «پاس شده» (Cleared) تغییر می‌یابد. موجودی حساب بانکی شرکت *واقعاً* کاهش می‌یابد و سند حسابداری نهایی ثبت می‌شود.

2.  **ابطال چک (Void):**
    * *عملیات:* اگر چک قبل از تحویل به تأمین‌کننده یا به هر دلیلی باطل شود.
    * *نتیجه:* وضعیت چک به «باطل شده» (Voided) تغییر می‌یابد. سریال چک (اگر امکان‌پذیر باشد) می‌تواند مجدداً «خام» شود یا برای همیشه باطل بماند.

# مفهوم و فرم: سند دریافت و پرداخت (Payment/Receipt Document)

---

## ۱. مفهوم

این فرم، **اصلی‌ترین فرم عملیاتی** در ماژول خزانه‌داری است. هرگونه جابجایی وجه (ورود، خروج یا انتقال داخلی) *باید* از طریق این سند ثبت شود. این سند به تنهایی موجودی بانک/صندوق را تغییر می‌دهد و مبنای صدور سند حسابداری است.

* **هدف:** ثبت یکپارچه تمامی دریافت‌ها، پرداخت‌ها و انتقالات.
* **انواع تراکنش:**
    1.  **دریافت (Receipt):** دریافت وجه از مشتریان (بابت فاکتور فروش) یا سایر درآمدها.
    2.  **پرداخت (Payment):** پرداخت وجه به تأمین‌کنندگان (بابت فاکتور خرید)، پرداخت هزینه‌ها، یا پرداخت حقوق.
    3.  **انتقال (Transfer):** جابجایی وجه بین دو حساب بانکی داخلی یا بین حساب بانکی و صندوق (مثلاً شارژ تنخواه).

---

## ۲. ملاحظات خاص: پیش‌پرداخت و علی‌الحساب

این سند باید بتواند مفاهیم «پیش‌پرداخت» و «علی‌الحساب» را مدیریت کند:

### پیش‌پرداخت (Prepayment)
* **مفهوم:** پرداختی که *قبل* از دریافت کالا/خدمات و صدور فاکتور انجام می‌شود و مستقیماً به یک **سفارش (PO/SO)** مرتبط است.
* **نحوه اجرا:** در سند پرداخت/دریافت، کاربر باید بتواند شماره «سفارش خرید» یا «سفارش فروش» را انتخاب کند. این پرداخت به عنوان یک «آیتم باز» (Open Item) روی آن سفارش می‌نشیند و در زمان صدور فاکتور نهایی، به صورت خودکار از مبلغ قابل پرداخت کسر می‌گردد.
* **مثال پرداخت:** پرداخت 30% مبلغ به تأمین‌کننده در زمان ثبت سفارش خرید (PO).
* **مثال دریافت:** دریافت 50% مبلغ از مشتری در زمان ثبت سفارش فروش (SO).

### علی‌الحساب (On-Account)
* **مفهوم:** پرداختی که به هیچ فاکتور یا سفارش *مشخصی* در لحظه ثبت، مرتبط نیست. صرفاً مبلغی است که به حساب مشتری/تأمین‌کننده واریز یا از آن دریافت می‌شود.
* **نحوه اجرا:** در سند پرداخت/دریافت، کاربر فقط «طرف حساب» (مشتری/تأمین‌کننده) را انتخاب می‌کند، اما هیچ فاکتور یا سفارشی را به آن لینک نمی‌کند.
* **نتیجه:** این مبلغ به عنوان «بستانکاری» (در پرداخت) یا «بدهکاری» (در دریافت) در حساب آن شخص باقی می‌ماند تا بعداً در فرم «تسویه» (Settlement) با فاکتورهای آینده تسویه شود.

---

## ۳. فرم: سند دریافت و پرداخت (Payment/Receipt Document)

این فرم معمولاً دارای یک «سربرگ» (Header) برای اطلاعات مشترک و یک بخش «ردیف‌ها» (Lines) برای جزئیات روش پرداخت است.

**مسیر:**
`خزانه‌داری / عملیات / سند دریافت و پرداخت جدید`

### بخش سربرگ (Header)

| نام فیلد                            | نوع داده     | اجباری                    | توضیح                                                 |
| :---------------------------------- | :----------- | :------------------------ | :---------------------------------------------------- |
| **بنگاه اقتصادی**                   | انتخابی (FK) | بله                       | بنگاهی که تراکنش را انجام می‌دهد.                      |
| **نوع سند**                         | انتخابی      | بله                       | `دریافت` / `پرداخت` / `انتقال`                        |
| **تاریخ سند**                       | تاریخ        | بله                       | تاریخ واقعی تراکنش.                                   |
| **تاریخ ثبت**                       | تاریخ        | بله                       | تاریخ ورود داده در سیستم (معمولاً خودکار).             |
| **طرف حساب (Partner)**              | انتخابی (FK) | (بله، برای دریافت/پرداخت) | مشتری، تأمین‌کننده، کارمند، یا حساب GL (برای هزینه‌ها). |
| **مبلغ کل**                         | عددی         | بله                       | مبلغ کل سند (باید برابر با مجموع ردیف‌ها باشد).        |
| **شرح سند**                         | متنی         | بله                       | توضیح کلی در مورد تراکنش.                             |
| **ارجاع به سفارش (برای پیش‌پرداخت)** | انتخابی (FK) | خیر                       | شماره سفارش فروش یا سفارش خرید (در صورت پیش‌پرداخت).   |

---

### بخش ردیف‌ها (Lines) - (جزئیات روش پرداخت)

کاربر می‌تواند برای یک سند، چندین ردیف (مثلاً پرداخت بخشی نقد، بخشی چک) اضافه کند.

| نام فیلد            | نوع داده     | اجباری                    | توضیح                                         |
| :------------------ | :----------- | :------------------------ | :-------------------------------------------- |
| **روش پرداخت**      | انتخابی      | بله                       | `نقد` / `چک` / `حواله (انتقال بانکی)`         |
| **مبلغ**            | عددی         | بله                       | مبلغ مربوط به این ردیف.                       |
| **حساب/صندوق مبدأ** | انتخابی (FK) | (بله، برای پرداخت/انتقال) | حساب بانکی یا صندوقی که پول از آن خارج می‌شود. |
| **حساب/صندوق مقصد** | انتخابی (FK) | (بله، برای دریافت/انتقال) | حساب بانکی یا صندوقی که پول به آن وارد می‌شود. |
| **شرح ردیف**        | متنی         | خیر                       | توضیحات جزئی.                                 |

---

### فیلدهای اختصاصی بر اساس روش پرداخت (در ردیف)

**اگر روش = `چک` (پرداختی):**

* **شماره سریال چک:** انتخابی (از لیست سریال‌های «خام» دسته چک).
* **تاریخ سررسید:** تاریخ.
* **در وجه:** متنی (معمولاً نام طرف حساب).

**اگر روش = `چک` (دریافتی):**

* **شماره سریال چک:** متنی (کاربر وارد می‌کند).
* **بانک چک:** انتخابی (FK - از فرم بانک‌ها).
* **شعبه و کد:** متنی.
* **تاریخ سررسید:** تاریخ.
* **صاحب حساب:** متنی.

**اگر روش = `حواله (انتقال بانکی)`:**

* **شماره پیگیری:** متنی (کد رهگیری انتقال).

---

## ۴. فرآیند پس از ثبت

1.  **ثبت نهایی (Post):** پس از تأیید، سند «ثبت نهایی» می‌شود.
2.  **تأثیر موجودی:** موجودی حساب بانکی/صندوق بلافاصله (برای نقد و حواله) یا در سررسید (برای چک) به‌روز می‌شود.
3.  **ایجاد سند حسابداری:** یک سند حسابداری خودکار در GL صادر می‌شود (جزئیات در `Treasury_Integration_Accounting.md`).
4.  **ایجاد آیتم باز:** اگر سند «علی‌الحساب» باشد یا فاکتوری انتخاب نشده باشد، یک آیتم باز در حساب طرف حساب ایجاد می‌کند.

# مفهوم و فرم: تسویه حساب (Settlement / Clearing)

---

## ۱. مفهوم

تسویه حساب، فرآیند حیاتی «اتصال» آیتم‌های بستانکار (مانند پرداخت‌ها، پیش‌پرداخت‌ها، اعتبارات) به آیتم‌های بدهکار (مانند فاکتورها) در حساب یک طرف حساب (مشتری یا تأمین‌کننده) است.

* **هدف:** صفر کردن مانده حساب آیتم‌های باز و تعیین وضعیت «تسویه شده» برای فاکتورها و پرداخت‌ها.
* **نیاز به تسویه (M:N):** این فرآیند ضروری است زیرا ارتباط بین فاکتور و پرداخت همیشه یک به یک (1:1) نیست:
    * **چند به یک (N:1):** یک مشتری ممکن است ۳ فاکتور باز را با ۱ چک پرداخت کند.
    * **یک به چند (1:N):** یک مشتری ممکن است ۱ فاکتور را در ۳ قسط پرداخت کند.
    * **چند به چند (M:N):** یک مشتری ممکن است ۲ فاکتور و بخشی از فاکتور سوم را با ۱ چک و ۱ واریز نقدی (که قبلاً علی‌الحساب پرداخت کرده) تسویه کند.

---

## ۲. فرم: میزکار تسویه حساب (Settlement Workbench)

این فرم یک ابزار تعاملی است که به کاربر (حسابدار) اجازه می‌دهد آیتم‌های باز یک طرف حساب را مشاهده و با هم تسویه کند.

**مسیر:**
`خزانه‌داری / عملیات / تسویه حساب مشتریان`
`خزانه‌داری / عملیات / تسویه حساب تأمین‌کنندگان`

### رابط کاربری (UX)

این فرم معمولاً به صورت زیر طراحی می‌شود:

1.  **انتخاب طرف حساب:** کاربر ابتدا مشتری یا تأمین‌کننده مورد نظر را انتخاب می‌کند.
2.  **نمایش دو ستونی:** سیستم تمامی آیتم‌های باز (Open Items) آن شخص را در دو ستون نمایش می‌دهد:

    * **ستون ۱: بدهی‌ها (Invoices / Debits):**
        * لیست تمام فاکتورهای فروش (برای مشتری) یا فاکتورهای خرید (برای تأمین‌کننده) که هنوز تسویه نشده‌اند.
        * شامل: شماره فاکتور، تاریخ، مبلغ کل، مبلغ باقیمانده.

    * **ستون ۲: بستانکاری‌ها (Payments / Credits):**
        * لیست تمام پرداخت‌های «علی‌الحساب».
        * پیش‌پرداخت‌های مرتبط.
        * برگشت از فروش‌ها (Credit Memos).
        * شامل: شماره سند پرداخت، تاریخ، مبلغ کل، مبلغ باقیمانده قابل تخصیص.

3.  **فرآیند تسویه (Matching):**
    * کاربر آیتم‌های مورد نظر از هر دو ستون را انتخاب (تیک) می‌کند.
    * *مثال:* انتخاب فاکتور ۱ (مبلغ ۱۰۰) و فاکتور ۲ (مبلغ ۵۰) از ستون ۱؛ و انتخاب پرداخت علی‌الحساب (مبلغ ۱۲۰) و پرداخت جدید (مبلغ ۳۰) از ستون ۲.
    * مجموع بدهی انتخاب شده = ۱۵۰
    * مجموع بستانکاری انتخاب شده = ۱۵۰

4.  **دکمه «تسویه» (Settle):**
    * کاربر دکمه تسویه را می‌زند.
    * سیستم بررسی می‌کند که مجموع دو طرف برابر باشد (یا در صورت تسویه جزئی، منطق آن رعایت شود).
    * سیستم وضعیت فاکتورها و پرداخت‌های انتخاب شده را به «تسویه شده» (Cleared) تغییر می‌دهد و رکوردهای ارتباطی (Settlement Line) را ایجاد می‌کند.

---

## ۳. تسویه خودکار (Automatic Settlement)

برای سادگی، سیستم می‌تواند یک دکمه «تسویه خودکار» نیز داشته باشد که بر اساس منطق FIFO (اولین فاکتور با اولین پرداخت) یا بر اساس شماره ارجاع یکسان، آیتم‌ها را به صورت خودکار تسویه کند.
