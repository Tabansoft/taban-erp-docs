
<!doctype html>
<html lang="fa" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="توضیحات پروژه شما اینجا قرار می‌گیرد.">
      
      
        <meta name="author" content="تابان‌سافت">
      
      
        <link rel="canonical" href="https://docs.tabansoft.ir/financial/treasury/operations/receipt-voucher/">
      
      
        <link rel="prev" href="../payment-voucher/">
      
      
        <link rel="next" href="../transfer-voucher/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>دریافت‌ها - مستندات ERP تابان</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Vazirmatn:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Vazirmatn";--md-code-font:"Fira Code"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="rtl">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#receipt-vouchers" class="md-skip">
          پرش به محتویات
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="سرتیتر">
    <a href="../../../.." title="مستندات ERP تابان" class="md-header__button md-logo" aria-label="مستندات ERP تابان" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            مستندات ERP تابان
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              دریافت‌ها
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="جستجو" placeholder="جستجو" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="جستجو">
        
        <button type="reset" class="md-search__icon md-icon" title="بازنشانی" aria-label="بازنشانی" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            راه‌اندازی جستجو
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/tabansoft/taban-erp-docs/" title="رفتن به مخزن" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="هدایت" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="مستندات ERP تابان" class="md-nav__button md-logo" aria-label="مستندات ERP تابان" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    مستندات ERP تابان
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tabansoft/taban-erp-docs/" title="رفتن به مخزن" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    معرفی
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ساختار سازمان
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            ساختار سازمان
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ساختار مالی
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            ساختار مالی
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../enterprise-structure/financial/legal-entity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    بنگاه‌های اقتصادی
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ساختار عملیاتی
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            ساختار عملیاتی
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../enterprise-structure/operational/operating-unit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    مکان‌های عملیاتی
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    مالی
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            مالی
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    خزانه‌داری
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            خزانه‌داری
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    معرفی ماژول خزانه‌داری
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2" >
        
          
          <label class="md-nav__link" for="__nav_3_1_2" id="__nav_3_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    تعاریف پایه
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2">
            <span class="md-nav__icon md-icon"></span>
            تعاریف پایه
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../master-data/cash-box/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    صندوق‌های نقدی
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../master-data/document-box/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    صندوق‌های اسناد
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../master-data/bank/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    بانک‌ها
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../master-data/bank-branch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ‌شعب بانک‌ها
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../master-data/bank-account/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    حساب‌های بانکی
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../master-data/checkbook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    دسته‌چک‌ها
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../master-data/payment-method/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    روش‌های پرداخت
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3" >
        
          
          <label class="md-nav__link" for="__nav_3_1_3" id="__nav_3_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    مدیریت چک‌های دریافتی
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3">
            <span class="md-nav__icon md-icon"></span>
            مدیریت چک‌های دریافتی
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../received-check-management/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    مقدمه
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../received-check-management/receipt-check/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    دریافت چک جدید
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../received-check-management/deposite-check/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    واگذاری چک به بانک
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../received-check-management/clearance-check/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    اعلام وصول/برگشت چک
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../received-check-management/endorsement-check/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    خرج کردن چک
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../received-check-management/return-check/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    استرداد چک
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1_4" id="__nav_3_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    عملیات
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1_4">
            <span class="md-nav__icon md-icon"></span>
            عملیات
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../payment-voucher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    پرداخت‌ها
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    دریافت‌ها
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    دریافت‌ها
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="فهرست موضوعات">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      فهرست موضوعات
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      مقدمه
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      چه زمانی به سراغ این سند می‌آییم؟
    </span>
  </a>
  
    <nav class="md-nav" aria-label="چه زمانی به سراغ این سند می‌آییم؟">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-settlement" class="md-nav__link">
    <span class="md-ellipsis">
      الف) سناریوی اول: تسویه بدهی‌های گذشته (The Settlement)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-advance-payment" class="md-nav__link">
    <span class="md-ellipsis">
      ب) سناریوی دوم: پیش‌دریافت و رزرو (The Advance Payment)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-miscellaneous" class="md-nav__link">
    <span class="md-ellipsis">
      ج) سناریوی سوم: درآمدهای غیرتجاری (The Miscellaneous)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      ضرورت و کارکردها
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ضرورت و کارکردها">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clearing-ar" class="md-nav__link">
    <span class="md-ellipsis">
      ۱. شفاف‌سازی حساب مشتری (Clearing AR)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-deductions" class="md-nav__link">
    <span class="md-ellipsis">
      ۲. مدیریت هوشمند کسورات (Handling Deductions)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#realization" class="md-nav__link">
    <span class="md-ellipsis">
      ۳. تبدیل تعهد به دارایی (Realization)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instrument-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      ۴. رهگیری چرخه حیات چک (Instrument Tracking)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      کالبدشکافی معماری: جریان ۴ لایه‌ای داده‌ها (Data Flow)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="کالبدشکافی معماری: جریان ۴ لایه‌ای داده‌ها (Data Flow)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#context-identification" class="md-nav__link">
    <span class="md-ellipsis">
      لایه ۱: شناسایی و بستر (Context &amp; Identification)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allocation-logic" class="md-nav__link">
    <span class="md-ellipsis">
      لایه ۲: منطق تخصیص (Allocation Logic)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discrepancy-deductions" class="md-nav__link">
    <span class="md-ellipsis">
      لایه ۳: مدیریت مغایرت‌ها (Discrepancy &amp; Deductions)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#settlement-instrument" class="md-nav__link">
    <span class="md-ellipsis">
      لایه ۴: ابزار تسویه (Settlement Instrument)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      ۵. خروجی نهایی سیستم
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#document-lifecycle-state-machine" class="md-nav__link">
    <span class="md-ellipsis">
      ۲. چرخه حیات سند و ماشین وضعیت (Document Lifecycle &amp; State Machine)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="۲. چرخه حیات سند و ماشین وضعیت (Document Lifecycle &amp; State Machine)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      فلسفه چرخه حیات
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-flow" class="md-nav__link">
    <span class="md-ellipsis">
      دیاگرام جریان وضعیت (State Flow)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detailed-states" class="md-nav__link">
    <span class="md-ellipsis">
      تشریح دقیق وضعیت‌ها (Detailed States)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="تشریح دقیق وضعیت‌ها (Detailed States)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#draft" class="md-nav__link">
    <span class="md-ellipsis">
      ۱. پیش‌نویس (Draft)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submitted-pending-approval" class="md-nav__link">
    <span class="md-ellipsis">
      ۲. آماده بررسی / در انتظار تایید (Submitted / Pending Approval)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#posted-finalized" class="md-nav__link">
    <span class="md-ellipsis">
      ۳. قطعی / نهایی شده (Posted / Finalized)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#void-cancelled" class="md-nav__link">
    <span class="md-ellipsis">
      ۴. ابطال شده (Void / Cancelled)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transition-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      جدول ماتریس گذار (Transition Matrix)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-notes" class="md-nav__link">
    <span class="md-ellipsis">
      نکات فنی برای پیاده‌سازی (Developer Notes)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#receipt-types" class="md-nav__link">
    <span class="md-ellipsis">
      ۳. انواع دریافت (Receipt Types)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-standard-customer-receipt" class="md-nav__link">
    <span class="md-ellipsis">
      ۳-۱. دریافت استاندارد از مشتری (Standard Customer Receipt)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="۳-۱. دریافت استاندارد از مشتری (Standard Customer Receipt)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      تعریف و کاربرد
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      رفتار سیستم (System Behavior)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gl-impact" class="md-nav__link">
    <span class="md-ellipsis">
      اثر حسابداری (GL Impact)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      مثال واقعی
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-sales-advance-down-payment" class="md-nav__link">
    <span class="md-ellipsis">
      ۳-۲. پیش‌دریافت فروش (Sales Advance / Down Payment)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="۳-۲. پیش‌دریافت فروش (Sales Advance / Down Payment)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      تعریف و کاربرد
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-behavior_1" class="md-nav__link">
    <span class="md-ellipsis">
      رفتار سیستم (System Behavior)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gl-impact_1" class="md-nav__link">
    <span class="md-ellipsis">
      اثر حسابداری (GL Impact)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      مثال واقعی
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      راهکار: استفاده از "دسته‌بندی درآمد" به جای "کد حساب"
    </span>
  </a>
  
    <nav class="md-nav" aria-label="راهکار: استفاده از &#34;دسته‌بندی درآمد&#34; به جای &#34;کد حساب&#34;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      ۱. تنظیمات پشت صحنه (توسط مدیر مالی)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ui" class="md-nav__link">
    <span class="md-ellipsis">
      ۲. آنچه کاربر نهایی می‌بیند (UI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend" class="md-nav__link">
    <span class="md-ellipsis">
      ۳. آنچه سیستم انجام می‌دهد (Backend)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suspense-account" class="md-nav__link">
    <span class="md-ellipsis">
      ۴. پیشنهاد ویژه: گزینه "واریزی نامشخص" (Suspense Account)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    <span class="md-ellipsis">
      خلاصه تغییرات در مستندات (برای اصلاح بخش ۳-۳)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-miscellaneous-direct-receipt" class="md-nav__link">
    <span class="md-ellipsis">
      ۳-۳. درآمد متفرقه / دریافت مستقیم (Miscellaneous / Direct Receipt)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="۳-۳. درآمد متفرقه / دریافت مستقیم (Miscellaneous / Direct Receipt)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      تعریف و کاربرد
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-behavior_2" class="md-nav__link">
    <span class="md-ellipsis">
      رفتار سیستم (System Behavior)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gl-impact_2" class="md-nav__link">
    <span class="md-ellipsis">
      اثر حسابداری (GL Impact)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      مثال واقعی
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-_1" class="md-nav__link">
    <span class="md-ellipsis">
      ۳-۴. جدول مقایسه‌ای (برای تحلیل‌گر و برنامه‌نویس)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="۳-۴. جدول مقایسه‌ای (برای تحلیل‌گر و برنامه‌نویس)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-knock-off" class="md-nav__link">
    <span class="md-ellipsis">
      ۳-۵. سوال کلیدی: اگر پیش‌دریافت بعداً تبدیل به فاکتور شود چه؟ (فرآیند Knock-off)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#receipt-document" class="md-nav__link">
    <span class="md-ellipsis">
      ۴. جزئیات فرم عملیاتی (Receipt Document)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transfer-voucher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    انتقال‌ها
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settlement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    تسویه حساب
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_5" >
        
          
          <label class="md-nav__link" for="__nav_3_1_5" id="__nav_3_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    عملیات دوره‌ای
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_5">
            <span class="md-nav__icon md-icon"></span>
            عملیات دوره‌ای
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../periodic-operations/bank-reconciliation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    مغایرت بانکی
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    حسابداری
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            حسابداری
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../accounting/overview.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    معرفی ماژول حسابداری
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    مدیریت موجودی
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            مدیریت موجودی
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    تعاریف پایه
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            تعاریف پایه
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../inventory-management/master-data/package-type/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    انواع بسته‌بندی کالا
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    مدیریت انبار
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            مدیریت انبار
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    تعاریف پایه
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            تعاریف پایه
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../inventory-management/master-data/package-type/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    انواع بسته‌بندی کالا
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    برنامه‌ریزی و کنترل تولید
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            برنامه‌ریزی و کنترل تولید
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    تعاریف پایه
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            تعاریف پایه
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../manufacturing/master-data/capability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    قابلیت‌ها
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../manufacturing/master-data/resource-type/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    انواع منبع
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../manufacturing/master-data/resource/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    منابع
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../manufacturing/master-data/work-center/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    مراکز کار
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../manufacturing/master-data/dispatching-rule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    قواعد تخصیص
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../manufacturing/master-data/sheduler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    موتور زمان‌بندی
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    مهندسی تولید
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            مهندسی تولید
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../manufacturing/production-engineering/bom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    فرمول‌های تولید
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../manufacturing/production-engineering/routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    فرآیند‌های تولید
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    برنامه‌ریزی
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            برنامه‌ریزی
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../manufacturing/planning/master-production-schedules.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    برنامه‌های تولید اصلی
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    اجرای تولید
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            اجرای تولید
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../manufacturing/planning/resources.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    دستور‌های تولید
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    مدیریت حمل‌ونقل
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            مدیریت حمل‌ونقل
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    تعاریف پایه
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            تعاریف پایه
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transportation-management/master-data/vehicle-type/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    انواع وسیله نقلیه
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="فهرست موضوعات">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      فهرست موضوعات
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      مقدمه
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      چه زمانی به سراغ این سند می‌آییم؟
    </span>
  </a>
  
    <nav class="md-nav" aria-label="چه زمانی به سراغ این سند می‌آییم؟">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-settlement" class="md-nav__link">
    <span class="md-ellipsis">
      الف) سناریوی اول: تسویه بدهی‌های گذشته (The Settlement)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-advance-payment" class="md-nav__link">
    <span class="md-ellipsis">
      ب) سناریوی دوم: پیش‌دریافت و رزرو (The Advance Payment)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-miscellaneous" class="md-nav__link">
    <span class="md-ellipsis">
      ج) سناریوی سوم: درآمدهای غیرتجاری (The Miscellaneous)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      ضرورت و کارکردها
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ضرورت و کارکردها">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clearing-ar" class="md-nav__link">
    <span class="md-ellipsis">
      ۱. شفاف‌سازی حساب مشتری (Clearing AR)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-deductions" class="md-nav__link">
    <span class="md-ellipsis">
      ۲. مدیریت هوشمند کسورات (Handling Deductions)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#realization" class="md-nav__link">
    <span class="md-ellipsis">
      ۳. تبدیل تعهد به دارایی (Realization)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instrument-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      ۴. رهگیری چرخه حیات چک (Instrument Tracking)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      کالبدشکافی معماری: جریان ۴ لایه‌ای داده‌ها (Data Flow)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="کالبدشکافی معماری: جریان ۴ لایه‌ای داده‌ها (Data Flow)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#context-identification" class="md-nav__link">
    <span class="md-ellipsis">
      لایه ۱: شناسایی و بستر (Context &amp; Identification)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allocation-logic" class="md-nav__link">
    <span class="md-ellipsis">
      لایه ۲: منطق تخصیص (Allocation Logic)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discrepancy-deductions" class="md-nav__link">
    <span class="md-ellipsis">
      لایه ۳: مدیریت مغایرت‌ها (Discrepancy &amp; Deductions)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#settlement-instrument" class="md-nav__link">
    <span class="md-ellipsis">
      لایه ۴: ابزار تسویه (Settlement Instrument)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      ۵. خروجی نهایی سیستم
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#document-lifecycle-state-machine" class="md-nav__link">
    <span class="md-ellipsis">
      ۲. چرخه حیات سند و ماشین وضعیت (Document Lifecycle &amp; State Machine)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="۲. چرخه حیات سند و ماشین وضعیت (Document Lifecycle &amp; State Machine)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      فلسفه چرخه حیات
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-flow" class="md-nav__link">
    <span class="md-ellipsis">
      دیاگرام جریان وضعیت (State Flow)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detailed-states" class="md-nav__link">
    <span class="md-ellipsis">
      تشریح دقیق وضعیت‌ها (Detailed States)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="تشریح دقیق وضعیت‌ها (Detailed States)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#draft" class="md-nav__link">
    <span class="md-ellipsis">
      ۱. پیش‌نویس (Draft)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submitted-pending-approval" class="md-nav__link">
    <span class="md-ellipsis">
      ۲. آماده بررسی / در انتظار تایید (Submitted / Pending Approval)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#posted-finalized" class="md-nav__link">
    <span class="md-ellipsis">
      ۳. قطعی / نهایی شده (Posted / Finalized)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#void-cancelled" class="md-nav__link">
    <span class="md-ellipsis">
      ۴. ابطال شده (Void / Cancelled)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transition-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      جدول ماتریس گذار (Transition Matrix)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-notes" class="md-nav__link">
    <span class="md-ellipsis">
      نکات فنی برای پیاده‌سازی (Developer Notes)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#receipt-types" class="md-nav__link">
    <span class="md-ellipsis">
      ۳. انواع دریافت (Receipt Types)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-standard-customer-receipt" class="md-nav__link">
    <span class="md-ellipsis">
      ۳-۱. دریافت استاندارد از مشتری (Standard Customer Receipt)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="۳-۱. دریافت استاندارد از مشتری (Standard Customer Receipt)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      تعریف و کاربرد
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      رفتار سیستم (System Behavior)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gl-impact" class="md-nav__link">
    <span class="md-ellipsis">
      اثر حسابداری (GL Impact)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      مثال واقعی
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-sales-advance-down-payment" class="md-nav__link">
    <span class="md-ellipsis">
      ۳-۲. پیش‌دریافت فروش (Sales Advance / Down Payment)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="۳-۲. پیش‌دریافت فروش (Sales Advance / Down Payment)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      تعریف و کاربرد
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-behavior_1" class="md-nav__link">
    <span class="md-ellipsis">
      رفتار سیستم (System Behavior)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gl-impact_1" class="md-nav__link">
    <span class="md-ellipsis">
      اثر حسابداری (GL Impact)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      مثال واقعی
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      راهکار: استفاده از "دسته‌بندی درآمد" به جای "کد حساب"
    </span>
  </a>
  
    <nav class="md-nav" aria-label="راهکار: استفاده از &#34;دسته‌بندی درآمد&#34; به جای &#34;کد حساب&#34;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      ۱. تنظیمات پشت صحنه (توسط مدیر مالی)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ui" class="md-nav__link">
    <span class="md-ellipsis">
      ۲. آنچه کاربر نهایی می‌بیند (UI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend" class="md-nav__link">
    <span class="md-ellipsis">
      ۳. آنچه سیستم انجام می‌دهد (Backend)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suspense-account" class="md-nav__link">
    <span class="md-ellipsis">
      ۴. پیشنهاد ویژه: گزینه "واریزی نامشخص" (Suspense Account)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    <span class="md-ellipsis">
      خلاصه تغییرات در مستندات (برای اصلاح بخش ۳-۳)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-miscellaneous-direct-receipt" class="md-nav__link">
    <span class="md-ellipsis">
      ۳-۳. درآمد متفرقه / دریافت مستقیم (Miscellaneous / Direct Receipt)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="۳-۳. درآمد متفرقه / دریافت مستقیم (Miscellaneous / Direct Receipt)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      تعریف و کاربرد
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-behavior_2" class="md-nav__link">
    <span class="md-ellipsis">
      رفتار سیستم (System Behavior)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gl-impact_2" class="md-nav__link">
    <span class="md-ellipsis">
      اثر حسابداری (GL Impact)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      مثال واقعی
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-_1" class="md-nav__link">
    <span class="md-ellipsis">
      ۳-۴. جدول مقایسه‌ای (برای تحلیل‌گر و برنامه‌نویس)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="۳-۴. جدول مقایسه‌ای (برای تحلیل‌گر و برنامه‌نویس)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-knock-off" class="md-nav__link">
    <span class="md-ellipsis">
      ۳-۵. سوال کلیدی: اگر پیش‌دریافت بعداً تبدیل به فاکتور شود چه؟ (فرآیند Knock-off)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#receipt-document" class="md-nav__link">
    <span class="md-ellipsis">
      ۴. جزئیات فرم عملیاتی (Receipt Document)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="receipt-vouchers">اسناد دریافت (Receipt Vouchers)</h1>
<h2 id="_1">مقدمه</h2>
<p>در ادبیات تجاری و مدیریت مالی، جمله‌ای کلیدی وجود دارد که ماهیت کسب‌وکارهای B2B را تعریف می‌کند:</p>
<blockquote>
<p><strong>«فروش واقعی زمانی اتفاق می‌افتد که پول به حساب بنشیند؛ قبل از آن، همه چیز فقط یک هدیه یا تعهد بوده است!»</strong></p>
</blockquote>
<p>ماژول <strong>«سند دریافت» (Receipt Voucher)</strong> در سیستم‌های ERP (مانند تابان)، دقیقاً مسئولیت تبدیل این «هدیه» به «نقدینگی واقعی» را بر عهده دارد. برخلاف نرم‌افزارهای ساده فروشگاهی که دریافت پول را صرفاً ثبت یک عدد در صندوق می‌دانند، در سازمان‌های متوسط و بزرگ، این فرم یک <strong>«نقطه عطف استراتژیک»</strong> است.</p>
<p>این ماژول نقش <strong>«پل ارتباطی»</strong> و نقطه تلاقی سه زیرسیستم اصلی سازمان است:</p>
<ol>
<li><strong>زیرسیستم فروش (Sales):</strong> که پیش‌تر با صدور فاکتور، یک «بدهی» و «تعهد» برای مشتری ایجاد کرده است.</li>
<li><strong>زیرسیستم خزانه‌داری (Treasury):</strong> که مسئولیت حفاظت فیزیکی و مدیریت گردش دارایی‌ها (پول نقد، چک، حواله) را دارد.</li>
<li><strong>زیرسیستم حسابداری (General Ledger):</strong> که باید دفاتر کل را تراز کرده، ماهیت حساب‌ها را تغییر دهد و اسناد دوبل را صادر کند.</li>
</ol>
<p>بنابراین، سند دریافت <strong>«نقطه پایان»</strong> چرخه فروش و <strong>«نقطه شروع»</strong> چرخه مدیریت نقدینگی است.</p>
<hr />
<h2 id="_2">چه زمانی به سراغ این سند می‌آییم؟</h2>
<p>کاربران سیستم (خزانه‌داران یا حسابداران فروش) معمولاً در ۳ موقعیت کلیدی و متمایز نیاز به ثبت سند دریافت پیدا می‌کنند. هر یک از این موقعیت‌ها نیاز خاصی را پاسخ می‌دهد:</p>
<h3 id="the-settlement">الف) سناریوی اول: تسویه بدهی‌های گذشته (The Settlement)</h3>
<ul>
<li><strong>وضعیت:</strong> کالا یا خدمات در گذشته (مثلاً هفته پیش) تحویل شده و فاکتور رسمی صادر شده است. حساب مشتری اکنون بدهکار است.</li>
<li><strong>اتفاق:</strong> مشتری امروز چک می‌فرستد یا مبلغی را به حساب شرکت واریز می‌کند.</li>
<li><strong>هدف سیستمی:</strong> «می‌خواهیم به سیستم بفهمانیم که آقای مشتری دیگر بدهکار نیست.» در اینجا سند دریافت نقش <strong>پاک‌کننده بدهی (Clearing)</strong> را بازی می‌کند تا مانده حساب مشتری با واقعیت منطبق شود.</li>
</ul>
<h3 id="the-advance-payment">ب) سناریوی دوم: پیش‌دریافت و رزرو (The Advance Payment)</h3>
<ul>
<li>
<p><strong>وضعیت:</strong> مشتری سفارش خریدی ثبت کرده، اما طبق سیاست شرکت یا قرارداد فی‌مابین، تا زمانی که ۳۰٪ مبلغ کل قرارداد پرداخت نشود، کالا از انبار خارج نخواهد شد.</p>
</li>
<li>
<p><strong>اتفاق:</strong> مشتری مبلغ بیعانه را واریز می‌کند.</p>
</li>
<li><strong>هدف سیستمی:</strong> «می‌خواهیم این پول را دریافت کرده و مشخصاً برای همین سفارش خاص <strong>رزرو (Allocate)</strong> کنیم.» در این حالت، سند دریافت مجوزی برای واحد فروش و انبار است تا فرآیند تحویل کالا را آغاز کنند.</li>
</ul>
<h3 id="the-miscellaneous">ج) سناریوی سوم: درآمدهای غیرتجاری (The Miscellaneous)</h3>
<ul>
<li><strong>وضعیت:</strong> مبالغی وارد حساب‌های شرکت می‌شود که ناشی از عملیات اصلی فروش نیست.</li>
<li><strong>اتفاق:</strong> بانک سود سپرده ماهانه را واریز می‌کند، یا ضایعات کارتن‌های انبار به صورت نقدی به یک خریدار رهگذر فروخته می‌شود.</li>
<li><strong>هدف سیستمی:</strong> «پولی وارد شرکت شده که طرف حساب آن مشتری تجاری نیست، اما باید در سیستم ثبت شود تا موجودی بانک یا صندوق با واقعیت فیزیکی همخوانی (Reconciliation) داشته باشد.»</li>
</ul>
<hr />
<h2 id="_3">ضرورت و کارکردها</h2>
<p>اگر فرآیند دریافت صرفاً به «گرفتن پول» محدود می‌شد، نیازی به این حجم از پیچیدگی نبود. اهمیت این سند در ۴ کارکرد حیاتی آن نهفته است:</p>
<h3 id="clearing-ar">۱. شفاف‌سازی حساب مشتری (Clearing AR)</h3>
<p>بدون سند دریافت، سیستم فروش همچنان مشتری را بدهکار می‌داند. این سند مانند یک مکانیزم <strong>تهاتر</strong> عمل می‌کند که بدهی‌های باز (Open Invoices) را شناسایی کرده و با دارایی ورودی تسویه می‌کند.</p>
<h3 id="handling-deductions">۲. مدیریت هوشمند کسورات (Handling Deductions)</h3>
<p>این مهم‌ترین چالش در حسابداری فروش است. پول دریافتی به ندرت دقیقاً با مبلغ فاکتور برابر است.</p>
<ul>
<li><strong>چالش:</strong> مشتری باید ۱۰۰ میلیون تومان پرداخت می‌کرد، اما چک ۸۵ میلیون تومانی داده است.</li>
<li><strong>نقش سند:</strong> این سند تنها جایی است که حسابدار می‌تواند تعیین تکلیف کند که آن ۱۵ میلیون تومان اختلاف چیست؟<ul>
<li>آیا تخفیف نقدی بوده؟ (هزینه تخفیفات)</li>
<li>آیا کسورات بیمه و مالیات تکلیفی بوده؟ (انتقال بدهی از مشتری به سازمان‌های دولتی)</li>
<li>آیا اشتباه واریزی است؟ (بستانکاری مشتری)</li>
</ul>
</li>
</ul>
<h3 id="realization">۳. تبدیل تعهد به دارایی (Realization)</h3>
<p>فاکتور فروش صرفاً یک «کاغذ» و یک «حق حقوقی» است. سند دریافت ابزاری است که ماهیت این حق را به «دارایی ملموس» (وجه نقد یا اسناد تجاری) تغییر می‌دهد و ترازنامه شرکت را واقعی می‌کند.</p>
<h3 id="instrument-tracking">۴. رهگیری چرخه حیات چک (Instrument Tracking)</h3>
<p>در محیط تجاری ایران، بخش بزرگی از دریافت‌ها با <strong>چک</strong> انجام می‌شود. سند دریافت محل <strong>«تولد چک»</strong> در سیستم است. تا چک در اینجا ثبت نشود، سیستم نمی‌تواند سررسید آن را هشدار دهد، امکان واگذاری به بانک (کلر) را فراهم کند یا در صورت برگشت خوردن، فرآیند حقوقی را آغاز نماید.</p>
<hr />
<h2 id="data-flow">کالبدشکافی معماری: جریان ۴ لایه‌ای داده‌ها (Data Flow)</h2>
<p>در طراحی سیستم تابان، برخلاف نگاه سنتی و خطی، پردازش سند دریافت بر اساس یک منطق <strong>«مهندسی معکوس»</strong> و در ۴ لایه مجزا اما به هم پیوسته انجام می‌شود:</p>
<h3 id="context-identification">لایه ۱: شناسایی و بستر (Context &amp; Identification)</h3>
<p>در این لایه، «سربرگ» (Header) سند شکل می‌گیرد.</p>
<ul>
<li><strong>سوالات کلیدی:</strong> پرداخت‌کننده کیست؟ تاریخ دریافت چه زمانی است؟ ارز مبادله چیست؟</li>
<li><strong>نکته فنی:</strong> ثبت دقیق نرخ ارز در این لحظه حیاتی است. اگر بین زمان صدور فاکتور و زمان دریافت پول، نرخ ارز تغییر کرده باشد، سیستم در همین لایه مقدمات محاسبه <strong>سود و زیان ناشی از تسعیر ارز</strong> را فراهم می‌کند.</li>
</ul>
<h3 id="allocation-logic">لایه ۲: منطق تخصیص (Allocation Logic)</h3>
<p>این لایه مغز متفکر سیستم است. صرف اینکه مانده حساب مشتری صفر شود کافی نیست؛ باید مشخص شود این پول دقیقاً کدام فاکتور را پاس کرده است.</p>
<ul>
<li><strong>اهمیت:</strong> اگر تخصیص در سطح فاکتور انجام نشود، در <strong>«گزارش سنی مطالبات» (Aging Report)</strong>، فاکتورهای قدیمی همچنان «باز» و معوق نمایش داده می‌شوند، در حالی که یک پول «آزاد» در حساب مشتری وجود دارد. سیستم باید دقیقاً لینک کند که: <em>"این چک ۵۰ تومانی، فاکتور شماره INV-101 را تسویه کرد."</em></li>
</ul>
<h3 id="discrepancy-deductions">لایه ۳: مدیریت مغایرت‌ها (Discrepancy &amp; Deductions)</h3>
<p>این لایه مسئول پاسخ به سوال «اختلاف مبلغ فاکتور و مبلغ دریافتی» است.</p>
<ul>
<li><strong>عملکرد:</strong> در اینجا کاربر (حسابدار) با استفاده از کدهای دلیل (Reason Codes)، ماهیت اختلاف را مشخص می‌کند. مثلاً مشخص می‌کند که مبلغ کسر شده «سوخت» نشده، بلکه ماهیت آن از «طلب از مشتری» به «طلب از سازمان تأمین اجتماعی» (بابت سپرده بیمه) تغییر یافته است. این دقیق‌ترین بخش حسابداری پیمانکاری است.</li>
</ul>
<h3 id="settlement-instrument">لایه ۴: ابزار تسویه (Settlement Instrument)</h3>
<p>در لایه آخر، سیستم به جنس دارایی ورودی نگاه می‌کند.</p>
<ul>
<li><strong>نقد/واریز:</strong> مستقیماً موجودی بانک را افزایش می‌دهد.</li>
<li><strong>چک:</strong> موجودی بانک را تغییر نمی‌دهد؛ بلکه حسابی واسط به نام "اسناد دریافتنی نزد صندوق" را درگیر می‌کند و یک موجودیت جدید (Entity) به نام «برگه چک» در سیستم ایجاد می‌کند که چرخه‌عمری مستقل دارد (وصول، برگشت، عودت، خرج کردن).</li>
</ul>
<h3 id="_4">۵. خروجی نهایی سیستم</h3>
<p>پس از تکمیل و تأیید این سند، سه اتفاق بزرگ به صورت همزمان رخ می‌دهد:</p>
<ol>
<li><strong>در فروش:</strong> پرونده فاکتورهای مرتبط بسته شده و اعتبار مشتری آزاد می‌شود.</li>
<li><strong>در خزانه:</strong> موجودی نقد و لیست چک‌های موجود به‌روزرسانی می‌شود.</li>
<li><strong>در حسابداری:</strong> سند حسابداری دوبل (Double-entry) که شامل تمام جزئیات (بدهکاری بانک/اسناد دریافتنی، هزینه تخفیفات، کسورات قانونی و بستانکاری مشتری) است، به صورت اتوماتیک صادر می‌گردد.</li>
</ol>
<hr />
<h2 id="document-lifecycle-state-machine">۲. چرخه حیات سند و ماشین وضعیت (Document Lifecycle &amp; State Machine)</h2>
<h3 id="_5">فلسفه چرخه حیات</h3>
<p>در یک نرم‌افزار ساده (مثل Excel)، شما یک عدد را می‌نویسید و هر وقت خواستید پاک می‌کنید. اما در <strong>ERP</strong>، اسناد نباید "پاک" شوند؛ آن‌ها باید "متولد"، "بالغ" و در صورت لزوم "بازنشسته" شوند.
چرخه حیات به ما تضمین می‌دهد که:</p>
<ol>
<li><strong>یکپارچگی داده:</strong> سندی که نهایی شده، تغییر نمی‌کند تا تراز مالی به هم نریزد.</li>
<li><strong>تفکیک وظایف:</strong> کسی که اطلاعات را وارد می‌کند (Data Entry) با کسی که تایید نهایی می‌کند (Approver) متفاوت است.</li>
<li><strong>ردگیری (Audit Trail):</strong> تاریخچه تغییرات مشخص است.</li>
</ol>
<hr />
<h3 id="state-flow">دیاگرام جریان وضعیت (State Flow)</h3>
<p>مسیر حرکت یک سند دریافت از لحظه ایجاد تا پایان به شکل زیر است:</p>
<ol>
<li><strong>شروع:</strong> سند همیشه در حالت <strong>«پیش‌نویس»</strong> متولد می‌شود.</li>
<li><strong>حرکت:</strong> کاربر سند را تکمیل کرده و به وضعیت <strong>«آماده بررسی»</strong> می‌فرستد.</li>
<li><strong>تصمیم:</strong> مدیر مالی سند را می‌بیند. یا آن را <strong>«تایید/قطعی»</strong> می‌کند یا اگر ایراد داشت، دوباره به <strong>«پیش‌نویس»</strong> برمی‌گرداند (Reject).</li>
<li><strong>پایان:</strong> سند قطعی شده، دیگر بر نمی‌گردد. اگر اشتباه بود، باید <strong>«ابطال»</strong> شود (که منجر به صدور سند معکوس می‌شود).</li>
</ol>
<hr />
<h3 id="detailed-states">تشریح دقیق وضعیت‌ها (Detailed States)</h3>
<h4 id="draft">۱. پیش‌نویس (Draft)</h4>
<ul>
<li><strong>معنی:</strong> سند در حالِ ساخت است. مثل یک چک‌نویس روی کاغذ که هنوز امضا نشده.</li>
<li><strong>دسترسی کاربر:</strong> خواندن و نوشتن (Read/Write). کاربر می‌تواند بارها مبلغ، مشتری و تاریخ را عوض کند یا حتی سند را حذف (Delete) کند.</li>
<li><strong>رفتار سیستم:</strong><ul>
<li>هیچ سند حسابداری (GL) صادر نمی‌شود.</li>
<li>موجودی صندوق/بانک تغییر نمی‌کند.</li>
<li>شماره سند رزرو می‌شود (یا به صورت موقت نمایش داده می‌شود).</li>
<li>کنترل‌های سخت‌گیرانه (مثل تاریخ بسته شده) اعمال نمی‌شود.</li>
</ul>
</li>
</ul>
<h4 id="submitted-pending-approval">۲. آماده بررسی / در انتظار تایید (Submitted / Pending Approval)</h4>
<ul>
<li><strong>معنی:</strong> کاربر ورود اطلاعات را تمام کرده و ادعا می‌کند "کار من تمام است". توپ در زمین مدیر است.</li>
<li><strong>دسترسی کاربر:</strong> فقط خواندنی (Read-only). کاربر عادی دیگر نمی‌تواند تغییر دهد.</li>
<li><strong>دسترسی مدیر:</strong> می‌تواند دکمه‌های "تایید" (Approve) یا "رد" (Reject) را بزند.</li>
<li><strong>رفتار سیستم:</strong><ul>
<li>سند قفل می‌شود (Lock).</li>
<li>هنوز سند حسابداری رسمی صادر نشده، اما در برخی سیستم‌های پیشرفته یک "رزرو موجودی" (Soft Commit) انجام می‌شود تا فروشنده بداند این پول "در راه" است.</li>
</ul>
</li>
</ul>
<h4 id="posted-finalized">۳. قطعی / نهایی شده (Posted / Finalized)</h4>
<ul>
<li><strong>معنی:</strong> سند توسط مقام مسئول تایید شده و اثر مالی آن در دفاتر قانونی ثبت شده است. این <strong>نقطه بی‌بازگشت (Point of No Return)</strong> برای ویرایش است.</li>
<li><strong>دسترسی:</strong> کاملاً قفل (Locked). هیچ‌کس (حتی مدیر) حق ویرایش مبلغ یا تاریخ را ندارد. دکمه "حذف" (Delete) ناپدید می‌شود.</li>
<li><strong>رفتار سیستم (بسیار مهم):</strong><ul>
<li><strong>تولید سند حسابداری (GL Creation):</strong> موتور حسابداری فعال شده و آرتیکل‌ها (بدهکار/بستانکار) را در دیتابیس مالی درج می‌کند.</li>
<li><strong>به‌روزرسانی مانده‌ها:</strong> مانده حساب مشتری کم می‌شود. موجودی خزانه زیاد می‌شود.</li>
<li><strong>تغییر وضعیت چک:</strong> اگر چک دریافت شده باشد، چک در ماژول چک ثبت و آماده عملیات بانکی (خواباندن به حساب) می‌شود.</li>
</ul>
</li>
</ul>
<h4 id="void-cancelled">۴. ابطال شده (Void / Cancelled)</h4>
<ul>
<li><strong>معنی:</strong> این وضعیت برای دو حالت است:<ol>
<li>سند پیش‌نویس بوده و منصرف شدیم (حذف منطقی).</li>
<li>سند Post شده بود، اما فهمیدیم اشتباه فاحش دارد یا چک برگشت خورده و کلاً معامله فسخ شده.</li>
</ol>
</li>
<li><strong>رفتار سیستم (در صورت ابطال سند Posted):</strong><ul>
<li>سیستم اجازه پاک کردن رکورد را نمی‌دهد.</li>
<li>یک <strong>سند حسابداری معکوس (Reversal Entry)</strong> به صورت اتوماتیک صادر می‌شود تا اثر سند قبلی را خنثی کند.</li>
<li>روی سند اصلی یک "مهر ابطال" (Void Flag) می‌خورد تا در گزارش‌ها نیاید.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="transition-matrix">جدول ماتریس گذار (Transition Matrix)</h3>
<p>این جدول برای <strong>برنامه‌نویسان</strong> حیاتی است تا بدانند کدام دکمه‌ها در چه وضعیتی فعال هستند.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">وضعیت فعلی</th>
<th style="text-align: left;">دکمه‌های مجاز (Actions)</th>
<th style="text-align: left;">وضعیت بعدی</th>
<th style="text-align: left;">شرط منطقی / تریگر</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Draft</strong></td>
<td style="text-align: left;">ذخیره (Save)</td>
<td style="text-align: left;">Draft</td>
<td style="text-align: left;">اعتبارسنجی اولیه فرمت داده‌ها</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Draft</strong></td>
<td style="text-align: left;">حذف (Delete)</td>
<td style="text-align: left;">(Deleted)</td>
<td style="text-align: left;">حذف فیزیکی از دیتابیس (فقط در حالت پیش‌نویس مجاز است)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Draft</strong></td>
<td style="text-align: left;">ارسال/تایید (Submit)</td>
<td style="text-align: left;">Submitted</td>
<td style="text-align: left;">تمام فیلدهای اجباری پر شده باشند + معادله تراز برقرار باشد.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Submitted</strong></td>
<td style="text-align: left;">رد کردن (Reject)</td>
<td style="text-align: left;">Draft</td>
<td style="text-align: left;">مدیر سند را برای اصلاح به کاربر برمی‌گرداند.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Submitted</strong></td>
<td style="text-align: left;">تایید نهایی (Post)</td>
<td style="text-align: left;">Posted</td>
<td style="text-align: left;">چک کردن دوره مالی باز + صدور سند GL.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Posted</strong></td>
<td style="text-align: left;">ابطال (Void)</td>
<td style="text-align: left;">Void</td>
<td style="text-align: left;">صدور سند معکوس (Reversal GL) + آزاد کردن فاکتورهای تخصیص داده شده.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Posted</strong></td>
<td style="text-align: left;">ویرایش (Edit)</td>
<td style="text-align: left;">❌</td>
<td style="text-align: left;"><strong>ممنوع.</strong> (مگر با دسترسی ادمین خاص که آن هم توصیه نمی‌شود).</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="developer-notes">نکات فنی برای پیاده‌سازی (Developer Notes)</h3>
<ol>
<li><strong>تغییر ناپذیری (Immutability):</strong> وقتی <code>DocStatus = Posted</code> شد، تمام فیلدهای مالی جدول (Amount, Date, CustomerID) باید در دیتابیس <code>Immutable</code> شوند. هر تلاشی برای <code>UPDATE</code> روی این رکوردها باید توسط Backend بلاک شود.</li>
<li><strong>رول‌بک تراکنش (Transaction Rollback):</strong> عملیات تغییر وضعیت به Posted باید در یک <code>Database Transaction</code> باشد. یعنی اگر سند حسابداری (GL) به هر دلیلی صادر نشد، وضعیت سند دریافت هم نباید به Posted تغییر کند و باید برگردد.</li>
<li><strong>تاریخچه تغییرات (Audit Log):</strong> جدولی باید وجود داشته باشد که ثبت کند:<ul>
<li>چه کسی (User ID)</li>
<li>در چه زمانی (Timestamp)</li>
<li>وضعیت را از چی به چی تغییر داد؟ (مثلاً از Draft به Posted).</li>
</ul>
</li>
</ol>
<p>این ساختار تضمین می‌کند که سیستم شما در برابر حسابرسی‌های مالی (Auditing) سربلند بیرون می‌آید.</p>
<hr />
<h2 id="receipt-types">۳. انواع دریافت (Receipt Types)</h2>
<p>فیلد <code>ReceiptType</code> اولین انتخابی است که کاربر انجام می‌دهد و کل رفتار فرم بر اساس آن تغییر می‌کند (Polymorphic Behavior).</p>
<h2 id="-standard-customer-receipt">۳-۱. دریافت استاندارد از مشتری (Standard Customer Receipt)</h2>
<h3 id="_6">تعریف و کاربرد</h3>
<p>این رایج‌ترین نوع دریافت است. زمانی استفاده می‌شود که <strong>«بدهی از قبل وجود دارد»</strong>. یعنی کالا فروخته شده، فاکتور صادر شده و اکنون مشتری پول آن را پرداخت می‌کند.</p>
<h3 id="system-behavior">رفتار سیستم (System Behavior)</h3>
<ul>
<li><strong>انتخاب مشتری:</strong> اجباری (<code>Required</code>).</li>
<li><strong>تب تخصیص (Allocation):</strong> <strong>فعال است.</strong> سیستم لیست فاکتورهای باز (بدهکار) این مشتری را نمایش می‌دهد تا کاربر مشخص کند این پول بابت کدام فاکتور است. در اینجا عملیات «تسویه» (Settlement) انجام می شود و مبلغ دریافتی با بدهی فاکتور تهاتر می‌شود.</li>
<li><strong>منطق کنترل:</strong> جمع مبلغ نمی‌تواند کمتر از مبلغ تخصیص باشد.</li>
</ul>
<h3 id="gl-impact">اثر حسابداری (GL Impact)</h3>
<ul>
<li><strong>بستانکار:</strong> حساب‌های دریافتنی تجاری (Accounts Receivable).</li>
<li><strong>بدهکار:</strong> بانک / صندوق.</li>
</ul>
<h3 id="_7">مثال واقعی</h3>
<blockquote>
<p>شرکت تابان ۱۰۰ عدد "شیر صنعتی" به "پتروشیمی جم" فروخته و فاکتور شماره ۱۰۱ به مبلغ ۵۰۰ میلیون تومان صادر کرده است.
امروز پتروشیمی جم یک چک ۵۰۰ میلیونی ارسال می‌کند.</p>
<ul>
<li><strong>نوع:</strong> دریافت از مشتری</li>
<li><strong>تخصیص:</strong> فاکتور ۱۰۱ انتخاب می‌شود.</li>
<li><strong>نتیجه:</strong> حساب پتروشیمی جم صفر می‌شود.</li>
</ul>
</blockquote>
<hr />
<h2 id="-sales-advance-down-payment">۳-۲. پیش‌دریافت فروش (Sales Advance / Down Payment)</h2>
<h3 id="_8">تعریف و کاربرد</h3>
<p>زمانی استفاده می‌شود که <strong>«هنوز فاکتوری صادر نشده است»</strong> اما پول دریافت می‌شود. این حالت در پروژه‌های سفارشی یا فروش‌های شرایطی (که اول پول می‌گیرند بعد کالا می‌دهند) رخ می‌دهد.</p>
<h3 id="system-behavior_1">رفتار سیستم (System Behavior)</h3>
<ul>
<li><strong>انتخاب مشتری:</strong> اجباری (<code>Required</code>).</li>
<li><strong>اتصال به سفارش:</strong> عملیات "لینک کردن" (Linking) انجام می شود. پول به عنوان پیش‌دریافت ثبت می‌شود اما به سفارش فروش متصل می‌گردد تا در زمان صدور فاکتور نهایی، به طور خودکار کسر شود.</li>
<li><strong>تب تخصیص (Allocation):</strong> <strong>غیرفعال یا خالی است.</strong> (چون هنوز فاکتوری وجود ندارد که بدهی ایجاد کرده باشد).</li>
<li><strong>مالیات:</strong> در برخی قوانین مالیاتی، پیش‌دریافت هم مشمول صدور فاکتور و مالیات است (نیاز به هندلینگ خاص).</li>
</ul>
<h3 id="gl-impact_1">اثر حسابداری (GL Impact)</h3>
<ul>
<li><strong>بستانکار:</strong> پیش‌دریافت مشتریان (Advances from Customers) - <em>ماهیت: بدهی جاری (Liability).</em><ul>
<li><em>نکته:</em> این پول درآمد نیست؛ بلکه بدهی ما به مشتری است تا زمانی که کالا را تحویل دهیم.</li>
</ul>
</li>
<li><strong>بدهکار:</strong> بانک / صندوق.</li>
</ul>
<h3 id="_9">مثال واقعی</h3>
<blockquote>
<p>مشتری "فولاد مبارکه" سفارش ساخت یک مخزن بزرگ را می‌دهد. طبق قرارداد، باید ۳۰٪ مبلغ (۳۰۰ میلیون) را اول واریز کند. هنوز مخزنی ساخته نشده و فاکتوری نیست.</p>
<ul>
<li><strong>نوع:</strong> پیش‌دریافت</li>
<li><strong>لینک:</strong> سفارش فروش شماره SO-800</li>
<li><strong>نتیجه:</strong> در ترازنامه، شرکت ۳۰۰ میلیون به فولاد مبارکه بدهکار می‌شود (تعهد انجام کار).</li>
</ul>
</blockquote>
<hr />
<p>بله، کاملاً درست می‌فرمایید.
یکی از بزرگترین اشتباهات در طراحی نرم‌افزار این است که از کاربر عملیاتی (مثل صندوق‌دار یا مسئول خزانه) انتظار داشته باشیم که <strong>«کدینگ حسابداری»</strong> را بلد باشد. این کار هم باعث <strong>خطای انسانی</strong> می‌شود و هم <strong>سرعت ثبت</strong> را پایین می‌آورد.</p>
<p>برای حل این مشکل، ما از یک لایه واسط به نام <strong>«عنوان درآمد» (Income Category / Reason Code)</strong> استفاده می‌کنیم.</p>
<p>در اینجا راهکار استاندارد ERP برای حل این چالش را توضیح می‌دهم:</p>
<hr />
<h3 id="_10">راهکار: استفاده از "دسته‌بندی درآمد" به جای "کد حساب"</h3>
<p>به جای اینکه لیست هزاران حساب معین را به کاربر نشان دهید، یک لیست محدود و قابل فهم از <strong>"بابت‌ها"</strong> را تعریف می‌کنید و در پشت صحنه، هر کدام را به یک حساب وصل می‌کنید.</p>
<h4 id="_11">۱. تنظیمات پشت صحنه (توسط مدیر مالی)</h4>
<p>مدیر مالی یک‌بار وارد تنظیمات می‌شود و جدولی شبیه زیر را پر می‌کند (این جدول از دید کاربر مخفی است):</p>
<table>
<thead>
<tr>
<th style="text-align: left;">کد سیستمی</th>
<th style="text-align: left;">عنوان نمایشی برای کاربر (User Friendly)</th>
<th style="text-align: left;">حساب معین متصل (GL Account)</th>
<th style="text-align: left;">مرکز هزینه (اختیاری)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;"><strong>سود سپرده بانکی</strong></td>
<td style="text-align: left;">70101 (سایر درآمدها - سود)</td>
<td style="text-align: left;">--</td>
</tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: left;"><strong>فروش ضایعات / کارتن</strong></td>
<td style="text-align: left;">70105 (درآمد حاصل از ضایعات)</td>
<td style="text-align: left;">کارخانه</td>
</tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: left;"><strong>برگشت تنخواه</strong></td>
<td style="text-align: left;">10105 (تنخواه‌گردان‌ها)</td>
<td style="text-align: left;">--</td>
</tr>
<tr>
<td style="text-align: left;">4</td>
<td style="text-align: left;"><strong>واریزی نامشخص (نیاز به بررسی)</strong></td>
<td style="text-align: left;">20500 (حساب‌های انتظامی/نامشخص)</td>
<td style="text-align: left;">--</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="ui">۲. آنچه کاربر نهایی می‌بیند (UI)</h4>
<p>وقتی کاربر نوع دریافت را <strong>«درآمد متفرقه»</strong> انتخاب می‌کند، فیلد "حساب معین" حذف می‌شود و فیلد <strong>«بابت / نوع درآمد»</strong> ظاهر می‌شود.</p>
<p>کاربر فقط گزینه‌های زیر را می‌بیند:</p>
<ul>
<li>سود سپرده بانکی</li>
<li>فروش ضایعات</li>
<li>برگشت تنخواه</li>
<li>واریزی نامشخص</li>
</ul>
<p><strong>مثال:</strong></p>
<blockquote>
<p>مسئول خزانه می‌بیند که ۵۰۰ هزار تومان به حساب آمده و در شرح فیش نوشته "فروش کارتن‌های انبار".
او در سیستم گزینه <strong>«فروش ضایعات / کارتن»</strong> را انتخاب می‌کند. تمام!</p>
</blockquote>
<hr />
<h4 id="backend">۳. آنچه سیستم انجام می‌دهد (Backend)</h4>
<p>سیستم هنگام صدور سند حسابداری (<code>Posting</code>)، به جدول تنظیمات نگاه می‌کند:</p>
<ol>
<li>کاربر گزینه "فروش ضایعات" (ID: 2) را انتخاب کرده.</li>
<li>سیستم کد <code>70105</code> را پیدا می‌کند.</li>
<li>سند را صادر می‌کند:<ul>
<li><strong>بدهکار:</strong> بانک (۵۰۰,۰۰۰)</li>
<li><strong>بستانکار:</strong> درآمد حاصل از ضایعات - کد ۷۰۱۰۵ (۵۰۰,۰۰۰)</li>
</ul>
</li>
</ol>
<hr />
<h3 id="suspense-account">۴. پیشنهاد ویژه: گزینه "واریزی نامشخص" (Suspense Account)</h3>
<p>همیشه حالتی پیش می‌آید که مسئول خزانه واقعاً نمی‌داند این پول چیست (مثلاً یک واریزی بدون نام).
برای اینکه کار متوقف نشود:</p>
<ol>
<li>یک گزینه با نام <strong>«واریزی نامشخص / نیاز به اصلاح»</strong> ایجاد کنید.</li>
<li>آن را به یک حساب موقت (مثل "بستانکاران متفرقه" یا "وجوه نامشخص") وصل کنید.</li>
<li>مسئول خزانه پول را ثبت می‌کند تا موجودی بانک در سیستم درست شود.</li>
<li>حسابدار آخر هفته گزارش حساب "وجوه نامشخص" را می‌گیرد و پس از پیگیری، با یک سند اصلاحی آن را به حساب درست (یا مشتری درست) منتقل می‌کند.</li>
</ol>
<hr />
<h3 id="-">خلاصه تغییرات در مستندات (برای اصلاح بخش ۳-۳)</h3>
<p><strong>در بخش ۳-۳ (درآمد متفرقه)، جدول را به این صورت اصلاح کنید:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">فیلد</th>
<th style="text-align: left;">وضعیت</th>
<th style="text-align: left;">توضیحات</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>انتخاب مشتری</strong></td>
<td style="text-align: left;">غیرفعال</td>
<td style="text-align: left;">--</td>
</tr>
<tr>
<td style="text-align: left;"><strong>دسته درآمد (Income Category)</strong></td>
<td style="text-align: left;"><strong>اجباری</strong></td>
<td style="text-align: left;">انتخاب از لیست تعریف شده (مثل سود، ضایعات). <br> <em>نکته: کاربر کد حساب نمی‌بیند.</em></td>
</tr>
<tr>
<td style="text-align: left;"><strong>حساب معین (GL Account)</strong></td>
<td style="text-align: left;"><strong>مخفی (Hidden)</strong></td>
<td style="text-align: left;">سیستم بر اساس "دسته درآمد" انتخاب شده، این فیلد را پشت صحنه پر می‌کند.</td>
</tr>
</tbody>
</table>
<p>با این روش، هم دیتای حسابداری دقیق می‌ماند و هم کاربر بدون دانش مالی، کارش را به راحتی انجام می‌دهد.</p>
<hr />
<h2 id="-miscellaneous-direct-receipt">۳-۳. درآمد متفرقه / دریافت مستقیم (Miscellaneous / Direct Receipt)</h2>
<h3 id="_12">تعریف و کاربرد</h3>
<p>پول‌هایی که وارد شرکت می‌شوند اما <strong>مربوط به عملیات اصلی فروش کالا/خدمات نیستند</strong> و طرف حساب مشخص تجاری (مشتری) ندارند.</p>
<h3 id="system-behavior_2">رفتار سیستم (System Behavior)</h3>
<ul>
<li><strong>انتخاب مشتری:</strong> غیرفعال (<code>Hidden</code> یا <code>Optional</code>).</li>
<li><strong>تب تخصیص:</strong> غیرفعال.</li>
<li><strong>انتخاب حساب معین (GL Account):</strong> <strong>اجباری.</strong> کاربر باید دستی انتخاب کند که این پول بابت چیست (مثلاً حساب درآمد سود سپرده، حساب درآمد فروش ضایعات، جاری شرکا).</li>
</ul>
<h3 id="gl-impact_2">اثر حسابداری (GL Impact)</h3>
<ul>
<li><strong>بستانکار:</strong> حساب درآمدی انتخاب شده توسط کاربر (مثلاً "سایر درآمدهای غیرعملیاتی").</li>
<li><strong>بدهکار:</strong> بانک / صندوق.</li>
</ul>
<h3 id="_13">مثال واقعی</h3>
<blockquote>
<ol>
<li>بانک سر ماه مبلغ ۵ میلیون تومان سود به حساب شرکت واریز می‌کند.</li>
<li>شرکت تعدادی میز و صندلی کهنه اداری را به یک خریدار ناشناس می‌فروشد و نقداً پول می‌گیرد.</li>
<li><strong>نوع:</strong> درآمد متفرقه</li>
<li><strong>حساب معین:</strong> درآمد ناشی از فروش دارایی ثابت / سود سپرده بانکی.</li>
</ol>
</blockquote>
<hr />
<h2 id="-_1">۳-۴. جدول مقایسه‌ای (برای تحلیل‌گر و برنامه‌نویس)</h2>
<p>این جدول تفاوت‌های فنی رفتار فرم را در هر یک از این سه نوع نشان می‌دهد:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">ویژگی (Feature)</th>
<th style="text-align: left;">دریافت از مشتری (Customer)</th>
<th style="text-align: left;">پیش‌دریافت (Advance)</th>
<th style="text-align: left;">درآمد متفرقه (Misc)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>فیلد مشتری (Payer)</strong></td>
<td style="text-align: left;"><strong>اجباری</strong></td>
<td style="text-align: left;"><strong>اجباری</strong></td>
<td style="text-align: left;">غیرفعال / اختیاری</td>
</tr>
<tr>
<td style="text-align: left;"><strong>منبع داده (Source)</strong></td>
<td style="text-align: left;">فاکتور فروش (Invoice)</td>
<td style="text-align: left;">سفارش فروش (Sales Order)</td>
<td style="text-align: left;">بدون مرجع (Direct GL)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>تب تخصیص (Alloc)</strong></td>
<td style="text-align: left;">فعال (الزامی برای تسویه)</td>
<td style="text-align: left;">غیرفعال</td>
<td style="text-align: left;">غیرفعال</td>
</tr>
<tr>
<td style="text-align: left;"><strong>حساب بستانکار (Credit GL)</strong></td>
<td style="text-align: left;">حساب‌های دریافتنی (A/R)</td>
<td style="text-align: left;">حساب پیش‌دریافت (Liability)</td>
<td style="text-align: left;">انتخاب دستی کاربر (Income/Equity)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>تأثیر بر سقف اعتبار</strong></td>
<td style="text-align: left;">اعتبار را آزاد می‌کند</td>
<td style="text-align: left;">اعتبار را آزاد می‌کند</td>
<td style="text-align: left;">بی اثر</td>
</tr>
<tr>
<td style="text-align: left;"><strong>کنترل مالیات (VAT)</strong></td>
<td style="text-align: left;">روی فاکتور محاسبه شده</td>
<td style="text-align: left;">ممکن است نیاز به صدور فاکتور پیش‌دریافت باشد</td>
<td style="text-align: left;">معمولاً ندارد (مگر فروش ضایعات)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="-knock-off">۳-۵. سوال کلیدی: اگر پیش‌دریافت بعداً تبدیل به فاکتور شود چه؟ (فرآیند Knock-off)</h3>
<p>این یک نکته پیشرفته برای تکمیل داکیومنت است:
وقتی شما <strong>«پیش‌دریافت»</strong> می‌گیرید، بعداً که کالا را تحویل دادید و <strong>«فاکتور»</strong> صادر کردید، باید این دو را به هم وصل کنید.
به این فرآیند <strong>تهاتر یا تخصیص مجدد (Re-allocation / Knock-off)</strong> می‌گویند.</p>
<ul>
<li>سیستم باید امکانی داشته باشد که کاربر بگوید: "آن ۳۰۰ میلیونی که ماه پیش گرفتم (پیش‌دریافت)، بابت این فاکتور شماره ۱۰۵ است که امروز صادر شد."</li>
<li>با این کار، حساب "پیش‌دریافت" بدهکار و حساب "دریافتنی تجاری" بستانکار می‌شود.</li>
</ul>
<hr />
<h2 id="receipt-document">۴. جزئیات فرم عملیاتی (Receipt Document)</h2>
<p><strong>مسیر دسترسی:</strong> <code>خزانه‌داری &gt; عملیات دریافت &gt; سند دریافت جدید</code></p>
<p>این بخش، <strong>«شناسنامه»</strong> سند است. قبل از اینکه وارد جزئیات شویم (چه کسی پول داده یا بابت کدام فاکتور)، باید مشخصات کلی تراکنش در سربرگ (Header) تعیین شود.
اطلاعات سربرگ در تمام سیستم (حسابداری، گزارشات فصلی و مغایرت‌گیری) به عنوان <strong>داده‌های مرجع</strong> استفاده می‌شوند.</p>
<p>در ادامه، این بخش را با جزئیات فنی (برای دیتابیس)، منطق بیزینس (برای تحلیل‌گر) و مثال (برای کاربر) باز می‌کنم.</p>
<hr />
<h1 id="header-">بخش اول: اطلاعات سربرگ (Header) - جزئیات و منطق</h1>
<p><strong>موقعیت در فرم:</strong> بالاترین قسمت فرم که معمولاً ثابت (Fixed) است و با اسکرول کردن صفحه، مخفی نمی‌شود.</p>
<h2 id="data-dictionary">۱. جدول مشخصات فیلدها (Data Dictionary)</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">عنوان فیلد (UI)</th>
<th style="text-align: left;">نام فنی (DB)</th>
<th style="text-align: left;">نوع داده</th>
<th style="text-align: center;">الزامی</th>
<th style="text-align: left;">پیش‌فرض</th>
<th style="text-align: left;">منطق بیزینس و رفتار سیستم</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>شماره سند</strong></td>
<td style="text-align: left;"><code>DocNum</code></td>
<td style="text-align: left;">String</td>
<td style="text-align: center;">بله</td>
<td style="text-align: left;">Auto</td>
<td style="text-align: left;"><strong>تولید خودکار.</strong> الگوی پیشنهاد: <code>RCT-{Year}-{Seq}</code>. (مثال: <code>RCT-1403-1050</code>). غیرقابل ویرایش توسط کاربر جهت حفظ توالی.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>وضعیت</strong></td>
<td style="text-align: left;"><code>DocStatus</code></td>
<td style="text-align: left;">Enum</td>
<td style="text-align: center;">بله</td>
<td style="text-align: left;">Draft</td>
<td style="text-align: left;">وضعیت چرخه حیات سند (پیش‌نویس، تایید شده، ابطال). غیرقابل ویرایش مستقیم (تغییر فقط با دکمه‌های عملیاتی).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>تاریخ دریافت</strong></td>
<td style="text-align: left;"><code>DocDate</code></td>
<td style="text-align: left;">Date</td>
<td style="text-align: center;">بله</td>
<td style="text-align: left;">Today</td>
<td style="text-align: left;"><strong>تاریخ موثر حسابداری.</strong> تاریخی که پول واقعاً دریافت شده. سیستم باید چک کند این تاریخ در "دوره مالی بسته شده" نباشد.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>نوع دریافت</strong></td>
<td style="text-align: left;"><code>ReceiptType</code></td>
<td style="text-align: left;">Enum</td>
<td style="text-align: center;">بله</td>
<td style="text-align: left;">Customer</td>
<td style="text-align: left;">تعیین کننده رفتار تب‌های پایین (تخصیص فاکتور یا سفارش). مقادیر: دریافت مشتری / پیش‌دریافت / درآمد متفرقه.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>بنگاه اقتصادی</strong></td>
<td style="text-align: left;"><code>LegalEntityID</code></td>
<td style="text-align: left;">FK</td>
<td style="text-align: center;">بله</td>
<td style="text-align: left;">Default</td>
<td style="text-align: left;">اگر شرکت هلدینگ است یا چند شعبه مستقل دارد، باید مشخص شود پول به حساب کدام شعبه واریز شده است.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>پرداخت‌کننده</strong></td>
<td style="text-align: left;"><code>PayerID</code></td>
<td style="text-align: left;">FK</td>
<td style="text-align: center;"><em>شرطی</em></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">اگر نوع دریافت "مشتری" یا "پیش‌دریافت" باشد، <strong>الزامی</strong> است. لیست باید فقط مشتریان "فعال" را نمایش دهد.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ارز</strong></td>
<td style="text-align: left;"><code>CurrencyID</code></td>
<td style="text-align: left;">FK</td>
<td style="text-align: center;">بله</td>
<td style="text-align: left;">IRR</td>
<td style="text-align: left;">ارز دریافتی. اگر ارزی غیر از ریال انتخاب شود، فیلد "نرخ ارز" فعال می‌شود.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>نرخ ارز</strong></td>
<td style="text-align: left;"><code>ExchangeRate</code></td>
<td style="text-align: left;">Decimal</td>
<td style="text-align: center;">بله</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">نرخ تبدیل ارز به ریال در روز دریافت. (برای محاسبه سود و زیان تسعیر ارز حیاتی است).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>مبلغ کل</strong></td>
<td style="text-align: left;"><code>TotalAmount</code></td>
<td style="text-align: left;">Decimal</td>
<td style="text-align: center;"><strong>بله</strong></td>
<td style="text-align: left;">0</td>
<td style="text-align: left;"><strong>مبلغ کنترل (Control Total).</strong> جمع کل پولی که کاربر ادعا می‌کند دریافت کرده است. این عدد باید با جمع اقلام پایین برابر شود.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>شرح سند</strong></td>
<td style="text-align: left;"><code>Description</code></td>
<td style="text-align: left;">Text</td>
<td style="text-align: center;">خیر</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">توضیحات تکمیلی برای سند حسابداری. (مثلاً: "واریزی آقای اکبری بابت قرارداد فاز ۲").</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="deep-dive">۲. تشریح منطق‌های هوشمند و پیچیده (Deep Dive)</h2>
<p>در اینجا سه فیلد چالش‌برانگیز سربرگ را با جزئیات بررسی می‌کنیم:</p>
<h3 id="docdate-vs-createddate">الف) منطق تاریخ دریافت (<code>DocDate</code>) vs تاریخ ثبت (<code>CreatedDate</code>)</h3>
<p>باید بین این دو تمایز قائل شوید:</p>
<ul>
<li><strong>تاریخ ثبت (System Date):</strong> تاریخی که کاربر پشت سیستم نشسته و تایپ می‌کند (مثلاً امروز ۱۸ آذر).</li>
<li><strong>تاریخ دریافت (Doc Date):</strong> تاریخی که پول واقعاً به حساب آمده (مثلاً فیش واریزی برای ۱۴ آذر است).</li>
<li><strong>قانون کنترلی:</strong> کاربر می‌تواند تاریخ دریافت را عقب‌تر بزند (Backdate)، اما سیستم باید چک کند که تاریخ انتخابی متعلق به <strong>«دوره مالی بسته شده»</strong> نباشد. اگر حسابدار ماه آبان را بسته است، کاربر نباید بتواند سندی با تاریخ ۲۵ آبان ثبت کند.</li>
</ul>
<h3 id="totalamount">ب) منطق مبلغ کل (<code>TotalAmount</code>) به عنوان "عدد کنترل"</h3>
<p>چرا این فیلد در هدر است و محاسبه نمی‌شود؟</p>
<ul>
<li><strong>رویکرد سنتی:</strong> کاربر پایین چک‌ها را وارد می‌کند، سیستم بالا جمع می‌زند.</li>
<li><strong>رویکرد حرفه‌ای (ERP):</strong> کاربر <strong>ابتدا</strong> مبلغ کل چک/پول نقدی که روی میزش هست را در هدر وارد می‌کند (مثلاً ۱۰۰ میلیون). سپس شروع به وارد کردن جزئیات می‌کند.<ul>
<li>اگر جمع جزئیات ۹۰ میلیون شد، سیستم خطا می‌دهد: <em>"۱۰ میلیون مغایرت دارید! (۱۰۰ انتظار - ۹۰ ثبت شده)"</em>.</li>
<li>این روش جلوی خطای تایپی و فراموشی اقلام را می‌گیرد.</li>
</ul>
</li>
</ul>
<h3 id="payerid">ج) منطق پرداخت‌کننده (<code>PayerID</code>) و نوع دریافت</h3>
<p>فیلد مشتری باید هوشمند باشد:</p>
<ol>
<li>اگر <code>ReceiptType = MiscIncome</code> (درآمد متفرقه) باشد، فیلد مشتری <strong>غیرفعال</strong> یا <strong>اختیاری</strong> می‌شود. (مثلاً سود بانکی مشتری خاصی ندارد).</li>
<li>اگر مشتری ارزی است (مثلاً مشتری صادراتی)، سیستم باید به صورت خودکار ارز (<code>CurrencyID</code>) را روی دلار/یورو ست کند.</li>
</ol>
<hr />
<h2 id="scenarios">۳. مثال‌های عملیاتی (Scenarios)</h2>
<p>برای اینکه تحلیل‌گر و برنامه‌نویس دقیقاً متوجه شوند کاربر چه چیزی می‌بیند:</p>
<h3 id="_14">مثال ۱: سناریوی روتین (دریافت چک بابت بدهی)</h3>
<p>کاربر یک چک ۵۰ میلیونی از "شرکت لبنیات کاله" دریافت کرده است.</p>
<ul>
<li><strong>نوع:</strong> دریافت از مشتری (<code>CustomerReceipt</code>)</li>
<li><strong>مشتری:</strong> شرکت کاله (<code>CUST-1002</code>)</li>
<li><strong>تاریخ:</strong> ۱۴۰۳/۰۹/۱۸</li>
<li><strong>مبلغ کل:</strong> ۵۰۰,۰۰۰,۰۰۰ ریال</li>
<li><strong>نتیجه:</strong> با انتخاب "کاله"، تب تخصیص فعال می‌شود و فاکتورهای باز کاله نمایش داده می‌شوند.</li>
</ul>
<h3 id="_15">مثال ۲: سناریوی ارزی (صادرات)</h3>
<p>کاربر ۱۰,۰۰۰ دلار حواله از یک مشتری در دبی دریافت کرده است.</p>
<ul>
<li><strong>مشتری:</strong> Trading LLC</li>
<li><strong>ارز:</strong> USD (دلار آمریکا)</li>
<li><strong>نرخ ارز:</strong> ۵۵۰,۰۰۰ (کاربر نرخ روز صرافی را وارد می‌کند).</li>
<li><strong>مبلغ کل:</strong> ۱۰,۰۰۰ (دقت کنید مبلغ به ارز اصلی وارد می‌شود).</li>
<li><strong>مبلغ ریالی (محاسباتی):</strong> ۵,۵۰۰,۰۰۰,۰۰۰ ریال (این عدد در پس‌زمینه برای سند حسابداری محاسبه می‌شود).</li>
</ul>
<h3 id="_16">مثال ۳: سناریوی اصلاحی (تاریخ گذشته)</h3>
<p>امروز (۱۸ آذر) متوجه شدیم یک واریزی در تاریخ ۱ آذر جا افتاده است.</p>
<ul>
<li><strong>تاریخ دریافت:</strong> ۱۴۰۳/۰۹/۰۱ (کاربر تاریخ را دستی عقب می‌کشد).</li>
<li><strong>هشدار سیستم:</strong> <em>"توجه: شما در حال ثبت سند در تاریخ گذشته هستید. آیا دوره مالی آذر باز است؟ بله. ادامه..."</em></li>
</ul>
<hr />
<h2 id="ui-wireframe">۴. طرح گرافیکی پیشنهادی (UI Wireframe)</h2>
<p>برای برنامه‌نویس فرانت‌اند (Front-end)، چیدمان هدر باید به این صورت باشد:</p>
<pre><code class="language-text">-----------------------------------------------------------------------------------------
|  شماره سند: [RCT-1403-1099] (قفل)     |   وضعیت: [ پیش‌نویس 🔽]   |   تاریخ: [ 1403/09/18 📅] |
-----------------------------------------------------------------------------------------
|  نوع دریافت: [ دریافت از مشتری 🔽]    |   مشتری/پرداخت‌کننده: [ شرکت فولاد مبارکه 🔍 ]      |
-----------------------------------------------------------------------------------------
|  بنگاه اقتصادی: [ شعبه مرکزی 🔽]      |   ارز: [ ریال 🔽]         |   نرخ: [ 1 ] (قفل)        |
-----------------------------------------------------------------------------------------
|  مبلغ کل دریافتی: [ 250,000,000 ] ریال  &lt;-- (کاربر اینجا تایپ می‌کند)                        |
|  * شرح: [ بابت تسویه فاکتورهای پروژه الف و کسورات قانونی                             ]      |
-----------------------------------------------------------------------------------------
</code></pre>
<h2 id="dev-faq">۵. سوالات متداول توسعه‌دهندگان (Dev FAQ)</h2>
<ul>
<li>
<p><strong>س: آیا کاربر می‌تواند بعد از <code>Post</code> شدن سند، شرح (<code>Description</code>) را عوض کند؟</strong></p>
<ul>
<li><strong>پاسخ:</strong> بله، معمولاً فیلد "شرح" تنها فیلدی است که حتی بعد از قطعی شدن سند، با دسترسی خاص قابل ویرایش است (چون اثر مالی ندارد)، اما بقیه فیلدهای هدر (مبلغ، تاریخ، مشتری) کاملاً قفل می‌شوند.</li>
</ul>
</li>
<li>
<p><strong>س: اگر نرخ ارز را تغییر دهیم، چه اتفاقی می‌افتد؟</strong></p>
<h2 id="draft_1">* <strong>پاسخ:</strong> اگر در حال ویرایش (Draft) هستید، با تغییر نرخ ارز، سیستم باید معادل ریالی سند را دوباره محاسبه کند. اگر فاکتورها ریالی باشند و دریافت دلاری، این نرخ برای محاسبه اینکه "چقدر از بدهی ریالی کسر شد" حیاتی است.</h2>
</li>
</ul>
<p>این بخش <strong>مغز متفکر</strong> سند دریافت است. اینجا جایی است که تعیین می‌کنیم پول ورودی دقیقاً چه سرنوشتی دارد.</p>
<p>در سیستم‌های حسابداری پیشرفته، ما فقط نمی‌خواهیم بدانیم "مشتری چقدر بدهکار است" (مانده حساب)؛ بلکه می‌خواهیم بدانیم <strong>"کدام فاکتورها هنوز پاس نشده‌اند" (Open Items).</strong> تب تخصیص وظیفه مدیریت این موضوع را دارد.</p>
<p>در ادامه، این تب را با جزئیات کامل، منطق رفتاری و مثال‌های عددی باز می‌کنم.</p>
<hr />
<h1 id="allocation-">تب ۱: تخصیص (Allocation) - جزئیات و منطق کامل</h1>
<h2 id="_17">۱. فلسفه تخصیص: "تهاتر یا لینک کردن؟"</h2>
<p>رفتار این تب کاملاً وابسته به این است که شما در هدر (Header) چه <strong>نوع دریافتی</strong> را انتخاب کرده‌اید. این تب به صورت هوشمند (Dynamic) تغییر چهره می‌دهد:</p>
<ul>
<li><strong>حالت A (دریافت مشتری):</strong> هدف <strong>«تهاتر» (Settlement)</strong> است. یعنی قلم‌خوردن بدهی‌های قبلی.</li>
<li><strong>حالت B (پیش‌دریافت):</strong> هدف <strong>«لینک کردن» (Linking)</strong> است. یعنی چسباندن پول به یک سفارش باز.</li>
</ul>
<hr />
<h2 id="a-invoice-allocation">۲. سناریو A: تخصیص به فاکتورها (Invoice Allocation)</h2>
<p><strong>(زمانی که <code>ReceiptType = CustomerReceipt</code> است)</strong></p>
<p>در این حالت، سیستم تمام فاکتورهایی که هنوز <strong>"مانده باز" (Open Balance)</strong> دارند را لیست می‌کند.</p>
<h3 id="grid-columns">ستون‌های جدول (Grid Columns)</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">عنوان ستون</th>
<th style="text-align: left;">توضیح و منطق</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>انتخاب (Check)</strong></td>
<td style="text-align: left;">تیک زدن فاکتورهایی که قرار است تسویه شوند.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>شماره فاکتور</strong></td>
<td style="text-align: left;">شماره مرجع (مثلاً <code>INV-1403-101</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>تاریخ فاکتور</strong></td>
<td style="text-align: left;">برای تشخیص قدیمی بودن بدهی (اصل FIFO).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>مبلغ کل فاکتور</strong></td>
<td style="text-align: left;">مبلغ نهایی فاکتور (شامل مالیات).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>مانده باز (Open)</strong></td>
<td style="text-align: left;">مبلغی که هنوز پرداخت نشده. (ممکن است بخشی قبلاً پرداخت شده باشد).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>مبلغ تخصیص (Allocated)</strong></td>
<td style="text-align: left;"><strong>(قابل ویرایش)</strong> مبلغی از این دریافت که بابت این فاکتور برمی‌داریم.</td>
</tr>
</tbody>
</table>
<h3 id="_18">مثال‌های عملیاتی (بسیار مهم)</h3>
<h4 id="clean-settlement">مثال ۱: تسویه کامل و چندگانه (Clean Settlement)</h4>
<blockquote>
<p><strong>وضعیت:</strong> مشتری دو فاکتور باز دارد:</p>
<ol>
<li>فاکتور A: مبلغ ۱۰۰ میلیون (مانده: ۱۰۰ م)</li>
<li>فاکتور B: مبلغ ۵۰ میلیون (مانده: ۵۰ م)</li>
</ol>
<p><strong>دریافت:</strong> مشتری یک چک <strong>۱۵۰ میلیونی</strong> می‌دهد.
<strong>عملکرد تب تخصیص:</strong></p>
<ul>
<li>کاربر مبلغ ۱۵۰ را در هدر می‌زند.</li>
<li>سیستم (یا کاربر) هر دو فاکتور را تیک می‌زند.</li>
<li><strong>نتیجه:</strong> مانده هر دو فاکتور <strong>صفر</strong> می‌شود و وضعیت آنها به <code>Closed</code> تغییر می‌کند.</li>
</ul>
</blockquote>
<h4 id="partial-payment">مثال ۲: پرداخت بخشی (Partial Payment)</h4>
<blockquote>
<p><strong>وضعیت:</strong> مشتری یک فاکتور باز دارد:</p>
<ol>
<li>فاکتور A: مبلغ ۲۰۰ میلیون.</li>
</ol>
<p><strong>دریافت:</strong> مشتری فعلاً <strong>۸۰ میلیون</strong> واریز می‌کند.
<strong>عملکرد تب تخصیص:</strong></p>
<ul>
<li>کاربر مبلغ ۸۰ را وارد می‌کند.</li>
<li>فاکتور A تیک می‌خورد.</li>
<li>در ستون "مبلغ تخصیص"، عدد <strong>۸۰,۰۰۰,۰۰۰</strong> درج می‌شود (نه ۲۰۰ میلیون).</li>
<li><strong>نتیجه:</strong> وضعیت فاکتور <code>Open</code> می‌ماند، اما "مانده باز" آن به <strong>۱۲۰ میلیون</strong> کاهش می‌یابد.</li>
</ul>
</blockquote>
<h4 id="over-payment">مثال ۳: اضافه پرداخت (Over-Payment)</h4>
<blockquote>
<p><strong>وضعیت:</strong> فاکتور باز:</p>
<ol>
<li>فاکتور A: مبلغ ۱۰۰ میلیون.</li>
</ol>
<p><strong>دریافت:</strong> مشتری اشتباهاً (یا عمداً برای خرید بعدی) <strong>۱۱۰ میلیون</strong> واریز می‌کند.
<strong>عملکرد تب تخصیص:</strong></p>
<ul>
<li>کاربر فاکتور A را انتخاب می‌کند. ستون تخصیص به صورت خودکار سقف را روی <strong>۱۰۰ میلیون</strong> قفل می‌کند (نمی‌توان ۱۱۰ تخصیص داد چون بدهی ۱۰۰ است).</li>
<li><strong>نتیجه:</strong><ul>
<li>۱۰۰ میلیون: صرف تسویه فاکتور A می‌شود.</li>
<li>۱۰ میلیون باقیمانده: سیستم آن را به عنوان <strong>"مبلغ تخصیص نیافته" (Unallocated)</strong> در نظر می‌گیرد و به عنوان <strong>پیش‌دریافت آزاد</strong> در حساب مشتری می‌نشاند.</li>
</ul>
</li>
</ul>
</blockquote>
<hr />
<h2 id="b-order-allocation">۳. سناریو B: تخصیص به سفارش فروش (Order Allocation)</h2>
<p><strong>(زمانی که <code>ReceiptType = AdvanceReceipt</code> است)</strong></p>
<p>در این حالت، لیستی از فاکتورها وجود ندارد (چون هنوز صادر نشده‌اند). سیستم لیست <strong>سفارش‌های فروش (Sales Orders)</strong> را می‌آورد.</p>
<h3 id="_19">تفاوت کلیدی با حالت قبلی</h3>
<p>در اینجا ما بدهی را "صاف" نمی‌کنیم (چون سفارشی که فاکتور نشده، بدهی مالی ندارد). ما فقط پول را <strong>رزرو</strong> می‌کنیم.</p>
<h3 id="_20">ستون‌های جدول</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">عنوان ستون</th>
<th style="text-align: left;">توضیح</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>شماره سفارش</strong></td>
<td style="text-align: left;">مثلاً <code>SO-1403-500</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>مبلغ کل سفارش</strong></td>
<td style="text-align: left;">ارزش تقریبی قرارداد.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>پیش‌دریافت‌های قبلی</strong></td>
<td style="text-align: left;">چقدر تا الان برای این سفارش پول گرفته‌ایم؟</td>
</tr>
<tr>
<td style="text-align: left;"><strong>مبلغ تخصیص (Link Amount)</strong></td>
<td style="text-align: left;">چه مقدار از پولِ فعلی را به این سفارش می‌چسبانیم؟</td>
</tr>
</tbody>
</table>
<h3 id="_21">مثال عملیاتی</h3>
<blockquote>
<p><strong>وضعیت:</strong> سفارش ساخت دستگاه (<code>SO-500</code>) به ارزش ۱ میلیارد تومان ثبت شده. هنوز فاکتوری صادر نشده.
<strong>دریافت:</strong> مشتری طبق قرارداد ۳۰٪ (۳۰۰ میلیون) پیش‌پرداخت می‌دهد.
<strong>عملکرد:</strong></p>
<ul>
<li>کاربر در تب تخصیص، سفارش <code>SO-500</code> را پیدا کرده و مبلغ ۳۰۰ میلیون را جلوی آن وارد می‌کند.</li>
<li><strong>نتیجه:</strong><ul>
<li>سند حسابداری: <code>بانک (بد) / پیش‌دریافت مشتریان (بس)</code></li>
<li>در دیتابیس: این ۳۰۰ میلیون با یک شناسه (<code>RefOrderID</code>) به سفارش ۵۰۰ لینک می‌شود.</li>
<li><strong>آینده:</strong> ماه بعد که فاکتورِ ۱ میلیاردی صادر شد، سیستم اتوماتیک می‌گوید: "این سفارش ۳۰۰ میلیون پیش‌دریافت دارد، آیا کسر کنم؟"</li>
</ul>
</li>
</ul>
</blockquote>
<hr />
<h2 id="ux-features">۴. ویژگی‌های هوشمند (UX Features)</h2>
<p>برای اینکه کاربر نهایی راحت کار کند، این قابلیت‌ها در تب تخصیص ضروری است:</p>
<ol>
<li>
<p><strong>دکمه "تخصیص خودکار" (Auto Allocate):</strong></p>
<ul>
<li>یک دکمه جادویی که اگر زده شود، سیستم بر اساس روش <strong>FIFO (اولین صادره، اولین وارده)</strong>، پول را از قدیمی‌ترین فاکتور شروع به پخش کردن می‌کند تا زمانی که پول تمام شود.</li>
</ul>
</li>
<li>
<p><strong>کنترل سقف (Validation):</strong></p>
<ul>
<li>سیستم نباید اجازه دهد کاربر در ستون "مبلغ تخصیص"، عددی بزرگتر از "مانده باز فاکتور" وارد کند.</li>
<li><em>فرمول:</em> <code>Allocated Amount &lt;= Open Balance</code></li>
</ul>
</li>
<li>
<p><strong>نمایش جمع‌ها (Footer Totals):</strong></p>
<ul>
<li>پایین گرید باید سه عدد نمایش داده شود:<ul>
<li><strong>کل بدهی انتخاب شده:</strong> (جمع ستون مانده فاکتورهای تیک خورده).</li>
<li><strong>کل تخصیص داده شده:</strong> (جمع ستونی که کاربر پر کرده).</li>
<li><strong>مانده آزاد (Unallocated):</strong> (مبلغ کل سند منهای مبلغ تخصیص). <em>این عدد باید صفر شود تا تخصیص کامل باشد.</em></li>
</ul>
</li>
</ul>
</li>
</ol>
<hr />
<h2 id="_22">۵. دیاگرام مفهومی (چطور پول پخش می‌شود؟)</h2>
<pre><code class="language-mermaid">graph TD
    M[مبلغ دریافتی: ۱۰۰ واحد] --&gt; Decision{نوع سند؟}

    Decision -- دریافت از مشتری --&gt; InvoiceLogic
    Decision -- پیش دریافت --&gt; OrderLogic

    subgraph &quot;سناریو A: تسویه فاکتور&quot;
    InvoiceLogic[لیست فاکتورها]
    InvoiceLogic --&gt; F1[فاکتور ۱: بدهی ۳۰]
    InvoiceLogic --&gt; F2[فاکتور ۲: بدهی ۵۰]
    InvoiceLogic --&gt; F3[فاکتور ۳: بدهی ۴۰]

    F1 --&gt; |تخصیص ۳۰| Settled1[تسویه کامل]
    F2 --&gt; |تخصیص ۵۰| Settled2[تسویه کامل]
    F3 --&gt; |تخصیص ۲۰| Partial[تسویه ناقص - مانده ۲۰]
    end

    subgraph &quot;سناریو B: لینک به سفارش&quot;
    OrderLogic[لیست سفارش‌ها]
    OrderLogic --&gt; O1[سفارش ۱۰۰۱]
    O1 --&gt; |لینک ۱۰۰ واحد| Linked[ذخیره به عنوان پیش‌دریافت مرتبط]
    end
</code></pre>
<hr />
<p>این تب یکی از فنی‌ترین و حساس‌ترین بخش‌های حسابداری پیمانکاری و فروش شرکتی (B2B) است. اگر این بخش درست طراحی نشود، حسابدار مجبور می‌شود ده‌ها سند دستی (Journal Voucher) جداگانه صادر کند.</p>
<p>در ادامه، فلسفه، انواع، مثال‌ها و منطق حسابداری این تب را به صورت جامع باز می‌کنم.</p>
<hr />
<h1 id="deductions-management">تب ۲: مدیریت کسورات (Deductions Management)</h1>
<h2 id="_23">۱. فلسفه و مشکل بیزینس</h2>
<p>در فروش‌های خرد (B2C)، وقتی شما یک نوشابه ۱۰ هزار تومانی می‌خرید، دقیقا ۱۰ هزار تومان کارت می‌کشید.
اما در فروش‌های کلان و پیمانکاری، فرمول متفاوت است:
$$\text{پول نقد دریافتی} \neq \text{مبلغ فاکتور}$$</p>
<p>معمولاً کارفرما (مشتری) طبق قانون یا قرارداد، بخشی از پول فاکتور را نگه می‌دارد.</p>
<ul>
<li><strong>سوال:</strong> اگر فاکتور ۱۰۰ میلیون است و مشتری ۸۰ میلیون واریز کرده، آن ۲۰ میلیون کجاست؟</li>
<li><strong>پاسخ غلط:</strong> مشتری هنوز ۲۰ میلیون بدهکار است. (خیر، مشتری تسویه کرده است).</li>
<li><strong>پاسخ صحیح:</strong> آن ۲۰ میلیون تبدیل به یک <strong>دارایی دیگر</strong> (مثل طلب از بیمه یا اداره مالیات) شده است. تب کسورات وظیفه ثبت این "تبدیل" را دارد.</li>
</ul>
<hr />
<h2 id="_24">۲. انواع کسورات و ماهیت حسابداری آن‌ها</h2>
<p>سیستم باید انواع زیر را به صورت پیش‌فرض (و قابل تعریف) پشتیبانی کند. نکته کلیدی <strong>«حساب معین» (GL Account)</strong> پشت هر نوع است:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">نوع کسورات</th>
<th style="text-align: left;">مثال درصد</th>
<th style="text-align: left;">ماهیت حسابداری</th>
<th style="text-align: left;">توضیح برای کاربر و تحلیل‌گر</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>۱. سپرده بیمه (SSO Retention)</strong></td>
<td style="text-align: left;">معمولاً ۱۶.۶۷٪ یا ۵٪</td>
<td style="text-align: left;"><strong>دارایی جاری</strong> <br> <em>(سپرده بیمه نزد پیمانکاران)</em></td>
<td style="text-align: left;">کارفرما این پول را نگه می‌دارد تا زمانی که ما «مفاصاحساب بیمه» را از تامین اجتماعی بگیریم و به او بدهیم. پس پول ما سوخت نشده، فقط گروگان است.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>۲. مالیات تکلیفی (Withholding Tax)</strong></td>
<td style="text-align: left;">معمولاً ۳٪ یا ۵٪</td>
<td style="text-align: left;"><strong>دارایی جاری</strong> <br> <em>(پیش‌پرداخت مالیات)</em></td>
<td style="text-align: left;">کارفرما این پول را مستقیماً به اداره دارایی می‌دهد. فیش آن برای ما حکم "پول نقد" را دارد چون از مالیات پایان سال ما کم می‌شود.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>۳. حسن انجام کار (Good Performance)</strong></td>
<td style="text-align: left;">معمولاً ۱۰٪</td>
<td style="text-align: left;"><strong>دارایی غیرجاری</strong> <br> <em>(سپرده حسن انجام کار)</em></td>
<td style="text-align: left;">کارفرما این مبلغ را تا پایان دوره گارانتی (مثلاً ۱ سال) نگه می‌دارد. اگر دستگاه خراب نشد، پول را پس می‌دهد.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>۴. تخفیف نقدی (Cash Discount)</strong></td>
<td style="text-align: left;">توافقی</td>
<td style="text-align: left;"><strong>هزینه</strong> <br> <em>(تخفیفات نقدی فروش)</em></td>
<td style="text-align: left;">این تنها موردی است که پول واقعاً "می‌سوزد". ما برای تسریع در دریافت پول، مبلغی را می‌بخشیم.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>۵. جریمه دیرکرد (Penalty)</strong></td>
<td style="text-align: left;">متغیر</td>
<td style="text-align: left;"><strong>هزینه</strong> <br> <em>(هزینه جرایم قراردادی)</em></td>
<td style="text-align: left;">اگر کالا را دیر تحویل داده باشیم و کارفرما جریمه کم کرده باشد.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>۶. کارمزد بانکی (Bank Charge)</strong></td>
<td style="text-align: left;">مبلغی</td>
<td style="text-align: left;"><strong>هزینه</strong> <br> <em>(هزینه خدمات بانکی)</em></td>
<td style="text-align: left;">وقتی مشتری هزینه حواله پایا/ساتنا را از اصل پول کم می‌کند.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="walkthrough">۳. سناریوی جامع و مثال عددی (Walkthrough)</h2>
<p>فرض کنید شرکت "تابان" یک صورت‌وضعیت (فاکتور) به مبلغ <strong>۱,۰۰۰,۰۰۰,۰۰۰ ریال (یک میلیارد)</strong> برای "پالایشگاه تهران" صادر کرده است.
پالایشگاه مبالغ زیر را کسر و مابقی را واریز می‌کند:</p>
<ol>
<li><strong>بیمه:</strong> ۱۶۷,۰۰۰,۰۰۰ ریال (۱۶.۶۷٪)</li>
<li><strong>مالیات:</strong> ۵۰,۰۰۰,۰۰۰ ریال (۵٪)</li>
<li><strong>حسن انجام کار:</strong> ۱۰۰,۰۰۰,۰۰۰ ریال (۱۰٪)</li>
<li><strong>تخفیف:</strong> ۳,۰۰۰,۰۰۰ ریال (گرد کردن مبلغ)</li>
</ol>
<p><strong>محاسبه:</strong>
<code>۱۰۰۰ (فاکتور) - ۱۶۷ - ۵۰ - ۱۰۰ - ۳ = ۶۸۰ میلیون ریال.</code>
پالایشگاه یک چک <strong>۶۸۰ میلیون تومانی</strong> می‌دهد.</p>
<h3 id="_25">نحوه ثبت در سیستم (توسط کاربر)</h3>
<ol>
<li><strong>هدر:</strong> کاربر مبلغ دریافتی را <strong>۶۸۰,۰۰۰,۰۰۰</strong> وارد می‌کند. (چون نقدینگی واقعی این است).</li>
<li><strong>تب ۱ (تخصیص):</strong> کاربر فاکتور یک میلیاردی را انتخاب می‌کند. در ستون "مبلغ تخصیص"، عدد <strong>۱,۰۰۰,۰۰۰,۰۰۰</strong> را وارد می‌کند.<ul>
<li><em>هشدار سیستم:</em> "شما می‌خواهید ۱ میلیارد بدهی را پاک کنید، اما فقط ۶۸۰ میلیون پول دادید. ۳۲۰ میلیون اختلاف دارید!"</li>
</ul>
</li>
<li><strong>تب ۲ (کسورات):</strong> کاربر اختلاف ۳۲۰ میلیونی را به ریز وارد می‌کند:</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align: left;">ردیف</th>
<th style="text-align: left;">نوع کسورات</th>
<th style="text-align: left;">حساب معین (پیشنهاد سیستم)</th>
<th style="text-align: left;">مبلغ (ریال)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">۱</td>
<td style="text-align: left;">سپرده بیمه</td>
<td style="text-align: left;">حساب سپرده‌های بیمه</td>
<td style="text-align: left;">۱۶۷,۰۰۰,۰۰۰</td>
</tr>
<tr>
<td style="text-align: left;">۲</td>
<td style="text-align: left;">مالیات تکلیفی</td>
<td style="text-align: left;">حساب پیش‌پرداخت مالیات</td>
<td style="text-align: left;">۵۰,۰۰۰,۰۰۰</td>
</tr>
<tr>
<td style="text-align: left;">۳</td>
<td style="text-align: left;">حسن انجام کار</td>
<td style="text-align: left;">حساب سپرده حسن انجام کار</td>
<td style="text-align: left;">۱۰۰,۰۰۰,۰۰۰</td>
</tr>
<tr>
<td style="text-align: left;">۴</td>
<td style="text-align: left;">تخفیف</td>
<td style="text-align: left;">هزینه تخفیفات</td>
<td style="text-align: left;">۳,۰۰۰,۰۰۰</td>
</tr>
<tr>
<td style="text-align: left;"><strong>جمع</strong></td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;"><strong>۳۲۰,۰۰۰,۰۰۰</strong></td>
</tr>
</tbody>
</table>
<ol>
<li><strong>تب ۳ (دریافت):</strong> چک ۶۸۰ میلیونی ثبت می‌شود.</li>
</ol>
<p><strong>نتیجه معادله تراز:</strong>
<code>۱۰۰۰ (تخصیص) = ۶۸۰ (چک) + ۳۲۰ (کسورات)</code> ✅</p>
<hr />
<h2 id="_26">۴. منطق فنی و دیتابیس (برای برنامه‌نویس)</h2>
<h3 id="-deductiontypes">۴-۱. جدول تنظیمات انواع کسورات (<code>DeductionTypes</code>)</h3>
<p>برای اینکه کاربر هر بار حساب معین را دستی انتخاب نکند، باید یک جدول تنظیمات داشته باشیم:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">ID</th>
<th style="text-align: left;">Title (عنوان)</th>
<th style="text-align: left;">DefaultGLAccount (حساب معین پیش‌فرض)</th>
<th style="text-align: left;">IsExpense (آیا هزینه است؟)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;">سپرده بیمه</td>
<td style="text-align: left;">10501 (دارایی)</td>
<td style="text-align: left;">False</td>
</tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: left;">تخفیف نقدی</td>
<td style="text-align: left;">50200 (هزینه)</td>
<td style="text-align: left;">True</td>
</tr>
</tbody>
</table>
<h3 id="-_2">۴-۲. رفتار فیلدها در تب کسورات</h3>
<ul>
<li><strong>نوع کسورات:</strong> Dropdown (از جدول بالا می‌خواند).</li>
<li><strong>حساب معین:</strong> به محض انتخاب نوع، حساب پیش‌فرض پر می‌شود اما کاربر می‌تواند آن را عوض کند.</li>
<li><strong>مبلغ:</strong> دستی وارد می‌شود.</li>
<li><strong>شرح:</strong> اختیاری (برای توضیحات تکمیلی مثل "کسر بابت عدم ارائه کلاه ایمنی").</li>
</ul>
<hr />
<h2 id="gl-entry">۵. سند حسابداری اتوماتیک (GL Entry)</h2>
<p>این بخش نشان می‌دهد چرا این تب حیاتی است. سیستم به جای یک ثبت ساده، یک سند مرکب (Compound Entry) می‌زند:</p>
<p><strong>آرتیکل سند:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">ماهیت</th>
<th style="text-align: left;">نام حساب</th>
<th style="text-align: left;">بدهکار (Dr)</th>
<th style="text-align: left;">بستانکار (Cr)</th>
<th style="text-align: left;">تحلیل</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;">موجودی بانک (چک)</td>
<td style="text-align: left;">680,000,000</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">پول واقعی</td>
</tr>
<tr>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;">سپرده بیمه نزد کارفرما</td>
<td style="text-align: left;">167,000,000</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">طلب ما از بیمه</td>
</tr>
<tr>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;">پیش‌پرداخت مالیات</td>
<td style="text-align: left;">50,000,000</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">طلب ما از دارایی</td>
</tr>
<tr>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;">سپرده حسن انجام کار</td>
<td style="text-align: left;">100,000,000</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">طلب بلندمدت ما</td>
</tr>
<tr>
<td style="text-align: left;">هزینه</td>
<td style="text-align: left;">هزینه تخفیفات</td>
<td style="text-align: left;">3,000,000</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">هزینه شناسایی شده</td>
</tr>
<tr>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;"><strong>حساب‌های دریافتنی (پالایشگاه)</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>1,000,000,000</strong></td>
<td style="text-align: left;"><strong>تسویه کامل بدهی</strong></td>
</tr>
</tbody>
</table>
<p><strong>نکته نهایی:</strong> اگر تب کسورات وجود نداشت، حسابدار مجبور بود فقط ۶۸۰ میلیون را سند بزند و حساب پالایشگاه ۳۲۰ میلیون <strong>بدهکار کاذب</strong> می‌ماند که بعداً باید با سندهای دستی اصلاح می‌شد. این تب، حسابداری را اتوماتیک و دقیق می‌کند.</p>
<hr />
<p>این بخش، <strong>«ویترین نقدینگی»</strong> سیستم است. پس از اینکه مشخص کردیم پول بابت کدام فاکتور است (تب ۱) و چقدر کسورات داشته (تب ۲)، در <strong>تب ۳</strong> باید فیزیکِ پول را تعیین تکلیف کنیم.</p>
<p>در واقع، این تب پاسخ به سوال مدیر مالی است: <em>"این پولی که ثبت کردی، الان دقیقاً کجاست؟ در گاوصندوق است؟ در بانک نشسته؟ یا یک کاغذ (چک) است که ۶ ماه دیگر پول می‌شود؟"</em></p>
<hr />
<h1 id="payment-instruments">تب ۳: روش‌های دریافت (Payment Instruments)</h1>
<h2 id="_27">۱. فلسفه و منطق حاکم</h2>
<p>این تب تعیین‌کننده <strong>«سمت بدهکار سند» (Debit Side)</strong> است.
برخلاف تب ۱ و ۲ که از حساب مشتری (بستانکار) کم می‌کردند، این تب دارایی‌های نقد و شبه‌نقد ما را زیاد می‌کند.</p>
<h3 id="golden-rule">قانون طلایی (Golden Rule)</h3>
<p>سیستم باید یک اعتبارسنجی سخت‌گیرانه داشته باشد:</p>
<blockquote>
<p><strong>جمع مبالغ ردیف‌های این تب = مبلغ کل دریافتی (Total Receipt Amount) در هدر</strong></p>
</blockquote>
<p>اگر مبلغ هدر ۱۰۰ میلیون است، کاربر نمی‌تواند اینجا ۹۰ میلیون چک و ۵ میلیون نقد ثبت کند. باید دقیقاً ۱۰۰ میلیون را توجیه کند.</p>
<hr />
<h2 id="instrument-types">۲. انواع ابزار پرداخت (Instrument Types)</h2>
<p>سیستم باید ۴ روش اصلی را پشتیبانی کند. با انتخاب هر روش، فیلدهای خاص آن ظاهر می‌شوند:</p>
<h3 id="cheque-pdc">الف) چک دریافتی (Cheque / PDC)</h3>
<p><strong>پیچیده‌ترین و مهم‌ترین نوع در ایران.</strong> چک، "پول" نیست؛ بلکه "اسناد دریافتنی" است.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">نام فیلد</th>
<th style="text-align: left;">الزامی</th>
<th style="text-align: left;">توضیحات و منطق سیستم</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>مبلغ چک</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;">مبلغ روی برگه چک.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>شناسه صیادی</strong></td>
<td style="text-align: left;"><strong>بله</strong></td>
<td style="text-align: left;"><code>SayadID</code>. فیلد ۱۶ رقمی. <strong>کنترل:</strong> سیستم باید با الگوریتم «لهم» چک کند و همچنین بررسی کند این چک قبلاً در سیستم ثبت نشده باشد (جلوگیری از تقلب).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>تاریخ سررسید</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;"><code>DueDate</code>. تاریخ نقد شدن چک. بسیار حیاتی برای گزارش "جریان نقدینگی" (Cash Flow).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>شماره سریال</strong></td>
<td style="text-align: left;">خیر</td>
<td style="text-align: left;">شماره قدیمی چک (سری/سریال) برای بایگانی فیزیکی.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>بانک و شعبه</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;">بانک صادرکننده (مثلاً صادرات شعبه بازار).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>صاحب حساب</strong></td>
<td style="text-align: left;">خیر</td>
<td style="text-align: left;">نام شخصی که چک را امضا کرده. (مفید برای وقتی که مشتری، چکِ شخص ثالث (خرج شده) به ما می‌دهد).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>صندوق مقصد</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;">این برگه چک فیزیکی در کدام گاوصندوق/کشوی شرکت نگهداری می‌شود؟</td>
</tr>
</tbody>
</table>
<h3 id="bank-transfer">ب) واریز بانکی / حواله (Bank Transfer)</h3>
<p>پول‌هایی که با ساتنا، پایا، کارت‌به‌کارت یا واریز فیش نقدی به حساب شرکت می‌آیند.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">نام فیلد</th>
<th style="text-align: left;">الزامی</th>
<th style="text-align: left;">توضیحات و منطق سیستم</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>مبلغ واریزی</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;">مبلغی که دقیقاً به حساب نشسته است.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>حساب مقصد</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;"><code>TargetBankAccount</code>. پول به کدام حساب شرکت واریز شده؟ (مثلاً جاری ملت).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>شماره پیگیری</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;"><code>TraceNo</code>. شماره ارجاع/فیش. <strong>کنترل:</strong> یکتایی شماره پیگیری در آن بانک خاص.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>تاریخ مؤثر</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;">تاریخی که پول در پرینت بانک دیده می‌شود (گاهی با تاریخ ثبت فرق دارد).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>شبای واریزکننده</strong></td>
<td style="text-align: left;">خیر</td>
<td style="text-align: left;">برای کنترل‌های پولشویی و اطمینان از اینکه پول از حساب خود مشتری آمده است.</td>
</tr>
</tbody>
</table>
<h3 id="pos">ج) دستگاه کارت‌خوان (POS)</h3>
<p>فروش‌های حضوری یا تسویه در محل.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">نام فیلد</th>
<th style="text-align: left;">الزامی</th>
<th style="text-align: left;">توضیحات و منطق سیستم</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>مبلغ تراکنش</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;">مبلغ کشیده شده.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ترمینال پوز</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;">انتخاب دستگاه پوز. (هر پوز در تنظیمات به یک حساب بانکی متصل است).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>شماره مرجع</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;"><code>RRN</code>. کد ۱۲ رقمی روی رسید کاغذی پوز.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>کارمزد شاپرک</strong></td>
<td style="text-align: left;">خیر</td>
<td style="text-align: left;">(جدید) مبلغی که شاپرک از ما کم کرده (اگر تنظیم شده باشد که کارمزد را جدا ثبت کنیم).</td>
</tr>
</tbody>
</table>
<h3 id="cash">د) دریافت نقدی (Cash)</h3>
<p>دریافت اسکناس (ریال/دلار).</p>
<table>
<thead>
<tr>
<th style="text-align: left;">نام فیلد</th>
<th style="text-align: left;">الزامی</th>
<th style="text-align: left;">توضیحات و منطق سیستم</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>مبلغ</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;">ارزش اسکناس‌ها.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>صندوق مقصد</strong></td>
<td style="text-align: left;">بله</td>
<td style="text-align: left;"><code>TargetSafe</code>. پول در کدام صندوق (تنخواه) قرار گرفت؟</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="complex-scenario">۳. مثال جامع ترکیبی (Complex Scenario)</h2>
<p>فرض کنید شرکت "فولاد مبارکه" باید <strong>۱ میلیارد تومان</strong> به ما بدهد.
مسئول مالی آن‌ها می‌گوید: "۵۰۰ تومن رو چک میدم برای ۲ ماه دیگه، ۳۰۰ تومن رو الان پایا می‌کنم، ۲۰۰ تومن هم کارت می‌کشم."</p>
<p><strong>نحوه ثبت در تب ۳:</strong></p>
<p><strong>ردیف ۱ (چک):</strong></p>
<ul>
<li><strong>نوع:</strong> چک دریافتی</li>
<li><strong>مبلغ:</strong> ۵,۰۰۰,۰۰۰,۰۰۰ ریال</li>
<li><strong>صیاد:</strong> ۱۲۳۴...</li>
<li><strong>سررسید:</strong> ۱۴۰۳/۱۱/۲۰</li>
<li><strong>محل:</strong> صندوق امانات شرکت</li>
</ul>
<p><strong>ردیف ۲ (حواله):</strong></p>
<ul>
<li><strong>نوع:</strong> واریز بانکی</li>
<li><strong>مبلغ:</strong> ۳,۰۰۰,۰۰۰,۰۰۰ ریال</li>
<li><strong>حساب:</strong> جاری بانک تجارت</li>
<li><strong>شماره پیگیری:</strong> ۸۸۹۹۶۶</li>
</ul>
<p><strong>ردیف ۳ (پوز):</strong></p>
<ul>
<li><strong>نوع:</strong> کارت‌خوان</li>
<li><strong>مبلغ:</strong> ۲,۰۰۰,۰۰۰,۰۰۰ ریال</li>
<li><strong>ترمینال:</strong> پوز بانک ملت (واحد فروش)</li>
<li><strong>شماره مرجع:</strong> ۵۵۴۴۱۱</li>
</ul>
<p><strong>کنترل سیستم:</strong>
<code>۵۰۰ + ۳۰۰ + ۲۰۰ = ۱۰۰۰</code> (برابر با مبلغ کل). ✅ اجازه ثبت داده می‌شود.</p>
<hr />
<h2 id="gl-impact_3">۴. چرخه حیات و اثر حسابداری (GL Impact)</h2>
<p>نکته کلیدی برای برنامه‌نویسان و حسابداران این است که هر روش، یک حساب معین متفاوت را درگیر می‌کند:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">روش دریافت</th>
<th style="text-align: left;">حساب بدهکار (Dr)</th>
<th style="text-align: left;">توضیح فنی</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>چک</strong></td>
<td style="text-align: left;"><strong>اسناد دریافتنی نزد صندوق</strong></td>
<td style="text-align: left;">این حساب "شبه نقد" است. هنوز پول نیست. بعداً با عملیات "واگذاری به بانک"، از این حساب خارج می‌شود.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>واریز بانکی</strong></td>
<td style="text-align: left;"><strong>موجودی بانک</strong></td>
<td style="text-align: left;">مستقیماً موجودی قابل برداشت را زیاد می‌کند.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>کارت‌خوان</strong></td>
<td style="text-align: left;"><strong>حساب‌های در جریان وصول (Settlement)</strong> <br> <em>یا</em> <strong>موجودی بانک</strong></td>
<td style="text-align: left;">معمولاً پول پوز فردا صبح به حساب می‌نشیند. برخی شرکت‌ها مستقیم به بانک می‌زنند، برخی به حساب واسط "شاپرک".</td>
</tr>
<tr>
<td style="text-align: left;"><strong>نقد</strong></td>
<td style="text-align: left;"><strong>موجودی نقد / صندوق</strong></td>
<td style="text-align: left;">موجودی فیزیکی شرکت را زیاد می‌کند.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="pro-tips">۵. نکات ریز اما حیاتی (Pro Tips)</h2>
<ol>
<li>
<p><strong>مدیریت چک‌های امانی (Guarantee Cheques):</strong></p>
<ul>
<li>گاهی چک بابت "ضمانت" گرفته می‌شود نه پرداخت.</li>
<li><strong>راهکار:</strong> یک چک‌باکس <code>IsGuarantee</code> در فرم چک بگذارید. اگر تیک خورد، سند حسابداری آن متفاوت خواهد بود (حساب‌های انتظامی) و از مبلغ بدهی مشتری کم نمی‌کند.</li>
</ul>
</li>
<li>
<p><strong>دریافت چک‌های متعدد (Batch Entry):</strong></p>
<ul>
<li>گاهی مشتری ۱۰ فقره چک متوالی می‌دهد.</li>
<li><strong>ویژگی UX:</strong> دکمه‌ای به نام "تولید خودکار چک" بگذارید که بگوید: "۱۰ چک، هر کدام ۵۰ میلیون، تاریخ‌ها ماه به ماه". سیستم خودش ۱۰ ردیف تولید کند.</li>
</ul>
</li>
<li>
<p><strong>تصویر چک:</strong></p>
<ul>
<li>حتماً امکان آپلود عکس چک (پشت و رو) را در همین تب (کنار هر ردیف) فراهم کنید. این برای پیگیری‌های حقوقی بعدی نجات‌بخش است.</li>
</ul>
</li>
</ol>
<hr />
<p>این بخش، نقش <strong>«پلیس دروازه‌بان»</strong> سیستم را بازی می‌کند.
اگر زیباترین رابط کاربری را داشته باشید اما کنترل‌های امنیتی (Validations) ضعیف باشند، دیتابیس شما پر از زباله (Dirty Data)، مغایرت مالی و حتی کلاهبرداری خواهد شد.</p>
<p>کنترل‌ها در سیستم ERP تابان به دو دسته تقسیم می‌شوند:
1.  <strong>خطاهای بازدارنده (Hard Stop):</strong> کاربر به هیچ وجه نمی‌تواند عبور کند (مثل عدم تراز سند).
2.  <strong>هشدارهای هوشمند (Soft Warning):</strong> سیستم اخطار می‌دهد اما با تایید کاربر رد می‌شود (مثل سقف اعتبار).</p>
<p>در ادامه، ۵ قانون حیاتی را با جزئیات و مثال‌های واقعی بررسی می‌کنیم.</p>
<hr />
<h1 id="validation-rules">۵. کنترل‌های امنیتی و هوشمند (Validation Rules)</h1>
<h2 id="-accounting-balance-check">۵-۱. قانون طلایی: معادله تراز سند (Accounting Balance Check)</h2>
<p><strong>نوع:</strong> بازدارنده (Error) ⛔</p>
<p>این مهم‌ترین قانون سیستم است. دکمه <code>Post</code> (تایید نهایی) باید غیرفعال باشد مگر اینکه این تساوی ریاضی برقرار باشد. سیستم نباید اجازه دهد حتی ۱ ریال اختلاف وجود داشته باشد.</p>
<h3 id="_28">فرمول ریاضی:</h3>
<p>$$\text{مبلغ تخصیص داده شده به بدهی‌ها} = (\text{جمع پول و چک دریافتی}) + (\text{جمع کسورات ثبت شده})$$</p>
<h3 id="_29">مثال تخلف:</h3>
<ul>
<li><strong>بدهکار:</strong> مشتری فاکتوری به مبلغ <strong>۱۰۰ میلیون</strong> دارد.</li>
<li><strong>دریافت:</strong> مشتری <strong>۹۰ میلیون</strong> چک می‌دهد.</li>
<li><strong>کاربر:</strong> در تب تخصیص، جلوی فاکتور ۱۰۰ میلیونی عدد <strong>۱۰۰ میلیون</strong> را وارد می‌کند (می‌خواهد کل بدهی را پاک کند) اما در تب کسورات چیزی وارد نمی‌کند.</li>
<li><strong>واکنش سیستم:</strong>
    &gt; ❌ <strong>خطای عدم تراز:</strong> شما قصد تسویه ۱۰۰ میلیون بدهی را دارید، اما منابع شما (۹۰ میلیون چک) کافی نیست. اختلاف: ۱۰ میلیون ریال. لطفاً یا مبلغ تخصیص را کم کنید یا کسورات (مثل مالیات/تخفیف) را ثبت کنید.</li>
</ul>
<hr />
<h2 id="-duplicate-check">۵-۲. کنترل یکتایی اسناد (Duplicate Check)</h2>
<p><strong>نوع:</strong> بازدارنده (Error) ⛔</p>
<p>جلوگیری از ثبت تکراری یک چک یا فیش واریزی در سیستم. این کنترل باید <strong>Global</strong> باشد (یعنی در کل دیتابیس و بین همه شعبه‌ها چک شود).</p>
<h3 id="_30">سناریوی تقلب/اشتباه:</h3>
<p>یک چک ۵۰ میلیونی قبلاً بابت فاکتور A ثبت شده است. دو ماه بعد، حسابدار جدید (یا کاربر بدطینت) سعی می‌کند همان شماره چک را بابت فاکتور B وارد کند تا بدهی مشتری را ظاهراً تسویه کند.</p>
<h3 id="_31">منطق سیستم:</h3>
<p>هنگام ورود اطلاعات در تب ۳ (روش‌های دریافت):
1.  <strong>برای چک:</strong> ترکیب <code>SayadID</code> (شناسه صیادی) باید در کل جدول چک‌های سیستم یکتا باشد.
2.  <strong>برای واریز:</strong> ترکیب <code>TraceNo</code> (شماره پیگیری) + <code>BankID</code> (بانک مقصد) + <code>Amount</code> باید یکتا باشد. (چون ممکن است شماره پیگیری تصادفاً تکراری باشد، اما احتمال اینکه مبلغ و بانک هم یکی باشند صفر است).</p>
<hr />
<h2 id="-allocation-over-cap">۵-۳. کنترل سقف تخصیص (Allocation Over-Cap)</h2>
<p><strong>نوع:</strong> بازدارنده (Error) ⛔</p>
<p>سیستم نباید اجازه دهد کاربر بیشتر از "مانده بدهی واقعی"، پولی را به یک فاکتور تخصیص دهد (مگر اینکه ماژول اجازه Over-payment را بدهد که آن هم باید به پیش‌دریافت برود، نه اینکه بدهی را منفی کند).</p>
<h3 id="_32">مثال:</h3>
<ul>
<li><strong>فاکتور:</strong> ۱۰ میلیون تومان.</li>
<li><strong>پرداخت قبلی:</strong> ۴ میلیون تومان.</li>
<li><strong>مانده فعلی:</strong> ۶ میلیون تومان.</li>
<li><strong>اقدام کاربر:</strong> کاربر سعی می‌کند در ستون "مبلغ تخصیص"، عدد ۷ میلیون تومان وارد کند.</li>
<li><strong>واکنش سیستم:</strong>
    &gt; ❌ <strong>خطای سقف تخصیص:</strong> حداکثر مبلغ قابل تخصیص به این فاکتور ۶,۰۰۰,۰۰۰ ریال است.</li>
</ul>
<hr />
<h2 id="-period-control">۵-۴. کنترل دوره مالی و تاریخ (Period Control)</h2>
<p><strong>نوع:</strong> بازدارنده (Error) ⛔</p>
<p>حسابداری یک موجود زنده با بازه‌های زمانی (ماهانه/سالانه) است.</p>
<h3 id="_33">سناریو:</h3>
<p>امروز ۱۸ آذر است. مدیر مالی حساب‌های ماه "آبان" را بسته و گزارش سود و زیان را به هیئت مدیره داده است.
کاربر سعی می‌کند یک سند دریافت با تاریخ ۲۵ آبان ثبت کند.</p>
<h3 id="_34">منطق سیستم:</h3>
<ol>
<li>تاریخ سند (<code>DocDate</code>) را می‌خواند.</li>
<li>به جدول <code>FinancialPeriods</code> مراجعه می‌کند.</li>
<li>اگر وضعیت ماه آبان <code>Closed</code> یا <code>Locked</code> باشد:
    &gt; ❌ <strong>خطای دوره مالی:</strong> دوره مالی منتهی به ۳۰ آبان بسته شده است. شما مجاز به صدور سند در این تاریخ نیستید.</li>
</ol>
<hr />
<h2 id="-credit-limit-logic">۵-۵. کنترل اعتبار مشتری (Credit Limit Logic)</h2>
<p><strong>نوع:</strong> هشدار (Warning) ⚠️</p>
<p>این کنترل کمی ظریف است. در "فروش"، سقف اعتبار مانع صدور فاکتور می‌شود. اما در "دریافت"، ما داریم پول می‌گیریم! پس چرا باید مانع شویم؟
پاسخ: اگر دریافت <strong>«چک»</strong> باشد.</p>
<p>چک، پول نقد نیست. چک، یک "وعده" است. اگر مشتری ۱ میلیارد سقف اعتبار دارد و تا الان ۵۰۰ میلیون بدهی دارد، و امروز یک چک ۲ میلیاردی می‌دهد:
1.  بدهی دفتری او صفر می‌شود (و حتی بستانکار می‌شود).
2.  سیستم فروش اجازه می‌دهد کالای جدید ببرد.
3.  اما چک او ۲ ماه دیگر پاس نمی‌شود!</p>
<h3 id="_35">منطق هوشمند:</h3>
<ul>
<li><strong>فرمول ریسک:</strong> <code>مانده حساب</code> + <code>اسناد دریافتنی وصول نشده (چک‌های در راه)</code> &gt; <code>سقف اعتبار</code></li>
<li><strong>واکنش سیستم:</strong>
    &gt; ⚠️ <strong>هشدار ریسک اعتباری:</strong> دریافت این چک باعث می‌شود تعهدات مشتری (شامل چک‌های پاس نشده) از سقف اعتبار او تجاوز کند. آیا مطمئن هستید؟ (نیاز به تایید مدیر).</li>
</ul>
<hr />
<h2 id="-cross-field-validations">۵-۶. کنترل‌های متقابل (Cross-Field Validations)</h2>
<p>این‌ها قوانین کوچک اما مهمی هستند که فیلدها را نسبت به هم می‌سنجند:</p>
<ol>
<li><strong>ارز و نرخ:</strong> اگر <code>Currency</code> ≠ ریال باشد، فیلد <code>ExchangeRate</code> نمی‌تواند ۱ یا ۰ یا خالی باشد.</li>
<li><strong>تاریخ سررسید چک:</strong> <code>DueDate</code> چک نباید قبل از <code>DocDate</code> (تاریخ دریافت) باشد. (چک تاریخ گذشته معنی ندارد، مگر در شرایط خاص که سیستم باید هشدار دهد).</li>
<li><strong>الزام فیلد:</strong> اگر نوع دریافت "چک" است، فیلد "شناسه صیادی" اجباری است. اگر نوع دریافت "نقد" است، فیلد "شناسه صیادی" باید غیرفعال/خالی باشد.</li>
</ol>
<hr />
<h3 id="system-messages">جدول خلاصه پیام‌های سیستم (System Messages)</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">کد خطا</th>
<th style="text-align: left;">متن پیام</th>
<th style="text-align: left;">نوع</th>
<th style="text-align: left;">اقدام کاربر</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>VAL-001</strong></td>
<td style="text-align: left;">جمع اقلام تخصیص و روش‌های دریافت برابر نیست. اختلاف: [مبلغ]</td>
<td style="text-align: left;">Error</td>
<td style="text-align: left;">اصلاح مبالغ در تب ۳ یا ۱</td>
</tr>
<tr>
<td style="text-align: left;"><strong>VAL-002</strong></td>
<td style="text-align: left;">شناسه صیادی [شماره] قبلاً در سند [شماره سند] استفاده شده است.</td>
<td style="text-align: left;">Error</td>
<td style="text-align: left;">بررسی لاشه چک و اصلاح شماره</td>
</tr>
<tr>
<td style="text-align: left;"><strong>VAL-003</strong></td>
<td style="text-align: left;">دوره مالی تاریخ انتخابی بسته شده است.</td>
<td style="text-align: left;">Error</td>
<td style="text-align: left;">تغییر تاریخ سند به دوره جاری</td>
</tr>
<tr>
<td style="text-align: left;"><strong>WRN-001</strong></td>
<td style="text-align: left;">مبلغ چک از میانگین گردش حساب مشتری بالاتر است.</td>
<td style="text-align: left;">Warning</td>
<td style="text-align: left;">اخذ تاییدیه مدیر</td>
</tr>
<tr>
<td style="text-align: left;"><strong>WRN-002</strong></td>
<td style="text-align: left;">تاریخ سررسید چک مربوط به روز تعطیل رسمی است.</td>
<td style="text-align: left;">Warning</td>
<td style="text-align: left;">اطلاع به کاربر (جهت اطمینان)</td>
</tr>
</tbody>
</table>
<hr />
<p>این بخش، <strong>«لحظه حقیقت»</strong> در سیستم ERP است. تمام زحماتی که کاربر در وارد کردن اطلاعات (هدر، تخصیص، چک، کسورات) کشیده است، در نهایت باید تبدیل به یک <strong>«سند حسابداری» (Journal Entry)</strong> استاندارد شود تا ترازنامه شرکت شکل بگیرد.</p>
<p>در سیستم‌های سنتی، حسابدار این سند را دستی می‌زند (که پر از خطاست). در سیستم تابان، این سند <strong>خودکار</strong> صادر می‌شود.</p>
<p>در ادامه، موتور صدور سند را با ۴ سناریوی مختلف (از ساده تا بسیار پیچیده) کالبدشکافی می‌کنیم.</p>
<hr />
<h1 id="automated-gl-engine">۶. موتور صدور سند حسابداری (Automated GL Engine)</h1>
<p><strong>زمان اجرا:</strong> دقیقا لحظه‌ای که وضعیت سند از <code>Draft</code> به <code>Posted</code> تغییر می‌کند.
<strong>قانون کلی:</strong> مجموع ستون بدهکار (Dr) باید دقیقاً برابر با مجموع ستون بستانکار (Cr) باشد.</p>
<hr />
<h2 id="_36">سناریوی ۱: دریافت ساده (تسویه چک)</h2>
<p><strong>شرح:</strong> مشتری یک فاکتور ۵۰۰ میلیونی دارد و یک چک ۵۰۰ میلیونی می‌دهد. هیچ کسوراتی در کار نیست.</p>
<p><strong>تحلیل سیستم:</strong>
* بدهی مشتری باید صفر شود (پس حساب مشتری <strong>بستانکار</strong> می‌شود).
* یک برگه چک وارد صندوق شده (پس حساب اسناد دریافتنی <strong>بدهکار</strong> می‌شود).</p>
<table>
<thead>
<tr>
<th style="text-align: left;">ردیف</th>
<th style="text-align: left;">کد حساب (GL Code)</th>
<th style="text-align: left;">نام حساب (Account Name)</th>
<th style="text-align: left;">بدهکار (Dr)</th>
<th style="text-align: left;">بستانکار (Cr)</th>
<th style="text-align: left;">تحلیل سیستمی</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">۱</td>
<td style="text-align: left;">۱۰۲۰۱</td>
<td style="text-align: left;"><strong>اسناد دریافتنی نزد صندوق</strong></td>
<td style="text-align: left;">۵۰۰,۰۰۰,۰۰۰</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">دارایی جاری شرکت زیاد شد (چک).</td>
</tr>
<tr>
<td style="text-align: left;">۲</td>
<td style="text-align: left;">۱۰۳۰۱</td>
<td style="text-align: left;"><strong>حساب‌های دریافتنی تجاری</strong> (تفصیلی: مشتری X)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">۵۰۰,۰۰۰,۰۰۰</td>
<td style="text-align: left;">دارایی (طلب) شرکت کم شد / تسویه شد.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>جمع</strong></td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;"><strong>۵۰۰,۰۰۰,۰۰۰</strong></td>
<td style="text-align: left;"><strong>۵۰۰,۰۰۰,۰۰۰</strong></td>
<td style="text-align: left;">تراز ✅</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="-_3">سناریوی ۲: دریافت پیمانکاری (پیچیده - با کسورات و نقد/چک)</h2>
<p><strong>این سناریو قدرت واقعی سیستم شماست.</strong>
<strong>شرح:</strong>
* فاکتور صادره: <strong>۱,۰۰۰ واحد</strong> (شامل ارزش افزوده).
* کسورات مشتری: ۱۰۰ واحد حسن انجام کار + ۵۰ واحد مالیات + ۱۶۷ واحد بیمه.
* مبلغ قابل پرداخت: ۶۸۳ واحد.
* پرداخت شده با: ۴۰۰ واحد چک + ۲۸۳ واحد واریز به بانک.</p>
<p><strong>تحلیل سیستم:</strong>
سیستم باید بداند که گرچه مشتری ۶۸۳ واحد پول داده، اما کل ۱۰۰۰ واحد بدهی‌اش پاک شده است. مابه‌التفاوت به حساب‌های واسط می‌رود.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">ردیف</th>
<th style="text-align: left;">ماهیت</th>
<th style="text-align: left;">نام حساب</th>
<th style="text-align: left;">بدهکار (Dr)</th>
<th style="text-align: left;">بستانکار (Cr)</th>
<th style="text-align: left;">منبع داده در فرم</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">۱</td>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;"><strong>موجودی بانک ملت</strong></td>
<td style="text-align: left;">۲۸۳,۰۰۰,۰۰۰</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">تب ۳ (واریز)</td>
</tr>
<tr>
<td style="text-align: left;">۲</td>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;"><strong>اسناد دریافتنی نزد صندوق</strong></td>
<td style="text-align: left;">۴۰۰,۰۰۰,۰۰۰</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">تب ۳ (چک)</td>
</tr>
<tr>
<td style="text-align: left;">۳</td>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;"><strong>سپرده حسن انجام کار</strong></td>
<td style="text-align: left;">۱۰۰,۰۰۰,۰۰۰</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">تب ۲ (کسورات)</td>
</tr>
<tr>
<td style="text-align: left;">۴</td>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;"><strong>پیش‌پرداخت مالیات</strong></td>
<td style="text-align: left;">۵۰,۰۰۰,۰۰۰</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">تب ۲ (کسورات)</td>
</tr>
<tr>
<td style="text-align: left;">۵</td>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;"><strong>سپرده بیمه پیمانکاری</strong></td>
<td style="text-align: left;">۱۶۷,۰۰۰,۰۰۰</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">تب ۲ (کسورات)</td>
</tr>
<tr>
<td style="text-align: left;">۶</td>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;"><strong>حساب‌های دریافتنی تجاری</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>۱,۰۰۰,۰۰۰,۰۰۰</strong></td>
<td style="text-align: left;">تب ۱ (مبلغ تخصیص)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="advance-payment">سناریوی ۳: پیش‌دریافت (Advance Payment)</h2>
<p><strong>شرح:</strong> مشتری برای سفارشی که هنوز فاکتور نشده، ۲۰۰ میلیون واریز می‌کند.</p>
<p><strong>تحلیل سیستم:</strong>
* چون فاکتوری وجود ندارد، حساب "حساب‌های دریافتنی" نباید درگیر شود.
* پول دریافتی برای شرکت "درآمد" نیست، بلکه <strong>"بدهی به مشتری" (تعهد)</strong> است.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">ردیف</th>
<th style="text-align: left;">ماهیت</th>
<th style="text-align: left;">نام حساب</th>
<th style="text-align: left;">بدهکار (Dr)</th>
<th style="text-align: left;">بستانکار (Cr)</th>
<th style="text-align: left;">تحلیل سیستمی</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">۱</td>
<td style="text-align: left;">دارایی</td>
<td style="text-align: left;"><strong>موجودی بانک</strong></td>
<td style="text-align: left;">۲۰۰,۰۰۰,۰۰۰</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">پول وارد شد.</td>
</tr>
<tr>
<td style="text-align: left;">۲</td>
<td style="text-align: left;">بدهی جاری</td>
<td style="text-align: left;"><strong>پیش‌دریافت مشتریان</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">۲۰۰,۰۰۰,۰۰۰</td>
<td style="text-align: left;">تعهد ایجاد شد (Liability).</td>
</tr>
</tbody>
</table>
<p><strong>نکته فنی:</strong> سیستم در اینجا <code>RefOrderID</code> را در دیتابیس نگه می‌دارد، اما در سند حسابداری معمولاً فقط در شرح سند (Narration) می‌نویسد: "بابت سفارش شماره SO-100".</p>
<hr />
<h2 id="forex-gainloss">سناریوی ۴: دریافت ارزی و تسعیر (Forex Gain/Loss)</h2>
<p><strong>شرح:</strong>
* فاکتور صادره در تاریخ ۱ فروردین: <strong>۱۰,۰۰۰ دلار</strong> (نرخ ۵۰,۰۰۰ تومان) -&gt; بدهی مشتری: <strong>۵۰۰ میلیون ریال</strong>.
* دریافت پول در تاریخ ۱ خرداد: <strong>۱۰,۰۰۰ دلار</strong> (نرخ ۵۲,۰۰۰ تومان) -&gt; ارزش پول: <strong>۵۲۰ میلیون ریال</strong>.</p>
<p><strong>تحلیل سیستم:</strong>
مشتری ۱۰ هزار دلار داده و بدهی ۱۰ هزار دلاری‌اش صاف شده. اما در دفاتر ریالی ما، ۲۰ میلیون تومان "اضافه" آمده است. این پول از کجا آمده؟ <strong>سود ناشی از تسعیر ارز.</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">ردیف</th>
<th style="text-align: left;">نام حساب</th>
<th style="text-align: left;">بدهکار (Dr)</th>
<th style="text-align: left;">بستانکار (Cr)</th>
<th style="text-align: left;">فرمول محاسبه</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">۱</td>
<td style="text-align: left;"><strong>موجودی ارزی (بانک)</strong></td>
<td style="text-align: left;">۵۲۰,۰۰۰,۰۰۰</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">۱۰,۰۰۰ دلار × ۵۲,۰۰۰</td>
</tr>
<tr>
<td style="text-align: left;">۲</td>
<td style="text-align: left;"><strong>حساب‌های دریافتنی</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">۵۰۰,۰۰۰,۰۰۰</td>
<td style="text-align: left;">باید دقیقاً به اندازه بدهی اولیه بسته شود</td>
</tr>
<tr>
<td style="text-align: left;">۳</td>
<td style="text-align: left;"><strong>سود/زیان تسعیر ارز</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"><strong>۲۰,۰۰۰,۰۰۰</strong></td>
<td style="text-align: left;">نقش "تراز کننده" (Plug Figure)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="expense-handling">سناریوی ۵: کارمزد بانکی و تخفیف (Expense Handling)</h2>
<p><strong>شرح:</strong> مشتری باید ۱۰۰ میلیون می‌ریخت، اما ۹۹ میلیون ریخته و ۱ میلیون هزینه انتقال را کم کرده (یا تخفیف گرفته). ما می‌خواهیم حسابش کامل (۱۰۰) بسته شود.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">ردیف</th>
<th style="text-align: left;">نام حساب</th>
<th style="text-align: left;">بدهکار (Dr)</th>
<th style="text-align: left;">بستانکار (Cr)</th>
<th style="text-align: left;">تحلیل</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">۱</td>
<td style="text-align: left;"><strong>موجودی بانک</strong></td>
<td style="text-align: left;">۹۹,۰۰۰,۰۰۰</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">پول واقعی</td>
</tr>
<tr>
<td style="text-align: left;">۲</td>
<td style="text-align: left;"><strong>هزینه کارمزد بانکی</strong></td>
<td style="text-align: left;">۱,۰۰۰,۰۰۰</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">هزینه شناسایی شده</td>
</tr>
<tr>
<td style="text-align: left;">۳</td>
<td style="text-align: left;"><strong>حساب‌های دریافتنی</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">۱۰۰,۰۰۰,۰۰۰</td>
<td style="text-align: left;">تسویه کامل بدهی</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="gl-determination">بخش فنی: سیستم چگونه حساب‌ها را پیدا می‌کند؟ (GL Determination)</h2>
<p>برنامه‌نویسان می‌پرسند: <em>"سیستم از کجا می‌فهمد کد حساب بانک ملت چیست یا کد حساب پیش‌دریافت کدام است؟"</em>
ما نباید کدها را در برنامه Hard-code کنیم. سیستم از <strong>«ماتریس تنظیمات حسابداری»</strong> استفاده می‌کند:</p>
<ol>
<li><strong>حساب بانک:</strong> از تنظیمات حساب بانکی انتخاب شده در تب ۳ خوانده می‌شود (<code>BankAccount.GLCode</code>).</li>
<li><strong>حساب مشتری:</strong> از تنظیمات "گروه تفصیلی مشتری" خوانده می‌شود (<code>CustomerGroup.AccountReceivableGL</code>).</li>
<li><strong>کسورات:</strong> از تنظیمات "انوع کسورات" خوانده می‌شود (<code>DeductionType.GLAccount</code>).</li>
<li><strong>پیش‌دریافت:</strong> از تنظیمات کلی سیستم فروش خوانده می‌شود (<code>SystemSettings.Sales.AdvanceGL</code>).</li>
</ol>
<h3 id="_37">دیاگرام منطق صدور سند</h3>
<p>این دیاگرام نشان می‌دهد که:
* مبالغ <strong>تب ۳ (دریافت‌ها)</strong> ---&gt; همیشه به سمت <strong>بدهکار (Dr)</strong> می‌روند.
* مبالغ <strong>تب ۲ (کسورات)</strong> ---&gt; همیشه به سمت <strong>بدهکار (Dr)</strong> می‌روند (چون دارایی یا هزینه هستند).
* مبلغ <strong>تب ۱ (تخصیص)</strong> ---&gt; همیشه به سمت <strong>بستانکار (Cr)</strong> می‌رود (کاهش بدهی مشتری).
* <strong>استثنا:</strong> اگر پیش‌دریافت باشد، سمت بستانکار حساب "پیش‌دریافت" است.</p>
<hr />
<p>این بخش <strong>«جعبه ابزار حل بحران»</strong> برای کاربران است. معمولاً کاربران وقتی به این بخش مراجعه می‌کنند که به مشکلی برخورده‌اند یا با سناریویی مواجه شده‌اند که در روال عادی نمی‌گنجد.</p>
<p>بخش FAQ را به سه دسته کلیدی تقسیم کرده‌ام: <strong>۱. اصلاحات و اشتباهات، ۲. سناریوهای خاص مالی، ۳. سوالات فنی و سیستمی.</strong></p>
<hr />
<h1 id="faq-troubleshooting">۷. پرسش‌های متداول و سناریوهای خاص (FAQ &amp; Troubleshooting)</h1>
<h2 id="-corrections">۷-۱. اصلاحات و خطاهای کاربری (Corrections)</h2>
<p><strong>س ۱: سندی را «قطعی» (Post) کرده‌ام، اما متوجه شدم مبلغ آن اشتباه تایپ شده است (مثلاً ۱۰ میلیون را ۱۰۰ میلیون زدم). آیا می‌توانم ویرایش کنم؟</strong>
* <strong>پاسخ:</strong> خیر. طبق اصول استاندارد حسابداری و برای حفظ امنیت داده‌ها، سند قطعی شده هرگز ویرایش نمی‌شود.
* <strong>راهکار:</strong> باید از دکمه <strong>«ابطال» (Void)</strong> استفاده کنید.
    * <strong>رفتار سیستم:</strong> با زدن ابطال، سیستم یک سند حسابداری قرینه (معکوس) صادر می‌کند تا اثر مالی سند غلط کاملاً خنثی شود. سپس باید یک سند دریافت جدید با مبلغ صحیح صادر کنید.
    * <em>مثال:</em> سند اشتباه (بانک بدهکار ۱۰۰). سند ابطال (بانک بستانکار ۱۰۰). سند صحیح جدید (بانک بدهکار ۱۰).</p>
<p><strong>س ۲: تاریخ سند را اشتباه زده‌ام، اما هنوز سند در حالت «پیش‌نویس» (Draft) است. آیا مشکلی دارد؟</strong>
* <strong>پاسخ:</strong> خیر، تا زمانی که سند <code>Draft</code> است، می‌توانید تاریخ، مبلغ و همه چیز را تغییر دهید.
* <strong>نکته:</strong> اگر تاریخ را تغییر دادید، حتماً دکمه "بروزرسانی نرخ ارز" (در صورت ارزی بودن) را بزنید تا نرخ روز جدید اعمال شود.</p>
<p><strong>س ۳: مشتری چک را داد و ما ثبت کردیم. بعد از ۲ روز مشتری تماس گرفت و گفت "چک را نقد نکنید، بیایید با پول نقد عوض کنیم". چه کنیم؟</strong>
* <strong>پاسخ:</strong> دو حالت دارد:
    1.  <strong>اگر چک هنوز در صندوق است:</strong> سند دریافت را <strong>ابطال</strong> کنید و یک سند جدید با نوع "دریافت نقد/واریز" ثبت کنید.
    2.  <strong>اگر چک را به بانک واگذار کرده‌اید:</strong> دیگر نمی‌توانید سند دریافت را ابطال کنید. باید از طریق ماژول "استرداد چک" (Cheque Return) چک را به مشتری برگردانید و سپس یک سند دریافت جدید بابت پول نقد ثبت کنید.</p>
<hr />
<h2 id="-financial-scenarios">۷-۲. سناریوهای خاص مالی و بانکی (Financial Scenarios)</h2>
<p><strong>س ۴: مشتری مبلغی بیشتر از بدهی‌اش واریز کرده است (اضافه واریز). با مابقی پول چه کنم؟</strong>
* <strong>پاسخ:</strong> کل مبلغ دریافتی را در هدر وارد کنید. در تب تخصیص، فاکتورها را تسویه کنید.
* <strong>رفتار سیستم:</strong> سیستم به صورت هوشمند مابه‌التفاوت را تشخیص می‌دهد و آن را در حساب مشتری به عنوان <strong>«پیش‌دریافت / بستانکار»</strong> ثبت می‌کند.
* <em>مثال:</em> بدهی ۱۰۰ واحد، واریزی ۱۲۰ واحد.
    * ۱۰۰ واحد -&gt; تسویه فاکتور (Accounts Receivable).
    * ۲۰ واحد -&gt; پیش‌دریافت (Customer Advances).</p>
<p><strong>س ۵: مشتری چک "شخص ثالث" (چک خرجی) داده است. یعنی چک متعلق به خودش نیست. چگونه ثبت کنم؟</strong>
* <strong>پاسخ:</strong> برای سیستم مهم است که <strong>"بدهی چه کسی کم می‌شود"</strong>.
    * در هدر (فیلد <code>PayerID</code>)، نام <strong>مشتری خودتان</strong> را انتخاب کنید (چون می‌خواهیم حساب او تسویه شود).
    * در تب روش دریافت (ردیف چک)، فیلد <strong>«صاحب حساب» (Account Holder)</strong> را پر کنید و نام صاحبِ اصلیِ چک را بنویسید.
    * <em>فایده:</em> اگر چک برگشت خورد، سیستم حساب مشتری شما را بدهکار می‌کند، اما در گزارشات می‌نویسد که این چک متعلق به آقای X بوده است.</p>
<p><strong>س ۶: مالیات بر ارزش افزوده (VAT) کجاست؟ چرا فیلدی برای ثبت مالیات دریافتی نداریم؟</strong>
* <strong>پاسخ:</strong> مالیات در زمان <strong>«صدور فاکتور فروش»</strong> شناسایی و ثبت شده است.
    * وقتی فاکتور ۱۰۰ میلیونی صادر کردید (که ۹۰ تومن اصل و ۱۰ تومن مالیات بوده)، مشتری کلاً ۱۰۰ میلیون بدهکار شده است.
    * در سند دریافت، شما کل ۱۰۰ میلیون را می‌گیرید و بدهی را تسویه می‌کنید. نیازی به تفکیک مجدد مالیات نیست.</p>
<p><strong>س ۷: مشتری پول را واریز کرده اما می‌گوید "۵ هزار تومان هزینه کارت‌به‌کارت را شما بدهید". (یعنی ۵ هزار تومان کمتر ریخته).</strong>
* <strong>پاسخ:</strong>
    1.  مبلغ فاکتور: ۱,۰۰۰,۰۰۰ ریال.
    2.  مبلغ واریزی: ۹۹۵,۰۰۰ ریال.
    3.  در تب تخصیص: ۱,۰۰۰,۰۰۰ را انتخاب کنید.
    4.  در تب کسورات: مبلغ ۵,۰۰۰ ریال را با نوع <strong>«هزینه کارمزد بانکی»</strong> ثبت کنید.
    * <em>نتیجه:</em> حساب مشتری کامل بسته می‌شود و شرکت شما ۵۰۰۰ ریال هزینه شناسایی می‌کند.</p>
<hr />
<h2 id="-technical-logic">۷-۳. سوالات فنی و سیستمی (Technical &amp; Logic)</h2>
<p><strong>س ۸: چرا دکمه "تایید نهایی" (Post) غیرفعال یا خاکستری است؟</strong>
* <strong>پاسخ:</strong> سیستم کنترل تراز را انجام داده و مغایرت پیدا کرده است.
* <strong>چک‌لیست:</strong>
    1.  آیا جمع مبالغ تب "روش‌های دریافت" (چک+نقد) دقیقاً برابر با مبلغ هدر است؟
    2.  آیا جمع مبلغ "تخصیص داده شده" با (دریافتی + کسورات) برابر است؟
    3.  پیام خطای قرمز رنگ پایین صفحه را بخوانید.</p>
<p><strong>س ۹: آیا می‌توانم سند را بدون "تخصیص" ثبت کنم؟ (مثلاً وقت ندارم الان فاکتورها را پیدا کنم).</strong>
* <strong>پاسخ:</strong> بله.
    * اگر نوع دریافت را "دریافت از مشتری" انتخاب کنید و تب تخصیص را خالی بگذارید، کل مبلغ به عنوان <strong>«علی‌الحساب» (On Account)</strong> در حساب مشتری ثبت می‌شود.
    * <em>نکته:</em> توصیه می‌شود بعداً از طریق فرم "تخصیص دستی" (Manual Allocation)، این مبلغ را به فاکتورها وصل کنید تا گزارش سنی مطالبات (Aging) مشتری خراب نشود.</p>
<p><strong>س ۱۰: نرخ ارز تغییر کرده است. فاکتور با دلار ۵۰ تومن بوده، الان دلار ۵۵ تومن شده. این ۵ تومن اختلاف کجا می‌رود؟</strong>
* <strong>پاسخ:</strong> سیستم به صورت اتوماتیک محاسبه می‌کند.
    * شما فقط مبلغ دلاری (۱۰,۰۰۰) و نرخ روز (۵۵,۰۰۰) را وارد کنید.
    * سیستم بدهی ۵۰,۰۰۰ تومانی (قبلی) را می‌بندد و مابه‌التفاوت را در سطر <strong>«سود و زیان ناشی از تسعیر ارز»</strong> در سند حسابداری درج می‌کند. کاربر نیازی به محاسبه دستی ندارد.</p>
<p><strong>س ۱۱: آیا می‌توانم عکس فیش واریزی یا چک را به سند بچسبانم؟</strong>
* <strong>پاسخ:</strong> بله، در نوار ابزار بالا دکمه 📎 (Attachments) وجود دارد. توصیه اکید می‌شود تصویر چک و فیش را آپلود کنید تا در زمان حسابرسی یا گم شدن لاشه چک، مدرک داشته باشید.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u06a9\u067e\u06cc \u0634\u062f", "clipboard.copy": "\u06a9\u067e\u06cc \u06a9\u0631\u062f\u0646", "search.result.more.one": "1 \u0645\u0648\u0631\u062f \u062f\u06cc\u06af\u0631 \u062f\u0631 \u0627\u06cc\u0646 \u0635\u0641\u062d\u0647", "search.result.more.other": "# \u0645\u0648\u0631\u062f \u062f\u06cc\u06af\u0631 \u062f\u0631 \u0627\u06cc\u0646 \u0635\u0641\u062d\u0647", "search.result.none": "\u0633\u0646\u062f\u06cc \u06cc\u0627\u0641\u062a \u0646\u0634\u062f", "search.result.one": "1 \u0633\u0646\u062f \u06cc\u0627\u0641\u062a \u0634\u062f", "search.result.other": "# \u0633\u0646\u062f \u06cc\u0627\u0641\u062a \u0634\u062f", "search.result.placeholder": "\u0628\u0631\u0627\u06cc \u0634\u0631\u0648\u0639 \u062c\u0633\u062a\u062c\u0648 \u062a\u0627\u06cc\u067e \u06a9\u0646\u06cc\u062f", "search.result.term.missing": "\u0645\u0648\u062c\u0648\u062f \u0646\u06cc\u0633\u062a", "select.version": "\u0627\u0646\u062a\u062e\u0627\u0628 \u0648\u06cc\u0631\u0627\u06cc\u0634"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>